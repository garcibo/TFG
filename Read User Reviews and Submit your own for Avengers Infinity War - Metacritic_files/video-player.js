/* eslint-disable */
/**
 * video-player v3.1.8
 * Built 07/07/2021 at 10:19:20 PM (GMT+0000)
 * Includes:
 *   - hls.js v0.12.4
 *   - cvui v
 */
(function(){var define, require;
!function(){var a,b;(function(){function b(a,b,c){switch(c.length){case 0:return a.call(b);case 1:return a.call(b,c[0]);case 2:return a.call(b,c[0],c[1]);case 3:return a.call(b,c[0],c[1],c[2])}return a.apply(b,c)}function c(a,b){for(var c=-1,d=null==a?0:a.length;++c<d&&!1!==b(a[c],c,a););return a}function d(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(!b(a[c],c,a))return!1;return!0}function e(a,b){for(var c=-1,d=null==a?0:a.length,e=0,f=[];++c<d;){var g=a[c];b(g,c,a)&&(f[e++]=g)}return f}function f(a,b){return!!(null==a?0:a.length)&&n(a,b,0)>-1}function g(a,b,c){for(var d=-1,e=null==a?0:a.length;++d<e;)if(c(b,a[d]))return!0;return!1}function h(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e}function i(a,b){for(var c=-1,d=b.length,e=a.length;++c<d;)a[e+c]=b[c];return a}function j(a,b,c,d){var e=-1,f=null==a?0:a.length;for(d&&f&&(c=a[++e]);++e<f;)c=b(c,a[e],e,a);return c}function k(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function l(a){return a.split("")}function m(a,b,c,d){for(var e=a.length,f=c+(d?1:-1);d?f--:++f<e;)if(b(a[f],f,a))return f;return-1}function n(a,b,c){return b===b?G(a,b,c):m(a,p,c)}function o(a,b,c,d){for(var e=c-1,f=a.length;++e<f;)if(d(a[e],b))return e;return-1}function p(a){return a!==a}function q(a){return function(b){return null==b?Yd:b[a]}}function r(a){return function(b){return null==a?Yd:a[b]}}function s(a,b){var c=a.length;for(a.sort(b);c--;)a[c]=a[c].value;return a}function t(a,b){for(var c=-1,d=Array(a);++c<a;)d[c]=b(c);return d}function u(a){return function(b){return a(b)}}function v(a,b){return h(b,function(b){return a[b]})}function w(a,b){return a.has(b)}function x(a,b){for(var c=a.length,d=0;c--;)a[c]===b&&++d;return d}function y(a){return"\\"+fg[a]}function z(a,b){return null==a?Yd:a[b]}function A(a){return ag.test(a)}function B(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c}function C(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function D(a,b){return function(c){return a(b(c))}}function E(a,b){for(var c=-1,d=a.length,e=0,f=[];++c<d;){var g=a[c];g!==b&&g!==ce||(a[c]=ce,f[e++]=c)}return f}function F(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}function G(a,b,c){for(var d=c-1,e=a.length;++d<e;)if(a[d]===b)return d;return-1}function H(a){return A(a)?J(a):tg(a)}function I(a){return A(a)?K(a):l(a)}function J(a){for(var b=_f.lastIndex=0;_f.test(a);)++b;return b}function K(a){return a.match(_f)||[]}function L(a){if(ld(a)&&!Hh(a)&&!(a instanceof O)){if(a instanceof N)return a;if(Ag.call(a,"__wrapped__"))return Ac(a)}return new N(a)}function M(){}function N(a,b){this.__wrapped__=a,this.__actions__=[],this.__chain__=!!b,this.__index__=0,this.__values__=Yd}function O(a){this.__wrapped__=a,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Be,this.__views__=[]}function P(){var a=new O(this.__wrapped__);return a.__actions__=yb(this.__actions__),a.__dir__=this.__dir__,a.__filtered__=this.__filtered__,a.__iteratees__=yb(this.__iteratees__),a.__takeCount__=this.__takeCount__,a.__views__=yb(this.__views__),a}function Q(){if(this.__filtered__){var a=new O(this);a.__dir__=-1,a.__filtered__=!0}else a=this.clone(),a.__dir__*=-1;return a}function R(){var a=this.__wrapped__.value(),b=this.__dir__,c=Hh(a),d=b<0,e=c?a.length:0,f=$b(0,e,this.__views__),g=f.start,h=f.end,i=h-g,j=d?h:g-1,k=this.__iteratees__,l=k.length,m=0,n=Yg(i,this.__takeCount__);if(!c||!d&&e==i&&n==i)return lb(a,this.__actions__);var o=[];a:for(;i--&&m<n;){j+=b;for(var p=-1,q=a[j];++p<l;){var r=k[p],s=r.iteratee,t=r.type,u=s(q);if(t==ve)q=u;else if(!u){if(t==ue)continue a;break a}}o[m++]=q}return o}function S(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function T(){this.__data__=eh?eh(null):{},this.size=0}function U(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=b?1:0,b}function V(a){var b=this.__data__;if(eh){var c=b[a];return c===ae?Yd:c}return Ag.call(b,a)?b[a]:Yd}function W(a){var b=this.__data__;return eh?b[a]!==Yd:Ag.call(b,a)}function X(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=eh&&b===Yd?ae:b,this}function Y(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function Z(){this.__data__=[],this.size=0}function $(a){var b=this.__data__,c=ta(b,a);return!(c<0)&&(c==b.length-1?b.pop():Ng.call(b,c,1),--this.size,!0)}function _(a){var b=this.__data__,c=ta(b,a);return c<0?Yd:b[c][1]}function aa(a){return ta(this.__data__,a)>-1}function ba(a,b){var c=this.__data__,d=ta(c,a);return d<0?(++this.size,c.push([a,b])):c[d][1]=b,this}function ca(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function da(){this.size=0,this.__data__={hash:new S,map:new(ah||Y),string:new S}}function ea(a){var b=Wb(this,a).delete(a);return this.size-=b?1:0,b}function fa(a){return Wb(this,a).get(a)}function ga(a){return Wb(this,a).has(a)}function ha(a,b){var c=Wb(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this}function ia(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new ca;++b<c;)this.add(a[b])}function ja(a){return this.__data__.set(a,ae),this}function ka(a){return this.__data__.has(a)}function la(a){var b=this.__data__=new Y(a);this.size=b.size}function ma(){this.__data__=new Y,this.size=0}function na(a){var b=this.__data__,c=b.delete(a);return this.size=b.size,c}function oa(a){return this.__data__.get(a)}function pa(a){return this.__data__.has(a)}function qa(a,b){var c=this.__data__;if(c instanceof Y){var d=c.__data__;if(!ah||d.length<$d-1)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new ca(d)}return c.set(a,b),this.size=c.size,this}function ra(a,b){var c=Hh(a),d=!c&&Gh(a),e=!c&&!d&&Ih(a),f=!c&&!d&&!e&&Mh(a),g=c||d||e||f,h=g?t(a.length,String):[],i=h.length;for(var j in a)!b&&!Ag.call(a,j)||g&&("length"==j||e&&("offset"==j||"parent"==j)||f&&("buffer"==j||"byteLength"==j||"byteOffset"==j)||gc(j,i))||h.push(j);return h}function sa(a,b,c){var d=a[b];Ag.call(a,b)&&cd(d,c)&&(c!==Yd||b in a)||wa(a,b,c)}function ta(a,b){for(var c=a.length;c--;)if(cd(a[c][0],b))return c;return-1}function ua(a,b){return a&&zb(b,Cd(b),a)}function va(a,b){return a&&zb(b,Dd(b),a)}function wa(a,b,c){"__proto__"==b&&Rg?Rg(a,b,{configurable:!0,enumerable:!0,value:c,writable:!0}):a[b]=c}function xa(a,b){for(var c=-1,d=b.length,e=Array(d),f=null==a;++c<d;)e[c]=f?Yd:zd(a,b[c]);return e}function ya(a,b,c){return a===a&&(c!==Yd&&(a=a<=c?a:c),b!==Yd&&(a=a>=b?a:b)),a}function za(a,b,d,e,f,g){var h,i=b&de,j=b&ee,k=b&fe;if(d&&(h=f?d(a,e,f,g):d(a)),h!==Yd)return h;if(!kd(a))return a;var l=Hh(a);if(l){if(h=bc(a),!i)return yb(a,h)}else{var m=xh(a),n=m==Ke||m==Le;if(Ih(a))return ob(a,i);if(m==Pe||m==De||n&&!f){if(h=j||n?{}:cc(a),!i)return j?Bb(a,va(h,a)):Ab(a,ua(h,a))}else{if(!dg[m])return f?a:{};h=dc(a,m,i)}}g||(g=new la);var o=g.get(a);if(o)return o;if(g.set(a,h),Lh(a))return a.forEach(function(c){h.add(za(c,b,d,c,a,g))}),h;if(Kh(a))return a.forEach(function(c,e){h.set(e,za(c,b,d,e,a,g))}),h;var p=k?j?Sb:Rb:j?Dd:Cd,q=l?Yd:p(a);return c(q||a,function(c,e){q&&(e=c,c=a[e]),sa(h,e,za(c,b,d,e,a,g))}),h}function Aa(a,b,c,d){var e=-1,i=f,j=!0,k=a.length,l=[],m=b.length;if(!k)return l;c&&(b=h(b,u(c))),d?(i=g,j=!1):b.length>=$d&&(i=w,j=!1,b=new ia(b));a:for(;++e<k;){var n=a[e],o=null==c?n:c(n);if(n=d||0!==n?n:0,j&&o===o){for(var p=m;p--;)if(b[p]===o)continue a;l.push(n)}else i(b,o,d)||l.push(n)}return l}function Ba(a,b){var c=!0;return qh(a,function(a,d,e){return c=!!b(a,d,e)}),c}function Ca(a,b,c){for(var d=-1,e=a.length;++d<e;){var f=a[d],g=b(f);if(null!=g&&(h===Yd?g===g&&!rd(g):c(g,h)))var h=g,i=f}return i}function Da(a,b,c,d,e){var f=-1,g=a.length;for(c||(c=fc),e||(e=[]);++f<g;){var h=a[f];b>0&&c(h)?b>1?Da(h,b-1,c,d,e):i(e,h):d||(e[e.length]=h)}return e}function Ea(a,b){return a&&rh(a,b,Cd)}function Fa(a,b){return e(b,function(b){return id(a[b])})}function Ga(a,b){b=mb(b,a);for(var c=0,d=b.length;null!=a&&c<d;)a=a[xc(b[c++])];return c&&c==d?a:Yd}function Ha(a,b,c){var d=b(a);return Hh(a)?d:i(d,c(a))}function Ia(a){return null==a?a===Yd?We:Oe:Qg&&Qg in Object(a)?Zb(a):rc(a)}function Ja(a,b){return null!=a&&Ag.call(a,b)}function Ka(a,b){return null!=a&&b in Object(a)}function La(a,b,c){return a>=Yg(b,c)&&a<Xg(b,c)}function Ma(a,c,d){c=mb(c,a),a=tc(a,c);var e=null==a?a:a[xc(Gc(c))];return null==e?Yd:b(e,a,d)}function Na(a){return ld(a)&&Ia(a)==De}function Oa(a){return ld(a)&&Ia(a)==He}function Pa(a,b,c,d,e){return a===b||(null==a||null==b||!ld(a)&&!ld(b)?a!==a&&b!==b:Qa(a,b,c,d,Pa,e))}function Qa(a,b,c,d,e,f){var g=Hh(a),h=Hh(b),i=g?Ee:xh(a),j=h?Ee:xh(b);i=i==De?Pe:i,j=j==De?Pe:j;var k=i==Pe,l=j==Pe,m=i==j;if(m&&Ih(a)){if(!Ih(b))return!1;g=!0,k=!1}if(m&&!k)return f||(f=new la),g||Mh(a)?Nb(a,b,c,d,e,f):Ob(a,b,i,c,d,e,f);if(!(c&ge)){var n=k&&Ag.call(a,"__wrapped__"),o=l&&Ag.call(b,"__wrapped__");if(n||o){var p=n?a.value():a,q=o?b.value():b;return f||(f=new la),e(p,q,c,d,f)}}return!!m&&(f||(f=new la),Pb(a,b,c,d,e,f))}function Ra(a){return ld(a)&&xh(a)==Me}function Sa(a,b,c,d){var e=c.length,f=e,g=!d;if(null==a)return!f;for(a=Object(a);e--;){var h=c[e];if(g&&h[2]?h[1]!==a[h[0]]:!(h[0]in a))return!1}for(;++e<f;){h=c[e];var i=h[0],j=a[i],k=h[1];if(g&&h[2]){if(j===Yd&&!(i in a))return!1}else{var l=new la;if(d)var m=d(j,k,i,a,b,l);if(!(m===Yd?Pa(k,j,ge|he,d,l):m))return!1}}return!0}function Ta(a){return!(!kd(a)||lc(a))&&(id(a)?Fg:Df).test(yc(a))}function Ua(a){return ld(a)&&xh(a)==Te}function Va(a){return ld(a)&&jd(a.length)&&!!cg[Ia(a)]}function Wa(a){return"function"==typeof a?a:null==a?Pd:"object"==typeof a?Hh(a)?ab(a[0],a[1]):_a(a):Ud(a)}function Xa(a){if(!mc(a))return Wg(a);var b=[];for(var c in Object(a))Ag.call(a,c)&&"constructor"!=c&&b.push(c);return b}function Ya(a){if(!kd(a))return qc(a);var b=mc(a),c=[];for(var d in a)("constructor"!=d||!b&&Ag.call(a,d))&&c.push(d);return c}function Za(a,b){return a<b}function $a(a,b){var c=-1,d=dd(a)?Array(a.length):[];return qh(a,function(a,e,f){d[++c]=b(a,e,f)}),d}function _a(a){var b=Xb(a);return 1==b.length&&b[0][2]?oc(b[0][0],b[0][1]):function(c){return c===a||Sa(c,a,b)}}function ab(a,b){return ic(a)&&nc(b)?oc(xc(a),b):function(c){var d=zd(c,a);return d===Yd&&d===b?Bd(c,a):Pa(b,d,ge|he)}}function bb(a,b,c){var d=-1;return b=h(b.length?b:[Pd],u(Vb())),s($a(a,function(a,c,e){return{criteria:h(b,function(b){return b(a)}),index:++d,value:a}}),function(a,b){return vb(a,b,c)})}function cb(a,b,c){for(var d=-1,e=b.length,f={};++d<e;){var g=b[d],h=Ga(a,g);c(h,g)&&hb(f,mb(g,a),h)}return f}function db(a){return function(b){return Ga(b,a)}}function eb(a,b,c,d){var e=d?o:n,f=-1,g=b.length,i=a;for(a===b&&(b=yb(b)),c&&(i=h(a,u(c)));++f<g;)for(var j=0,k=b[f],l=c?c(k):k;(j=e(i,l,j,d))>-1;)i!==a&&Ng.call(i,j,1),Ng.call(a,j,1);return a}function fb(a,b){var c="";if(!a||b<1||b>ye)return c;do{b%2&&(c+=a),(b=Tg(b/2))&&(a+=a)}while(b);return c}function gb(a,b){return zh(sc(a,b,Pd),a+"")}function hb(a,b,c,d){if(!kd(a))return a;b=mb(b,a);for(var e=-1,f=b.length,g=f-1,h=a;null!=h&&++e<f;){var i=xc(b[e]),j=c;if(e!=g){var k=h[i];j=d?d(k,i,h):Yd,j===Yd&&(j=kd(k)?k:gc(b[e+1])?[]:{})}sa(h,i,j),h=h[i]}return a}function ib(a,b,c){var d=-1,e=a.length;b<0&&(b=-b>e?0:e+b),c=c>e?e:c,c<0&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}function jb(a,b){var c;return qh(a,function(a,d,e){return!(c=b(a,d,e))}),!!c}function kb(a){if("string"==typeof a)return a;if(Hh(a))return h(a,kb)+"";if(rd(a))return oh?oh.call(a):"";var b=a+"";return"0"==b&&1/a==-xe?"-0":b}function lb(a,b){var c=a;return c instanceof O&&(c=c.value()),j(b,function(a,b){return b.func.apply(b.thisArg,i([a],b.args))},c)}function mb(a,b){return Hh(a)?a:ic(a,b)?[a]:Ah(xd(a))}function nb(a,b,c){var d=a.length;return c=c===Yd?d:c,!b&&c>=d?a:ib(a,b,c)}function ob(a,b){if(b)return a.slice();var c=a.length,d=Jg?Jg(c):new a.constructor(c);return a.copy(d),d}function pb(a){var b=new a.constructor(a.byteLength);return new Ig(b).set(new Ig(a)),b}function qb(a,b){var c=b?pb(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.byteLength)}function rb(a){var b=new a.constructor(a.source,Af.exec(a));return b.lastIndex=a.lastIndex,b}function sb(a){return nh?Object(nh.call(a)):{}}function tb(a,b){var c=b?pb(a.buffer):a.buffer;return new a.constructor(c,a.byteOffset,a.length)}function ub(a,b){if(a!==b){var c=a!==Yd,d=null===a,e=a===a,f=rd(a),g=b!==Yd,h=null===b,i=b===b,j=rd(b);if(!h&&!j&&!f&&a>b||f&&g&&i&&!h&&!j||d&&g&&i||!c&&i||!e)return 1;if(!d&&!f&&!j&&a<b||j&&c&&e&&!d&&!f||h&&c&&e||!g&&e||!i)return-1}return 0}function vb(a,b,c){for(var d=-1,e=a.criteria,f=b.criteria,g=e.length,h=c.length;++d<g;){var i=ub(e[d],f[d]);if(i){if(d>=h)return i;return i*("desc"==c[d]?-1:1)}}return a.index-b.index}function wb(a,b,c,d){for(var e=-1,f=a.length,g=c.length,h=-1,i=b.length,j=Xg(f-g,0),k=Array(i+j),l=!d;++h<i;)k[h]=b[h];for(;++e<g;)(l||e<f)&&(k[c[e]]=a[e]);for(;j--;)k[h++]=a[e++];return k}function xb(a,b,c,d){for(var e=-1,f=a.length,g=-1,h=c.length,i=-1,j=b.length,k=Xg(f-h,0),l=Array(k+j),m=!d;++e<k;)l[e]=a[e];for(var n=e;++i<j;)l[n+i]=b[i];for(;++g<h;)(m||e<f)&&(l[n+c[g]]=a[e++]);return l}function yb(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b}function zb(a,b,c,d){var e=!c;c||(c={});for(var f=-1,g=b.length;++f<g;){var h=b[f],i=d?d(c[h],a[h],h,c,a):Yd;i===Yd&&(i=a[h]),e?wa(c,h,i):sa(c,h,i)}return c}function Ab(a,b){return zb(a,vh(a),b)}function Bb(a,b){return zb(a,wh(a),b)}function Cb(a){return gb(function(b,c){var d=-1,e=c.length,f=e>1?c[e-1]:Yd,g=e>2?c[2]:Yd;for(f=a.length>3&&"function"==typeof f?(e--,f):Yd,g&&hc(c[0],c[1],g)&&(f=e<3?Yd:f,e=1),b=Object(b);++d<e;){var h=c[d];h&&a(b,h,d,f)}return b})}function Db(a,b){return function(c,d){if(null==c)return c;if(!dd(c))return a(c,d);for(var e=c.length,f=b?e:-1,g=Object(c);(b?f--:++f<e)&&!1!==d(g[f],f,g););return c}}function Eb(a){return function(b,c,d){for(var e=-1,f=Object(b),g=d(b),h=g.length;h--;){var i=g[a?h:++e];if(!1===c(f[i],i,f))break}return b}}function Fb(a){return function(b){b=xd(b);var c=A(b)?I(b):Yd,d=c?c[0]:b.charAt(0),e=c?nb(c,1).join(""):b.slice(1);return d[a]()+e}}function Gb(a){return function(){var b=arguments;switch(b.length){case 0:return new a;case 1:return new a(b[0]);case 2:return new a(b[0],b[1]);case 3:return new a(b[0],b[1],b[2]);case 4:return new a(b[0],b[1],b[2],b[3]);case 5:return new a(b[0],b[1],b[2],b[3],b[4]);case 6:return new a(b[0],b[1],b[2],b[3],b[4],b[5]);case 7:return new a(b[0],b[1],b[2],b[3],b[4],b[5],b[6])}var c=ph(a.prototype),d=a.apply(c,b);return kd(d)?d:c}}function Hb(a){return function(b,c,d){var e=Object(b);if(!dd(b)){var f=Vb(c,3);b=Cd(b),c=function(a){return f(e[a],a,e)}}var g=a(b,c,d);return g>-1?e[f?b[g]:g]:Yd}}function Ib(a,b,c,d,e,f,g,h,i,j){function k(){for(var r=arguments.length,s=Array(r),t=r;t--;)s[t]=arguments[t];if(o)var u=Ub(k),v=x(s,u);if(d&&(s=wb(s,d,e,o)),f&&(s=xb(s,f,g,o)),r-=v,o&&r<j){var w=E(s,u);return Kb(a,b,Ib,k.placeholder,c,s,w,h,i,j-r)}var y=m?c:this,z=n?y[a]:a;return r=s.length,h?s=uc(s,h):p&&r>1&&s.reverse(),l&&i<r&&(s.length=i),this&&this!==jg&&this instanceof k&&(z=q||Gb(z)),z.apply(y,s)}var l=b&pe,m=b&ie,n=b&je,o=b&(le|me),p=b&re,q=n?Yd:Gb(a);return k}function Jb(a,b){b=b===Yd?" ":kb(b);var c=b.length;if(c<2)return c?fb(b,a):b;var d=fb(b,Sg(a/H(b)));return A(b)?nb(I(d),0,a).join(""):d.slice(0,a)}function Kb(a,b,c,d,e,f,g,h,i,j){var k=b&le,l=k?g:Yd,m=k?Yd:g,n=k?f:Yd,o=k?Yd:f;b|=k?ne:oe,(b&=~(k?oe:ne))&ke||(b&=~(ie|je));var p=[a,b,e,n,l,o,m,h,i,j],q=c.apply(Yd,p);return kc(a)&&yh(q,p),q.placeholder=d,vc(q,a,b)}function Lb(a){var b=Math[a];return function(a,c){if(a=wd(a),c=null==c?0:Yg(vd(c),292)){var d=(xd(a)+"e").split("e");return d=(xd(b(d[0]+"e"+(+d[1]+c)))+"e").split("e"),+(d[0]+"e"+(+d[1]-c))}return b(a)}}function Mb(a,b,c,d){return a===Yd||cd(a,xg[c])&&!Ag.call(d,c)?b:a}function Nb(a,b,c,d,e,f){var g=c&ge,h=a.length,i=b.length;if(h!=i&&!(g&&i>h))return!1;var j=f.get(a);if(j&&f.get(b))return j==b;var l=-1,m=!0,n=c&he?new ia:Yd;for(f.set(a,b),f.set(b,a);++l<h;){var o=a[l],p=b[l];if(d)var q=g?d(p,o,l,b,a,f):d(o,p,l,a,b,f);if(q!==Yd){if(q)continue;m=!1;break}if(n){if(!k(b,function(a,b){if(!w(n,b)&&(o===a||e(o,a,c,d,f)))return n.push(b)})){m=!1;break}}else if(o!==p&&!e(o,p,c,d,f)){m=!1;break}}return f.delete(a),f.delete(b),m}function Ob(a,b,c,d,e,f,g){switch(c){case Ze:if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)return!1;a=a.buffer,b=b.buffer;case Ye:return!(a.byteLength!=b.byteLength||!f(new Ig(a),new Ig(b)));case Ge:case He:case Ne:return cd(+a,+b);case Je:return a.name==b.name&&a.message==b.message;case Se:case Ue:return a==b+"";case Me:var h=C;case Te:var i=d&ge;if(h||(h=F),a.size!=b.size&&!i)return!1;var j=g.get(a);if(j)return j==b;d|=he,g.set(a,b);var k=Nb(h(a),h(b),d,e,f,g);return g.delete(a),k;case Ve:if(nh)return nh.call(a)==nh.call(b)}return!1}function Pb(a,b,c,d,e,f){var g=c&ge,h=Rb(a),i=h.length;if(i!=Rb(b).length&&!g)return!1;for(var j=i;j--;){var k=h[j];if(!(g?k in b:Ag.call(b,k)))return!1}var l=f.get(a);if(l&&f.get(b))return l==b;var m=!0;f.set(a,b),f.set(b,a);for(var n=g;++j<i;){k=h[j];var o=a[k],p=b[k];if(d)var q=g?d(p,o,k,b,a,f):d(o,p,k,a,b,f);if(!(q===Yd?o===p||e(o,p,c,d,f):q)){m=!1;break}n||(n="constructor"==k)}if(m&&!n){var r=a.constructor,s=b.constructor;r!=s&&"constructor"in a&&"constructor"in b&&!("function"==typeof r&&r instanceof r&&"function"==typeof s&&s instanceof s)&&(m=!1)}return f.delete(a),f.delete(b),m}function Qb(a){return zh(sc(a,Yd,Ec),a+"")}function Rb(a){return Ha(a,Cd,vh)}function Sb(a){return Ha(a,Dd,wh)}function Tb(a){for(var b=a.name+"",c=gh[b],d=Ag.call(gh,b)?c.length:0;d--;){var e=c[d],f=e.func;if(null==f||f==a)return e.name}return b}function Ub(a){return(Ag.call(L,"placeholder")?L:a).placeholder}function Vb(){var a=L.iteratee||Qd;return a=a===Qd?Wa:a,arguments.length?a(arguments[0],arguments[1]):a}function Wb(a,b){var c=a.__data__;return jc(b)?c["string"==typeof b?"string":"hash"]:c.map}function Xb(a){for(var b=Cd(a),c=b.length;c--;){var d=b[c],e=a[d];b[c]=[d,e,nc(e)]}return b}function Yb(a,b){var c=z(a,b);return Ta(c)?c:Yd}function Zb(a){var b=Ag.call(a,Qg),c=a[Qg];try{a[Qg]=Yd;var d=!0}catch(a){}var e=Cg.call(a);return d&&(b?a[Qg]=c:delete a[Qg]),e}function $b(a,b,c){for(var d=-1,e=c.length;++d<e;){var f=c[d],g=f.size;switch(f.type){case"drop":a+=g;break;case"dropRight":b-=g;break;case"take":b=Yg(b,a+g);break;case"takeRight":a=Xg(a,b-g)}}return{start:a,end:b}}function _b(a){var b=a.match(wf);return b?b[1].split(xf):[]}function ac(a,b,c){b=mb(b,a);for(var d=-1,e=b.length,f=!1;++d<e;){var g=xc(b[d]);if(!(f=null!=a&&c(a,g)))break;a=a[g]}return f||++d!=e?f:!!(e=null==a?0:a.length)&&jd(e)&&gc(g,e)&&(Hh(a)||Gh(a))}function bc(a){var b=a.length,c=new a.constructor(b);return b&&"string"==typeof a[0]&&Ag.call(a,"index")&&(c.index=a.index,c.input=a.input),c}function cc(a){return"function"!=typeof a.constructor||mc(a)?{}:ph(Kg(a))}function dc(a,b,c){var d=a.constructor;switch(b){case Ye:return pb(a);case Ge:case He:return new d(+a);case Ze:return qb(a,c);case $e:case _e:case af:case bf:case cf:case df:case ef:case ff:case gf:return tb(a,c);case Me:return new d;case Ne:case Ue:return new d(a);case Se:return rb(a);case Te:return new d;case Ve:return sb(a)}}function ec(a,b){var c=b.length;if(!c)return a;var d=c-1;return b[d]=(c>1?"& ":"")+b[d],b=b.join(c>2?", ":" "),a.replace(vf,"{\n/* [wrapped with "+b+"] */\n")}function fc(a){return Hh(a)||Gh(a)||!!(Og&&a&&a[Og])}function gc(a,b){var c=typeof a;return!!(b=null==b?ye:b)&&("number"==c||"symbol"!=c&&Ff.test(a))&&a>-1&&a%1==0&&a<b}function hc(a,b,c){if(!kd(c))return!1;var d=typeof b;return!!("number"==d?dd(c)&&gc(b,c.length):"string"==d&&b in c)&&cd(c[b],a)}function ic(a,b){if(Hh(a))return!1;var c=typeof a;return!("number"!=c&&"symbol"!=c&&"boolean"!=c&&null!=a&&!rd(a))||(rf.test(a)||!qf.test(a)||null!=b&&a in Object(b))}function jc(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a}function kc(a){var b=Tb(a),c=L[b];if("function"!=typeof c||!(b in O.prototype))return!1;if(a===c)return!0;var d=uh(c);return!!d&&a===d[0]}function lc(a){return!!Bg&&Bg in a}function mc(a){var b=a&&a.constructor;return a===("function"==typeof b&&b.prototype||xg)}function nc(a){return a===a&&!kd(a)}function oc(a,b){return function(c){return null!=c&&(c[a]===b&&(b!==Yd||a in Object(c)))}}function pc(a){var b=Zc(a,function(a){return c.size===be&&c.clear(),a}),c=b.cache;return b}function qc(a){var b=[];if(null!=a)for(var c in Object(a))b.push(c);return b}function rc(a){return Cg.call(a)}function sc(a,c,d){return c=Xg(c===Yd?a.length-1:c,0),function(){for(var e=arguments,f=-1,g=Xg(e.length-c,0),h=Array(g);++f<g;)h[f]=e[c+f];f=-1;for(var i=Array(c+1);++f<c;)i[f]=e[f];return i[c]=d(h),b(a,this,i)}}function tc(a,b){return b.length<2?a:Ga(a,ib(b,0,-1))}function uc(a,b){for(var c=a.length,d=Yg(b.length,c),e=yb(a);d--;){var f=b[d];a[d]=gc(f,c)?e[f]:Yd}return a}function vc(a,b,c){var d=b+"";return zh(a,ec(d,zc(_b(d),c)))}function wc(a){var b=0,c=0;return function(){var d=Zg(),e=te-(d-c);if(c=d,e>0){if(++b>=se)return arguments[0]}else b=0;return a.apply(Yd,arguments)}}function xc(a){if("string"==typeof a||rd(a))return a;var b=a+"";return"0"==b&&1/a==-xe?"-0":b}function yc(a){if(null!=a){try{return zg.call(a)}catch(a){}try{return a+""}catch(a){}}return""}function zc(a,b){return c(Ce,function(c){var d="_."+c[0];b&c[1]&&!f(a,d)&&a.push(d)}),a.sort()}function Ac(a){if(a instanceof O)return a.clone();var b=new N(a.__wrapped__,a.__chain__);return b.__actions__=yb(a.__actions__),b.__index__=a.__index__,b.__values__=a.__values__,b}function Bc(a){for(var b=-1,c=null==a?0:a.length,d=0,e=[];++b<c;){var f=a[b];f&&(e[d++]=f)}return e}function Cc(a,b,c){var d=null==a?0:a.length;return d?(b=c||b===Yd?1:vd(b),ib(a,b<0?0:b,d)):[]}function Dc(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=null==c?0:vd(c);return e<0&&(e=Xg(d+e,0)),m(a,Vb(b,3),e)}function Ec(a){return(null==a?0:a.length)?Da(a,1):[]}function Fc(a,b,c){var d=null==a?0:a.length;if(!d)return-1;var e=null==c?0:vd(c);return e<0&&(e=Xg(d+e,0)),n(a,b,e)}function Gc(a){var b=null==a?0:a.length;return b?a[b-1]:Yd}function Hc(a,b){return a&&a.length&&b&&b.length?eb(a,b):a}function Ic(a){return null==a?a:$g.call(a)}function Jc(a){var b=L(a);return b.__chain__=!0,b}function Kc(a,b){return b(a),a}function Lc(a,b){return b(a)}function Mc(){return Jc(this)}function Nc(){return new N(this.value(),this.__chain__)}function Oc(){this.__values__===Yd&&(this.__values__=td(this.value()));var a=this.__index__>=this.__values__.length;return{done:a,value:a?Yd:this.__values__[this.__index__++]}}function Pc(){return this}function Qc(a){for(var b,c=this;c instanceof M;){var d=Ac(c);d.__index__=0,d.__values__=Yd,b?e.__wrapped__=d:b=d;var e=d;c=c.__wrapped__}return e.__wrapped__=a,b}function Rc(){var a=this.__wrapped__;if(a instanceof O){var b=a;return this.__actions__.length&&(b=new O(this)),b=b.reverse(),b.__actions__.push({func:Lc,args:[Ic],thisArg:Yd}),new N(b,this.__chain__)}return this.thru(Ic)}function Sc(){return lb(this.__wrapped__,this.__actions__)}function Tc(a,b,c){var e=Hh(a)?d:Ba;return c&&hc(a,b,c)&&(b=Yd),e(a,Vb(b,3))}function Uc(a,b){return(Hh(a)?c:qh)(a,Vb(b,3))}function Vc(a,b,c,d){a=dd(a)?a:Gd(a),c=c&&!d?vd(c):0;var e=a.length;return c<0&&(c=Xg(e+c,0)),qd(a)?c<=e&&a.indexOf(b,c)>-1:!!e&&n(a,b,c)>-1}function Wc(a,b){return(Hh(a)?h:$a)(a,Vb(b,3))}function Xc(a,b,c){var d=Hh(a)?k:jb;return c&&hc(a,b,c)&&(b=Yd),d(a,Vb(b,3))}function Yc(a,b,c){function d(b){var c=m,d=n;return m=n=Yd,s=b,p=a.apply(d,c)}function e(a){return s=a,q=setTimeout(h,b),t?d(a):p}function f(a){var c=a-r,d=a-s,e=b-c;return u?Yg(e,o-d):e}function g(a){var c=a-r,d=a-s;return r===Yd||c>=b||c<0||u&&d>=o}function h(){var a=Fh();if(g(a))return i(a);q=setTimeout(h,f(a))}function i(a){return q=Yd,v&&m?d(a):(m=n=Yd,p)}function j(){q!==Yd&&clearTimeout(q),s=0,m=r=n=q=Yd}function k(){return q===Yd?p:i(Fh())}function l(){var a=Fh(),c=g(a);if(m=arguments,n=this,r=a,c){if(q===Yd)return e(r);if(u)return q=setTimeout(h,b),d(r)}return q===Yd&&(q=setTimeout(h,b)),p}var m,n,o,p,q,r,s=0,t=!1,u=!1,v=!0;if("function"!=typeof a)throw new TypeError(_d);return b=wd(b)||0,kd(c)&&(t=!!c.leading,u="maxWait"in c,o=u?Xg(wd(c.maxWait)||0,b):o,v="trailing"in c?!!c.trailing:v),l.cancel=j,l.flush=k,l}function Zc(a,b){if("function"!=typeof a||null!=b&&"function"!=typeof b)throw new TypeError(_d);var c=function(){var d=arguments,e=b?b.apply(this,d):d[0],f=c.cache;if(f.has(e))return f.get(e);var g=a.apply(this,d);return c.cache=f.set(e,g)||f,g};return c.cache=new(Zc.Cache||ca),c}function $c(a){if("function"!=typeof a)throw new TypeError(_d);return function(){var b=arguments;switch(b.length){case 0:return!a.call(this);case 1:return!a.call(this,b[0]);case 2:return!a.call(this,b[0],b[1]);case 3:return!a.call(this,b[0],b[1],b[2])}return!a.apply(this,b)}}function _c(a,b,c){var d=!0,e=!0;if("function"!=typeof a)throw new TypeError(_d);return kd(c)&&(d="leading"in c?!!c.leading:d,e="trailing"in c?!!c.trailing:e),Yc(a,b,{leading:d,maxWait:b,trailing:e})}function ad(a){return za(a,fe)}function bd(a){return za(a,de|fe)}function cd(a,b){return a===b||a!==a&&b!==b}function dd(a){return null!=a&&jd(a.length)&&!id(a)}function ed(a){return ld(a)&&dd(a)}function fd(a){return!0===a||!1===a||ld(a)&&Ia(a)==Ge}function gd(a){if(null==a)return!0;if(dd(a)&&(Hh(a)||"string"==typeof a||"function"==typeof a.splice||Ih(a)||Mh(a)||Gh(a)))return!a.length;var b=xh(a);if(b==Me||b==Te)return!a.size;if(mc(a))return!Xa(a).length;for(var c in a)if(Ag.call(a,c))return!1;return!0}function hd(a){if(!ld(a))return!1;var b=Ia(a);return b==Je||b==Ie||"string"==typeof a.message&&"string"==typeof a.name&&!pd(a)}function id(a){if(!kd(a))return!1;var b=Ia(a);return b==Ke||b==Le||b==Fe||b==Re}function jd(a){return"number"==typeof a&&a>-1&&a%1==0&&a<=ye}function kd(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function ld(a){return null!=a&&"object"==typeof a}function md(a){return od(a)&&a!=+a}function nd(a){return null===a}function od(a){return"number"==typeof a||ld(a)&&Ia(a)==Ne}function pd(a){if(!ld(a)||Ia(a)!=Pe)return!1;var b=Kg(a);if(null===b)return!0;var c=Ag.call(b,"constructor")&&b.constructor;return"function"==typeof c&&c instanceof c&&zg.call(c)==Dg}function qd(a){return"string"==typeof a||!Hh(a)&&ld(a)&&Ia(a)==Ue}function rd(a){return"symbol"==typeof a||ld(a)&&Ia(a)==Ve}function sd(a){return a===Yd}function td(a){if(!a)return[];if(dd(a))return qd(a)?I(a):yb(a);if(Pg&&a[Pg])return B(a[Pg]());var b=xh(a);return(b==Me?C:b==Te?F:Gd)(a)}function ud(a){if(!a)return 0===a?a:0;if((a=wd(a))===xe||a===-xe){return(a<0?-1:1)*ze}return a===a?a:0}function vd(a){var b=ud(a),c=b%1;return b===b?c?b-c:b:0}function wd(a){if("number"==typeof a)return a;if(rd(a))return Ae;if(kd(a)){var b="function"==typeof a.valueOf?a.valueOf():a;a=kd(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(uf,"");var c=Cf.test(a);return c||Ef.test(a)?gg(a.slice(2),c?2:8):Bf.test(a)?Ae:+a}function xd(a){return null==a?"":kb(a)}function yd(a,b){return a&&Ea(a,Vb(b,3))}function zd(a,b,c){var d=null==a?Yd:Ga(a,b);return d===Yd?c:d}function Ad(a,b){return null!=a&&ac(a,b,Ja)}function Bd(a,b){return null!=a&&ac(a,b,Ka)}function Cd(a){return dd(a)?ra(a):Xa(a)}function Dd(a){return dd(a)?ra(a,!0):Ya(a)}function Ed(a,b){return Fd(a,$c(Vb(b)))}function Fd(a,b){if(null==a)return{};var c=h(Sb(a),function(a){return[a]});return b=Vb(b),cb(a,c,function(a,c){return b(a,c[0])})}function Gd(a){return null==a?[]:v(a,Cd(a))}function Hd(a,b,c){return b=ud(b),c===Yd?(c=b,b=0):c=ud(c),a=wd(a),La(a,b,c)}function Id(a){return Qh(xd(a).toLowerCase())}function Jd(a,b,c){a=xd(a),b=kb(b);var d=a.length;c=c===Yd?d:ya(vd(c),0,d);var e=c;return(c-=b.length)>=0&&a.slice(c,e)==b}function Kd(a){return a=xd(a),a&&mf.test(a)?a.replace(lf,ug):a}function Ld(a,b,c){a=xd(a),b=vd(b);var d=b?H(a):0;return b&&d<b?Jb(b-d,c)+a:a}function Md(a,b,c){return a=xd(a),c=null==c?0:ya(vd(c),0,a.length),b=kb(b),a.slice(c,c+b.length)==b}function Nd(a,b,c){var d=L.templateSettings;c&&hc(a,b,c)&&(b=Yd),a=xd(a),b=Ph({},b,d,Mb);var e,f,g=Ph({},b.imports,d.imports,Mb),h=Cd(g),i=v(g,h),j=0,k=b.interpolate||Gf,l="__p += '",m=RegExp((b.escape||Gf).source+"|"+k.source+"|"+(k===pf?zf:Gf).source+"|"+(b.evaluate||Gf).source+"|$","g"),n="//# sourceURL="+("sourceURL"in b?b.sourceURL:"lodash.templateSources["+ ++bg+"]")+"\n";a.replace(m,function(b,c,d,g,h,i){return d||(d=g),l+=a.slice(j,i).replace(Hf,y),c&&(e=!0,l+="' +\n__e("+c+") +\n'"),h&&(f=!0,l+="';\n"+h+";\n__p += '"),d&&(l+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),j=i+b.length,b}),l+="';\n";var o=b.variable;o||(l="with (obj) {\n"+l+"\n}\n"),l=(f?l.replace(hf,""):l).replace(jf,"$1").replace(kf,"$1;"),l="function("+(o||"obj")+") {\n"+(o?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(e?", __e = _.escape":"")+(f?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+l+"return __p\n}";var p=Rh(function(){return Function(h,n+"return "+l).apply(Yd,i)});if(p.source=l,hd(p))throw p;return p}function Od(a){return function(){return a}}function Pd(a){return a}function Qd(a){return Wa("function"==typeof a?a:za(a,de))}function Rd(a,b,d){var e=Cd(b),f=Fa(b,e);null!=d||kd(b)&&(f.length||!e.length)||(d=b,b=a,a=this,f=Fa(b,Cd(b)));var g=!(kd(d)&&"chain"in d&&!d.chain),h=id(a);return c(f,function(c){var d=b[c];a[c]=d,h&&(a.prototype[c]=function(){var b=this.__chain__;if(g||b){var c=a(this.__wrapped__);return(c.__actions__=yb(this.__actions__)).push({func:d,args:arguments,thisArg:a}),c.__chain__=b,c}return d.apply(a,i([this.value()],arguments))})}),a}function Sd(){return jg._===this&&(jg._=Eg),this}function Td(){}function Ud(a){return ic(a)?q(xc(a)):db(a)}function Vd(){return[]}function Wd(){return!1}function Xd(a){return a&&a.length?Ca(a,Pd,Za):Yd}var Yd,Zd="4.17.5",$d=200,_d="Expected a function",ae="__lodash_hash_undefined__",be=500,ce="__lodash_placeholder__",de=1,ee=2,fe=4,ge=1,he=2,ie=1,je=2,ke=4,le=8,me=16,ne=32,oe=64,pe=128,qe=256,re=512,se=800,te=16,ue=1,ve=2,we=3,xe=1/0,ye=9007199254740991,ze=1.7976931348623157e308,Ae=NaN,Be=4294967295,Ce=[["ary",pe],["bind",ie],["bindKey",je],["curry",le],["curryRight",me],["flip",re],["partial",ne],["partialRight",oe],["rearg",qe]],De="[object Arguments]",Ee="[object Array]",Fe="[object AsyncFunction]",Ge="[object Boolean]",He="[object Date]",Ie="[object DOMException]",Je="[object Error]",Ke="[object Function]",Le="[object GeneratorFunction]",Me="[object Map]",Ne="[object Number]",Oe="[object Null]",Pe="[object Object]",Qe="[object Promise]",Re="[object Proxy]",Se="[object RegExp]",Te="[object Set]",Ue="[object String]",Ve="[object Symbol]",We="[object Undefined]",Xe="[object WeakMap]",Ye="[object ArrayBuffer]",Ze="[object DataView]",$e="[object Float32Array]",_e="[object Float64Array]",af="[object Int8Array]",bf="[object Int16Array]",cf="[object Int32Array]",df="[object Uint8Array]",ef="[object Uint8ClampedArray]",ff="[object Uint16Array]",gf="[object Uint32Array]",hf=/\b__p \+= '';/g,jf=/\b(__p \+=) '' \+/g,kf=/(__e\(.*?\)|\b__t\)) \+\n'';/g,lf=/[&<>"']/g,mf=RegExp(lf.source),nf=/<%-([\s\S]+?)%>/g,of=/<%([\s\S]+?)%>/g,pf=/<%=([\s\S]+?)%>/g,qf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rf=/^\w*$/,sf=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tf=/[\\^$.*+?()[\]{}|]/g,uf=/^\s+|\s+$/g,vf=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,wf=/\{\n\/\* \[wrapped with (.+)\] \*/,xf=/,? & /,yf=/\\(\\)?/g,zf=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Af=/\w*$/,Bf=/^[-+]0x[0-9a-f]+$/i,Cf=/^0b[01]+$/i,Df=/^\[object .+?Constructor\]$/,Ef=/^0o[0-7]+$/i,Ff=/^(?:0|[1-9]\d*)$/,Gf=/($^)/,Hf=/['\n\r\u2028\u2029\\]/g,If="\\ud800-\\udfff",Jf="\\u0300-\\u036f",Kf="\\ufe20-\\ufe2f",Lf="\\u20d0-\\u20ff",Mf=Jf+Kf+Lf,Nf="\\ufe0e\\ufe0f",Of="["+If+"]",Pf="["+Mf+"]",Qf="\\ud83c[\\udffb-\\udfff]",Rf="(?:"+Pf+"|"+Qf+")",Sf="[^"+If+"]",Tf="(?:\\ud83c[\\udde6-\\uddff]){2}",Uf="[\\ud800-\\udbff][\\udc00-\\udfff]",Vf="\\u200d",Wf=Rf+"?",Xf="["+Nf+"]?",Yf="(?:"+Vf+"(?:"+[Sf,Tf,Uf].join("|")+")"+Xf+Wf+")*",Zf=Xf+Wf+Yf,$f="(?:"+[Sf+Pf+"?",Pf,Tf,Uf,Of].join("|")+")",_f=RegExp(Qf+"(?="+Qf+")|"+$f+Zf,"g"),ag=RegExp("["+Vf+If+Mf+Nf+"]"),bg=-1,cg={};cg[$e]=cg[_e]=cg[af]=cg[bf]=cg[cf]=cg[df]=cg[ef]=cg[ff]=cg[gf]=!0,cg[De]=cg[Ee]=cg[Ye]=cg[Ge]=cg[Ze]=cg[He]=cg[Je]=cg[Ke]=cg[Me]=cg[Ne]=cg[Pe]=cg[Se]=cg[Te]=cg[Ue]=cg[Xe]=!1;var dg={};dg[De]=dg[Ee]=dg[Ye]=dg[Ze]=dg[Ge]=dg[He]=dg[$e]=dg[_e]=dg[af]=dg[bf]=dg[cf]=dg[Me]=dg[Ne]=dg[Pe]=dg[Se]=dg[Te]=dg[Ue]=dg[Ve]=dg[df]=dg[ef]=dg[ff]=dg[gf]=!0,dg[Je]=dg[Ke]=dg[Xe]=!1;var eg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},fg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},gg=parseInt,hg="object"==typeof global&&global&&global.Object===Object&&global,ig="object"==typeof self&&self&&self.Object===Object&&self,jg=hg||ig||Function("return this")(),kg="object"==typeof exports&&exports&&!exports.nodeType&&exports,lg=kg&&"object"==typeof module&&module&&!module.nodeType&&module,mg=lg&&lg.exports===kg,ng=mg&&hg.process,og=function(){try{return ng&&ng.binding&&ng.binding("util")}catch(a){}}(),pg=og&&og.isDate,qg=og&&og.isMap,rg=og&&og.isSet,sg=og&&og.isTypedArray,tg=q("length"),ug=r(eg),vg=Array.prototype,wg=Function.prototype,xg=Object.prototype,yg=jg["__core-js_shared__"],zg=wg.toString,Ag=xg.hasOwnProperty,Bg=function(){var a=/[^.]+$/.exec(yg&&yg.keys&&yg.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),Cg=xg.toString,Dg=zg.call(Object),Eg=jg._,Fg=RegExp("^"+zg.call(Ag).replace(tf,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gg=mg?jg.Buffer:Yd,Hg=jg.Symbol,Ig=jg.Uint8Array,Jg=Gg?Gg.allocUnsafe:Yd,Kg=D(Object.getPrototypeOf,Object),Lg=Object.create,Mg=xg.propertyIsEnumerable,Ng=vg.splice,Og=Hg?Hg.isConcatSpreadable:Yd,Pg=Hg?Hg.iterator:Yd,Qg=Hg?Hg.toStringTag:Yd,Rg=function(){try{var a=Yb(Object,"defineProperty");return a({},"",{}),a}catch(a){}}(),Sg=Math.ceil,Tg=Math.floor,Ug=Object.getOwnPropertySymbols,Vg=Gg?Gg.isBuffer:Yd,Wg=D(Object.keys,Object),Xg=Math.max,Yg=Math.min,Zg=Date.now,$g=vg.reverse,_g=Yb(jg,"DataView"),ah=Yb(jg,"Map"),bh=Yb(jg,"Promise"),ch=Yb(jg,"Set"),dh=Yb(jg,"WeakMap"),eh=Yb(Object,"create"),fh=dh&&new dh,gh={},hh=yc(_g),ih=yc(ah),jh=yc(bh),kh=yc(ch),lh=yc(dh),mh=Hg?Hg.prototype:Yd,nh=mh?mh.valueOf:Yd,oh=mh?mh.toString:Yd,ph=function(){function a(){}return function(b){if(!kd(b))return{};if(Lg)return Lg(b);a.prototype=b;var c=new a;return a.prototype=Yd,c}}();L.templateSettings={escape:nf,evaluate:of,interpolate:pf,variable:"",imports:{_:L}},L.prototype=M.prototype,L.prototype.constructor=L,N.prototype=ph(M.prototype),N.prototype.constructor=N,O.prototype=ph(M.prototype),O.prototype.constructor=O,S.prototype.clear=T,S.prototype.delete=U,S.prototype.get=V,S.prototype.has=W,S.prototype.set=X,Y.prototype.clear=Z,Y.prototype.delete=$,Y.prototype.get=_,Y.prototype.has=aa,Y.prototype.set=ba,ca.prototype.clear=da,ca.prototype.delete=ea,ca.prototype.get=fa,ca.prototype.has=ga,ca.prototype.set=ha,ia.prototype.add=ia.prototype.push=ja,ia.prototype.has=ka,la.prototype.clear=ma,la.prototype.delete=na,la.prototype.get=oa,la.prototype.has=pa,la.prototype.set=qa;var qh=Db(Ea),rh=Eb(),sh=fh?function(a,b){return fh.set(a,b),a}:Pd,th=Rg?function(a,b){return Rg(a,"toString",{configurable:!0,enumerable:!1,value:Od(b),writable:!0})}:Pd,uh=fh?function(a){return fh.get(a)}:Td,vh=Ug?function(a){return null==a?[]:(a=Object(a),e(Ug(a),function(b){return Mg.call(a,b)}))}:Vd,wh=Ug?function(a){for(var b=[];a;)i(b,vh(a)),a=Kg(a);return b}:Vd,xh=Ia;(_g&&xh(new _g(new ArrayBuffer(1)))!=Ze||ah&&xh(new ah)!=Me||bh&&xh(bh.resolve())!=Qe||ch&&xh(new ch)!=Te||dh&&xh(new dh)!=Xe)&&(xh=function(a){var b=Ia(a),c=b==Pe?a.constructor:Yd,d=c?yc(c):"";if(d)switch(d){case hh:return Ze;case ih:return Me;case jh:return Qe;case kh:return Te;case lh:return Xe}return b});var yh=wc(sh),zh=wc(th),Ah=pc(function(a){var b=[];return 46===a.charCodeAt(0)&&b.push(""),a.replace(sf,function(a,c,d,e){b.push(d?e.replace(yf,"$1"):c||a)}),b}),Bh=gb(Hc),Ch=gb(function(a,b){return ed(a)?Aa(a,b):[]}),Dh=(Qb(function(a){var b=a.length,c=b?a[0]:0,d=this.__wrapped__,e=function(b){return xa(b,a)};return!(b>1||this.__actions__.length)&&d instanceof O&&gc(c)?(d=d.slice(c,+c+(b?1:0)),d.__actions__.push({func:Lc,args:[e],thisArg:Yd}),new N(d,this.__chain__).thru(function(a){return b&&!a.length&&a.push(Yd),a})):this.thru(e)}),Hb(Dc)),Eh=gb(function(a,b){if(null==a)return[];var c=b.length;return c>1&&hc(a,b[0],b[1])?b=[]:c>2&&hc(b[0],b[1],b[2])&&(b=[b[0]]),bb(a,Da(b,1),[])}),Fh=function(){return jg.Date.now()};Zc.Cache=ca;var Gh=Na(function(){return arguments}())?Na:function(a){return ld(a)&&Ag.call(a,"callee")&&!Mg.call(a,"callee")},Hh=Array.isArray,Ih=Vg||Wd,Jh=pg?u(pg):Oa,Kh=qg?u(qg):Ra,Lh=rg?u(rg):Ua,Mh=sg?u(sg):Va,Nh=Cb(function(a,b){if(mc(b)||dd(b))return void zb(b,Cd(b),a);for(var c in b)Ag.call(b,c)&&sa(a,c,b[c])}),Oh=Cb(function(a,b){zb(b,Dd(b),a)}),Ph=Cb(function(a,b,c,d){zb(b,Dd(b),a,d)}),Qh=Fb("toUpperCase"),Rh=gb(function(a,c){try{return b(a,Yd,c)}catch(a){return hd(a)?a:new Error(a)}}),Sh=Lb("round");L.assign=Nh,L.assignIn=Oh,L.assignInWith=Ph,L.chain=Jc,L.compact=Bc,L.constant=Od,L.debounce=Yc,L.drop=Cc,L.flatten=Ec,L.iteratee=Qd,L.keys=Cd,L.keysIn=Dd,L.map=Wc,L.memoize=Zc,L.mixin=Rd,L.negate=$c,L.omitBy=Ed,L.pickBy=Fd,L.property=Ud,L.pull=Bh,L.pullAll=Hc,L.reverse=Ic,L.sortBy=Eh,L.tap=Kc,L.throttle=_c,L.thru=Lc,L.toArray=td,L.values=Gd,L.without=Ch,L.extend=Oh,L.extendWith=Ph,Rd(L,L),L.attempt=Rh,L.capitalize=Id,L.clone=ad,L.cloneDeep=bd,L.endsWith=Jd,L.eq=cd,L.escape=Kd,L.every=Tc,L.find=Dh,L.findIndex=Dc,L.forEach=Uc,L.forOwn=yd,L.get=zd,L.has=Ad,L.hasIn=Bd,L.identity=Pd,L.includes=Vc,L.indexOf=Fc,L.inRange=Hd,L.isArguments=Gh,L.isArray=Hh,L.isArrayLike=dd,L.isArrayLikeObject=ed,L.isBoolean=fd,L.isBuffer=Ih,L.isDate=Jh,L.isEmpty=gd,L.isError=hd,L.isFunction=id,L.isLength=jd,L.isMap=Kh,L.isNaN=md,L.isNull=nd,L.isNumber=od,L.isObject=kd,L.isObjectLike=ld,L.isPlainObject=pd,L.isSet=Lh,L.isString=qd,L.isSymbol=rd,L.isTypedArray=Mh,L.isUndefined=sd,L.last=Gc,L.min=Xd,L.stubArray=Vd,L.stubFalse=Wd,L.noConflict=Sd,L.noop=Td,L.now=Fh,L.padStart=Ld,L.round=Sh,L.some=Xc,L.startsWith=Md,L.template=Nd,L.toFinite=ud,L.toInteger=vd,L.toNumber=wd,L.toString=xd,L.upperFirst=Qh,L.each=Uc,Rd(L,function(){var a={};return Ea(L,function(b,c){Ag.call(L.prototype,c)||(a[c]=b)}),a}(),{chain:!1}),L.VERSION=Zd,c(["drop","take"],function(a,b){O.prototype[a]=function(c){c=c===Yd?1:Xg(vd(c),0);var d=this.__filtered__&&!b?new O(this):this.clone();return d.__filtered__?d.__takeCount__=Yg(c,d.__takeCount__):d.__views__.push({size:Yg(c,Be),type:a+(d.__dir__<0?"Right":"")}),d},O.prototype[a+"Right"]=function(b){return this.reverse()[a](b).reverse()}}),c(["filter","map","takeWhile"],function(a,b){var c=b+1,d=c==ue||c==we;O.prototype[a]=function(a){var b=this.clone();return b.__iteratees__.push({iteratee:Vb(a,3),type:c}),b.__filtered__=b.__filtered__||d,b}}),c(["head","last"],function(a,b){var c="take"+(b?"Right":"");O.prototype[a]=function(){return this[c](1).value()[0]}}),c(["initial","tail"],function(a,b){var c="drop"+(b?"":"Right");O.prototype[a]=function(){return this.__filtered__?new O(this):this[c](1)}}),O.prototype.compact=function(){return this.filter(Pd)},O.prototype.find=function(a){return this.filter(a).head()},O.prototype.findLast=function(a){return this.reverse().find(a)},O.prototype.invokeMap=gb(function(a,b){return"function"==typeof a?new O(this):this.map(function(c){return Ma(c,a,b)})}),O.prototype.reject=function(a){return this.filter($c(Vb(a)))},O.prototype.slice=function(a,b){a=vd(a);var c=this;return c.__filtered__&&(a>0||b<0)?new O(c):(a<0?c=c.takeRight(-a):a&&(c=c.drop(a)),b!==Yd&&(b=vd(b),c=b<0?c.dropRight(-b):c.take(b-a)),c)},O.prototype.takeRightWhile=function(a){return this.reverse().takeWhile(a).reverse()},O.prototype.toArray=function(){return this.take(Be)},Ea(O.prototype,function(a,b){var c=/^(?:filter|find|map|reject)|While$/.test(b),d=/^(?:head|last)$/.test(b),e=L[d?"take"+("last"==b?"Right":""):b],f=d||/^find/.test(b);e&&(L.prototype[b]=function(){var b=this.__wrapped__,g=d?[1]:arguments,h=b instanceof O,j=g[0],k=h||Hh(b),l=function(a){var b=e.apply(L,i([a],g));return d&&m?b[0]:b};k&&c&&"function"==typeof j&&1!=j.length&&(h=k=!1);var m=this.__chain__,n=!!this.__actions__.length,o=f&&!m,p=h&&!n;if(!f&&k){b=p?b:new O(this);var q=a.apply(b,g);return q.__actions__.push({func:Lc,args:[l],thisArg:Yd}),new N(q,m)}return o&&p?a.apply(this,g):(q=this.thru(l),o?d?q.value()[0]:q.value():q)})}),c(["pop","push","shift","sort","splice","unshift"],function(a){var b=vg[a],c=/^(?:push|sort|unshift)$/.test(a)?"tap":"thru",d=/^(?:pop|shift)$/.test(a);L.prototype[a]=function(){var a=arguments;if(d&&!this.__chain__){var e=this.value();return b.apply(Hh(e)?e:[],a)}return this[c](function(c){return b.apply(Hh(c)?c:[],a)})}}),Ea(O.prototype,function(a,b){var c=L[b];if(c){var d=c.name+"";(gh[d]||(gh[d]=[])).push({name:b,func:c})}}),gh[Ib(Yd,je).name]=[{name:"wrapper",func:Yd}],O.prototype.clone=P,O.prototype.reverse=Q,O.prototype.value=R,L.prototype.chain=Mc,L.prototype.commit=Nc,L.prototype.next=Oc,L.prototype.plant=Qc,L.prototype.reverse=Rc,L.prototype.toJSON=L.prototype.valueOf=L.prototype.value=Sc,L.prototype.first=L.prototype.head,Pg&&(L.prototype[Pg]=Pc),"function"==typeof a&&"object"==typeof a.amd&&a.amd?(jg._=L,a(function(){return L})):lg?((lg.exports=L)._=L,kg._=L):jg._=L}).call(this),"undefined"!=typeof window&&function(b,c){"object"==typeof exports&&"object"==typeof module?module.exports=c():"function"==typeof a&&a.amd?a([],c):"object"==typeof exports?exports.Hls=c():b.Hls=c()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{enumerable:!0,get:d})},b.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},b.t=function(a,c){if(1&c&&(a=b(a)),8&c)return a;if(4&c&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(b.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&c&&"string"!=typeof a)for(var e in a)b.d(d,e,function(b){return a[b]}.bind(null,e));return d},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/dist/",b(b.s="./src/hls.js")}({"./node_modules/eventemitter3/index.js":function(a,b,c){"use strict";function d(){}function e(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function f(a,b,c,d,f){if("function"!=typeof c)throw new TypeError("The listener must be a function");var g=new e(c,d||a,f),h=j?j+b:b;return a._events[h]?a._events[h].fn?a._events[h]=[a._events[h],g]:a._events[h].push(g):(a._events[h]=g,a._eventsCount++),a}function g(a,b){0==--a._eventsCount?a._events=new d:delete a._events[b]}function h(){this._events=new d,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,j="~";Object.create&&(d.prototype=Object.create(null),(new d).__proto__||(j=!1)),h.prototype.eventNames=function(){var a,b,c=[];if(0===this._eventsCount)return c;for(b in a=this._events)i.call(a,b)&&c.push(j?b.slice(1):b);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},h.prototype.listeners=function(a){var b=j?j+a:a,c=this._events[b];if(!c)return[];if(c.fn)return[c.fn];for(var d=0,e=c.length,f=new Array(e);d<e;d++)f[d]=c[d].fn;return f},h.prototype.listenerCount=function(a){var b=j?j+a:a,c=this._events[b];return c?c.fn?1:c.length:0},h.prototype.emit=function(a,b,c,d,e,f){var g=j?j+a:a;if(!this._events[g])return!1;var h,i,k=this._events[g],l=arguments.length;if(k.fn){switch(k.once&&this.removeListener(a,k.fn,void 0,!0),l){case 1:return k.fn.call(k.context),!0;case 2:return k.fn.call(k.context,b),!0;case 3:return k.fn.call(k.context,b,c),!0;case 4:return k.fn.call(k.context,b,c,d),!0;case 5:return k.fn.call(k.context,b,c,d,e),!0;case 6:return k.fn.call(k.context,b,c,d,e,f),!0}for(i=1,h=new Array(l-1);i<l;i++)h[i-1]=arguments[i];k.fn.apply(k.context,h)}else{var m,n=k.length;for(i=0;i<n;i++)switch(k[i].once&&this.removeListener(a,k[i].fn,void 0,!0),l){case 1:k[i].fn.call(k[i].context);break;case 2:k[i].fn.call(k[i].context,b);break;case 3:k[i].fn.call(k[i].context,b,c);break;case 4:k[i].fn.call(k[i].context,b,c,d);break;default:if(!h)for(m=1,h=new Array(l-1);m<l;m++)h[m-1]=arguments[m];k[i].fn.apply(k[i].context,h)}}return!0},h.prototype.on=function(a,b,c){return f(this,a,b,c,!1)},h.prototype.once=function(a,b,c){return f(this,a,b,c,!0)},h.prototype.removeListener=function(a,b,c,d){var e=j?j+a:a;if(!this._events[e])return this;if(!b)return g(this,e),this;var f=this._events[e];if(f.fn)f.fn!==b||d&&!f.once||c&&f.context!==c||g(this,e);else{for(var h=0,i=[],k=f.length;h<k;h++)(f[h].fn!==b||d&&!f[h].once||c&&f[h].context!==c)&&i.push(f[h]);i.length?this._events[e]=1===i.length?i[0]:i:g(this,e)}return this},h.prototype.removeAllListeners=function(a){var b;return a?(b=j?j+a:a,this._events[b]&&g(this,b)):(this._events=new d,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=j,h.EventEmitter=h,a.exports=h},"./node_modules/node-libs-browser/node_modules/events/events.js":function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}a.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length)){if((b=arguments[1])instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:h=Array.prototype.slice.call(arguments,1),c.apply(this,h)}else if(f(c))for(h=Array.prototype.slice.call(arguments,1),j=c.slice(),e=j.length,i=0;i<e;i++)j[i].apply(this,h);return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned&&(e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners)&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace()),this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(e<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){return this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(d(b))return 1;if(b)return b.length}return 0},c.listenerCount=function(a,b){return a.listenerCount(b)}},"./node_modules/url-toolkit/src/url-toolkit.js":function(a,b,c){!function(b){var c=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,d=/^([^\/?#]*)(.*)$/,e=/(?:\/|^)\.(?=\/)/g,f=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,g={buildAbsoluteURL:function(a,b,c){if(c=c||{},a=a.trim(),!(b=b.trim())){if(!c.alwaysNormalize)return a;var e=g.parseURL(a);if(!e)throw new Error("Error trying to parse base URL.");return e.path=g.normalizePath(e.path),g.buildURLFromParts(e)}var f=g.parseURL(b);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=g.normalizePath(f.path),g.buildURLFromParts(f)):b;var h=g.parseURL(a);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&"/"!==h.path[0]){var i=d.exec(h.path);h.netLoc=i[1],h.path=i[2]}h.netLoc&&!h.path&&(h.path="/");var j={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(j.netLoc=h.netLoc,"/"!==f.path[0]))if(f.path){var k=h.path,l=k.substring(0,k.lastIndexOf("/")+1)+f.path;j.path=g.normalizePath(l)}else j.path=h.path,f.params||(j.params=h.params,f.query||(j.query=h.query));return null===j.path&&(j.path=c.alwaysNormalize?g.normalizePath(f.path):f.path),g.buildURLFromParts(j)},parseURL:function(a){var b=c.exec(a);return b?{scheme:b[1]||"",netLoc:b[2]||"",path:b[3]||"",params:b[4]||"",query:b[5]||"",fragment:b[6]||""}:null},normalizePath:function(a){for(a=a.split("").reverse().join("").replace(e,"");a.length!==(a=a.replace(f,"")).length;);return a.split("").reverse().join("")},buildURLFromParts:function(a){return a.scheme+a.netLoc+a.path+a.params+a.query+a.fragment}};a.exports=g}()},"./node_modules/webworkify-webpack/index.js":function(a,b,c){function d(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};b.m=a,b.c=c,b.i=function(a){return a},b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.r=function(a){Object.defineProperty(a,"__esModule",{value:!0})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/",b.oe=function(a){throw console.error(a),a};var d=b(b.s=ENTRY_MODULE);return d.default||d}function e(a){return(a+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(a){return!isNaN(1*a)}function g(a,b,d){var g={};g[d]=[];var h=b.toString(),i=h.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return g;for(var l,m=i[1],n=new RegExp("(\\\\n|\\W)"+e(m)+k,"g");l=n.exec(h);)"dll-reference"!==l[3]&&g[d].push(l[3]);for(n=new RegExp("\\("+e(m)+'\\("(dll-reference\\s('+j+'))"\\)\\)'+k,"g");l=n.exec(h);)a[l[2]]||(g[d].push(l[1]),a[l[2]]=c(l[1]).m),g[l[2]]=g[l[2]]||[],g[l[2]].push(l[4]);for(var o=Object.keys(g),p=0;p<o.length;p++)for(var q=0;q<g[o[p]].length;q++)f(g[o[p]][q])&&(g[o[p]][q]=1*g[o[p]][q]);return g}function h(a){return Object.keys(a).reduce(function(b,c){return b||a[c].length>0},!1)}function i(a,b){for(var c={main:[b]},d={main:[]},e={main:{}};h(c);)for(var f=Object.keys(c),i=0;i<f.length;i++){var j=f[i],k=c[j],l=k.pop();if(e[j]=e[j]||{},!e[j][l]&&a[j][l]){e[j][l]=!0,d[j]=d[j]||[],d[j].push(l);for(var m=g(a,a[j][l],j),n=Object.keys(m),o=0;o<n.length;o++)c[n[o]]=c[n[o]]||[],c[n[o]]=c[n[o]].concat(m[n[o]])}}return d}var j="[\\.|\\-|\\+|\\w|/|@]+",k="\\((/\\*.*?\\*/)?s?.*?("+j+").*?\\)";a.exports=function(a,b){b=b||{};var e={main:c.m},f=b.all?{main:Object.keys(e.main)}:i(e,a),g="";Object.keys(f).filter(function(a){return"main"!==a}).forEach(function(a){for(var b=0;f[a][b];)b++;f[a].push(b),e[a][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",g=g+"var "+a+" = ("+d.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+f[a].map(function(b){return JSON.stringify(b)+": "+e[a][b].toString()}).join(",")+"});\n"}),g=g+"new (("+d.toString().replace("ENTRY_MODULE",JSON.stringify(a))+")({"+f.main.map(function(a){return JSON.stringify(a)+": "+e.main[a].toString()}).join(",")+"}))(self);";var h=new window.Blob([g],{type:"text/javascript"});if(b.bare)return h;var j=window.URL||window.webkitURL||window.mozURL||window.msURL,k=j.createObjectURL(h),l=new window.Worker(k);return l.objectURL=k,l}},"./src/config.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/controller/abr-controller.js"),e=c("./src/controller/buffer-controller.js"),f=c("./src/controller/cap-level-controller.js"),g=c("./src/controller/fps-controller.js"),h=c("./src/utils/xhr-loader.js"),i=c("./src/controller/audio-track-controller.js"),j=c("./src/controller/audio-stream-controller.js"),k=c("./src/utils/cues.js"),l=c("./src/controller/timeline-controller.js"),m=c("./src/controller/subtitle-track-controller.js"),n=c("./src/controller/subtitle-stream-controller.js"),o=c("./src/controller/eme-controller.js"),p=c("./src/utils/mediakeys-helper.js");b.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:h.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:d.default,bufferController:e.default,capLevelController:f.default,fpsController:g.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,requestMediaKeySystemAccessFunc:p.requestMediaKeySystemAccess},b.hlsDefaultConfig.subtitleStreamController=n.SubtitleStreamController,b.hlsDefaultConfig.subtitleTrackController=m.default,b.hlsDefaultConfig.timelineController=l.default,b.hlsDefaultConfig.cueHandler=k,b.hlsDefaultConfig.enableCEA708Captions=!0,b.hlsDefaultConfig.enableWebVTT=!0,b.hlsDefaultConfig.captionsTextTrack1Label="English",b.hlsDefaultConfig.captionsTextTrack1LanguageCode="en",b.hlsDefaultConfig.captionsTextTrack2Label="Spanish",b.hlsDefaultConfig.captionsTextTrack2LanguageCode="es",b.hlsDefaultConfig.audioStreamController=j.default,b.hlsDefaultConfig.audioTrackController=i.default,b.hlsDefaultConfig.emeController=o.default},"./src/controller/abr-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/utils/buffer-helper.js"),h=c("./src/errors.js"),i=c("./src/utils/logger.js"),j=c("./src/utils/ewma-bandwidth-estimator.js"),k=window.performance,l=function(b){function c(a){var c=b.call(this,a,e.default.FRAG_LOADING,e.default.FRAG_LOADED,e.default.FRAG_BUFFERED,e.default.ERROR)||this;return c.lastLoadedFragLevel=0,c._nextAutoLevel=-1,c.hls=a,c.timer=null,c._bwEstimator=null,c.onCheck=c._abandonRulesCheck.bind(c),c}return d(c,b),c.prototype.destroy=function(){this.clearTimer(),f.default.prototype.destroy.call(this)},c.prototype.onFragLoading=function(a){var b=a.frag;if("main"===b.type&&(this.timer||(this.fragCurrent=b,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var c=this.hls,d=c.config,e=b.level,f=c.levels[e].details.live,g=void 0,h=void 0;f?(g=d.abrEwmaFastLive,h=d.abrEwmaSlowLive):(g=d.abrEwmaFastVoD,h=d.abrEwmaSlowVoD),this._bwEstimator=new j.default(c,h,g,d.abrEwmaDefaultEstimate)}},c.prototype._abandonRulesCheck=function(){var a=this.hls,b=a.media,c=this.fragCurrent;if(c){var d=c.loader,f=a.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return i.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var h=d.stats;if(b&&h&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var j=k.now()-h.trequest,l=Math.abs(b.playbackRate);if(j>500*c.duration/l){var m=a.levels,n=Math.max(1,h.bw?h.bw/8:1e3*h.loaded/j),o=m[c.level],p=o.realBitrate?Math.max(o.realBitrate,o.bitrate):o.bitrate,q=h.total?h.total:Math.max(h.loaded,Math.round(c.duration*p/8)),r=b.currentTime,s=(q-h.loaded)/n,t=(g.BufferHelper.bufferInfo(b,r,a.config.maxBufferHole).end-r)/l;if(t<2*c.duration/l&&s>t){var u=void 0,v=void 0;for(v=c.level-1;v>f;v--){var w=m[v].realBitrate?Math.max(m[v].realBitrate,m[v].bitrate):m[v].bitrate;if((u=c.duration*w/(6.4*n))<t)break}u<s&&(i.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+u.toFixed(1)+"<"+s.toFixed(1)+":"+t.toFixed(1)),a.nextLoadLevel=v,this._bwEstimator.sample(j,h.loaded),d.abort(),this.clearTimer(),a.trigger(e.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:h}))}}}}},c.prototype.onFragLoaded=function(b){var c=b.frag;if("main"===c.type&&a.isFinite(c.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=c.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[c.level],e=(d.loaded?d.loaded.bytes:0)+b.stats.loaded,f=(d.loaded?d.loaded.duration:0)+b.frag.duration;d.loaded={bytes:e,duration:f},d.realBitrate=Math.round(8*e/f)}if(b.frag.bitrateTest){var g=b.stats;g.tparsed=g.tbuffered=g.tload,this.onFragBuffered(b)}}},c.prototype.onFragBuffered=function(b){var c=b.stats,d=b.frag;if(!0!==c.aborted&&"main"===d.type&&a.isFinite(d.sn)&&(!d.bitrateTest||c.tload===c.tbuffered)){var e=c.tparsed-c.trequest;i.logger.log("latency/loading/parsing/append/kbps:"+Math.round(c.tfirst-c.trequest)+"/"+Math.round(c.tload-c.tfirst)+"/"+Math.round(c.tparsed-c.tload)+"/"+Math.round(c.tbuffered-c.tparsed)+"/"+Math.round(8*c.loaded/(c.tbuffered-c.trequest))),this._bwEstimator.sample(e,c.loaded),c.bwEstimate=this._bwEstimator.getEstimate(),d.bitrateTest?this.bitrateTestDelay=e/1e3:this.bitrateTestDelay=0}},c.prototype.onError=function(a){switch(a.details){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},c.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},Object.defineProperty(c.prototype,"nextAutoLevel",{get:function(){var a=this._nextAutoLevel,b=this._bwEstimator;if(!(-1===a||b&&b.canEstimate()))return a;var c=this._nextABRAutoLevel;return-1!==a&&(c=Math.min(a,c)),c},set:function(a){this._nextAutoLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"_nextABRAutoLevel",{get:function(){var a=this.hls,b=a.maxAutoLevel,c=a.levels,d=a.config,e=a.minAutoLevel,f=a.media,h=this.lastLoadedFragLevel,j=this.fragCurrent?this.fragCurrent.duration:0,k=f?f.currentTime:0,l=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,m=this._bwEstimator?this._bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,n=(g.BufferHelper.bufferInfo(f,k,d.maxBufferHole).end-k)/l,o=this._findBestLevel(h,j,m,e,b,n,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(o>=0)return o;i.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=j?Math.min(j,d.maxStarvationDelay):d.maxStarvationDelay,q=d.abrBandWidthFactor,r=d.abrBandWidthUpFactor;if(0===n){var s=this.bitrateTestDelay;if(s){p=(j?Math.min(j,d.maxLoadingDelay):d.maxLoadingDelay)-s,i.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),q=r=1}}return o=this._findBestLevel(h,j,m,e,b,n+p,q,r,c),Math.max(o,0)},enumerable:!0,configurable:!0}),c.prototype._findBestLevel=function(a,b,c,d,e,f,g,h,j){for(var k=e;k>=d;k--){var l=j[k];if(l){var m=l.details,n=m?m.totalduration/m.fragments.length:b,o=!!m&&m.live,p=void 0;p=k<=a?g*c:h*c;var q=j[k].realBitrate?Math.max(j[k].realBitrate,j[k].bitrate):j[k].bitrate,r=q*n/p;if(i.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(p)+"/"+q+"/"+n+"/"+f+"/"+r),p>q&&(!r||o&&!this.bitrateTestDelay||r<f))return k}}return-1},c}(f.default);b.default=l}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/audio-stream-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/utils/binary-search.js"),f=c("./src/utils/buffer-helper.js"),g=c("./src/demux/demuxer.js"),h=c("./src/events.js"),i=c("./src/controller/level-helper.js"),j=c("./src/utils/time-ranges.js"),k=c("./src/errors.js"),l=c("./src/utils/logger.js"),m=c("./src/utils/discontinuities.js"),n=c("./src/controller/fragment-tracker.js"),o=c("./src/loader/fragment.js"),p=c("./src/controller/base-stream-controller.js"),q=window.performance,r=100,s=function(b){function c(a,c){var d=b.call(this,a,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.AUDIO_TRACKS_UPDATED,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_LOADED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.BUFFER_RESET,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED,h.default.INIT_PTS_FOUND)||this;return d.fragmentTracker=c,d.config=a.config,d.audioCodecSwap=!1,d._state=p.State.STOPPED,d.initPTS=[],d.waitingFragment=null,d.videoTrackCC=null,d}return d(c,b),c.prototype.onInitPtsFound=function(a){var b=a.id,c=a.frag.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,this.videoTrackCC=c,l.logger.log("InitPTS for cc: "+c+" found from video track: "+d),this.state===p.State.WAITING_INIT_PTS&&this.tick())},c.prototype.startLoad=function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.setInterval(r),this.fragLoadError=0,b>0&&-1===a?(l.logger.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=p.State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=p.State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=p.State.STOPPED},Object.defineProperty(c.prototype,"state",{get:function(){return this._state},set:function(a){if(this.state!==a){var b=this.state;this._state=a,l.logger.log("audio stream:"+b+"->"+a)}},enumerable:!0,configurable:!0}),c.prototype.doTick=function(){var b,c,d,g=this.hls,i=g.config;switch(this.state){case p.State.ERROR:case p.State.PAUSED:case p.State.BUFFER_FLUSHING:break;case p.State.STARTING:this.state=p.State.WAITING_TRACK,this.loadedmetadata=!1;break;case p.State.IDLE:var j=this.tracks;if(!j)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)b=this.media.currentTime;else if(void 0===(b=this.nextLoadPosition))break;var k=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,r=f.BufferHelper.bufferInfo(k,b,i.maxBufferHole),s=f.BufferHelper.bufferInfo(o,b,i.maxBufferHole),t=r.len,u=r.end,v=this.fragPrevious,w=Math.min(i.maxBufferLength,i.maxMaxBufferLength),x=Math.max(w,s.len),y=this.audioSwitch,z=this.trackId;if((t<x||y)&&z<j.length){if(void 0===(d=j[z].details)){this.state=p.State.WAITING_TRACK;break}if(!y&&this._streamEnded(r,d))return this.hls.trigger(h.default.BUFFER_EOS,{type:"audio"}),void(this.state=p.State.ENDED);var A=d.fragments,B=A.length,C=A[0].start,D=A[B-1].start+A[B-1].duration,E=void 0;if(y)if(d.live&&!d.PTSKnown)l.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),u=0;else if(u=b,d.PTSKnown&&b<C){if(!(r.end>C||r.nextStart))return;l.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=C+.05}if(d.initSegment&&!d.initSegment.data)E=d.initSegment;else if(u<=C){if(E=A[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=m.findFragWithCC(A,this.videoTrackCC)),d.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var F=r.nextStart?r.nextStart:C;return l.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(F+.05)),void(this.media.currentTime=F+.05)}}else{var G=void 0,H=i.maxFragLookUpTolerance,I=v?A[v.sn-A[0].sn+1]:void 0,J=function(a){var b=Math.min(H,a.duration);return a.start+a.duration-b<=u?1:a.start-b>u&&a.start?-1:0};u<D?(u>D-H&&(H=0),G=I&&!J(I)?I:e.default.search(A,J)):G=A[B-1],G&&(E=G,C=G.start,v&&E.level===v.level&&E.sn===v.sn&&(E.sn<d.endSN?(E=A[E.sn+1-d.startSN],l.logger.log("SN just loaded, load next one: "+E.sn)):E=null))}E&&(E.encrypted?(l.logger.log("Loading key for "+E.sn+" of ["+d.startSN+" ,"+d.endSN+"],track "+z),this.state=p.State.KEY_LOADING,g.trigger(h.default.KEY_LOADING,{frag:E})):(l.logger.log("Loading "+E.sn+", cc: "+E.cc+" of ["+d.startSN+" ,"+d.endSN+"],track "+z+", currentTime:"+b+",bufferEnd:"+u.toFixed(3)),this.fragCurrent=E,(y||this.fragmentTracker.getState(E)===n.FragmentState.NOT_LOADED)&&(this.startFragRequested=!0,a.isFinite(E.sn)&&(this.nextLoadPosition=E.start+E.duration),g.trigger(h.default.FRAG_LOADING,{frag:E}),this.state=p.State.FRAG_LOADING)))}break;case p.State.WAITING_TRACK:c=this.tracks[this.trackId],c&&c.details&&(this.state=p.State.IDLE);break;case p.State.FRAG_LOADING_WAITING_RETRY:var K=q.now(),L=this.retryDate;k=this.media;var M=k&&k.seeking;(!L||K>=L||M)&&(l.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=p.State.IDLE);break;case p.State.WAITING_INIT_PTS:var N=this.videoTrackCC;if(void 0===this.initPTS[N])break;var O=this.waitingFragment;if(O){var P=O.frag.cc;N!==P?(c=this.tracks[this.trackId],c.details&&c.details.live&&(l.logger.warn("Waiting fragment CC ("+P+") does not match video track CC ("+N+")"),this.waitingFragment=null,this.state=p.State.IDLE)):(this.state=p.State.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=p.State.IDLE;break;case p.State.STOPPED:case p.State.FRAG_LOADING:case p.State.PARSING:case p.State.PARSED:case p.State.ENDED:}},c.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)},c.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},c.prototype.onAudioTracksUpdated=function(a){l.logger.log("audio tracks updated"),this.tracks=a.audioTracks},c.prototype.onAudioTrackSwitching=function(a){var b=!!a.url;this.trackId=a.id,this.fragCurrent=null,this.state=p.State.PAUSED,this.waitingFragment=null,b?this.setInterval(r):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=p.State.IDLE),this.tick()},c.prototype.onAudioTrackLoaded=function(b){var c=b.details,d=b.id,e=this.tracks[d],f=c.totalduration,g=0;if(l.logger.log("track "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+f),c.live){var h=e.details;h&&c.fragments.length>0?(i.mergeDetails(h,c),g=c.fragments[0].start,c.PTSKnown?l.logger.log("live audio playlist sliding:"+g.toFixed(3)):l.logger.log("live audio playlist - outdated PTS, unknown sliding")):(c.PTSKnown=!1,l.logger.log("live audio playlist - first load, unknown sliding"))}else c.PTSKnown=!1;if(e.details=c,!this.startFragRequested){if(-1===this.startPosition){var j=c.startTimeOffset;a.isFinite(j)?(l.logger.log("start time offset found in playlist, adjust startPosition to "+j),this.startPosition=j):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===p.State.WAITING_TRACK&&(this.state=p.State.IDLE),this.tick()},c.prototype.onKeyLoaded=function(){this.state===p.State.KEY_LOADING&&(this.state=p.State.IDLE,this.tick())},c.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag;if(this.state===p.State.FRAG_LOADING&&b&&"audio"===c.type&&c.level===b.level&&c.sn===b.sn){var d=this.tracks[this.trackId],e=d.details,f=e.totalduration,i=b.level,j=b.sn,k=b.cc,m=this.config.defaultAudioCodec||d.audioCodec||"mp4a.40.2",n=this.stats=a.stats;if("initSegment"===j)this.state=p.State.IDLE,n.tparsed=n.tbuffered=q.now(),e.initSegment.data=a.payload,this.hls.trigger(h.default.FRAG_BUFFERED,{stats:n,frag:b,id:"audio"}),this.tick();else{this.state=p.State.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new g.default(this.hls,"audio"));var o=this.initPTS[k],r=e.initSegment?e.initSegment.data:[];if(e.initSegment||void 0!==o){this.pendingBuffering=!0,l.logger.log("Demuxing "+j+" of ["+e.startSN+" ,"+e.endSN+"],track "+i);this.demuxer.push(a.payload,r,m,null,b,f,!1,o)}else l.logger.log("unknown video PTS for continuity counter "+k+", waiting for video PTS before demuxing audio frag "+j+" of ["+e.startSN+" ,"+e.endSN+"],track "+i),this.waitingFragment=a,this.state=p.State.WAITING_INIT_PTS}}this.fragLoadError=0},c.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===p.State.PARSING){var d=a.tracks,e=void 0;if(d.video&&delete d.video,e=d.audio){e.levelCodec=e.codec,e.id=a.id,this.hls.trigger(h.default.BUFFER_CODECS,d),l.logger.log("audio track:audio,container:"+e.container+",codecs[level/parsed]=["+e.levelCodec+"/"+e.codec+"]");var f=e.initSegment;if(f){var g={type:"audio",data:f,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[g]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,g))}this.tick()}}},c.prototype.onFragParsingData=function(b){var c=this,d=this.fragCurrent,e=b.frag;if(d&&"audio"===b.id&&"audio"===b.type&&e.sn===d.sn&&e.level===d.level&&this.state===p.State.PARSING){var f=this.trackId,g=this.tracks[f],j=this.hls;a.isFinite(b.endPTS)||(b.endPTS=b.startPTS+d.duration,b.endDTS=b.startDTS+d.duration),d.addElementaryStream(o.default.ElementaryStreamTypes.AUDIO),l.logger.log("parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb),i.updateFragPTSDTS(g.details,d,b.startPTS,b.endPTS);var m=this.audioSwitch,n=this.media,q=!1;if(m&&n)if(n.readyState){var r=n.currentTime;l.logger.log("switching audio track : currentTime:"+r),r>=b.startPTS&&(l.logger.log("switching audio track : flushing all audio"),this.state=p.State.BUFFER_FLUSHING,j.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"}),q=!0,this.audioSwitch=!1,j.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:f}))}else this.audioSwitch=!1,j.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:f});var s=this.pendingData;if(!s)return l.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void j.trigger(h.default.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([b.data1,b.data2].forEach(function(a){a&&a.length&&s.push({type:b.type,data:a,parent:"audio",content:"data"})}),!q&&s.length&&(s.forEach(function(a){c.state===p.State.PARSING&&(c.pendingBuffering=!0,c.hls.trigger(h.default.BUFFER_APPENDING,a))}),this.pendingData=[],this.appended=!0)),this.tick()}},c.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"audio"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===p.State.PARSING&&(this.stats.tparsed=q.now(),this.state=p.State.PARSED,this._checkAppendedParsed())},c.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},c.prototype.onBufferCreated=function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0),a.tracks.video&&(this.videoBuffer=a.tracks.video.buffer)},c.prototype.onBufferAppended=function(a){if("audio"===a.parent){var b=this.state;b!==p.State.PARSING&&b!==p.State.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},c.prototype._checkAppendedParsed=function(){if(!(this.state!==p.State.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=this.stats,c=this.hls;if(a){this.fragPrevious=a,b.tbuffered=q.now(),c.trigger(h.default.FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var d=this.mediaBuffer?this.mediaBuffer:this.media;l.logger.log("audio buffered : "+j.default.toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=p.State.IDLE}this.tick()}},c.prototype.onError=function(b){var c=b.frag;if(!c||"audio"===c.type)switch(b.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:var d=b.frag;if(d&&"audio"!==d.type)break;if(!b.fatal){var e=this.fragLoadError;e?e++:e=1;var g=this.config;if(e<=g.fragLoadingMaxRetry){this.fragLoadError=e;var i=Math.min(Math.pow(2,e-1)*g.fragLoadingRetryDelay,g.fragLoadingMaxRetryTimeout);l.logger.warn("AudioStreamController: frag loading failed, retry in "+i+" ms"),this.retryDate=q.now()+i,this.state=p.State.FRAG_LOADING_WAITING_RETRY}else l.logger.error("AudioStreamController: "+b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.state=p.State.ERROR}break;case k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==p.State.ERROR&&(this.state=b.fatal?p.State.ERROR:p.State.IDLE,l.logger.warn("AudioStreamController: "+b.details+" while loading frag, now switching to "+this.state+" state ..."));break;case k.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===b.parent&&(this.state===p.State.PARSING||this.state===p.State.PARSED)){var j=this.mediaBuffer,m=this.media.currentTime;if(j&&f.BufferHelper.isBuffered(j,m)&&f.BufferHelper.isBuffered(j,m+.5)){var g=this.config;g.maxMaxBufferLength>=g.maxBufferLength&&(g.maxMaxBufferLength/=2,l.logger.warn("AudioStreamController: reduce max buffer length to "+g.maxMaxBufferLength+"s")),this.state=p.State.IDLE}else l.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=p.State.BUFFER_FLUSHING,this.hls.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"})}}},c.prototype.onBufferFlushed=function(){var a=this,b=this.pendingData;b&&b.length?(l.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),b.forEach(function(b){a.hls.trigger(h.default.BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=p.State.PARSED):(this.state=p.State.IDLE,this.fragPrevious=null,this.tick())},c}(p.default);b.default=s}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/audio-track-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/task-loop.js"),g=c("./src/utils/logger.js"),h=c("./src/errors.js"),i=function(a){function b(b){var c=a.call(this,b,e.default.MANIFEST_LOADING,e.default.MANIFEST_PARSED,e.default.AUDIO_TRACK_LOADED,e.default.AUDIO_TRACK_SWITCHED,e.default.LEVEL_LOADED,e.default.ERROR)||this;return c._trackId=-1,c._selectDefaultTrack=!0,c.tracks=[],c.trackIdBlacklist=Object.create(null),c.audioGroupId=null,c}return d(b,a),b.prototype.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},b.prototype.onManifestParsed=function(a){var b=this.tracks=a.audioTracks||[];this.hls.trigger(e.default.AUDIO_TRACKS_UPDATED,{audioTracks:b})},b.prototype.onAudioTrackLoaded=function(a){if(a.id>=this.tracks.length)return void g.logger.warn("Invalid audio track id:",a.id);if(g.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.hasInterval()){var b=1e3*a.details.targetduration;this.setInterval(b)}!a.details.live&&this.hasInterval()&&this.clearInterval()},b.prototype.onAudioTrackSwitched=function(a){var b=this.tracks[a.id].groupId;b&&this.audioGroupId!==b&&(this.audioGroupId=b)},b.prototype.onLevelLoaded=function(a){var b=this.hls.levels[a.level];if(b.audioGroupIds){var c=b.audioGroupIds[b.urlId];this.audioGroupId!==c&&(this.audioGroupId=c,this._selectInitialAudioTrack())}},b.prototype.onError=function(a){a.type===h.ErrorTypes.NETWORK_ERROR&&(a.fatal&&this.clearInterval(),a.details===h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(g.logger.warn("Network failure on audio-track id:",a.context.id),this._handleLoadError()))},Object.defineProperty(b.prototype,"audioTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTrack",{get:function(){return this._trackId},set:function(a){this._setAudioTrack(a),this._selectDefaultTrack=!1},enumerable:!0,configurable:!0}),b.prototype._setAudioTrack=function(a){if(this._trackId===a&&this.tracks[this._trackId].details)return void g.logger.debug("Same id as current audio-track passed, and track details available -> no-op");if(a<0||a>=this.tracks.length)return void g.logger.warn("Invalid id passed to audio-track controller");var b=this.tracks[a];g.logger.log("Now switching to audio-track index "+a),this.clearInterval(),this._trackId=a;var c=b.url,d=b.type,f=b.id;this.hls.trigger(e.default.AUDIO_TRACK_SWITCHING,{id:f,type:d,url:c}),this._loadTrackDetailsIfNeeded(b)},b.prototype.doTick=function(){this._updateTrack(this._trackId)},b.prototype._selectInitialAudioTrack=function(){var a=this,b=this.tracks;if(b.length){var c=this.tracks[this._trackId],d=null;if(c&&(d=c.name),this._selectDefaultTrack){var f=b.filter(function(a){return a.default});f.length?b=f:g.logger.warn("No default audio tracks defined")}var i=!1,j=function(){b.forEach(function(b){i||a.audioGroupId&&b.groupId!==a.audioGroupId||d&&d!==b.name||(a._setAudioTrack(b.id),i=!0)})};j(),i||(d=null,j()),i||(g.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(e.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},b.prototype._needsTrackLoading=function(a){var b=a.details,c=a.url;return!(b&&!b.live)&&!!c},b.prototype._loadTrackDetailsIfNeeded=function(a){if(this._needsTrackLoading(a)){var b=a.url,c=a.id;g.logger.log("loading audio-track playlist for id: "+c),this.hls.trigger(e.default.AUDIO_TRACK_LOADING,{url:b,id:c})}},b.prototype._updateTrack=function(a){if(!(a<0||a>=this.tracks.length)){this.clearInterval(),this._trackId=a,g.logger.log("trying to update audio-track "+a);var b=this.tracks[a];this._loadTrackDetailsIfNeeded(b)}},b.prototype._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var a=this._trackId,b=this.tracks[a],c=b.name,d=b.language,e=b.groupId;g.logger.warn("Loading failed on audio track id: "+a+", group-id: "+e+', name/language: "'+c+'" / "'+d+'"');for(var f=a,h=0;h<this.tracks.length;h++)if(!this.trackIdBlacklist[h]){var i=this.tracks[h];if(i.name===c){f=h;break}}if(f===a)return void g.logger.warn('No fallback audio-track found for name/language: "'+c+'" / "'+d+'"');g.logger.log("Attempting audio-track fallback id:",f,"group-id:",this.tracks[f].groupId),this._setAudioTrack(f)},b}(f.default);b.default=i},"./src/controller/base-stream-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/task-loop.js"),f=c("./src/controller/fragment-tracker.js"),g=c("./src/utils/buffer-helper.js"),h=c("./src/utils/logger.js");b.State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};var i=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}return d(e,c),e.prototype.doTick=function(){},e.prototype.startLoad=function(){},e.prototype.stopLoad=function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragmentTracker.removeFragment(a)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=b.State.STOPPED},e.prototype._streamEnded=function(a,b){var c=this,d=c.fragCurrent,e=c.fragmentTracker;if(!b.live&&d&&!d.backtracked&&d.sn===b.endSN&&!a.nextStart){var g=e.getState(d);return g===f.FragmentState.PARTIAL||g===f.FragmentState.OK}return!1},e.prototype.onMediaSeeking=function(){var c=this,d=c.config,e=c.media,f=c.mediaBuffer,i=c.state,j=e?e.currentTime:null,k=g.BufferHelper.bufferInfo(f||e,j,this.config.maxBufferHole);if(a.isFinite(j)&&h.logger.log("media seeking to "+j.toFixed(3)),i===b.State.FRAG_LOADING){var l=this.fragCurrent;if(0===k.len&&l){var m=d.maxFragLookUpTolerance,n=l.start-m,o=l.start+l.duration+m;j<n||j>o?(l.loader&&(h.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),l.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=b.State.IDLE):h.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else i===b.State.ENDED&&(0===k.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=b.State.IDLE);e&&(this.lastCurrentTime=j),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=j),this.tick()},e.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.prototype.onHandlerDestroying=function(){this.stopLoad(),c.prototype.onHandlerDestroying.call(this)},e.prototype.onHandlerDestroyed=function(){this.state=b.State.STOPPED,this.fragmentTracker=null},e}(e.default);b.default=i}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/buffer-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/utils/logger.js"),h=c("./src/errors.js"),i=c("./src/utils/mediasource-helper.js"),j=i.getMediaSource(),k=function(b){function c(a){var c=b.call(this,a,e.default.MEDIA_ATTACHING,e.default.MEDIA_DETACHING,e.default.MANIFEST_PARSED,e.default.BUFFER_RESET,e.default.BUFFER_APPENDING,e.default.BUFFER_CODECS,e.default.BUFFER_EOS,e.default.BUFFER_FLUSHING,e.default.LEVEL_PTS_UPDATED,e.default.LEVEL_UPDATED)||this;return c._msDuration=null,c._levelDuration=null,c._levelTargetDuration=10,c._live=null,c._objectUrl=null,c.bufferCodecEventsExpected=0,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c.tracks={},c}return d(c,b),c.prototype.destroy=function(){f.default.prototype.destroy.call(this)},c.prototype.onLevelPtsUpdated=function(a){var b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container){var d=this.sourceBuffer.audio;if(Math.abs(d.timestampOffset-a.start)>.1){var e=d.updating;try{d.abort()}catch(a){g.logger.warn("can not abort audio buffer: "+a)}e?this.audioTimestampOffset=a.start:(g.logger.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}},c.prototype.onManifestParsed=function(a){this.bufferCodecEventsExpected=a.altAudio?2:1,g.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},c.prototype.onMediaAttaching=function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new j;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=window.URL.createObjectURL(c),this._objectUrl=b.src}},c.prototype.onMediaDetaching=function(){g.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(a){g.logger.warn("onMediaDetaching:"+a.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):g.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(e.default.MEDIA_DETACHED)},c.prototype.onMediaSourceOpen=function(){g.logger.log("media source opened"),this.hls.trigger(e.default.MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},c.prototype.checkPendingTracks=function(){var a=this,b=a.bufferCodecEventsExpected,c=a.pendingTracks,d=Object.keys(c).length;(d&&!b||2===d)&&(this.createSourceBuffers(c),this.pendingTracks={},this.doAppending())},c.prototype.onMediaSourceClose=function(){g.logger.log("media source closed")},c.prototype.onMediaSourceEnded=function(){g.logger.log("media source ended")},c.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var a=this.sourceBuffer.audio;g.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0),d={},f=this.sourceBuffer;for(var h in f)d[h]=f[h].buffered;this.hls.trigger(e.default.BUFFER_APPENDED,{parent:b,pending:c,timeRanges:d}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration(),0===c&&this.flushLiveBackBuffer()},c.prototype.onSBUpdateError=function(a){g.logger.error("sourceBuffer error:",a),this.hls.trigger(e.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},c.prototype.onBufferReset=function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(a){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},c.prototype.onBufferCodecs=function(a){var b=this;if(!Object.keys(this.sourceBuffer).length){Object.keys(a).forEach(function(c){b.pendingTracks[c]=a[c]});var c=this.mediaSource;this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),c&&"open"===c.readyState&&this.checkPendingTracks()}},c.prototype.createSourceBuffers=function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var f=a[d],i=f.levelCodec||f.codec,j=f.container+";codecs="+i;g.logger.log("creating sourceBuffer("+j+")");try{var k=b[d]=c.addSourceBuffer(j);k.addEventListener("updateend",this.onsbue),k.addEventListener("error",this.onsbe),this.tracks[d]={codec:i,container:f.container},f.buffer=k}catch(a){g.logger.error("error while trying to add sourceBuffer:"+a.message),this.hls.trigger(e.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:a,mimeType:j})}}this.hls.trigger(e.default.BUFFER_CREATED,{tracks:a})},c.prototype.onBufferAppending=function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())},c.prototype.onBufferAppendFail=function(a){g.logger.error("sourceBuffer error:",a.event),this.hls.trigger(e.default.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},c.prototype.onBufferEos=function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,g.logger.log(d+" sourceBuffer now EOS"));this.checkEos()},c.prototype.checkEos=function(){var a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return void(this._needsEos=!1);for(var c in a){var d=a[c];if(!d.ended)return;if(d.updating)return void(this._needsEos=!0)}g.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(a){g.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},c.prototype.onBufferFlushing=function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()},c.prototype.flushLiveBackBuffer=function(){if(this._live){var a=this.hls.config.liveBackBufferLength;if(isFinite(a)&&!(a<0))for(var b=this.media.currentTime,c=this.sourceBuffer,d=Object.keys(c),e=b-Math.max(a,this._levelTargetDuration),f=d.length-1;f>=0;f--){var g=d[f],h=c[g].buffered;h.length>0&&e>h.start(0)&&this.removeBufferRange(g,c[g],0,e)}}},c.prototype.onLevelUpdated=function(a){var b=a.details;b.fragments.length>0&&(this._levelDuration=b.totalduration+b.fragments[0].start,this._levelTargetDuration=b.averagetargetduration||b.targetduration||10,this._live=b.live,this.updateMediaElementDuration())},c.prototype.updateMediaElementDuration=function(){var b,c=this.hls.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var d in this.sourceBuffer)if(!0===this.sourceBuffer[d].updating)return;b=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===c.liveDurationInfinity?(g.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>b||!a.isFinite(b))&&(g.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},c.prototype.doFlush=function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;try{for(var d in c)b+=c[d].buffered.length}catch(a){g.logger.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(e.default.BUFFER_FLUSHED)}},c.prototype.doAppending=function(){var a=this,b=a.hls,c=a.segments,d=a.sourceBuffer;if(Object.keys(d).length){if(this.media.error)return this.segments=[],void g.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(c&&c.length){var f=c.shift();try{var i=f.type,j=d[i];j?j.updating?c.unshift(f):(j.ended=!1,this.parent=f.parent,j.appendBuffer(f.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(a){g.logger.error("error while trying to append buffer:"+a.message),c.unshift(f);var k={type:h.ErrorTypes.MEDIA_ERROR,parent:f.parent};22!==a.code?(this.appendError?this.appendError++:this.appendError=1,k.details=h.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>b.config.appendErrorMaxRetry?(g.logger.log("fail "+b.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],k.fatal=!0,b.trigger(e.default.ERROR,k)):(k.fatal=!1,b.trigger(e.default.ERROR,k))):(this.segments=[],k.details=h.ErrorDetails.BUFFER_FULL_ERROR,k.fatal=!1,b.trigger(e.default.ERROR,k))}}}},c.prototype.flushBuffer=function(a,b,c){var d,e=this.sourceBuffer;if(Object.keys(e).length){if(g.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var f in e)if(!c||f===c){if(d=e[f],d.ended=!1,d.updating)return g.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(f,d,a,b))return this.flushBufferCounter++,!1}}else g.logger.warn("abort flushing too many retries");g.logger.log("buffer flushed")}return!0},c.prototype.removeBufferRange=function(a,b,c,d){try{for(var e=0;e<b.buffered.length;e++){var f=b.buffered.start(e),h=b.buffered.end(e),i=Math.max(f,c),j=Math.min(h,d);if(Math.min(j,h)-i>.5)return g.logger.log("sb remove "+a+" ["+i+","+j+"], of ["+f+","+h+"], pos:"+this.media.currentTime),b.remove(i,j),!0}}catch(a){g.logger.warn("removeBufferRange failed",a)}return!1},c}(f.default);b.default=k}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/cap-level-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=function(b){function c(c){var d=b.call(this,c,e.default.FPS_DROP_LEVEL_CAPPING,e.default.MEDIA_ATTACHING,e.default.MANIFEST_PARSED,e.default.BUFFER_CODECS,e.default.MEDIA_DETACHING)||this;return d.autoLevelCapping=a.POSITIVE_INFINITY,d.firstLevel=null,d.levels=[],d.media=null,d.restrictedLevels=[],d.timer=null,d}return d(c,b),c.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this._stopCapping())},c.prototype.onFpsDropLevelCapping=function(a){c.isLevelAllowed(a.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(a.droppedLevel)},c.prototype.onMediaAttaching=function(a){this.media=a.media instanceof window.HTMLVideoElement?a.media:null},c.prototype.onManifestParsed=function(a){var b=this.hls;this.restrictedLevels=[],this.levels=a.levels,this.firstLevel=a.firstLevel,b.config.capLevelToPlayerSize&&a.video&&this._startCapping()},c.prototype.onBufferCodecs=function(a){this.hls.config.capLevelToPlayerSize&&a.video&&this._startCapping()},c.prototype.onLevelsUpdated=function(a){this.levels=a.levels},c.prototype.onMediaDetaching=function(){this._stopCapping()},c.prototype.detectPlayerSize=function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}},c.prototype.getMaxLevel=function(a){var b=this;if(!this.levels)return-1;var d=this.levels.filter(function(d,e){return c.isLevelAllowed(e,b.restrictedLevels)&&e<=a});return c.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},c.prototype._startCapping=function(){this.timer||(this.autoLevelCapping=a.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},c.prototype._stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=a.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},Object.defineProperty(c.prototype,"mediaWidth",{get:function(){var a,b=this.media;return b&&(a=b.width||b.clientWidth||b.offsetWidth,a*=c.contentScaleFactor),a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"mediaHeight",{get:function(){var a,b=this.media;return b&&(a=b.height||b.clientHeight||b.offsetHeight,a*=c.contentScaleFactor),a},enumerable:!0,configurable:!0}),Object.defineProperty(c,"contentScaleFactor",{get:function(){var a=1;try{a=window.devicePixelRatio}catch(a){}return a},enumerable:!0,configurable:!0}),c.isLevelAllowed=function(a,b){return void 0===b&&(b=[]),-1===b.indexOf(a)},c.getMaxLevelByMediaSize=function(a,b,c){if(!a||a&&!a.length)return-1;for(var d=function(a,b){return!b||(a.width!==b.width||a.height!==b.height)},e=a.length-1,f=0;f<a.length;f+=1){var g=a[f];if((g.width>=b||g.height>=c)&&d(g,a[f+1])){e=f;break}}return e},c}(f.default);b.default=g}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/eme-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/event-handler.js"),f=c("./src/events.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=window.XMLHttpRequest,j=3,k={WIDEVINE:"com.widevine.alpha",PLAYREADY:"com.microsoft.playready"},l=function(a,b,c){var d={videoCapabilities:[]};return b.forEach(function(a){d.videoCapabilities.push({contentType:'video/mp4; codecs="'+a+'"'})}),[d]},m=function(a,b,c){switch(a){case k.WIDEVINE:return l(b,c);default:throw Error("Unknown key-system: "+a)}},n=function(a){function b(b){var c=a.call(this,b,f.default.MEDIA_ATTACHED,f.default.MANIFEST_PARSED)||this;return c._widevineLicenseUrl=b.config.widevineLicenseUrl,c._licenseXhrSetup=b.config.licenseXhrSetup,c._emeEnabled=b.config.emeEnabled,c._requestMediaKeySystemAccess=b.config.requestMediaKeySystemAccessFunc,c._mediaKeysList=[],c._media=null,c._hasSetMediaKeys=!1,c._isMediaEncrypted=!1,c._requestLicenseFailureCount=0,c}return d(b,a),b.prototype.getLicenseServerUrl=function(a){var b;switch(a){case k.WIDEVINE:b=this._widevineLicenseUrl;break;default:b=null}return b||(h.logger.error('No license server URL configured for key-system "'+a+'"'),this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})),b},b.prototype._attemptKeySystemAccess=function(a,b,c){var d=this,e=m(a,b,c);if(!e)return void h.logger.warn("Can not create config for key-system (maybe because platform is not supported):",a);h.logger.log("Requesting encrypted media key-system access"),this.requestMediaKeySystemAccess(a,e).then(function(b){d._onMediaKeySystemAccessObtained(a,b)}).catch(function(b){h.logger.error('Failed to obtain key-system "'+a+'" access:',b)})},Object.defineProperty(b.prototype,"requestMediaKeySystemAccess",{get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess},enumerable:!0,configurable:!0}),b.prototype._onMediaKeySystemAccessObtained=function(a,b){var c=this;h.logger.log('Access for key-system "'+a+'" obtained');var d={mediaKeys:null,mediaKeysSession:null,mediaKeysSessionInitialized:!1,mediaKeySystemAccess:b,mediaKeySystemDomain:a};this._mediaKeysList.push(d),b.createMediaKeys().then(function(b){d.mediaKeys=b,h.logger.log('Media-keys created for key-system "'+a+'"'),c._onMediaKeysCreated()}).catch(function(a){h.logger.error("Failed to create media-keys:",a)})},b.prototype._onMediaKeysCreated=function(){var a=this;this._mediaKeysList.forEach(function(b){b.mediaKeysSession||(b.mediaKeysSession=b.mediaKeys.createSession(),a._onNewMediaKeySession(b.mediaKeysSession))})},b.prototype._onNewMediaKeySession=function(a){var b=this;h.logger.log("New key-system session "+a.sessionId),a.addEventListener("message",function(c){b._onKeySessionMessage(a,c.message)},!1)},b.prototype._onKeySessionMessage=function(a,b){h.logger.log("Got EME message event, creating license request"),this._requestLicense(b,function(b){h.logger.log("Received license data, updating key-session"),a.update(b)})},b.prototype._onMediaEncrypted=function(a,b){h.logger.log('Media is encrypted using "'+a+'" init data type'),this._isMediaEncrypted=!0,this._mediaEncryptionInitDataType=a,this._mediaEncryptionInitData=b,this._attemptSetMediaKeys(),this._generateRequestWithPreferredKeySession()},b.prototype._attemptSetMediaKeys=function(){if(!this._hasSetMediaKeys){var a=this._mediaKeysList[0];if(!a||!a.mediaKeys)return h.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});h.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(a.mediaKeys),this._hasSetMediaKeys=!0}},b.prototype._generateRequestWithPreferredKeySession=function(){var a=this,b=this._mediaKeysList[0];if(!b)return h.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(b.mediaKeysSessionInitialized)return void h.logger.warn("Key-Session already initialized but requested again");var c=b.mediaKeysSession;c||(h.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0}));var d=this._mediaEncryptionInitDataType,e=this._mediaEncryptionInitData;h.logger.log('Generating key-session request for "'+d+'" init data type'),b.mediaKeysSessionInitialized=!0,c.generateRequest(d,e).then(function(){h.logger.debug("Key-session generation succeeded")}).catch(function(b){h.logger.error("Error generating key-session request:",b),a.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},b.prototype._createLicenseXhr=function(a,b,c){var d=new i,e=this._licenseXhrSetup;try{if(e)try{e(d,a)}catch(b){d.open("POST",a,!0),e(d,a)}d.readyState||d.open("POST",a,!0)}catch(a){return h.logger.error("Error setting up key-system license XHR",a),void this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}return d.responseType="arraybuffer",d.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,d,a,b,c),d},b.prototype._onLicenseRequestReadyStageChange=function(a,b,c,d){switch(a.readyState){case 4:if(200===a.status)this._requestLicenseFailureCount=0,h.logger.log("License request succeeded"),d(a.response);else{if(h.logger.error("License Request XHR failed ("+b+"). Status: "+a.status+" ("+a.statusText+")"),++this._requestLicenseFailureCount<=j){var e=j-this._requestLicenseFailureCount+1;return h.logger.warn("Retrying license request, "+e+" attempts left"),void this._requestLicense(c,d)}this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}}},b.prototype._generateLicenseRequestChallenge=function(a,b){var c;return a.mediaKeySystemDomain===k.PLAYREADY?h.logger.error("PlayReady is not supported (yet)"):a.mediaKeySystemDomain===k.WIDEVINE?c=b:h.logger.error("Unsupported key-system:",a.mediaKeySystemDomain),c},b.prototype._requestLicense=function(a,b){h.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(!c)return h.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(f.default.ERROR,{type:g.ErrorTypes.KEY_SYSTEM_ERROR,details:g.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});var d=this.getLicenseServerUrl(c.mediaKeySystemDomain),e=this._createLicenseXhr(d,a,b);h.logger.log("Sending license request to URL: "+d),e.send(this._generateLicenseRequestChallenge(c,a))},b.prototype.onMediaAttached=function(a){var b=this;if(this._emeEnabled){var c=a.media;this._media=c,c.addEventListener("encrypted",function(a){b._onMediaEncrypted(a.initDataType,a.initData)})}},b.prototype.onManifestParsed=function(a){if(this._emeEnabled){var b=a.levels.map(function(a){return a.audioCodec}),c=a.levels.map(function(a){return a.videoCodec});this._attemptKeySystemAccess(k.WIDEVINE,b,c)}},b}(e.default);b.default=n},"./src/controller/fps-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/utils/logger.js"),h=window.performance,i=function(a){function b(b){return a.call(this,b,e.default.MEDIA_ATTACHING)||this}return d(b,a),b.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},b.prototype.onMediaAttaching=function(a){var b=this.hls.config;if(b.capLevelOnFPSDrop){"function"==typeof(this.video=a.media instanceof window.HTMLVideoElement?a.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}},b.prototype.checkFPS=function(a,b,c){var d=h.now();if(b){if(this.lastTime){var f=d-this.lastTime,i=c-this.lastDroppedFrames,j=b-this.lastDecodedFrames,k=1e3*i/f,l=this.hls;if(l.trigger(e.default.FPS_DROP,{currentDropped:i,currentDecoded:j,totalDroppedFrames:c}),k>0&&i>l.config.fpsDroppedMonitoringThreshold*j){var m=l.currentLevel;g.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=m)&&(m-=1,l.trigger(e.default.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:l.currentLevel}),l.autoLevelCapping=m,l.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}},b.prototype.checkFPSInterval=function(){var a=this.video;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)},b}(f.default);b.default=i},"./src/controller/fragment-finders.js":function(a,b,c){"use strict";(function(a){function d(b,c,d){if(!Array.isArray(b)||!b.length||!a.isFinite(c))return null;if(c<b[0].programDateTime)return null;if(c>=b[b.length-1].endProgramDateTime)return null;d=d||0;for(var e=0;e<b.length;++e){var f=b[e];if(g(c,d,f))return f}return null}function e(a,b,c,d){void 0===c&&(c=0),void 0===d&&(d=0);var e=a?b[a.sn-b[0].sn+1]:null;return e&&!f(c,d,e)?e:h.default.search(b,f.bind(null,c,d))}function f(a,b,c){void 0===a&&(a=0),void 0===b&&(b=0);var d=Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-d<=a?1:c.start-d>a&&c.start?-1:0}function g(a,b,c){var d=1e3*Math.min(b,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.endProgramDateTime-d>a}Object.defineProperty(b,"__esModule",{value:!0});var h=c("./src/utils/binary-search.js");b.findFragmentByPDT=d,b.findFragmentByPTS=e,b.fragmentWithinToleranceTest=f,b.pdtWithinToleranceTest=g}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/fragment-tracker.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/event-handler.js"),f=c("./src/events.js");b.FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};var g=function(c){function g(a){var b=c.call(this,a,f.default.BUFFER_APPENDED,f.default.FRAG_BUFFERED,f.default.FRAG_LOADED)||this;return b.bufferPadding=.2,b.fragments=Object.create(null),b.timeRanges=Object.create(null),b.config=a.config,b}return d(g,c),g.prototype.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,e.default.prototype.destroy.call(this),c.prototype.destroy.call(this)},g.prototype.getBufferedFrag=function(a,b){var c=this.fragments,d=Object.keys(c).filter(function(d){var e=c[d];if(e.body.type!==b)return!1;if(!e.buffered)return!1;var f=e.body;return f.startPTS<=a&&a<=f.endPTS});if(0===d.length)return null;var e=d.pop();return c[e].body},g.prototype.detectEvictedFragments=function(a,b){var c,d,e=this;Object.keys(this.fragments).forEach(function(f){var g=e.fragments[f];if(!0===g.buffered){var h=g.range[a];if(h){c=h.time;for(var i=0;i<c.length;i++)if(d=c[i],!1===e.isTimeBuffered(d.startPTS,d.endPTS,b)){e.removeFragment(g.body);break}}}})},g.prototype.detectPartialFragments=function(a){var b=this,c=this.getFragmentKey(a),d=this.fragments[c];d&&(d.buffered=!0,Object.keys(this.timeRanges).forEach(function(c){if(a.hasElementaryStream(c)){var e=b.timeRanges[c];d.range[c]=b.getBufferedTimes(a.startPTS,a.endPTS,e)}}))},g.prototype.getBufferedTimes=function(a,b,c){for(var d,e,f=[],g=!1,h=0;h<c.length;h++){if(d=c.start(h)-this.bufferPadding,e=c.end(h)+this.bufferPadding,a>=d&&b<=e){f.push({startPTS:Math.max(a,c.start(h)),endPTS:Math.min(b,c.end(h))});break}if(a<e&&b>d)f.push({startPTS:Math.max(a,c.start(h)),endPTS:Math.min(b,c.end(h))}),g=!0;else if(b<=d)break}return{time:f,partial:g}},g.prototype.getFragmentKey=function(a){return a.type+"_"+a.level+"_"+a.urlId+"_"+a.sn},g.prototype.getPartialFragment=function(a){var b,c,d,e=this,f=null,g=0;return Object.keys(this.fragments).forEach(function(h){var i=e.fragments[h];e.isPartial(i)&&(c=i.body.startPTS-e.bufferPadding,d=i.body.endPTS+e.bufferPadding,a>=c&&a<=d&&(b=Math.min(a-c,d-a),g<=b&&(f=i.body,g=b)))}),f},g.prototype.getState=function(a){var c=this.getFragmentKey(a),d=this.fragments[c],e=b.FragmentState.NOT_LOADED;return void 0!==d&&(e=d.buffered?!0===this.isPartial(d)?b.FragmentState.PARTIAL:b.FragmentState.OK:b.FragmentState.APPENDING),e},g.prototype.isPartial=function(a){return!0===a.buffered&&(void 0!==a.range.video&&!0===a.range.video.partial||void 0!==a.range.audio&&!0===a.range.audio.partial)},g.prototype.isTimeBuffered=function(a,b,c){for(var d,e,f=0;f<c.length;f++){if(d=c.start(f)-this.bufferPadding,e=c.end(f)+this.bufferPadding,a>=d&&b<=e)return!0;if(b<=d)return!1}return!1},g.prototype.onFragLoaded=function(b){var c=b.frag;a.isFinite(c.sn)&&!c.bitrateTest&&(this.fragments[this.getFragmentKey(c)]={body:c,range:Object.create(null),buffered:!1})},g.prototype.onBufferAppended=function(a){var b=this;this.timeRanges=a.timeRanges,Object.keys(this.timeRanges).forEach(function(a){var c=b.timeRanges[a];b.detectEvictedFragments(a,c)})},g.prototype.onFragBuffered=function(a){this.detectPartialFragments(a.frag)},g.prototype.hasFragment=function(a){var b=this.getFragmentKey(a);return void 0!==this.fragments[b]},g.prototype.removeFragment=function(a){var b=this.getFragmentKey(a);delete this.fragments[b]},g.prototype.removeAllFragments=function(){this.fragments=Object.create(null)},g}(e.default);b.FragmentTracker=g}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/gap-controller.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/buffer-helper.js"),e=c("./src/errors.js"),f=c("./src/events.js"),g=c("./src/utils/logger.js"),h=1e3,i=.5,j=function(){function a(a,b,c,d){this.config=a,this.media=b,this.fragmentTracker=c,this.hls=d,this.stallReported=!1}return a.prototype.poll=function(a,b){var c=this,e=c.config,f=c.media,i=f.currentTime,j=window.performance.now();if(i!==a)return this.stallReported&&(g.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(j-this.stalled)+"ms"),this.stallReported=!1),this.stalled=null,void(this.nudgeRetry=0);if(!(f.ended||!f.buffered.length||f.readyState>2||f.seeking&&d.BufferHelper.isBuffered(f,i))){var k=j-this.stalled,l=d.BufferHelper.bufferInfo(f,i,e.maxBufferHole);if(!this.stalled)return void(this.stalled=j);k>=h&&this._reportStall(l.len),this._tryFixBufferStall(l,k)}},a.prototype._tryFixBufferStall=function(a,b){var c=this,d=c.config,e=c.fragmentTracker,f=c.media,g=f.currentTime,h=e.getPartialFragment(g);h&&this._trySkipBufferHole(h),a.len>i&&b>1e3*d.highBufferWatchdogPeriod&&(this.stalled=null,this._tryNudgeBuffer())},a.prototype._reportStall=function(a){var b=this,c=b.hls,d=b.media;b.stallReported||(this.stallReported=!0,g.logger.warn("Playback stalling at @"+d.currentTime+" due to low buffer"),c.trigger(f.default.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:a}))},a.prototype._trySkipBufferHole=function(a){for(var b=this,c=b.hls,d=b.media,h=d.currentTime,i=0,j=0;j<d.buffered.length;j++){var k=d.buffered.start(j);if(h>=i&&h<k)return d.currentTime=Math.max(k,d.currentTime+.1),g.logger.warn("skipping hole, adjusting currentTime from "+h+" to "+d.currentTime),this.stalled=null,void c.trigger(f.default.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+h+" to "+d.currentTime,frag:a});i=d.buffered.end(j)}},a.prototype._tryNudgeBuffer=function(){var a=this,b=a.config,c=a.hls,d=a.media,h=d.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<b.nudgeMaxRetry){var j=h+i*b.nudgeOffset;g.logger.log("adjust currentTime from "+h+" to "+j),d.currentTime=j,c.trigger(f.default.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else g.logger.error("still stuck in high buffer @"+h+" after "+b.nudgeMaxRetry+", raise fatal error"),c.trigger(f.default.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},a}();b.default=j},"./src/controller/id3-track-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/demux/id3.js"),h=c("./src/utils/texttrack-utils.js"),i=function(a){function b(b){var c=a.call(this,b,e.default.MEDIA_ATTACHED,e.default.MEDIA_DETACHING,e.default.FRAG_PARSING_METADATA)||this;return c.id3Track=void 0,c.media=void 0,c}return d(b,a),b.prototype.destroy=function(){f.default.prototype.destroy.call(this)},b.prototype.onMediaAttached=function(a){this.media=a.media,this.media},b.prototype.onMediaDetaching=function(){h.clearCurrentCues(this.id3Track),this.id3Track=void 0,this.media=void 0},b.prototype.getID3Track=function(a){for(var b=0;b<a.length;b++){var c=a[b];if("metadata"===c.kind&&"id3"===c.label)return h.sendAddTrackEvent(c,this.media),c}return this.media.addTextTrack("metadata","id3")},b.prototype.onFragParsingMetadata=function(a){var b=a.frag,c=a.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var d=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,e=0;e<c.length;e++){var f=g.default.getID3Frames(c[e].data);if(f){var h=c[e].pts,i=e<c.length-1?c[e+1].pts:b.endPTS;h===i&&(i+=1e-4);for(var j=0;j<f.length;j++){var k=f[j];if(!g.default.isTimeStampFrame(k)){var l=new d(h,i,"");l.value=k,this.id3Track.addCue(l)}}}}},b}(f.default);b.default=i},"./src/controller/level-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c("./src/events.js"),g=c("./src/event-handler.js"),h=c("./src/utils/logger.js"),i=c("./src/errors.js"),j=c("./src/utils/codecs.js"),k=c("./src/controller/level-helper.js"),l=(window.performance,function(a){function b(b){var c=a.call(this,b,f.default.MANIFEST_LOADED,f.default.LEVEL_LOADED,f.default.AUDIO_TRACK_SWITCHED,f.default.FRAG_LOADED,f.default.ERROR)||this;return c.canload=!1,c.currentLevelIndex=null,c.manualLevelIndex=-1,c.timer=null,e=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),c}return d(b,a),b.prototype.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},b.prototype.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},b.prototype.startLoad=function(){var a=this._levels;this.canload=!0,this.levelRetryCount=0,a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),null!==this.timer&&this.loadLevel()},b.prototype.stopLoad=function(){this.canload=!1},b.prototype.onManifestLoaded=function(a){var b,c=[],d=[],g={},l=null,m=!1,n=!1;if(a.levels.forEach(function(a){var b=a.attrs;a.loadError=0,a.fragmentError=!1,m=m||!!a.videoCodec,n=n||!!a.audioCodec,e&&a.audioCodec&&-1!==a.audioCodec.indexOf("mp4a.40.34")&&(a.audioCodec=void 0),l=g[a.bitrate],l?l.url.push(a.url):(a.url=[a.url],a.urlId=0,g[a.bitrate]=a,c.push(a)),b&&(b.AUDIO&&(n=!0,k.addGroupId(l||a,"audio",b.AUDIO)),b.SUBTITLES&&k.addGroupId(l||a,"text",b.SUBTITLES))}),m&&n&&(c=c.filter(function(a){return!!a.videoCodec})),c=c.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||j.isCodecSupportedInMp4(b,"audio"))&&(!c||j.isCodecSupportedInMp4(c,"video"))}),a.audioTracks&&(d=a.audioTracks.filter(function(a){return!a.audioCodec||j.isCodecSupportedInMp4(a.audioCodec,"audio")}),d.forEach(function(a,b){a.id=b})),c.length>0){b=c[0].bitrate,c.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=c;for(var o=0;o<c.length;o++)if(c[o].bitrate===b){this._firstLevel=o,h.logger.log("manifest loaded,"+c.length+" level(s) found, first bitrate:"+b);break}this.hls.trigger(f.default.MANIFEST_PARSED,{levels:c,audioTracks:d,firstLevel:this._firstLevel,stats:a.stats,audio:n,video:m,altAudio:d.some(function(a){return!!a.url})})}else this.hls.trigger(f.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},Object.defineProperty(b.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"level",{get:function(){return this.currentLevelIndex},set:function(a){var b=this._levels;b&&(a=Math.min(a,b.length-1),this.currentLevelIndex===a&&b[a].details||this.setLevelInternal(a))},enumerable:!0,configurable:!0}),b.prototype.setLevelInternal=function(a){var b=this._levels,c=this.hls;if(a>=0&&a<b.length){if(this.clearTimer(),this.currentLevelIndex!==a){h.logger.log("switching to level "+a),this.currentLevelIndex=a;var d=b[a];d.level=a,c.trigger(f.default.LEVEL_SWITCHING,d)}var e=b[a],g=e.details;if(!g||g.live){var j=e.urlId;c.trigger(f.default.LEVEL_LOADING,{url:e.url[j],level:a,id:j})}}else c.trigger(f.default.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})},Object.defineProperty(b.prototype,"manualLevel",{get:function(){return this.manualLevelIndex},set:function(a){this.manualLevelIndex=a,void 0===this._startLevel&&(this._startLevel=a),-1!==a&&(this.level=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"firstLevel",{get:function(){return this._firstLevel},set:function(a){this._firstLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"startLevel",{get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){this._startLevel=a},enumerable:!0,configurable:!0}),b.prototype.onError=function(a){if(a.fatal)return void(a.type===i.ErrorTypes.NETWORK_ERROR&&this.clearTimer());var b,c=!1,d=!1;switch(a.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:b=a.frag.level,d=!0;break;case i.ErrorDetails.LEVEL_LOAD_ERROR:case i.ErrorDetails.LEVEL_LOAD_TIMEOUT:b=a.context.level,c=!0;break;case i.ErrorDetails.REMUX_ALLOC_ERROR:b=a.level,c=!0}void 0!==b&&this.recoverLevel(a,b,c,d)},b.prototype.recoverLevel=function(a,b,c,d){var e,f,g,i=this,j=this.hls.config,k=a.details,l=this._levels[b];if(l.loadError++,l.fragmentError=d,c){if(!(this.levelRetryCount+1<=j.levelLoadingMaxRetry))return h.logger.error("level controller, cannot recover from "+k+" error"),this.currentLevelIndex=null,this.clearTimer(),void(a.fatal=!0);f=Math.min(Math.pow(2,this.levelRetryCount)*j.levelLoadingRetryDelay,j.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return i.loadLevel()},f),a.levelRetry=!0,this.levelRetryCount++,h.logger.warn("level controller, "+k+", retry in "+f+" ms, current retry count is "+this.levelRetryCount)}(c||d)&&(e=l.url.length,e>1&&l.loadError<e?(l.urlId=(l.urlId+1)%e,l.details=void 0,h.logger.warn("level controller, "+k+" for level "+b+": switching to redundant URL-id "+l.urlId)):-1===this.manualLevelIndex?(g=0===b?this._levels.length-1:b-1,h.logger.warn("level controller, "+k+": switch to "+g),this.hls.nextAutoLevel=this.currentLevelIndex=g):d&&(h.logger.warn("level controller, "+k+": reload a fragment"),this.currentLevelIndex=null))},b.prototype.onFragLoaded=function(a){var b=a.frag;if(void 0!==b&&"main"===b.type){var c=this._levels[b.level];void 0!==c&&(c.fragmentError=!1,c.loadError=0,this.levelRetryCount=0)}},b.prototype.onLevelLoaded=function(a){var b=this,c=a.level,d=a.details;if(c===this.currentLevelIndex){var e=this._levels[c];if(e.fragmentError||(e.loadError=0,this.levelRetryCount=0),d.live){var f=k.computeReloadInterval(e.details,d,a.stats.trequest);h.logger.log("live playlist, reload in "+Math.round(f)+" ms"),this.timer=setTimeout(function(){return b.loadLevel()},f)}else this.clearTimer()}},b.prototype.onAudioTrackSwitched=function(a){var b=this.hls.audioTracks[a.id].groupId,c=this.hls.levels[this.currentLevelIndex];if(c&&c.audioGroupIds){for(var d=-1,e=0;e<c.audioGroupIds.length;e++)if(c.audioGroupIds[e]===b){d=e;break}d!==c.urlId&&(c.urlId=d,this.startLoad())}},b.prototype.loadLevel=function(){if(h.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var a=this._levels[this.currentLevelIndex];if("object"==typeof a&&a.url.length>0){var b=this.currentLevelIndex,c=a.urlId,d=a.url[c];h.logger.log("Attempt loading level index "+b+" with URL-id "+c),this.hls.trigger(f.default.LEVEL_LOADING,{url:d,level:b,id:c})}}},Object.defineProperty(b.prototype,"nextLoadLevel",{get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(a){this.level=a,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=a)},enumerable:!0,configurable:!0}),b}(g.default));b.default=l},"./src/controller/level-helper.js":function(a,b,c){"use strict";(function(a){function d(a,b,c){switch(b){case"audio":a.audioGroupIds||(a.audioGroupIds=[]),a.audioGroupIds.push(c);break;case"text":a.textGroupIds||(a.textGroupIds=[]),a.textGroupIds.push(c)}}function e(b,c,d){var e=b[c],f=b[d],g=f.startPTS;a.isFinite(g)?d>c?(e.duration=g-e.start,e.duration<0&&l.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!")):(f.duration=e.start-g,f.duration<0&&l.logger.warn("negative duration computed for frag "+f.sn+",level "+f.level+", there should be some duration drift between playlist and fragment!")):f.start=d>c?e.start+e.duration:Math.max(e.start-f.duration,0)}function f(b,c,d,f,g,h){var i=d;if(a.isFinite(c.startPTS)){var j=Math.abs(c.startPTS-d);a.isFinite(c.deltaPTS)?c.deltaPTS=Math.max(j,c.deltaPTS):c.deltaPTS=j,i=Math.max(d,c.startPTS),d=Math.min(d,c.startPTS),f=Math.max(f,c.endPTS),g=Math.min(g,c.startDTS),h=Math.max(h,c.endDTS)}var k=d-c.start;c.start=c.startPTS=d,c.maxStartPTS=i,c.endPTS=f,c.startDTS=g,c.endDTS=h,c.duration=f-d;var l=c.sn;if(!b||l<b.startSN||l>b.endSN)return 0;var m,n,o;for(m=l-b.startSN,n=b.fragments,n[m]=c,o=m;o>0;o--)e(n,o,o-1);for(o=m;o<n.length-1;o++)e(n,o,o+1);return b.PTSKnown=!0,k}function g(b,c){c.initSegment&&b.initSegment&&(c.initSegment=b.initSegment);var d,e=0;if(i(b,c,function(b,f){e=b.cc-f.cc,a.isFinite(b.startPTS)&&(f.start=f.startPTS=b.startPTS,f.endPTS=b.endPTS,f.duration=b.duration,f.backtracked=b.backtracked,f.dropped=b.dropped,d=f),c.PTSKnown=!0}),c.PTSKnown){if(e){l.logger.log("discontinuity sliding from playlist, take drift into account");for(var g=c.fragments,h=0;h<g.length;h++)g[h].cc+=e}d?f(c,d,d.startPTS,d.endPTS,d.startDTS,d.endDTS):j(b,c),c.PTSKnown=b.PTSKnown}}function h(a,b,c){void 0===c&&(c=0);var d=-1;i(a,b,function(a,b,c){b.start=a.start,d=c});var e=b.fragments;if(d<0)return void e.forEach(function(a){a.start+=c});for(var f=d+1;f<e.length;f++)e[f].start=e[f-1].start+e[f-1].duration}function i(a,b,c){if(a&&b)for(var d=Math.max(a.startSN,b.startSN)-b.startSN,e=Math.min(a.endSN,b.endSN)-b.startSN,f=b.startSN-a.startSN,g=d;g<=e;g++){var h=a.fragments[f+g],i=b.fragments[g];if(!h||!i)break;c(h,i,g)}}function j(a,b){var c=b.startSN-a.startSN,d=a.fragments,e=b.fragments;if(!(c<0||c>d.length))for(var f=0;f<e.length;f++)e[f].start+=d[c].start}function k(a,b,c){var d=1e3*(b.averagetargetduration?b.averagetargetduration:b.targetduration),e=d/2;return a&&b.endSN===a.endSN&&(d=e),c&&(d=Math.max(e,d-(window.performance.now()-c))),Math.round(d)}Object.defineProperty(b,"__esModule",{value:!0});var l=c("./src/utils/logger.js");b.addGroupId=d,b.updatePTS=e,b.updateFragPTSDTS=f,b.mergeDetails=g,b.mergeSubtitlePlaylists=h,b.mapFragmentIntersection=i,b.adjustSliding=j,b.computeReloadInterval=k}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/stream-controller.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/utils/binary-search.js"),f=c("./src/utils/buffer-helper.js"),g=c("./src/demux/demuxer.js"),h=c("./src/events.js"),i=c("./src/controller/fragment-tracker.js"),j=c("./src/loader/fragment.js"),k=c("./src/loader/playlist-loader.js"),l=c("./src/controller/level-helper.js"),m=c("./src/utils/time-ranges.js"),n=c("./src/errors.js"),o=c("./src/utils/logger.js"),p=c("./src/utils/discontinuities.js"),q=c("./src/controller/fragment-finders.js"),r=c("./src/controller/gap-controller.js"),s=c("./src/controller/base-stream-controller.js"),t=100,u=function(b){function c(a,c){var d=b.call(this,a,h.default.MEDIA_ATTACHED,h.default.MEDIA_DETACHING,h.default.MANIFEST_LOADING,h.default.MANIFEST_PARSED,h.default.LEVEL_LOADED,h.default.KEY_LOADED,h.default.FRAG_LOADED,h.default.FRAG_LOAD_EMERGENCY_ABORTED,h.default.FRAG_PARSING_INIT_SEGMENT,h.default.FRAG_PARSING_DATA,h.default.FRAG_PARSED,h.default.ERROR,h.default.AUDIO_TRACK_SWITCHING,h.default.AUDIO_TRACK_SWITCHED,h.default.BUFFER_CREATED,h.default.BUFFER_APPENDED,h.default.BUFFER_FLUSHED)||this;return d.fragmentTracker=c,d.config=a.config,d.audioCodecSwap=!1,d._state=s.State.STOPPED,d.stallReported=!1,d.gapController=null,d}return d(c,b),c.prototype.startLoad=function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.setInterval(t),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;-1===d&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&-1===a&&(o.logger.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=s.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else this.forceStartLoad=!0,this.state=s.State.STOPPED},c.prototype.stopLoad=function(){this.forceStartLoad=!1,b.prototype.stopLoad.call(this)},c.prototype.doTick=function(){switch(this.state){case s.State.BUFFER_FLUSHING:this.fragLoadError=0;break;case s.State.IDLE:this._doTickIdle();break;case s.State.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=s.State.IDLE);break;case s.State.FRAG_LOADING_WAITING_RETRY:var b=window.performance.now(),c=this.retryDate;(!c||b>=c||this.media&&this.media.seeking)&&(o.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=s.State.IDLE);break;case s.State.ERROR:case s.State.STOPPED:case s.State.FRAG_LOADING:case s.State.PARSING:case s.State.PARSED:case s.State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},c.prototype._doTickIdle=function(){var a=this.hls,b=a.config,c=this.media;if(void 0!==this.levelLastLoaded&&(c||!this.startFragRequested&&b.startFragPrefetch)){var d;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,g=this.levels[e];if(g){var i,j=g.bitrate;i=j?Math.max(8*b.maxBufferSize/j,b.maxBufferLength):b.maxBufferLength,i=Math.min(i,b.maxMaxBufferLength);var k=f.BufferHelper.bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),l=k.len;if(!(l>=i)){o.logger.trace("buffer length of "+l.toFixed(3)+" is below max of "+i.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e;var m=g.details;if(!m||m.live&&this.levelLastLoaded!==e)return void(this.state=s.State.WAITING_LEVEL);if(this._streamEnded(k,m)){var n={};return this.altAudio&&(n.type="video"),this.hls.trigger(h.default.BUFFER_EOS,n),void(this.state=s.State.ENDED)}this._fetchPayloadOrEos(d,k,m)}}}},c.prototype._fetchPayloadOrEos=function(a,b,c){var d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0!==g){var h,i=f[0].start,j=f[g-1].start+f[g-1].duration,k=b.end;if(c.initSegment&&!c.initSegment.data)h=c.initSegment;else if(c.live){var l=this.config.initialLiveManifestSize;if(g<l)return void o.logger.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l);if(null===(h=this._ensureFragmentAtLivePoint(c,k,i,j,d,f,g)))return}else k<i&&(h=f[0]);h||(h=this._findFragment(i,d,g,f,k,j,c)),h&&(h.encrypted?(o.logger.log("Loading key for "+h.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e),this._loadKey(h)):(o.logger.log("Loading "+h.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e+", currentTime:"+a.toFixed(3)+",bufferEnd:"+k.toFixed(3)),this._loadFragment(h)))}},c.prototype._ensureFragmentAtLivePoint=function(a,b,c,d,f,g,h){var i,j=this.hls.config,k=this.media,l=void 0!==j.liveMaxLatencyDuration?j.liveMaxLatencyDuration:j.liveMaxLatencyDurationCount*a.targetduration;if(b<Math.max(c-j.maxFragLookUpTolerance,d-l)){var m=this.liveSyncPosition=this.computeLivePosition(c,a);o.logger.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+m.toFixed(3)),b=m,k&&k.readyState&&k.duration>m&&(k.currentTime=m),this.nextLoadPosition=m}if(a.PTSKnown&&b>d&&k&&k.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(f)if(a.hasProgramDateTime)o.logger.log("live playlist, switching playlist, load frag with same PDT: "+f.programDateTime),i=q.findFragmentByPDT(g,f.endProgramDateTime,j.maxFragLookUpTolerance);else{var n=f.sn+1;if(n>=a.startSN&&n<=a.endSN){var p=g[n-a.startSN];f.cc===p.cc&&(i=p,o.logger.log("live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=e.default.search(g,function(a){return f.cc-a.cc}))&&o.logger.log("live playlist, switching playlist, load frag with same CC: "+i.sn)}i||(i=g[Math.min(h-1,Math.round(h/2))],o.logger.log("live playlist, switching playlist, unknown, load middle frag : "+i.sn))}return i},c.prototype._findFragment=function(a,b,c,d,e,f,g){var h,i=this.hls.config;if(e<f){var j=e>f-i.maxFragLookUpTolerance?0:i.maxFragLookUpTolerance;h=q.findFragmentByPTS(b,d,e,j)}else h=d[c-1];if(h){var k=h.sn-g.startSN,l=b&&h.level===b.level,m=d[k-1],n=d[k+1];if(b&&h.sn===b.sn)if(l&&!h.backtracked)if(h.sn<g.endSN){var p=b.deltaPTS;p&&p>i.maxBufferHole&&b.dropped&&k?(h=m,o.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this")):(h=n,o.logger.log("SN just loaded, load next one: "+h.sn,h))}else h=null;else h.backtracked&&(n&&n.backtracked?(o.logger.warn("Already backtracked from fragment "+n.sn+", will not backtrack to fragment "+h.sn+". Loading fragment "+n.sn),h=n):(o.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),h.dropped=0,m?(h=m,h.backtracked=!0):k&&(h=null)))}return h},c.prototype._loadKey=function(a){this.state=s.State.KEY_LOADING,this.hls.trigger(h.default.KEY_LOADING,{frag:a})},c.prototype._loadFragment=function(b){var c=this.fragmentTracker.getState(b);this.fragCurrent=b,this.startFragRequested=!0,a.isFinite(b.sn)&&!b.bitrateTest&&(this.nextLoadPosition=b.start+b.duration),b.backtracked||c===i.FragmentState.NOT_LOADED||c===i.FragmentState.PARTIAL?(b.autoLevel=this.hls.autoLevelEnabled,b.bitrateTest=this.bitrateTest,this.hls.trigger(h.default.FRAG_LOADING,{frag:b}),this.demuxer||(this.demuxer=new g.default(this.hls,"main")),this.state=s.State.FRAG_LOADING):c===i.FragmentState.APPENDING&&this._reduceMaxBufferLength(b.duration)&&this.fragmentTracker.removeFragment(b)},Object.defineProperty(c.prototype,"state",{get:function(){return this._state},set:function(a){if(this.state!==a){var b=this.state;this._state=a,o.logger.log("main stream:"+b+"->"+a),this.hls.trigger(h.default.STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},enumerable:!0,configurable:!0}),c.prototype.getBufferedFrag=function(a){return this.fragmentTracker.getBufferedFrag(a,k.default.LevelType.MAIN)},Object.defineProperty(c.prototype,"currentLevel",{get:function(){var a=this.media;if(a){var b=this.getBufferedFrag(a.currentTime);if(b)return b.level}return-1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"nextBufferedFrag",{get:function(){var a=this.media;return a?this.followingBufferedFrag(this.getBufferedFrag(a.currentTime)):null},enumerable:!0,configurable:!0}),c.prototype.followingBufferedFrag=function(a){return a?this.getBufferedFrag(a.endPTS+.5):null},Object.defineProperty(c.prototype,"nextLevel",{get:function(){var a=this.nextBufferedFrag;return a?a.level:-1},enumerable:!0,configurable:!0}),c.prototype._checkFragmentChanged=function(){var a,b,c=this.media;if(c&&c.readyState&&!1===c.seeking&&(b=c.currentTime,b>this.lastCurrentTime&&(this.lastCurrentTime=b),f.BufferHelper.isBuffered(c,b)?a=this.getBufferedFrag(b):f.BufferHelper.isBuffered(c,b+.1)&&(a=this.getBufferedFrag(b+.1)),a)){var d=a;if(d!==this.fragPlaying){this.hls.trigger(h.default.FRAG_CHANGED,{frag:d});var e=d.level;this.fragPlaying&&this.fragPlaying.level===e||this.hls.trigger(h.default.LEVEL_SWITCHED,{level:e}),this.fragPlaying=d}}},c.prototype.immediateLevelSwitch=function(){if(o.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var b=this.media,c=void 0;b?(c=b.paused,b.pause()):c=!0,this.previouslyPaused=c}var d=this.fragCurrent;d&&d.loader&&d.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,a.POSITIVE_INFINITY)},c.prototype.immediateLevelSwitchEnd=function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,f.BufferHelper.isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())},c.prototype.nextLevelSwitch=function(){var b=this.media;if(b&&b.readyState){var c=void 0,d=void 0,e=void 0;if(d=this.getBufferedFrag(b.currentTime),d&&d.startPTS>1&&this.flushMainBuffer(0,d.startPTS-1),b.paused)c=0;else{var f=this.hls.nextLoadLevel,g=this.levels[f],h=this.fragLastKbps;c=h&&this.fragCurrent?this.fragCurrent.duration*g.bitrate/(1e3*h)+1:0}if((e=this.getBufferedFrag(b.currentTime+c))&&(e=this.followingBufferedFrag(e))){var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(e.maxStartPTS,a.POSITIVE_INFINITY)}}},c.prototype.flushMainBuffer=function(a,b){this.state=s.State.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(h.default.BUFFER_FLUSHING,c)},c.prototype.onMediaAttached=function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition),this.gapController=new r.default(c,b,this.fragmentTracker,this.hls)},c.prototype.onMediaDetaching=function(){var a=this.media;a&&a.ended&&(o.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.backtracked=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},c.prototype.onMediaSeeked=function(){var b=this.media,c=b?b.currentTime:void 0;a.isFinite(c)&&o.logger.log("media seeked to "+c.toFixed(3)),this.tick()},c.prototype.onManifestLoading=function(){o.logger.log("trigger BUFFER_RESET"),this.hls.trigger(h.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},c.prototype.onManifestParsed=function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){(b=a.audioCodec)&&(-1!==b.indexOf("mp4a.40.2")&&(c=!0),-1!==b.indexOf("mp4a.40.5")&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&o.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1;var e=this.config;(e.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(e.startPosition)},c.prototype.onLevelLoaded=function(b){var c=b.details,d=b.level,e=this.levels[this.levelLastLoaded],f=this.levels[d],g=c.totalduration,i=0;if(o.logger.log("level "+d+" loaded ["+c.startSN+","+c.endSN+"],duration:"+g),c.live){var j=f.details;j&&c.fragments.length>0?(l.mergeDetails(j,c),i=c.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(i,j),c.PTSKnown&&a.isFinite(i)?o.logger.log("live playlist sliding:"+i.toFixed(3)):(o.logger.log("live playlist - outdated PTS, unknown sliding"),p.alignStream(this.fragPrevious,e,c))):(o.logger.log("live playlist - first load, unknown sliding"),c.PTSKnown=!1,p.alignStream(this.fragPrevious,e,c))}else c.PTSKnown=!1;if(f.details=c,this.levelLastLoaded=d,this.hls.trigger(h.default.LEVEL_UPDATED,{details:c,level:d}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var k=c.startTimeOffset;a.isFinite(k)?(k<0&&(o.logger.log("negative start time offset "+k+", count from end of last fragment"),k=i+g+k),o.logger.log("start time offset found in playlist, adjust startPosition to "+k),this.startPosition=k):c.live?(this.startPosition=this.computeLivePosition(i,c),o.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===s.State.WAITING_LEVEL&&(this.state=s.State.IDLE),this.tick()},c.prototype.onKeyLoaded=function(){this.state===s.State.KEY_LOADING&&(this.state=s.State.IDLE,this.tick())},c.prototype.onFragLoaded=function(a){var b=this,c=b.fragCurrent,d=b.hls,e=b.levels,f=b.media,i=a.frag;if(this.state===s.State.FRAG_LOADING&&c&&"main"===i.type&&i.level===c.level&&i.sn===c.sn){var j=a.stats,k=e[c.level],l=k.details;if(this.bitrateTest=!1,this.stats=j,o.logger.log("Loaded "+c.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+c.level),i.bitrateTest&&d.nextLoadLevel)this.state=s.State.IDLE,this.startFragRequested=!1,j.tparsed=j.tbuffered=window.performance.now(),d.trigger(h.default.FRAG_BUFFERED,{stats:j,frag:c,id:"main"}),this.tick();else if("initSegment"===i.sn)this.state=s.State.IDLE,j.tparsed=j.tbuffered=window.performance.now(),l.initSegment.data=a.payload,d.trigger(h.default.FRAG_BUFFERED,{stats:j,frag:c,id:"main"}),this.tick();else{o.logger.log("Parsing "+c.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+c.level+", cc "+c.cc),this.state=s.State.PARSING,this.pendingBuffering=!0,this.appended=!1,i.bitrateTest&&(i.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:i}));var m=!(f&&f.seeking)&&(l.PTSKnown||!l.live),n=l.initSegment?l.initSegment.data:[],p=this._getAudioCodec(k),q=this.demuxer=this.demuxer||new g.default(this.hls,"main");q.push(a.payload,n,p,k.videoCodec,c,l.totalduration,m)}}this.fragLoadError=0},c.prototype.onFragParsingInitSegment=function(a){var b=this.fragCurrent,c=a.frag;if(b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===s.State.PARSING){var d=a.tracks,e=void 0,f=void 0;if(d.audio&&this.altAudio&&delete d.audio,f=d.audio){var g=this.levels[this.level].audioCodec,i=navigator.userAgent.toLowerCase();g&&this.audioCodecSwap&&(o.logger.log("swapping playlist audio codec"),g=-1!==g.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==f.metadata.channelCount&&-1===i.indexOf("firefox")&&(g="mp4a.40.5"),-1!==i.indexOf("android")&&"audio/mpeg"!==f.container&&(g="mp4a.40.2",o.logger.log("Android: force audio codec to "+g)),f.levelCodec=g,f.id=a.id}f=d.video,f&&(f.levelCodec=this.levels[this.level].videoCodec,f.id=a.id),this.hls.trigger(h.default.BUFFER_CODECS,d);for(e in d){f=d[e],o.logger.log("main track:"+e+",container:"+f.container+",codecs[level/parsed]=["+f.levelCodec+"/"+f.codec+"]");var j=f.initSegment;j&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(h.default.BUFFER_APPENDING,{type:e,data:j,parent:"main",content:"initSegment"}))}this.tick()}},c.prototype.onFragParsingData=function(b){var c=this,d=this.fragCurrent,e=b.frag;if(d&&"main"===b.id&&e.sn===d.sn&&e.level===d.level&&("audio"!==b.type||!this.altAudio)&&this.state===s.State.PARSING){var f=this.levels[this.level],g=d;if(a.isFinite(b.endPTS)||(b.endPTS=b.startPTS+d.duration,b.endDTS=b.startDTS+d.duration),!0===b.hasAudio&&g.addElementaryStream(j.default.ElementaryStreamTypes.AUDIO),!0===b.hasVideo&&g.addElementaryStream(j.default.ElementaryStreamTypes.VIDEO),o.logger.log("Parsed "+b.type+",PTS:["+b.startPTS.toFixed(3)+","+b.endPTS.toFixed(3)+"],DTS:["+b.startDTS.toFixed(3)+"/"+b.endDTS.toFixed(3)+"],nb:"+b.nb+",dropped:"+(b.dropped||0)),"video"===b.type)if(g.dropped=b.dropped,g.dropped)if(g.backtracked)o.logger.warn("Already backtracked on this fragment, appending with the gap",g.sn);else{var i=f.details;if(!i||g.sn!==i.startSN)return o.logger.warn("missing video frame(s), backtracking fragment",g.sn),this.fragmentTracker.removeFragment(g),g.backtracked=!0,this.nextLoadPosition=b.startPTS,this.state=s.State.IDLE,this.fragPrevious=g,void this.tick();o.logger.warn("missing video frame(s) on first frag, appending with gap",g.sn)}else g.backtracked=!1;var k=l.updateFragPTSDTS(f.details,g,b.startPTS,b.endPTS,b.startDTS,b.endDTS),m=this.hls;m.trigger(h.default.LEVEL_PTS_UPDATED,{details:f.details,level:this.level,drift:k,type:b.type,start:b.startPTS,end:b.endPTS}),[b.data1,b.data2].forEach(function(a){a&&a.length&&c.state===s.State.PARSING&&(c.appended=!0,c.pendingBuffering=!0,m.trigger(h.default.BUFFER_APPENDING,{type:b.type,data:a,parent:"main",content:"data"}))}),this.tick()}},c.prototype.onFragParsed=function(a){var b=this.fragCurrent,c=a.frag;b&&"main"===a.id&&c.sn===b.sn&&c.level===b.level&&this.state===s.State.PARSING&&(this.stats.tparsed=window.performance.now(),this.state=s.State.PARSED,this._checkAppendedParsed())},c.prototype.onAudioTrackSwitching=function(b){var c=!!b.url,d=b.id;if(!c){if(this.mediaBuffer!==this.media){o.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var e=this.fragCurrent;e.loader&&(o.logger.log("switching to main audio track, cancel main fragment load"),e.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=s.State.IDLE}var f=this.hls;f.trigger(h.default.BUFFER_FLUSHING,{startOffset:0,endOffset:a.POSITIVE_INFINITY,type:"audio"}),f.trigger(h.default.AUDIO_TRACK_SWITCHED,{id:d}),this.altAudio=!1}},c.prototype.onAudioTrackSwitched=function(a){var b=a.id,c=!!this.hls.audioTracks[b].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(o.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()},c.prototype.onBufferCreated=function(a){var b,c,d=a.tracks,e=!1;for(var f in d){var g=d[f];"main"===g.id?(c=f,b=g,"video"===f&&(this.videoBuffer=d[f].buffer)):e=!0}e&&b?(o.logger.log("alternate track found, use "+c+".buffered to schedule main fragment loading"),this.mediaBuffer=b.buffer):this.mediaBuffer=this.media},c.prototype.onBufferAppended=function(a){if("main"===a.parent){var b=this.state;b!==s.State.PARSING&&b!==s.State.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}},c.prototype._checkAppendedParsed=function(){if(!(this.state!==s.State.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent;if(a){var b=this.mediaBuffer?this.mediaBuffer:this.media;o.logger.log("main buffered : "+m.default.toString(b.buffered)),this.fragPrevious=a;var c=this.stats;c.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*c.total/(c.tbuffered-c.tfirst)),this.hls.trigger(h.default.FRAG_BUFFERED,{stats:c,frag:a,id:"main"}),this.state=s.State.IDLE}this.tick()}},c.prototype.onError=function(b){var c=b.frag||this.fragCurrent;if(!c||"main"===c.type){var d=!!this.media&&f.BufferHelper.isBuffered(this.media,this.media.currentTime)&&f.BufferHelper.isBuffered(this.media,this.media.currentTime+.5);switch(b.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:if(!b.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var e=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);o.logger.warn("mediaController: frag loading failed, retry in "+e+" ms"),this.retryDate=window.performance.now()+e,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=s.State.FRAG_LOADING_WAITING_RETRY}else o.logger.error("mediaController: "+b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.state=s.State.ERROR;break;case n.ErrorDetails.LEVEL_LOAD_ERROR:case n.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==s.State.ERROR&&(b.fatal?(this.state=s.State.ERROR,o.logger.warn("streamController: "+b.details+",switch to "+this.state+" state ...")):b.levelRetry||this.state!==s.State.WAITING_LEVEL||(this.state=s.State.IDLE));break;case n.ErrorDetails.BUFFER_FULL_ERROR:"main"!==b.parent||this.state!==s.State.PARSING&&this.state!==s.State.PARSED||(d?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=s.State.IDLE):(o.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,a.POSITIVE_INFINITY)))}}},c.prototype._reduceMaxBufferLength=function(a){var b=this.config;return b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,o.logger.warn("main:reduce max buffer length to "+b.maxMaxBufferLength+"s"),!0)},c.prototype._checkBuffer=function(){var a=this.media;if(a&&0!==a.readyState){var b=this.mediaBuffer?this.mediaBuffer:a,c=b.buffered;!this.loadedmetadata&&c.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,c)}},c.prototype.onFragLoadEmergencyAborted=function(){this.state=s.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},c.prototype.onBufferFlushed=function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;a&&this.fragmentTracker.detectEvictedFragments(j.default.ElementaryStreamTypes.VIDEO,a.buffered),this.state=s.State.IDLE,this.fragPrevious=null},c.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},c.prototype.computeLivePosition=function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)},c.prototype._seekToStartPos=function(){var a=this.media,b=a.currentTime,c=a.seeking?b:this.startPosition;b!==c&&(o.logger.log("target start position not buffered, seek to buffered.start(0) "+c+" from current time "+b+" "),a.currentTime=c)},c.prototype._getAudioCodec=function(a){var b=this.config.defaultAudioCodec||a.audioCodec;return this.audioCodecSwap&&(o.logger.log("swapping playlist audio codec"),b&&(b=-1!==b.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),b},Object.defineProperty(c.prototype,"liveSyncPosition",{get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a},enumerable:!0,configurable:!0}),c}(s.default);b.default=u}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/subtitle-stream-controller.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/utils/logger.js"),g=c("./src/crypt/decrypter.js"),h=c("./src/utils/buffer-helper.js"),i=c("./src/controller/fragment-finders.js"),j=c("./src/controller/fragment-tracker.js"),k=c("./src/controller/base-stream-controller.js"),l=c("./src/controller/level-helper.js"),m=window.performance,n=500,o=function(a){function b(b,c){var d=a.call(this,b,e.default.MEDIA_ATTACHED,e.default.MEDIA_DETACHING,e.default.ERROR,e.default.KEY_LOADED,e.default.FRAG_LOADED,e.default.SUBTITLE_TRACKS_UPDATED,e.default.SUBTITLE_TRACK_SWITCH,e.default.SUBTITLE_TRACK_LOADED,e.default.SUBTITLE_FRAG_PROCESSED,e.default.LEVEL_UPDATED)||this;return d.fragmentTracker=c,d.config=b.config,d.state=k.State.STOPPED,d.tracks=[],d.tracksBuffered=[],d.currentTrackId=-1,d.decrypter=new g.default(b,b.config),d.lastAVStart=0,d._onMediaSeeking=d.onMediaSeeking.bind(d),d}return d(b,a),b.prototype.onSubtitleFragProcessed=function(a){var b=a.frag,c=a.success;if(this.fragPrevious=b,this.state=k.State.IDLE,c){var d=this.tracksBuffered[this.currentTrackId];if(d){for(var e,f=b.start,g=0;g<d.length;g++)if(f>=d[g].start&&f<=d[g].end){e=d[g];break}var h=b.start+b.duration;e?e.end=h:(e={start:f,end:h},d.push(e))}}},b.prototype.onMediaAttached=function(a){var b=a.media;this.media=b,b.addEventListener("seeking",this._onMediaSeeking),this.state=k.State.IDLE},b.prototype.onMediaDetaching=function(){this.media.removeEventListener("seeking",this._onMediaSeeking),this.media=null,this.state=k.State.STOPPED},b.prototype.onError=function(a){var b=a.frag;b&&"subtitle"===b.type&&(this.state=k.State.IDLE)},b.prototype.onSubtitleTracksUpdated=function(a){var b=this;f.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=a.subtitleTracks,this.tracks.forEach(function(a){b.tracksBuffered[a.id]=[]})},b.prototype.onSubtitleTrackSwitch=function(a){if(this.currentTrackId=a.id,!this.tracks||-1===this.currentTrackId)return void this.clearInterval();var b=this.tracks[this.currentTrackId];b&&b.details&&this.setInterval(n)},b.prototype.onSubtitleTrackLoaded=function(a){var b=a.id,c=a.details,d=this,e=d.currentTrackId,f=d.tracks,g=f[e];b>=f.length||b!==e||!g||(c.live&&l.mergeSubtitlePlaylists(g.details,c,this.lastAVStart),g.details=c,this.setInterval(n))},b.prototype.onKeyLoaded=function(){this.state===k.State.KEY_LOADING&&(this.state=k.State.IDLE)},b.prototype.onFragLoaded=function(a){var b=this.fragCurrent,c=a.frag.decryptdata,d=a.frag,f=this.hls;if(this.state===k.State.FRAG_LOADING&&b&&"subtitle"===a.frag.type&&b.sn===a.frag.sn&&a.payload.byteLength>0&&c&&c.key&&"AES-128"===c.method){var g=m.now();this.decrypter.decrypt(a.payload,c.key.buffer,c.iv.buffer,function(a){var b=m.now();f.trigger(e.default.FRAG_DECRYPTED,{frag:d,payload:a,stats:{tstart:g,tdecrypt:b}})})}},b.prototype.onLevelUpdated=function(a){var b=a.details,c=b.fragments;this.lastAVStart=c.length?c[0].start:0},b.prototype.doTick=function(){if(!this.media)return void(this.state=k.State.IDLE);switch(this.state){case k.State.IDLE:var a=this,b=a.config,c=a.currentTrackId,d=a.fragmentTracker,g=a.media,l=a.tracks;if(!l||!l[c]||!l[c].details)break;var m=b.maxBufferHole,n=b.maxFragLookUpTolerance,o=Math.min(b.maxBufferLength,b.maxMaxBufferLength),p=h.BufferHelper.bufferedInfo(this._getBuffered(),g.currentTime,m),q=p.end,r=p.len,s=l[c].details,t=s.fragments,u=t.length,v=t[u-1].start+t[u-1].duration;if(r>o)return;var w=void 0,x=this.fragPrevious;q<v?(x&&s.hasProgramDateTime&&(w=i.findFragmentByPDT(t,x.endProgramDateTime,n)),w||(w=i.findFragmentByPTS(x,t,q,n))):w=t[u-1],w&&w.encrypted?(f.logger.log("Loading key for "+w.sn),this.state=k.State.KEY_LOADING,this.hls.trigger(e.default.KEY_LOADING,{frag:w})):w&&d.getState(w)===j.FragmentState.NOT_LOADED&&(this.fragCurrent=w,this.state=k.State.FRAG_LOADING,this.hls.trigger(e.default.FRAG_LOADING,{frag:w}))}},b.prototype.stopLoad=function(){this.lastAVStart=0,a.prototype.stopLoad.call(this)},b.prototype._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},b.prototype.onMediaSeeking=function(){this.fragPrevious=null},b}(k.default);b.SubtitleStreamController=o},"./src/controller/subtitle-track-controller.js":function(a,b,c){"use strict";(function(a){function d(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];"subtitles"===d.kind&&d.label&&b.push(a[c])}return b}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c("./src/events.js"),g=c("./src/event-handler.js"),h=c("./src/utils/logger.js"),i=c("./src/controller/level-helper.js"),j=function(b){function c(a){var c=b.call(this,a,f.default.MEDIA_ATTACHED,f.default.MEDIA_DETACHING,f.default.MANIFEST_LOADED,f.default.SUBTITLE_TRACK_LOADED)||this;return c.tracks=[],c.trackId=-1,c.media=null,c.stopped=!0,c.subtitleDisplay=!0,c}return e(c,b),c.prototype.destroy=function(){g.default.prototype.destroy.call(this)},c.prototype.onMediaAttached=function(a){var b=this;this.media=a.media,this.media&&(this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){b.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},c.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=null)},c.prototype.onManifestLoaded=function(a){var b=this,c=a.subtitles||[];this.tracks=c,this.hls.trigger(f.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:c}),c.forEach(function(a){a.default&&(b.media?b.subtitleTrack=a.id:b.queuedDefaultTrack=a.id)})},c.prototype.onSubtitleTrackLoaded=function(a){var b=this,c=a.id,d=a.details,e=this,f=e.trackId,g=e.tracks,j=g[f];if(c>=g.length||c!==f||!j||this.stopped)return void this._clearReloadTimer();if(h.logger.log("subtitle track "+c+" loaded"),d.live){var k=i.computeReloadInterval(j.details,d,a.stats.trequest);h.logger.log("Reloading live subtitle playlist in "+k+"ms"),this.timer=setTimeout(function(){b._loadCurrentTrack()},k)}else this._clearReloadTimer()},c.prototype.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},c.prototype.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},Object.defineProperty(c.prototype,"subtitleTracks",{get:function(){return this.tracks},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"subtitleTrack",{get:function(){return this.trackId},set:function(a){this.trackId!==a&&(this._toggleTrackModes(a),this._setSubtitleTrackInternal(a))},enumerable:!0,configurable:!0}),c.prototype._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},c.prototype._loadCurrentTrack=function(){var a=this,b=a.trackId,c=a.tracks,d=a.hls,e=c[b];b<0||!e||e.details&&!e.details.live||(h.logger.log("Loading subtitle track "+b),d.trigger(f.default.SUBTITLE_TRACK_LOADING,{url:e.url,id:b}))},c.prototype._toggleTrackModes=function(a){var b=this,c=b.media,e=b.subtitleDisplay,f=b.trackId;if(c){var g=d(c.textTracks);if(-1===a)[].slice.call(g).forEach(function(a){a.mode="disabled"});else{var h=g[f];h&&(h.mode="disabled")}var i=g[a];i&&(i.mode=e?"showing":"hidden")}},c.prototype._setSubtitleTrackInternal=function(b){var c=this,d=c.hls,e=c.tracks;!a.isFinite(b)||b<-1||b>=e.length||(this.trackId=b,h.logger.log("Switching to subtitle track "+b),d.trigger(f.default.SUBTITLE_TRACK_SWITCH,{id:b}),this._loadCurrentTrack())},c.prototype._onTextTracksChanged=function(){if(this.media){for(var a=-1,b=d(this.media.textTracks),c=0;c<b.length;c++)if("hidden"===b[c].mode)a=c;else if("showing"===b[c].mode){a=c;break}this.subtitleTrack=a}},c}(g.default);b.default=j}).call(this,c("./src/polyfills/number.js").Number)},"./src/controller/timeline-controller.js":function(a,b,c){"use strict";(function(a){function d(a,b){return a&&a.label===b.name&&!(a.textTrack1||a.textTrack2)}function e(a,b,c,d){return Math.min(b,d)-Math.max(a,c)}var f=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c("./src/events.js"),h=c("./src/event-handler.js"),i=c("./src/utils/cea-608-parser.js"),j=c("./src/utils/output-filter.js"),k=c("./src/utils/webvtt-parser.js"),l=c("./src/utils/logger.js"),m=c("./src/utils/texttrack-utils.js"),n=function(b){function c(a){var c=b.call(this,a,g.default.MEDIA_ATTACHING,g.default.MEDIA_DETACHING,g.default.FRAG_PARSING_USERDATA,g.default.FRAG_DECRYPTED,g.default.MANIFEST_LOADING,g.default.MANIFEST_LOADED,g.default.FRAG_LOADED,g.default.LEVEL_SWITCHING,g.default.INIT_PTS_FOUND)||this;if(c.hls=a,c.config=a.config,c.enabled=!0,c.Cues=a.config.cueHandler,c.textTracks=[],c.tracks=[],c.unparsedVttFrags=[],c.initPTS=[],c.cueRanges=[],c.captionsTracks={},c.captionsProperties={textTrack1:{label:c.config.captionsTextTrack1Label,languageCode:c.config.captionsTextTrack1LanguageCode},textTrack2:{label:c.config.captionsTextTrack2Label,languageCode:c.config.captionsTextTrack2LanguageCode}},c.config.enableCEA708Captions){var d=new j.default(c,"textTrack1"),e=new j.default(c,"textTrack2");c.cea608Parser=new i.default(0,d,e)}return c}return f(c,b),c.prototype.addCues=function(a,b,c,d){for(var f=this.cueRanges,g=!1,h=f.length;h--;){var i=f[h],j=e(i[0],i[1],b,c);if(j>=0&&(i[0]=Math.min(i[0],b),i[1]=Math.max(i[1],c),g=!0,j/(c-b)>.5))return}g||f.push([b,c]),this.Cues.newCue(this.captionsTracks[a],b,c,d)},c.prototype.onInitPtsFound=function(a){var b=this;if("main"===a.id&&(this.initPTS[a.frag.cc]=a.initPTS),this.unparsedVttFrags.length){var c=this.unparsedVttFrags;this.unparsedVttFrags=[],c.forEach(function(a){b.onFragLoaded(a)})}},c.prototype.getExistingTrack=function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c];if(d[a])return d}return null},c.prototype.createCaptionsTrack=function(a){var b=this.captionsProperties[a],c=b.label,d=b.languageCode,e=this.captionsTracks;if(!e[a]){var f=this.getExistingTrack(a);if(f)e[a]=f,m.clearCurrentCues(e[a]),m.sendAddTrackEvent(e[a],this.media);else{var g=this.createTextTrack("captions",c,d);g&&(g[a]=!0,e[a]=g)}}},c.prototype.createTextTrack=function(a,b,c){var d=this.media;if(d)return d.addTextTrack(a,b,c)},c.prototype.destroy=function(){h.default.prototype.destroy.call(this)},c.prototype.onMediaAttaching=function(a){this.media=a.media,this._cleanTracks()},c.prototype.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(b){m.clearCurrentCues(a[b]),delete a[b]})},c.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks()},c.prototype._cleanTracks=function(){var a=this.media;if(a){var b=a.textTracks;if(b)for(var c=0;c<b.length;c++)m.clearCurrentCues(b[c])}},c.prototype.onManifestLoaded=function(a){var b=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cueRanges=[],this.config.enableWebVTT){this.tracks=a.subtitles||[];var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,e){var f;if(e<c.length){for(var g=null,h=0;h<c.length;h++)if(d(c[h],a)){g=c[h];break}g&&(f=g)}f||(f=b.createTextTrack("subtitles",a.name,a.lang)),a.default?f.mode=b.hls.subtitleDisplay?"showing":"hidden":f.mode="disabled",b.textTracks.push(f)})}},c.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},c.prototype.onFragLoaded=function(b){var c=b.frag,d=b.payload;if("main"===c.type){var e=c.sn;if(e!==this.lastSn+1){var f=this.cea608Parser;f&&f.reset()}this.lastSn=e}else if("subtitle"===c.type)if(d.byteLength){if(!a.isFinite(this.initPTS[c.cc]))return this.unparsedVttFrags.push(b),void(this.initPTS.length&&this.hls.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c}));var h=c.decryptdata;null!=h&&null!=h.key&&"AES-128"===h.method||this._parseVTTs(c,d)}else this.hls.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:c})},c.prototype._parseVTTs=function(a,b){var c=this.vttCCs;c[a.cc]||(c[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc);var d=this.textTracks,e=this.hls;k.default.parse(b,this.initPTS[a.cc],c,a.cc,function(b){var c=d[a.level];if("disabled"===c.mode)return void e.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a});b.forEach(function(a){if(!c.cues.getCueById(a.id))try{c.addCue(a)}catch(d){var b=new window.TextTrackCue(a.startTime,a.endTime,a.text);b.id=a.id,c.addCue(b)}}),e.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(b){l.logger.log("Failed to parse VTT cue: "+b),e.trigger(g.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a})})},c.prototype.onFragDecrypted=function(b){var c=b.payload,d=b.frag;if("subtitle"===d.type){if(!a.isFinite(this.initPTS[d.cc]))return void this.unparsedVttFrags.push(b);this._parseVTTs(d,c)}},c.prototype.onFragParsingUserdata=function(a){if(this.enabled&&this.config.enableCEA708Captions)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}},c.prototype.extractCea608Data=function(a){for(var b,c,d,e,f,g=31&a[0],h=2,i=[],j=0;j<g;j++)b=a[h++],c=127&a[h++],d=127&a[h++],e=0!=(4&b),f=3&b,0===c&&0===d||e&&0===f&&(i.push(c),i.push(d));return i},c}(h.default);b.default=n}).call(this,c("./src/polyfills/number.js").Number)},"./src/crypt/aes-crypto.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.subtle=a,this.aesIV=b}return a.prototype.decrypt=function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)},a}();b.default=d},"./src/crypt/aes-decryptor.js":function(a,b,c){"use strict";function d(a){var b=a.byteLength,c=b&&new DataView(a).getUint8(b-1);return c?a.slice(0,b-c):a}Object.defineProperty(b,"__esModule",{value:!0}),b.removePadding=d;var e=function(){function a(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a.prototype.uint8ArrayToUint32Array_=function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;d<4;d++)c[d]=b.getUint32(4*d);return c},a.prototype.initTable=function(){var a=this.sBox,b=this.invSBox,c=this.subMix,d=c[0],e=c[1],f=c[2],g=c[3],h=this.invSubMix,i=h[0],j=h[1],k=h[2],l=h[3],m=new Uint32Array(256),n=0,o=0,p=0;for(p=0;p<256;p++)m[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var q=o^o<<1^o<<2^o<<3^o<<4;q=q>>>8^255&q^99,a[n]=q,b[q]=n;var r=m[n],s=m[r],t=m[s],u=257*m[q]^16843008*q;d[n]=u<<24|u>>>8,e[n]=u<<16|u>>>16,f[n]=u<<8|u>>>24,g[n]=u,u=16843009*t^65537*s^257*r^16843008*n,i[q]=u<<24|u>>>8,j[q]=u<<16|u>>>16,k[q]=u<<8|u>>>24,l[q]=u,n?(n=r^m[m[m[t^r]]],o^=m[m[o]]):n=o=1}},a.prototype.expandKey=function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f,g,h,i,j=this.ksRows=4*(e+6+1),k=this.keySchedule=new Uint32Array(j),l=this.invKeySchedule=new Uint32Array(j),m=this.sBox,n=this.rcon,o=this.invSubMix,p=o[0],q=o[1],r=o[2],s=o[3];for(f=0;f<j;f++)f<e?h=k[f]=b[f]:(i=h,f%e==0?(i=i<<8|i>>>24,i=m[i>>>24]<<24|m[i>>>16&255]<<16|m[i>>>8&255]<<8|m[255&i],i^=n[f/e|0]<<24):e>6&&f%e==4&&(i=m[i>>>24]<<24|m[i>>>16&255]<<16|m[i>>>8&255]<<8|m[255&i]),k[f]=h=(k[f-e]^i)>>>0);for(g=0;g<j;g++)f=j-g,i=3&g?k[f]:k[f-4],l[g]=g<4||f<=4?i:p[m[i>>>24]]^q[m[i>>>16&255]]^r[m[i>>>8&255]]^s[m[255&i]],l[g]=l[g]>>>0}},a.prototype.networkToHostOrderSwap=function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24},a.prototype.decrypt=function(a,b,c,e){for(var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=this.keySize+6,u=this.invKeySchedule,v=this.invSBox,w=this.invSubMix,x=w[0],y=w[1],z=w[2],A=w[3],B=this.uint8ArrayToUint32Array_(c),C=B[0],D=B[1],E=B[2],F=B[3],G=new Int32Array(a),H=new Int32Array(G.length),I=this.networkToHostOrderSwap;b<G.length;){for(n=I(G[b]),o=I(G[b+1]),p=I(G[b+2]),q=I(G[b+3]),j=n^u[0],k=q^u[1],l=p^u[2],m=o^u[3],r=4,s=1;s<t;s++)f=x[j>>>24]^y[k>>16&255]^z[l>>8&255]^A[255&m]^u[r],g=x[k>>>24]^y[l>>16&255]^z[m>>8&255]^A[255&j]^u[r+1],h=x[l>>>24]^y[m>>16&255]^z[j>>8&255]^A[255&k]^u[r+2],i=x[m>>>24]^y[j>>16&255]^z[k>>8&255]^A[255&l]^u[r+3],j=f,k=g,l=h,m=i,r+=4;f=v[j>>>24]<<24^v[k>>16&255]<<16^v[l>>8&255]<<8^v[255&m]^u[r],g=v[k>>>24]<<24^v[l>>16&255]<<16^v[m>>8&255]<<8^v[255&j]^u[r+1],h=v[l>>>24]<<24^v[m>>16&255]<<16^v[j>>8&255]<<8^v[255&k]^u[r+2],i=v[m>>>24]<<24^v[j>>16&255]<<16^v[k>>8&255]<<8^v[255&l]^u[r+3],r+=3,H[b]=I(f^C),H[b+1]=I(i^D),H[b+2]=I(h^E),H[b+3]=I(g^F),C=n,D=o,E=p,F=q,b+=4}return e?d(H.buffer):H.buffer},a.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},a}();b.default=e},"./src/crypt/decrypter.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/crypt/aes-crypto.js"),e=c("./src/crypt/fast-aes-key.js"),f=c("./src/crypt/aes-decryptor.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=c("./src/events.js"),j=c("./src/utils/get-self-scope.js"),k=j.getSelfScope(),l=function(){function a(a,b,c){var d=(void 0===c?{}:c).removePKCS7Padding,e=void 0===d||d;if(this.logEnabled=!0,this.observer=a,this.config=b,this.removePKCS7Padding=e,e)try{var f=k.crypto;f&&(this.subtle=f.subtle||f.webkitSubtle)}catch(a){}this.disableWebCrypto=!this.subtle}return a.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},a.prototype.decrypt=function(a,b,c,g){var i=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(h.logger.log("JS AES decrypt"),this.logEnabled=!1);var j=this.decryptor;j||(this.decryptor=j=new f.default),j.expandKey(b),g(j.decrypt(a,0,c,this.removePKCS7Padding))}else{this.logEnabled&&(h.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var k=this.subtle;this.key!==b&&(this.key=b,this.fastAesKey=new e.default(k,b)),this.fastAesKey.expandKey().then(function(e){new d.default(k,c).decrypt(a,e).catch(function(d){i.onWebCryptoError(d,a,b,c,g)}).then(function(a){g(a)})}).catch(function(d){i.onWebCryptoError(d,a,b,c,g)})}},a.prototype.onWebCryptoError=function(a,b,c,d,e){this.config.enableSoftwareAES?(h.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(b,c,d,e)):(h.logger.error("decrypting error : "+a.message),this.observer.trigger(i.default.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))},a.prototype.destroy=function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)},a}();b.default=l},"./src/crypt/fast-aes-key.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.subtle=a,this.key=b}return a.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},a}();b.default=d},"./src/demux/aacdemuxer.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/demux/adts.js"),e=c("./src/utils/logger.js"),f=c("./src/demux/id3.js"),g=function(){function b(a,b,c){this.observer=a,this.config=c,this.remuxer=b}return b.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},b.prototype.resetTimeStamp=function(){},b.probe=function(a){if(!a)return!1;for(var b=f.default.getID3Data(a,0)||[],c=b.length,g=a.length;c<g;c++)if(d.probe(a,c))return e.logger.log("ADTS sync word found !"),!0;return!1},b.prototype.append=function(b,c,g,h){for(var i=this._audioTrack,j=f.default.getID3Data(b,0)||[],k=f.default.getTimeStamp(j),l=a.isFinite(k)?90*k:9e4*c,m=0,n=l,o=b.length,p=j.length,q=[{pts:n,dts:n,data:j}];p<o-1;)if(d.isHeader(b,p)&&p+5<o){d.initTrackConfig(i,this.observer,b,p,i.manifestCodec);var r=d.appendFrame(i,b,p,l,m);if(!r){e.logger.log("Unable to parse AAC frame");break}p+=r.length,n=r.sample.pts,m++}else f.default.isHeader(b,p)?(j=f.default.getID3Data(b,p),q.push({pts:n,dts:n,data:j}),p+=j.length):p++;this.remuxer.remux(i,{samples:[]},{samples:q,inputTimeScale:9e4},{samples:[]},c,g,h)},b.prototype.destroy=function(){},b}();b.default=g}).call(this,c("./src/polyfills/number.js").Number)},"./src/demux/adts.js":function(a,b,c){"use strict";function d(a,b,c,d){var e,f,g,h,i,j=navigator.userAgent.toLowerCase(),k=d,l=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return e=1+((192&b[c+2])>>>6),(f=(60&b[c+2])>>>2)>l.length-1?void a.trigger(p.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f}):(h=(1&b[c+2])<<2,h|=(192&b[c+3])>>>6,n.logger.log("manifest codec:"+d+",ADTS data:type:"+e+",sampleingIndex:"+f+"["+l[f]+"Hz],channelConfig:"+h),/firefox/i.test(j)?f>=6?(e=5,i=new Array(4),g=f-3):(e=2,i=new Array(2),g=f):-1!==j.indexOf("android")?(e=2,i=new Array(2),g=f):(e=5,i=new Array(4),d&&(-1!==d.indexOf("mp4a.40.29")||-1!==d.indexOf("mp4a.40.5"))||!d&&f>=6?g=f-3:((d&&-1!==d.indexOf("mp4a.40.2")&&(f>=6&&1===h||/vivaldi/i.test(j))||!d&&1===h)&&(e=2,i=new Array(2)),g=f)),i[0]=e<<3,i[0]|=(14&f)>>1,i[1]|=(1&f)<<7,i[1]|=h<<3,5===e&&(i[1]|=(14&g)>>1,i[2]=(1&g)<<7,i[2]|=8,i[3]=0),{config:i,samplerate:l[f],channelCount:h,codec:"mp4a.40."+e,manifestCodec:k})}function e(a,b){return 255===a[b]&&240==(246&a[b+1])}function f(a,b){return 1&a[b+1]?7:9}function g(a,b){return(3&a[b+3])<<11|a[b+4]<<3|(224&a[b+5])>>>5}function h(a,b){return!!(b+1<a.length&&e(a,b))}function i(a,b){if(b+1<a.length&&e(a,b)){var c=f(a,b),d=c;b+5<a.length&&(d=g(a,b));var h=b+d;if(h===a.length||h+1<a.length&&e(a,h))return!0}return!1}function j(a,b,c,e,f){if(!a.samplerate){var g=d(b,c,e,f);a.config=g.config,a.samplerate=g.samplerate,a.channelCount=g.channelCount,a.codec=g.codec,a.manifestCodec=g.manifestCodec,n.logger.log("parsed codec:"+a.codec+",rate:"+g.samplerate+",nb channel:"+g.channelCount)}}function k(a){return 9216e4/a}function l(a,b,c,d,e){var h,i,j,k=a.length;if(h=f(a,b),i=g(a,b),(i-=h)>0&&b+h+i<=k)return j=c+d*e,{headerLength:h,frameLength:i,stamp:j}}function m(a,b,c,d,e){var f=k(a.samplerate),g=l(b,c,d,e,f);if(g){var h=g.stamp,i=g.headerLength,j=g.frameLength,m={unit:b.subarray(c+i,c+i+j),pts:h,dts:h};return a.samples.push(m),a.len+=j,{sample:m,length:j+i}}}Object.defineProperty(b,"__esModule",{value:!0});var n=c("./src/utils/logger.js"),o=c("./src/errors.js"),p=c("./src/events.js");b.getAudioConfig=d,b.isHeaderPattern=e,b.getHeaderLength=f,b.getFullFrameLength=g,b.isHeader=h,b.probe=i,b.initTrackConfig=j,b.getFrameDuration=k,b.parseFrameHeader=l,b.appendFrame=m},"./src/demux/demuxer-inline.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d,e=c("./src/events.js"),f=c("./src/errors.js"),g=c("./src/crypt/decrypter.js"),h=c("./src/demux/aacdemuxer.js"),i=c("./src/demux/mp4demuxer.js"),j=c("./src/demux/tsdemuxer.js"),k=c("./src/demux/mp3demuxer.js"),l=c("./src/remux/mp4-remuxer.js"),m=c("./src/remux/passthrough-remuxer.js"),n=c("./src/utils/get-self-scope.js"),o=c("./src/utils/logger.js"),p=n.getSelfScope();try{d=p.performance.now.bind(p.performance)}catch(a){o.logger.debug("Unable to use Performance API on this environment"),d=p.Date.now}var q=function(){function a(a,b,c,d){this.observer=a,this.typeSupported=b,this.config=c,this.vendor=d}return a.prototype.destroy=function(){var a=this.demuxer;a&&a.destroy()},a.prototype.push=function(a,b,c,f,h,i,j,k,l,m,n,o){var p=this;if(a.byteLength>0&&null!=b&&null!=b.key&&"AES-128"===b.method){var q=this.decrypter;null==q&&(q=this.decrypter=new g.default(this.observer,this.config));var r=d();q.decrypt(a,b.key.buffer,b.iv.buffer,function(a){var g=d();p.observer.trigger(e.default.FRAG_DECRYPTED,{stats:{tstart:r,tdecrypt:g}}),p.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),f,h,i,j,k,l,m,n,o)})}else this.pushDecrypted(new Uint8Array(a),b,new Uint8Array(c),f,h,i,j,k,l,m,n,o)},a.prototype.pushDecrypted=function(a,b,c,d,g,n,o,p,q,r,s,t){var u=this.demuxer;if(!u||(o||p)&&!this.probe(a)){for(var v=this.observer,w=this.typeSupported,x=this.config,y=[{demux:j.default,remux:l.default},{demux:i.default,remux:m.default},{demux:h.default,remux:l.default},{demux:k.default,remux:l.default}],z=0,A=y.length;z<A;z++){var B=y[z],C=B.demux.probe;if(C(a)){var D=this.remuxer=new B.remux(v,x,w,this.vendor);u=new B.demux(v,D,x,w),this.probe=C;break}}if(!u)return void v.trigger(e.default.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=u}var E=this.remuxer;(o||p)&&(u.resetInitSegment(c,d,g,r),E.resetInitSegment()),o&&(u.resetTimeStamp(t),E.resetTimeStamp(t)),"function"==typeof u.setDecryptData&&u.setDecryptData(b),u.append(a,n,q,s)},a}();b.default=q},"./src/demux/demuxer-worker.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/demux/demuxer-inline.js"),e=c("./src/events.js"),f=c("./src/utils/logger.js"),g=c("./node_modules/node-libs-browser/node_modules/events/events.js"),h=function(a){var b=new g.EventEmitter;b.trigger=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];b.emit.apply(b,[a,a].concat(c))},b.off=function(a){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];b.removeListener.apply(b,[a].concat(c))};var c=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(e){var g=e.data;switch(g.cmd){case"init":var h=JSON.parse(g.config);a.demuxer=new d.default(b,g.typeSupported,h,g.vendor),f.enableLogs(h.debug),c("init",null);break;case"demux":a.demuxer.push(g.data,g.decryptdata,g.initSegment,g.audioCodec,g.videoCodec,g.timeOffset,g.discontinuity,g.trackSwitch,g.contiguous,g.duration,g.accurateTimeOffset,g.defaultInitPTS)}}),b.on(e.default.FRAG_DECRYPTED,c),b.on(e.default.FRAG_PARSING_INIT_SEGMENT,c),b.on(e.default.FRAG_PARSED,c),b.on(e.default.ERROR,c),b.on(e.default.FRAG_PARSING_METADATA,c),b.on(e.default.FRAG_PARSING_USERDATA,c),b.on(e.default.INIT_PTS_FOUND,c),b.on(e.default.FRAG_PARSING_DATA,function(b,c){var d=[],e={event:b,data:c};c.data1&&(e.data1=c.data1.buffer,d.push(c.data1.buffer),delete c.data1),c.data2&&(e.data2=c.data2.buffer,d.push(c.data2.buffer),delete c.data2),a.postMessage(e,d)})};b.default=h},"./src/demux/demuxer.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c("./node_modules/webworkify-webpack/index.js"),e=c("./src/events.js"),f=c("./src/demux/demuxer-inline.js"),g=c("./src/utils/logger.js"),h=c("./src/errors.js"),i=c("./src/utils/mediasource-helper.js"),j=c("./src/utils/get-self-scope.js"),k=c("./src/observer.js"),l=j.getSelfScope(),m=i.getMediaSource(),n=function(){function b(a,b){var c=this;this.hls=a,this.id=b;var i=this.observer=new k.Observer,j=a.config,n=function(b,d){d=d||{},d.frag=c.frag,d.id=c.id,a.trigger(b,d)};i.on(e.default.FRAG_DECRYPTED,n),i.on(e.default.FRAG_PARSING_INIT_SEGMENT,n),i.on(e.default.FRAG_PARSING_DATA,n),i.on(e.default.FRAG_PARSED,n),i.on(e.default.ERROR,n),i.on(e.default.FRAG_PARSING_METADATA,n),i.on(e.default.FRAG_PARSING_USERDATA,n),i.on(e.default.INIT_PTS_FOUND,n);var o={mp4:m.isTypeSupported("video/mp4"),mpeg:m.isTypeSupported("audio/mpeg"),mp3:m.isTypeSupported('audio/mp4; codecs="mp3"')},p=navigator.vendor;if(j.enableWorker&&"undefined"!=typeof Worker){g.logger.log("demuxing in webworker");var q=void 0;try{q=this.w=d("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),q.addEventListener("message",this.onwmsg),q.onerror=function(b){a.trigger(e.default.ERROR,{type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:b.message+" ("+b.filename+":"+b.lineno+")"}})},q.postMessage({cmd:"init",typeSupported:o,vendor:p,id:b,config:JSON.stringify(j)})}catch(a){g.logger.warn("Error in worker:",a),g.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),q&&l.URL.revokeObjectURL(q.objectURL),this.demuxer=new f.default(i,o,j,p),this.w=void 0}}else this.demuxer=new f.default(i,o,j,p)}return b.prototype.destroy=function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}var c=this.observer;c&&(c.removeAllListeners(),this.observer=null)},b.prototype.push=function(b,c,d,e,f,h,i,j){var k=this.w,l=a.isFinite(f.startPTS)?f.startPTS:f.start,m=f.decryptdata,n=this.frag,o=!(n&&f.cc===n.cc),p=!(n&&f.level===n.level),q=n&&f.sn===n.sn+1,r=!p&&q;if(o&&g.logger.log(this.id+":discontinuity detected"),p&&g.logger.log(this.id+":switch detected"),this.frag=f,k)k.postMessage({cmd:"demux",data:b,decryptdata:m,initSegment:c,audioCodec:d,videoCodec:e,timeOffset:l,discontinuity:o,trackSwitch:p,contiguous:r,duration:h,accurateTimeOffset:i,defaultInitPTS:j},b instanceof ArrayBuffer?[b]:[]);else{var s=this.demuxer;s&&s.push(b,m,c,d,e,l,o,p,r,h,i,j)}},b.prototype.onWorkerMessage=function(a){var b=a.data,c=this.hls;switch(b.event){case"init":l.URL.revokeObjectURL(this.w.objectURL);break;case e.default.FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data2&&(b.data.data2=new Uint8Array(b.data2));default:b.data=b.data||{},b.data.frag=this.frag,b.data.id=this.id,c.trigger(b.event,b.data)}},b}();b.default=n}).call(this,c("./src/polyfills/number.js").Number)},"./src/demux/exp-golomb.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/logger.js"),e=function(){function a(a){this.data=a,this.bytesAvailable=a.byteLength,this.word=0,this.bitsAvailable=0}return a.prototype.loadWord=function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e},a.prototype.skipBits=function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)},a.prototype.readBits=function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&d.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c},a.prototype.skipLZ=function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!=(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()},a.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},a.prototype.readUEG=function(){var a=this.skipLZ();return this.readBits(a+1)-1},a.prototype.readEG=function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)},a.prototype.readBoolean=function(){return 1===this.readBits(1)},a.prototype.readUByte=function(){return this.readBits(8)},a.prototype.readUShort=function(){return this.readBits(16)},a.prototype.readUInt=function(){return this.readBits(32)},a.prototype.skipScalingList=function(a){var b,c,d=8,e=8;for(b=0;b<a;b++)0!==e&&(c=this.readEG(),e=(d+c+256)%256),d=0===e?d:e},a.prototype.readSPS=function(){var a,b,c,d,e,f,g,h=0,i=0,j=0,k=0,l=this.readUByte.bind(this),m=this.readBits.bind(this),n=this.readUEG.bind(this),o=this.readBoolean.bind(this),p=this.skipBits.bind(this),q=this.skipEG.bind(this),r=this.skipUEG.bind(this),s=this.skipScalingList.bind(this);if(l(),a=l(),m(5),p(3),l(),r(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var t=n();if(3===t&&p(1),r(),r(),p(1),o())for(f=3!==t?8:12,g=0;g<f;g++)o()&&s(g<6?16:64)}r();var u=n();if(0===u)n();else if(1===u)for(p(1),q(),q(),b=n(),g=0;g<b;g++)q();r(),p(1),c=n(),d=n(),e=m(1),0===e&&p(1),p(1),o()&&(h=n(),i=n(),j=n(),k=n());var v=[1,1];if(o()&&o()){switch(l()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[l()<<8|l(),l()<<8|l()]}}return{width:Math.ceil(16*(c+1)-2*h-2*i),height:(2-e)*(d+1)*16-(e?2:4)*(j+k),pixelRatio:v}},a.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},a}();b.default=e},"./src/demux/id3.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.isHeader=function(a,b){return b+10<=a.length&&73===a[b]&&68===a[b+1]&&51===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},a.isFooter=function(a,b){return b+10<=a.length&&51===a[b]&&68===a[b+1]&&73===a[b+2]&&a[b+3]<255&&a[b+4]<255&&a[b+6]<128&&a[b+7]<128&&a[b+8]<128&&a[b+9]<128},a.getID3Data=function(b,c){for(var d=c,e=0;a.isHeader(b,c);){e+=10;e+=a._readSize(b,c+6),a.isFooter(b,c+10)&&(e+=10),c+=e}if(e>0)return b.subarray(d,d+e)},a._readSize=function(a,b){var c=0;return c=(127&a[b])<<21,c|=(127&a[b+1])<<14,c|=(127&a[b+2])<<7,c|=127&a[b+3]},a.getTimeStamp=function(b){for(var c=a.getID3Frames(b),d=0;d<c.length;d++){var e=c[d];if(a.isTimeStampFrame(e))return a._readTimeStamp(e)}},a.isTimeStampFrame=function(a){return a&&"PRIV"===a.key&&"com.apple.streaming.transportStreamTimestamp"===a.info},a._getFrameData=function(b){var c=String.fromCharCode(b[0],b[1],b[2],b[3]),d=a._readSize(b,4),e=10;return{type:c,size:d,data:b.subarray(e,e+d)}},a.getID3Frames=function(b){for(var c=0,d=[];a.isHeader(b,c);){var e=a._readSize(b,c+6);c+=10;for(var f=c+e;c+8<f;){var g=a._getFrameData(b.subarray(c)),h=a._decodeFrame(g);h&&d.push(h),c+=g.size+10}a.isFooter(b,c)&&(c+=10)}return d},a._decodeFrame=function(b){return"PRIV"===b.type?a._decodePrivFrame(b):"T"===b.type[0]?a._decodeTextFrame(b):"W"===b.type[0]?a._decodeURLFrame(b):void 0},a._readTimeStamp=function(a){if(8===a.data.byteLength){var b=new Uint8Array(a.data),c=1&b[3],d=(b[4]<<23)+(b[5]<<15)+(b[6]<<7)+b[7];return d/=45,c&&(d+=47721858.84),Math.round(d)}},a._decodePrivFrame=function(b){if(!(b.size<2)){var c=a._utf8ArrayToStr(b.data,!0),d=new Uint8Array(b.data.subarray(c.length+1));return{key:b.type,info:c,data:d.buffer}}},a._decodeTextFrame=function(b){if(!(b.size<2)){if("TXXX"===b.type){var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data.subarray(1));return{key:b.type,data:f}}},a._decodeURLFrame=function(b){if("WXXX"===b.type){if(b.size<2)return;var c=1,d=a._utf8ArrayToStr(b.data.subarray(c));c+=d.length+1;var e=a._utf8ArrayToStr(b.data.subarray(c));return{key:b.type,info:d,data:e}}var f=a._utf8ArrayToStr(b.data);return{key:b.type,data:f}},a._utf8ArrayToStr=function(a,b){void 0===b&&(b=!1);for(var c,d,e,f=a.length,g="",h=0;h<f;){if(0===(c=a[h++])&&b)return g;if(0!==c&&3!==c)switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:g+=String.fromCharCode(c);break;case 12:case 13:d=a[h++],g+=String.fromCharCode((31&c)<<6|63&d);break;case 14:d=a[h++],e=a[h++],g+=String.fromCharCode((15&c)<<12|(63&d)<<6|(63&e)<<0)}}return g},a}(),e=d._utf8ArrayToStr;b.utf8ArrayToStr=e,b.default=d},"./src/demux/mp3demuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/demux/id3.js"),e=c("./src/utils/logger.js"),f=c("./src/demux/mpegaudio.js"),g=function(){function a(a,b,c){this.observer=a,this.config=c,this.remuxer=b}return a.prototype.resetInitSegment=function(a,b,c,d){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:b,duration:d,inputTimeScale:9e4}},a.prototype.resetTimeStamp=function(){},a.probe=function(a){var b,c,g=d.default.getID3Data(a,0);if(g&&void 0!==d.default.getTimeStamp(g))for(b=g.length,c=Math.min(a.length-1,b+100);b<c;b++)if(f.default.probe(a,b))return e.logger.log("MPEG Audio sync word found !"),!0;return!1},a.prototype.append=function(a,b,c,e){for(var g=d.default.getID3Data(a,0),h=d.default.getTimeStamp(g),i=h?90*h:9e4*b,j=g.length,k=a.length,l=0,m=0,n=this._audioTrack,o=[{pts:i,dts:i,data:g}];j<k;)if(f.default.isHeader(a,j)){var p=f.default.appendFrame(n,a,j,i,l);if(!p)break;j+=p.length,m=p.sample.pts,l++}else d.default.isHeader(a,j)?(g=d.default.getID3Data(a,j),o.push({pts:m,dts:m,data:g}),j+=g.length):j++;this.remuxer.remux(n,{samples:[]},{samples:o,inputTimeScale:9e4},{samples:[]},b,c,e)},a.prototype.destroy=function(){},a}();b.default=g},"./src/demux/mp4demuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/logger.js"),e=c("./src/events.js"),f=Math.pow(2,32)-1,g=function(){function a(a,b){this.observer=a,this.remuxer=b}return a.prototype.resetTimeStamp=function(a){this.initPTS=a},a.prototype.resetInitSegment=function(b,c,d,f){if(b&&b.byteLength){var g=this.initData=a.parseInitSegment(b);null==c&&(c="mp4a.40.5"),null==d&&(d="avc1.42e01e");var h={};g.audio&&g.video?h.audiovideo={container:"video/mp4",codec:c+","+d,initSegment:f?b:null}:(g.audio&&(h.audio={container:"audio/mp4",codec:c,initSegment:f?b:null}),g.video&&(h.video={container:"video/mp4",codec:d,initSegment:f?b:null})),this.observer.trigger(e.default.FRAG_PARSING_INIT_SEGMENT,{tracks:h})}else c&&(this.audioCodec=c),d&&(this.videoCodec=d)},a.probe=function(b){return a.findBox({data:b,start:0,end:Math.min(b.length,16384)},["moof"]).length>0},a.bin2str=function(a){return String.fromCharCode.apply(null,a)},a.readUint16=function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<8|a[b+1];return c<0?65536+c:c},a.readUint32=function(a,b){a.data&&(b+=a.start,a=a.data);var c=a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3];return c<0?4294967296+c:c},a.writeUint32=function(a,b,c){a.data&&(b+=a.start,a=a.data),a[b]=c>>24,a[b+1]=c>>16&255,a[b+2]=c>>8&255,a[b+3]=255&c},a.findBox=function(b,c){var d,e,f,g,h,i,j,k=[];if(b.data?(i=b.start,g=b.end,b=b.data):(i=0,g=b.byteLength),!c.length)return null;for(d=i;d<g;)e=a.readUint32(b,d),f=a.bin2str(b.subarray(d+4,d+8)),j=e>1?d+e:g,f===c[0]&&(1===c.length?k.push({data:b,start:d+8,end:j}):(h=a.findBox({data:b,start:d+8,end:j},c.slice(1)),h.length&&(k=k.concat(h)))),d=j;return k},a.parseSegmentIndex=function(b){var c,d=a.findBox(b,["moov"])[0],e=d?d.end:null,f=0,g=a.findBox(b,["sidx"]);if(!g||!g[0])return null;c=[],g=g[0];var h=g.data[0];f=0===h?8:16;var i=a.readUint32(g,f);f+=4;var j=0,k=0;f+=0===h?8:16,f+=2;var l=g.end+k,m=a.readUint16(g,f);f+=2;for(var n=0;n<m;n++){var o=f,p=a.readUint32(g,o);o+=4;var q=2147483647&p;if(1===(2147483648&p)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var r=a.readUint32(g,o);o+=4,c.push({referenceSize:q,subsegmentDuration:r,info:{duration:r/i,start:l,end:l+q-1}}),l+=q,o+=4,f=o}return{earliestPresentationTime:j,timescale:i,version:h,referencesCount:m,references:c,moovEndOffset:e}},a.parseInitSegment=function(b){var c=[];return a.findBox(b,["moov","trak"]).forEach(function(b){var e=a.findBox(b,["tkhd"])[0];if(e){var f=e.data[e.start],g=0===f?12:20,h=a.readUint32(e,g),i=a.findBox(b,["mdia","mdhd"])[0];if(i){f=i.data[i.start],g=0===f?12:20;var j=a.readUint32(i,g),k=a.findBox(b,["mdia","hdlr"])[0];if(k){var l=a.bin2str(k.data.subarray(k.start+8,k.start+12)),m={soun:"audio",vide:"video"}[l];if(m){var n=a.findBox(b,["mdia","minf","stbl","stsd"]);if(n.length){n=n[0];var o=a.bin2str(n.data.subarray(n.start+12,n.start+16));d.logger.log("MP4Demuxer:"+m+":"+o+" found")}c[h]={timescale:j,type:m},c[m]={timescale:j,id:h}}}}}}),c},a.getStartDTS=function(b,c){var d,e,f;return d=a.findBox(c,["moof","traf"]),e=[].concat.apply([],d.map(function(c){return a.findBox(c,["tfhd"]).map(function(d){var e,f;return e=a.readUint32(d,4),f=b[e].timescale||9e4,a.findBox(c,["tfdt"]).map(function(b){var c,d;return c=b.data[b.start],d=a.readUint32(b,4),1===c&&(d*=Math.pow(2,32),d+=a.readUint32(b,8)),d})[0]/f})})),f=Math.min.apply(null,e),isFinite(f)?f:0},a.offsetStartDTS=function(b,c,d){a.findBox(c,["moof","traf"]).map(function(c){return a.findBox(c,["tfhd"]).map(function(e){var g=a.readUint32(e,4),h=b[g].timescale||9e4;a.findBox(c,["tfdt"]).map(function(b){var c=b.data[b.start],e=a.readUint32(b,4);if(0===c)a.writeUint32(b,4,e-d*h);else{e*=Math.pow(2,32),e+=a.readUint32(b,8),e-=d*h,e=Math.max(e,0);var g=Math.floor(e/(f+1)),i=Math.floor(e%(f+1));a.writeUint32(b,4,g),a.writeUint32(b,8,i)}})})})},a.prototype.append=function(b,c,d,f){var g=this.initData;g||(this.resetInitSegment(b,this.audioCodec,this.videoCodec,!1),g=this.initData);var h,i=this.initPTS;if(void 0===i){var j=a.getStartDTS(g,b);this.initPTS=i=j-c,this.observer.trigger(e.default.INIT_PTS_FOUND,{initPTS:i})}a.offsetStartDTS(g,b,i),h=a.getStartDTS(g,b),this.remuxer.remux(g.audio,g.video,null,null,h,d,f,b)},a.prototype.destroy=function(){},a}();b.default=g},"./src/demux/mpegaudio.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(a,b,c,d,e){if(!(c+24>b.length)){var f=this.parseHeader(b,c);if(f&&c+f.frameLength<=b.length){var g=9e4*f.samplesPerFrame/f.sampleRate,h=d+e*g,i={unit:b.subarray(c,c+f.frameLength),pts:h,dts:h};return a.config=[],a.channelCount=f.channelCount,a.samplerate=f.sampleRate,a.samples.push(i),a.len+=f.frameLength,{sample:i,length:f.frameLength}}}},parseHeader:function(a,b){var c=a[b+1]>>3&3,e=a[b+1]>>1&3,f=a[b+2]>>4&15,g=a[b+2]>>2&3,h=a[b+2]>>1&1;if(1!==c&&0!==f&&15!==f&&3!==g){var i=3===c?3-e:3===e?3:4,j=1e3*d.BitratesMap[14*i+f-1],k=3===c?0:2===c?1:2,l=d.SamplingRateMap[3*k+g],m=a[b+3]>>6==3?1:2,n=d.SamplesCoefficients[c][e],o=d.BytesInSlot[e],p=8*n*o;return{sampleRate:l,channelCount:m,frameLength:parseInt(n*j/l+h,10)*o,samplesPerFrame:p}}},isHeaderPattern:function(a,b){return 255===a[b]&&224==(224&a[b+1])&&0!=(6&a[b+1])},isHeader:function(a,b){return!!(b+1<a.length&&this.isHeaderPattern(a,b))},probe:function(a,b){if(b+1<a.length&&this.isHeaderPattern(a,b)){var c=4,d=this.parseHeader(a,b),e=c;d&&d.frameLength&&(e=d.frameLength);var f=b+e;if(f===a.length||f+1<a.length&&this.isHeaderPattern(a,f))return!0}return!1}};b.default=d},"./src/demux/sample-aes.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/crypt/decrypter.js"),e=function(){function a(a,b,c,e){this.decryptdata=c,this.discardEPB=e,this.decrypter=new d.default(a,b,{removePKCS7Padding:!1})}return a.prototype.decryptBuffer=function(a,b){this.decrypter.decrypt(a,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,b)},a.prototype.decryptAacSample=function(a,b,c,d){var e=a[b].unit,f=e.subarray(16,e.length-e.length%16),g=f.buffer.slice(f.byteOffset,f.byteOffset+f.length),h=this;this.decryptBuffer(g,function(f){f=new Uint8Array(f),e.set(f,16),d||h.decryptAacSamples(a,b+1,c)})},a.prototype.decryptAacSamples=function(a,b,c){for(;;b++){if(b>=a.length)return void c();if(!(a[b].unit.length<32)){var d=this.decrypter.isSync();if(this.decryptAacSample(a,b,c,d),!d)return}}},a.prototype.getAvcEncryptedData=function(a){for(var b=16*Math.floor((a.length-48)/160)+16,c=new Int8Array(b),d=0,e=32;e<=a.length-16;e+=160,d+=16)c.set(a.subarray(e,e+16),d);return c},a.prototype.getAvcDecryptedUnit=function(a,b){b=new Uint8Array(b);for(var c=0,d=32;d<=a.length-16;d+=160,c+=16)a.set(b.subarray(c,c+16),d);return a},a.prototype.decryptAvcSample=function(a,b,c,d,e,f){var g=this.discardEPB(e.data),h=this.getAvcEncryptedData(g),i=this;this.decryptBuffer(h.buffer,function(h){e.data=i.getAvcDecryptedUnit(g,h),f||i.decryptAvcSamples(a,b,c+1,d)})},a.prototype.decryptAvcSamples=function(a,b,c,d){for(;;b++,c=0){if(b>=a.length)return void d();for(var e=a[b].units;!(c>=e.length);c++){var f=e[c];if(!(f.length<=48||1!==f.type&&5!==f.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(a,b,c,d,f,g),!g)return}}}},a}();b.default=e},"./src/demux/tsdemuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/demux/adts.js"),e=c("./src/demux/mpegaudio.js"),f=c("./src/events.js"),g=c("./src/demux/exp-golomb.js"),h=c("./src/demux/sample-aes.js"),i=c("./src/utils/logger.js"),j=c("./src/errors.js"),k={video:1,audio:2,id3:3,text:4},l=function(){function a(a,b,c,d){this.observer=a,this.config=c,this.typeSupported=d,this.remuxer=b,this.sampleAes=null}return a.prototype.setDecryptData=function(a){null!=a&&null!=a.key&&"SAMPLE-AES"===a.method?this.sampleAes=new h.default(this.observer,this.config,a,this.discardEPB):this.sampleAes=null},a.probe=function(b){var c=a._syncOffset(b);return!(c<0)&&(c&&i.logger.warn("MPEG2-TS detected but first sync word found @ offset "+c+", junk ahead ?"),!0)},a._syncOffset=function(a){for(var b=Math.min(1e3,a.length-564),c=0;c<b;){if(71===a[c]&&71===a[c+188]&&71===a[c+376])return c;c++}return-1},a.createTrack=function(a,b){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:k[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===a?0:void 0,isAAC:"audio"===a||void 0,duration:"audio"===a?b:void 0}},a.prototype.resetInitSegment=function(b,c,d,e){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",e),this._audioTrack=a.createTrack("audio",e),this._id3Track=a.createTrack("id3",e),this._txtTrack=a.createTrack("text",e),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=c,this.videoCodec=d,this._duration=e},a.prototype.resetTimeStamp=function(){},a.prototype.append=function(b,c,d,e){var g,h,k,l,m,n=b.length,o=!1;this.contiguous=d;var p=this.pmtParsed,q=this._avcTrack,r=this._audioTrack,s=this._id3Track,t=q.pid,u=r.pid,v=s.pid,w=this._pmtId,x=q.pesData,y=r.pesData,z=s.pesData,A=this._parsePAT,B=this._parsePMT,C=this._parsePES,D=this._parseAVCPES.bind(this),E=this._parseAACPES.bind(this),F=this._parseMPEGPES.bind(this),G=this._parseID3PES.bind(this),H=a._syncOffset(b);for(n-=(n+H)%188,g=H;g<n;g+=188)if(71===b[g]){if(h=!!(64&b[g+1]),k=((31&b[g+1])<<8)+b[g+2],(48&b[g+3])>>4>1){if((l=g+5+b[g+4])===g+188)continue}else l=g+4;switch(k){case t:h&&(x&&(m=C(x))&&void 0!==m.pts&&D(m,!1),x={data:[],size:0}),x&&(x.data.push(b.subarray(l,g+188)),x.size+=g+188-l);break;case u:h&&(y&&(m=C(y))&&void 0!==m.pts&&(r.isAAC?E(m):F(m)),y={data:[],size:0}),y&&(y.data.push(b.subarray(l,g+188)),y.size+=g+188-l);break;case v:h&&(z&&(m=C(z))&&void 0!==m.pts&&G(m),z={data:[],size:0}),z&&(z.data.push(b.subarray(l,g+188)),z.size+=g+188-l);break;case 0:h&&(l+=b[l]+1),w=this._pmtId=A(b,l);break;case w:h&&(l+=b[l]+1);var I=B(b,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);t=I.avc,t>0&&(q.pid=t),u=I.audio,u>0&&(r.pid=u,r.isAAC=I.isAAC),v=I.id3,v>0&&(s.pid=v),o&&!p&&(i.logger.log("reparse from beginning"),o=!1,g=H-188),p=this.pmtParsed=!0;break;case 17:case 8191:break;default:o=!0}}else this.observer.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});x&&(m=C(x))&&void 0!==m.pts?(D(m,!0),q.pesData=null):q.pesData=x,y&&(m=C(y))&&void 0!==m.pts?(r.isAAC?E(m):F(m),r.pesData=null):(y&&y.size&&i.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=y),z&&(m=C(z))&&void 0!==m.pts?(G(m),s.pesData=null):s.pesData=z,null==this.sampleAes?this.remuxer.remux(r,q,s,this._txtTrack,c,d,e):this.decryptAndRemux(r,q,s,this._txtTrack,c,d,e)},a.prototype.decryptAndRemux=function(a,b,c,d,e,f,g){if(a.samples&&a.isAAC){var h=this;this.sampleAes.decryptAacSamples(a.samples,0,function(){h.decryptAndRemuxAvc(a,b,c,d,e,f,g)})}else this.decryptAndRemuxAvc(a,b,c,d,e,f,g)},a.prototype.decryptAndRemuxAvc=function(a,b,c,d,e,f,g){if(b.samples){var h=this;this.sampleAes.decryptAvcSamples(b.samples,0,0,function(){h.remuxer.remux(a,b,c,d,e,f,g)})}else this.remuxer.remux(a,b,c,d,e,f,g)},a.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},a.prototype._parsePAT=function(a,b){return(31&a[b+10])<<8|a[b+11]},a.prototype._parsePMT=function(a,b,c,d){var e,f,g,h,j={audio:-1,avc:-1,id3:-1,isAAC:!0};for(e=(15&a[b+1])<<8|a[b+2],f=b+3+e-4,g=(15&a[b+10])<<8|a[b+11],b+=12+g;b<f;){switch(h=(31&a[b+1])<<8|a[b+2],a[b]){case 207:if(!d){i.logger.log("unkown stream type:"+a[b]);break}case 15:-1===j.audio&&(j.audio=h);break;case 21:-1===j.id3&&(j.id3=h);break;case 219:if(!d){i.logger.log("unkown stream type:"+a[b]);break}case 27:-1===j.avc&&(j.avc=h);break;case 3:case 4:c?-1===j.audio&&(j.audio=h,j.isAAC=!1):i.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:i.logger.warn("HEVC stream type found, not supported for now");break;default:i.logger.log("unkown stream type:"+a[b])}b+=5+((15&a[b+3])<<8|a[b+4])}return j},a.prototype._parsePES=function(a){var b,c,d,e,f,g,h,j,k=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;){var m=new Uint8Array(l[0].length+l[1].length);m.set(l[0]),m.set(l[1],l[0].length),l[0]=m,l.splice(1,1)}if(b=l[0],1===(b[0]<<16)+(b[1]<<8)+b[2]){if((d=(b[4]<<8)+b[5])&&d>a.size-6)return null;c=b[7],192&c&&(g=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,g>4294967295&&(g-=8589934592),64&c?(h=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,h>4294967295&&(h-=8589934592),g-h>54e5&&(i.logger.warn(Math.round((g-h)/9e4)+"s delta between PTS and DTS, align them"),g=h)):h=g),e=b[8],j=e+9,a.size-=j,f=new Uint8Array(a.size);for(var n=0,o=l.length;n<o;n++){b=l[n];var p=b.byteLength;if(j){if(j>p){j-=p;continue}b=b.subarray(j),p-=j,j=0}f.set(b,k),k+=p}return d&&(d-=e+3),{data:f,pts:g,dts:h,len:d}}return null},a.prototype.pushAccesUnit=function(a,b){if(a.units.length&&a.frame){var c=b.samples,d=c.length;!this.config.forceKeyFrameOnDiscontinuity||!0===a.key||b.sps&&(d||this.contiguous)?(a.id=d,c.push(a)):b.dropped++}a.debug.length&&i.logger.log(a.pts+"/"+a.dts+":"+a.debug)},a.prototype._parseAVCPES=function(a,b){var c,d,e,f=this,h=this._avcTrack,i=this._parseAVCNALu(a.data),j=!1,k=this.avcSample,l=!1,m=this.pushAccesUnit.bind(this),n=function(a,b,c,d){return{key:a,pts:b,dts:c,units:[],debug:d}};a.data=null,k&&i.length&&!h.audFound&&(m(k,h),k=this.avcSample=n(!1,a.pts,a.dts,"")),i.forEach(function(b){switch(b.type){case 1:d=!0,k||(k=f.avcSample=n(!0,a.pts,a.dts,"")),j&&(k.debug+="NDR "),k.frame=!0;var i=b.data;if(l&&i.length>4){var o=new g.default(i).readSliceType();2!==o&&4!==o&&7!==o&&9!==o||(k.key=!0)}break;case 5:d=!0,k||(k=f.avcSample=n(!0,a.pts,a.dts,"")),j&&(k.debug+="IDR "),k.key=!0,k.frame=!0;break;case 6:d=!0,j&&k&&(k.debug+="SEI "),c=new g.default(f.discardEPB(b.data)),c.readUByte();for(var p=0,q=0,r=!1,s=0;!r&&c.bytesAvailable>1;){p=0;do{s=c.readUByte(),p+=s}while(255===s);q=0;do{s=c.readUByte(),q+=s}while(255===s);if(4===p&&0!==c.bytesAvailable){r=!0;if(181===c.readUByte()){if(49===c.readUShort()){if(1195456820===c.readUInt()){if(3===c.readUByte()){var t=c.readUByte(),u=c.readUByte(),v=31&t,w=[t,u];for(e=0;e<v;e++)w.push(c.readUByte()),w.push(c.readUByte()),w.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:w})}}}}}else if(q<c.bytesAvailable)for(e=0;e<q;e++)c.readUByte()}break;case 7:if(d=!0,l=!0,j&&k&&(k.debug+="SPS "),!h.sps){c=new g.default(b.data);var x=c.readSPS();h.width=x.width,h.height=x.height,h.pixelRatio=x.pixelRatio,h.sps=[b.data],h.duration=f._duration;var y=b.data.subarray(1,4),z="avc1.";for(e=0;e<3;e++){var A=y[e].toString(16);A.length<2&&(A="0"+A),z+=A}h.codec=z}break;case 8:d=!0,j&&k&&(k.debug+="PPS "),h.pps||(h.pps=[b.data]);break;case 9:d=!1,h.audFound=!0,k&&m(k,h),k=f.avcSample=n(!1,a.pts,a.dts,j?"AUD ":"");break;case 12:d=!1;break;default:d=!1,k&&(k.debug+="unknown NAL "+b.type+" ")}if(k&&d){k.units.push(b)}}),b&&k&&(m(k,h),this.avcSample=null)},a.prototype._insertSampleInOrder=function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)},a.prototype._getLastNalUnit=function(){var a,b=this.avcSample;if(!b||0===b.units.length){var c=this._avcTrack,d=c.samples;b=d[d.length-1]}if(b){var e=b.units;a=e[e.length-1]}return a},a.prototype._parseAVCNALu=function(a){var b,c,d,e,f,g=0,h=a.byteLength,i=this._avcTrack,j=i.naluState||0,k=j,l=[],m=-1;for(-1===j&&(m=0,f=31&a[0],j=0,g=1);g<h;)if(b=a[g++],j)if(1!==j)if(b)if(1===b){if(m>=0)d={data:a.subarray(m,g-j-1),type:f},l.push(d);else{var n=this._getLastNalUnit();if(n&&(k&&g<=4-k&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-k)),(c=g-j-1)>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}g<h?(e=31&a[g],m=g,f=e,j=0):j=-1}else j=0;else j=3;else j=b?0:2;else j=b?0:1;if(m>=0&&j>=0&&(d={data:a.subarray(m,h),type:f,state:j},l.push(d)),0===l.length){var n=this._getLastNalUnit();if(n){var o=new Uint8Array(n.data.byteLength+a.byteLength);o.set(n.data,0),o.set(a,n.data.byteLength),n.data=o}}return i.naluState=j,l},a.prototype.discardEPB=function(a){for(var b,c,d=a.byteLength,e=[],f=1;f<d-2;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;f<b;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c},a.prototype._parseAACPES=function(a){var b,c,e,g,h,k=this._audioTrack,l=a.data,m=a.pts,n=0,o=this.aacOverFlow,p=this.aacLastPTS;if(o){var q=new Uint8Array(o.byteLength+l.byteLength);q.set(o,0),q.set(l,o.byteLength),l=q}for(e=n,h=l.length;e<h-1&&!d.isHeader(l,e);e++);if(e){var r=void 0,s=void 0;if(e<h-1?(r="AAC PES did not start with ADTS header,offset:"+e,s=!1):(r="no ADTS header found in AAC PES",s=!0),i.logger.warn("parsing error:"+r),this.observer.trigger(f.default.ERROR,{type:j.ErrorTypes.MEDIA_ERROR,details:j.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:r}),s)return}if(d.initTrackConfig(k,this.observer,l,e,this.audioCodec),c=0,b=d.getFrameDuration(k.samplerate),o&&p){var t=p+b;Math.abs(t-m)>1&&(i.logger.log("AAC: align PTS for overlapping frames by "+Math.round((t-m)/90)),m=t)}for(;e<h;)if(d.isHeader(l,e)&&e+5<h){var u=d.appendFrame(k,l,e,m,c);if(!u)break;e+=u.length,g=u.sample.pts,c++}else e++;o=e<h?l.subarray(e,h):null,this.aacOverFlow=o,this.aacLastPTS=g},a.prototype._parseMPEGPES=function(a){for(var b=a.data,c=b.length,d=0,f=0,g=a.pts;f<c;)if(e.default.isHeader(b,f)){var h=e.default.appendFrame(this._audioTrack,b,f,g,d);if(!h)break;f+=h.length,d++}else f++},a.prototype._parseID3PES=function(a){this._id3Track.samples.push(a)},a}();b.default=l},"./src/errors.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",KEY_SYSTEM_ERROR:"keySystemError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},b.ErrorDetails={KEY_SYSTEM_NO_KEYS:"keySystemNoKeys",KEY_SYSTEM_NO_ACCESS:"keySystemNoAccess",KEY_SYSTEM_NO_SESSION:"keySystemNoSession",KEY_SYSTEM_LICENSE_REQUEST_FAILED:"keySystemLicenseRequestFailed",MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},"./src/event-handler.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/logger.js"),e=c("./src/errors.js"),f=c("./src/events.js"),g={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function a(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.hls=a,this.onEvent=this.onEvent.bind(this),this.handledEvents=b,this.useGenericHandler=!0,this.registerListeners()}return a.prototype.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},a.prototype.onHandlerDestroying=function(){},a.prototype.onHandlerDestroyed=function(){},a.prototype.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},a.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if(g[a])throw new Error("Forbidden event-name: "+a);this.hls.on(a,this.onEvent)},this)},a.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)},this)},a.prototype.onEvent=function(a,b){this.onEventGeneric(a,b)},a.prototype.onEventGeneric=function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)};try{c.call(this,a,b).call()}catch(b){d.logger.error("An internal error happened while handling event "+a+'. Error message: "'+b.message+'". Here is a stacktrace:',b),this.hls.trigger(f.default.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:b})}},a}();b.default=h},"./src/events.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"};b.default=d},"./src/hls.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./node_modules/url-toolkit/src/url-toolkit.js"),f=c("./src/errors.js"),g=c("./src/loader/playlist-loader.js"),h=c("./src/loader/fragment-loader.js"),i=c("./src/loader/key-loader.js"),j=c("./src/controller/fragment-tracker.js"),k=c("./src/controller/stream-controller.js"),l=c("./src/controller/level-controller.js"),m=c("./src/controller/id3-track-controller.js"),n=c("./src/is-supported.js"),o=c("./src/utils/logger.js"),p=c("./src/config.js"),q=c("./src/events.js"),r=c("./src/observer.js"),s=function(a){function b(c){void 0===c&&(c={});var d=a.call(this)||this,e=b.DefaultConfig;if((c.liveSyncDurationCount||c.liveMaxLatencyDurationCount)&&(c.liveSyncDuration||c.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var f in e)f in c||(c[f]=e[f]);if(void 0!==c.liveMaxLatencyDurationCount&&c.liveMaxLatencyDurationCount<=c.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==c.liveMaxLatencyDuration&&(c.liveMaxLatencyDuration<=c.liveSyncDuration||void 0===c.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');o.enableLogs(c.debug),d.config=c,d._autoLevelCapping=-1;var n=d.abrController=new c.abrController(d),p=new c.bufferController(d),q=new c.capLevelController(d),r=new c.fpsController(d),s=new g.default(d),t=new h.default(d),u=new i.default(d),v=new m.default(d),w=d.levelController=new l.default(d),x=new j.FragmentTracker(d),y=d.streamController=new k.default(d,x),z=[w,y],A=c.audioStreamController;A&&z.push(new A(d,x)),d.networkControllers=z;var B=[s,t,u,n,p,q,r,v,x];if(A=c.audioTrackController){var C=new A(d);d.audioTrackController=C,B.push(C)}if(A=c.subtitleTrackController){var D=new A(d);d.subtitleTrackController=D,z.push(D)}if(A=c.emeController){var E=new A(d);d.emeController=E,B.push(E)}return A=c.subtitleStreamController,A&&z.push(new A(d,x)),A=c.timelineController,A&&B.push(new A(d)),d.coreComponents=B,d}return d(b,a),Object.defineProperty(b,"version",{get:function(){return"0.12.4"},enumerable:!0,configurable:!0}),b.isSupported=function(){return n.isSupported()},Object.defineProperty(b,"Events",{get:function(){return q.default},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ErrorTypes",{get:function(){return f.ErrorTypes},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ErrorDetails",{get:function(){return f.ErrorDetails},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultConfig",{get:function(){return b.defaultConfig?b.defaultConfig:p.hlsDefaultConfig},set:function(a){b.defaultConfig=a},enumerable:!0,configurable:!0}),b.prototype.destroy=function(){o.logger.log("destroy"),this.trigger(q.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(a){a.destroy()}),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},b.prototype.attachMedia=function(a){o.logger.log("attachMedia"),this.media=a,this.trigger(q.default.MEDIA_ATTACHING,{media:a})},b.prototype.detachMedia=function(){o.logger.log("detachMedia"),this.trigger(q.default.MEDIA_DETACHING),this.media=null},b.prototype.loadSource=function(a){a=e.buildAbsoluteURL(window.location.href,a,{alwaysNormalize:!0}),o.logger.log("loadSource:"+a),this.url=a,this.trigger(q.default.MANIFEST_LOADING,{url:a})},b.prototype.startLoad=function(a){void 0===a&&(a=-1),o.logger.log("startLoad("+a+")"),this.networkControllers.forEach(function(b){b.startLoad(a)})},b.prototype.stopLoad=function(){o.logger.log("stopLoad"),this.networkControllers.forEach(function(a){a.stopLoad()})},b.prototype.swapAudioCodec=function(){o.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.prototype.recoverMediaError=function(){o.logger.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)},Object.defineProperty(b.prototype,"levels",{get:function(){return this.levelController.levels},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"currentLevel",{get:function(){return this.streamController.currentLevel},set:function(a){o.logger.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextLevel",{get:function(){return this.streamController.nextLevel},set:function(a){o.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"loadLevel",{get:function(){return this.levelController.level},set:function(a){o.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextLoadLevel",{get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"firstLevel",{get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(a){o.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"startLevel",{get:function(){return this.levelController.startLevel},set:function(a){o.logger.log("set startLevel:"+a);var b=this;-1!==a&&(a=Math.max(a,b.minAutoLevel)),b.levelController.startLevel=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoLevelCapping",{get:function(){return this._autoLevelCapping},set:function(a){o.logger.log("set autoLevelCapping:"+a),this._autoLevelCapping=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"autoLevelEnabled",{get:function(){return-1===this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"manualLevel",{get:function(){return this.levelController.manualLevel},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"minAutoLevel",{get:function(){for(var a=this,b=a.levels,c=a.config.minAutoBitrate,d=b?b.length:0,e=0;e<d;e++){if((b[e].realBitrate?Math.max(b[e].realBitrate,b[e].bitrate):b[e].bitrate)>c)return e}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"maxAutoLevel",{get:function(){var a=this,b=a.levels,c=a.autoLevelCapping;return-1===c&&b&&b.length?b.length-1:c},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"nextAutoLevel",{get:function(){var a=this;return Math.min(Math.max(a.abrController.nextAutoLevel,a.minAutoLevel),a.maxAutoLevel)},set:function(a){var b=this;b.abrController.nextAutoLevel=Math.max(b.minAutoLevel,a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTracks",{get:function(){var a=this.audioTrackController;return a?a.audioTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"audioTrack",{get:function(){var a=this.audioTrackController;return a?a.audioTrack:-1},set:function(a){var b=this.audioTrackController;b&&(b.audioTrack=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"liveSyncPosition",{get:function(){return this.streamController.liveSyncPosition},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleTracks",{get:function(){var a=this.subtitleTrackController;return a?a.subtitleTracks:[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleTrack",{get:function(){var a=this.subtitleTrackController;return a?a.subtitleTrack:-1},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleTrack=a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"subtitleDisplay",{get:function(){var a=this.subtitleTrackController;return!!a&&a.subtitleDisplay},set:function(a){var b=this.subtitleTrackController;b&&(b.subtitleDisplay=a)},enumerable:!0,configurable:!0}),b}(r.Observer);b.default=s},"./src/is-supported.js":function(a,b,c){"use strict";function d(){var a=e.getMediaSource(),b=window.SourceBuffer||window.WebKitSourceBuffer,c=a&&"function"==typeof a.isTypeSupported&&a.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),d=!b||b.prototype&&"function"==typeof b.prototype.appendBuffer&&"function"==typeof b.prototype.remove;return!!c&&!!d}Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/utils/mediasource-helper.js");b.isSupported=d},"./src/loader/fragment-loader.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=function(b){function c(a){var c=b.call(this,a,e.default.FRAG_LOADING)||this;return c.loaders={},c}return d(c,b),c.prototype.destroy=function(){var a=this.loaders;for(var c in a){var d=a[c];d&&d.destroy()}this.loaders={},b.prototype.destroy.call(this)},c.prototype.onFragLoading=function(b){var c=b.frag,d=c.type,e=this.loaders,f=this.hls.config,g=f.fLoader,i=f.loader;c.loaded=0;var j=e[d];j&&(h.logger.warn("abort previous fragment loader for type: "+d),j.abort()),j=e[d]=c.loader=f.fLoader?new g(f):new i(f);var k,l,m;k={url:c.url,frag:c,responseType:"arraybuffer",progressData:!1};var n=c.byteRangeStartOffset,o=c.byteRangeEndOffset;a.isFinite(n)&&a.isFinite(o)&&(k.rangeStart=n,k.rangeEnd=o),l={timeout:f.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:f.fragLoadingMaxRetryTimeout},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},j.load(k,l,m)},c.prototype.loadsuccess=function(a,b,c,d){void 0===d&&(d=null);var f=a.data,g=c.frag;g.loader=void 0,this.loaders[g.type]=void 0,this.hls.trigger(e.default.FRAG_LOADED,{payload:f,frag:g,stats:b,networkDetails:d})},c.prototype.loaderror=function(a,b,c){void 0===c&&(c=null);var d=b.frag,f=d.loader;f&&f.abort(),this.loaders[d.type]=void 0,this.hls.trigger(e.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a,networkDetails:c})},c.prototype.loadtimeout=function(a,b,c){void 0===c&&(c=null);var d=b.frag,f=d.loader;f&&f.abort(),this.loaders[d.type]=void 0,this.hls.trigger(e.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag,networkDetails:c})},c.prototype.loadprogress=function(a,b,c,d){void 0===d&&(d=null);var f=b.frag;f.loaded=a.loaded,this.hls.trigger(e.default.FRAG_LOAD_PROGRESS,{frag:f,stats:a,networkDetails:d})},c}(f.default);b.default=i}).call(this,c("./src/polyfills/number.js").Number)},"./src/loader/fragment.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c("./node_modules/url-toolkit/src/url-toolkit.js"),e=c("./src/loader/level-key.js"),f=function(){function b(){var a;this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[],this.programDateTime=null,this.rawProgramDateTime=null,this._elementaryStreams=(a={},a[b.ElementaryStreamTypes.AUDIO]=!1,a[b.ElementaryStreamTypes.VIDEO]=!1,a)}return Object.defineProperty(b,"ElementaryStreamTypes",{get:function(){return{AUDIO:"audio",VIDEO:"video"}},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"url",{get:function(){return!this._url&&this.relurl&&(this._url=d.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(a){this._url=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRange",{get:function(){if(!this._byteRange&&!this.rawByteRange)return[];if(this._byteRange)return this._byteRange;var a=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(1===b.length){var c=this.lastByteRangeEndOffset;a[0]=c||0}else a[0]=parseInt(b[1]);a[1]=parseInt(b[0])+a[0],this._byteRange=a}return a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRangeStartOffset",{get:function(){return this.byteRange[0]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"byteRangeEndOffset",{get:function(){return this.byteRange[1]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"decryptdata",{get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"endProgramDateTime",{get:function(){if(!a.isFinite(this.programDateTime))return null;var b=a.isFinite(this.duration)?this.duration:0;return this.programDateTime+1e3*b},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"encrypted",{get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)},enumerable:!0,configurable:!0}),b.prototype.addElementaryStream=function(a){this._elementaryStreams[a]=!0},b.prototype.hasElementaryStream=function(a){return!0===this._elementaryStreams[a]},b.prototype.createInitializationVector=function(a){for(var b=new Uint8Array(16),c=12;c<16;c++)b[c]=a>>8*(15-c)&255;return b},b.prototype.fragmentDecryptdataFromLevelkey=function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=new e.default,c.method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c},b}();b.default=f}).call(this,c("./src/polyfills/number.js").Number)},"./src/loader/key-loader.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=function(a){function b(b){var c=a.call(this,b,e.default.KEY_LOADING)||this;return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return d(b,a),b.prototype.destroy=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},f.default.prototype.destroy.call(this)},b.prototype.onKeyLoading=function(a){var b=a.frag,c=b.type,d=this.loaders[c],f=b.decryptdata,g=f.uri;if(g!==this.decrypturl||null===this.decryptkey){var i=this.hls.config;d&&(h.logger.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new i.loader(i),this.decrypturl=g,this.decryptkey=null;var j=void 0,k=void 0,l=void 0;j={url:g,frag:b,responseType:"arraybuffer"},k={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(j,k,l)}else this.decryptkey&&(f.key=this.decryptkey,this.hls.trigger(e.default.KEY_LOADED,{frag:b}))},b.prototype.loadsuccess=function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(e.default.KEY_LOADED,{frag:d})},b.prototype.loaderror=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(e.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})},b.prototype.loadtimeout=function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(e.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})},b}(f.default);b.default=i},"./src/loader/level-key.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./node_modules/url-toolkit/src/url-toolkit.js"),e=function(){function a(){this.method=null,this.key=null,this.iv=null,this._uri=null}return Object.defineProperty(a.prototype,"uri",{get:function(){return!this._uri&&this.reluri&&(this._uri=d.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri},enumerable:!0,configurable:!0}),a}();b.default=e},"./src/loader/level.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function b(a){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=a,this.version=null}return Object.defineProperty(b.prototype,"hasProgramDateTime",{get:function(){return!(!this.fragments[0]||!a.isFinite(this.fragments[0].programDateTime))},enumerable:!0,configurable:!0}),b}();b.default=c}).call(this,c("./src/polyfills/number.js").Number)},"./src/loader/m3u8-parser.js":function(a,b,c){"use strict";(function(a){function d(a,b){for(var c=a[b],d=b-1;d>=0;d--){var e=a[d];e.programDateTime=c.programDateTime-1e3*e.duration,c=e}}function e(b,c){b.rawProgramDateTime?b.programDateTime=Date.parse(b.rawProgramDateTime):c&&c.programDateTime&&(b.programDateTime=c.endProgramDateTime),a.isFinite(b.programDateTime)||(b.programDateTime=null,b.rawProgramDateTime=null)}Object.defineProperty(b,"__esModule",{value:!0});var f=c("./node_modules/url-toolkit/src/url-toolkit.js"),g=c("./src/loader/fragment.js"),h=c("./src/loader/level.js"),i=c("./src/loader/level-key.js"),j=c("./src/utils/attr-list.js"),k=c("./src/utils/logger.js"),l=c("./src/utils/codecs.js"),m=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,n=/#EXT-X-MEDIA:(.*)/g,o=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),p=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,q=/\.(mp4|m4s|m4v|m4a)$/i,r=function(){function b(){}return b.findGroup=function(a,b){if(!a)return null;for(var c=null,d=0;d<a.length;d++){var e=a[d];e.id===b&&(c=e)}return c},b.convertAVC1ToAVCOTI=function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b},b.resolve=function(a,b){return f.buildAbsoluteURL(b,a,{alwaysNormalize:!0})},b.parseMasterPlaylist=function(a,c){function d(a,b){["video","audio"].forEach(function(c){var d=a.filter(function(a){return l.isCodecType(a,c)});if(d.length){var e=d.filter(function(a){return 0===a.lastIndexOf("avc1",0)||0===a.lastIndexOf("mp4a",0)});b[c+"Codec"]=e.length>0?e[0]:d[0],a=a.filter(function(a){return-1===d.indexOf(a)})}}),b.unknownCodecs=a}var e,f=[];for(m.lastIndex=0;null!=(e=m.exec(a));){var g={},h=g.attrs=new j.default(e[1]);g.url=b.resolve(e[2],c);var i=h.decimalResolution("RESOLUTION");i&&(g.width=i.width,g.height=i.height),g.bitrate=h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH"),g.name=h.NAME,d([].concat((h.CODECS||"").split(/[ ,]+/)),g),g.videoCodec&&-1!==g.videoCodec.indexOf("avc1")&&(g.videoCodec=b.convertAVC1ToAVCOTI(g.videoCodec)),f.push(g)}return f},b.parseMasterPlaylistMedia=function(a,c,d,e){void 0===e&&(e=[]);var f,g=[],h=0;for(n.lastIndex=0;null!==(f=n.exec(a));){var i={},k=new j.default(f[1]);if(k.TYPE===d){if(i.groupId=k["GROUP-ID"],i.name=k.NAME,i.type=d,i.default="YES"===k.DEFAULT,i.autoselect="YES"===k.AUTOSELECT,i.forced="YES"===k.FORCED,k.URI&&(i.url=b.resolve(k.URI,c)),i.lang=k.LANGUAGE,i.name||(i.name=i.lang),e.length){var l=b.findGroup(e,i.groupId);i.audioCodec=l?l.codec:e[0].codec}i.id=h++,g.push(i)}}return g},b.parseLevelPlaylist=function(b,c,f,l,m){var n,r,s=0,t=0,u=new h.default(c),v=new i.default,w=0,x=null,y=new g.default,z=null;for(o.lastIndex=0;null!==(n=o.exec(b));){var A=n[1];if(A){y.duration=parseFloat(A);var B=(" "+n[2]).slice(1);y.title=B||null,y.tagList.push(B?["INF",A,B]:["INF",A])}else if(n[3]){if(a.isFinite(y.duration)){var C=s++;y.type=l,y.start=t,y.levelkey=v,y.sn=C,y.level=f,y.cc=w,y.urlId=m,y.baseurl=c,y.relurl=(" "+n[3]).slice(1),e(y,x),u.fragments.push(y),x=y,t+=y.duration,y=new g.default}}else if(n[4]){if(y.rawByteRange=(" "+n[4]).slice(1),x){var D=x.byteRangeEndOffset;D&&(y.lastByteRangeEndOffset=D)}}else if(n[5])y.rawProgramDateTime=(" "+n[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),null===z&&(z=u.fragments.length);else{for(n=n[0].match(p),r=1;r<n.length&&void 0===n[r];r++);var E=(" "+n[r+1]).slice(1),F=(" "+n[r+2]).slice(1);switch(n[r]){case"#":y.tagList.push(F?[E,F]:[E]);break;case"PLAYLIST-TYPE":u.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":s=u.startSN=parseInt(E);break;case"TARGETDURATION":u.targetduration=parseFloat(E);break;case"VERSION":u.version=parseInt(E);break;case"EXTM3U":break;case"ENDLIST":u.live=!1;break;case"DIS":w++,y.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":w=parseInt(E);break;case"KEY":var G=E,H=new j.default(G),I=H.enumeratedString("METHOD"),J=H.URI,K=H.hexadecimalInteger("IV");I&&(v=new i.default,J&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(I)>=0&&(v.method=I,v.baseuri=c,v.reluri=J,v.key=null,v.iv=K));break;case"START":var L=E,M=new j.default(L),N=M.decimalFloatingPoint("TIME-OFFSET");a.isFinite(N)&&(u.startTimeOffset=N);break;case"MAP":var O=new j.default(E);y.relurl=O.URI,y.rawByteRange=O.BYTERANGE,y.baseurl=c,y.level=f,y.type=l,y.sn="initSegment",u.initSegment=y,y=new g.default,y.rawProgramDateTime=u.initSegment.rawProgramDateTime;break;default:k.logger.warn("line parsed but not handled: "+n)}}}return y=x,y&&!y.relurl&&(u.fragments.pop(),t-=y.duration),u.totalduration=t,u.averagetargetduration=t/u.fragments.length,u.endSN=s-1,u.startCC=u.fragments[0]?u.fragments[0].cc:0,u.endCC=w,!u.initSegment&&u.fragments.length&&u.fragments.every(function(a){return q.test(a.relurl)})&&(k.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),y=new g.default,y.relurl=u.fragments[0].relurl,y.baseurl=c,y.level=f,y.type=l,y.sn="initSegment",u.initSegment=y,u.needSidxRanges=!0),z&&d(u.fragments,z),u},b}();b.default=r}).call(this,c("./src/polyfills/number.js").Number)},"./src/loader/playlist-loader.js":function(a,b,c){"use strict";(function(a){var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/events.js"),f=c("./src/event-handler.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=c("./src/demux/mp4demuxer.js"),j=c("./src/loader/m3u8-parser.js"),k=window.performance,l={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},m={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},n=function(b){function c(a){var c=b.call(this,a,e.default.MANIFEST_LOADING,e.default.LEVEL_LOADING,e.default.AUDIO_TRACK_LOADING,e.default.SUBTITLE_TRACK_LOADING)||this;return c.loaders={},c}return d(c,b),Object.defineProperty(c,"ContextType",{get:function(){return l},enumerable:!0,configurable:!0}),Object.defineProperty(c,"LevelType",{get:function(){return m},enumerable:!0,configurable:!0}),c.canHaveQualityLevels=function(a){return a!==l.AUDIO_TRACK&&a!==l.SUBTITLE_TRACK},c.mapContextToLevelType=function(a){switch(a.type){case l.AUDIO_TRACK:return m.AUDIO;case l.SUBTITLE_TRACK:return m.SUBTITLE;default:return m.MAIN}},c.getResponseUrl=function(a,b){var c=a.url;return void 0!==c&&0!==c.indexOf("data:")||(c=b.url),c},c.prototype.createInternalLoader=function(a){var b=this.hls.config,c=b.pLoader,d=b.loader,e=c||d,f=new e(b);return a.loader=f,this.loaders[a.type]=f,f},c.prototype.getInternalLoader=function(a){return this.loaders[a.type]},c.prototype.resetInternalLoader=function(a){this.loaders[a]&&delete this.loaders[a]},c.prototype.destroyInternalLoaders=function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy(),this.resetInternalLoader(a)}},c.prototype.destroy=function(){this.destroyInternalLoaders(),b.prototype.destroy.call(this)},c.prototype.onManifestLoading=function(a){this.load(a.url,{type:l.MANIFEST,level:0,id:null})},c.prototype.onLevelLoading=function(a){this.load(a.url,{type:l.LEVEL,level:a.level,id:a.id})},c.prototype.onAudioTrackLoading=function(a){this.load(a.url,{type:l.AUDIO_TRACK,level:null,id:a.id})},c.prototype.onSubtitleTrackLoading=function(a){this.load(a.url,{type:l.SUBTITLE_TRACK,level:null,id:a.id})},c.prototype.load=function(a,b){var c=this.hls.config;h.logger.debug("Loading playlist of type "+b.type+", level: "+b.level+", id: "+b.id);var d=this.getInternalLoader(b);if(d){var e=d.context;if(e&&e.url===a)return h.logger.trace("playlist request ongoing"),!1;h.logger.warn("aborting previous loader for type: "+b.type),d.abort()}var f,g,i,j;switch(b.type){case l.MANIFEST:f=c.manifestLoadingMaxRetry,g=c.manifestLoadingTimeOut,i=c.manifestLoadingRetryDelay,j=c.manifestLoadingMaxRetryTimeout;break;case l.LEVEL:f=0,g=c.levelLoadingTimeOut;break;default:f=c.levelLoadingMaxRetry,g=c.levelLoadingTimeOut,i=c.levelLoadingRetryDelay,j=c.levelLoadingMaxRetryTimeout}d=this.createInternalLoader(b),b.url=a,b.responseType=b.responseType||"";var k={timeout:g,maxRetry:f,retryDelay:i,maxRetryDelay:j},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return h.logger.debug("Calling internal loader delegate for URL: "+a),d.load(b,k,m),!0},c.prototype.loadsuccess=function(a,b,c,d){if(void 0===d&&(d=null),c.isSidxRequest)return this._handleSidxRequest(a,c),void this._handlePlaylistLoaded(a,b,c,d);this.resetInternalLoader(c.type);var e=a.data;if(b.tload=k.now(),0!==e.indexOf("#EXTM3U"))return void this._handleManifestParsingError(a,c,"no EXTM3U delimiter",d);e.indexOf("#EXTINF:")>0||e.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(a,b,c,d):this._handleMasterPlaylist(a,b,c,d)},c.prototype.loaderror=function(a,b,c){void 0===c&&(c=null),this._handleNetworkError(b,c,!1,a)},c.prototype.loadtimeout=function(a,b,c){void 0===c&&(c=null),this._handleNetworkError(b,c,!0)},c.prototype._handleMasterPlaylist=function(a,b,d,f){var g=this.hls,i=a.data,k=c.getResponseUrl(a,d),l=j.default.parseMasterPlaylist(i,k);if(!l.length)return void this._handleManifestParsingError(a,d,"no level found in manifest",f);var m=l.map(function(a){return{id:a.attrs.AUDIO,codec:a.audioCodec}}),n=j.default.parseMasterPlaylistMedia(i,k,"AUDIO",m),o=j.default.parseMasterPlaylistMedia(i,k,"SUBTITLES");if(n.length){var p=!1;n.forEach(function(a){a.url||(p=!0)}),!1===p&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(h.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main"}))}g.trigger(e.default.MANIFEST_LOADED,{levels:l,audioTracks:n,subtitles:o,url:k,stats:b,networkDetails:f})},c.prototype._handleTrackOrLevelPlaylist=function(b,d,f,g){var h=this.hls,i=f.id,m=f.level,n=f.type,o=c.getResponseUrl(b,f),p=a.isFinite(i)?i:0,q=a.isFinite(m)?m:p,r=c.mapContextToLevelType(f),s=j.default.parseLevelPlaylist(b.data,o,q,r,p);if(s.tload=d.tload,n===l.MANIFEST){var t={url:o,details:s};h.trigger(e.default.MANIFEST_LOADED,{levels:[t],audioTracks:[],url:o,stats:d,networkDetails:g})}if(d.tparsed=k.now(),s.needSidxRanges){var u=s.initSegment.url;return void this.load(u,{isSidxRequest:!0,type:n,level:m,levelDetails:s,id:i,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}f.levelDetails=s,this._handlePlaylistLoaded(b,d,f,g)},c.prototype._handleSidxRequest=function(a,b){var c=i.default.parseSegmentIndex(new Uint8Array(a.data));if(c){var d=c.references,e=b.levelDetails;d.forEach(function(a,b){var c=a.info,d=e.fragments[b];0===d.byteRange.length&&(d.rawByteRange=String(1+c.end-c.start)+"@"+String(c.start))}),e.initSegment.rawByteRange=String(c.moovEndOffset)+"@0"}},c.prototype._handleManifestParsingError=function(a,b,c,d){this.hls.trigger(e.default.ERROR,{type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a.url,reason:c,networkDetails:d})},c.prototype._handleNetworkError=function(a,b,c,d){void 0===c&&(c=!1),void 0===d&&(d=null),h.logger.info("A network error occured while loading a "+a.type+"-type playlist");var f,i,j=this.getInternalLoader(a);switch(a.type){case l.MANIFEST:f=c?g.ErrorDetails.MANIFEST_LOAD_TIMEOUT:g.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case l.LEVEL:f=c?g.ErrorDetails.LEVEL_LOAD_TIMEOUT:g.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case l.AUDIO_TRACK:f=c?g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;default:i=!1}j&&(j.abort(),this.resetInternalLoader(a.type));var k={type:g.ErrorTypes.NETWORK_ERROR,details:f,fatal:i,url:j.url,loader:j,context:a,networkDetails:b};d&&(k.response=d),this.hls.trigger(e.default.ERROR,k)},c.prototype._handlePlaylistLoaded=function(a,b,d,f){var g=d.type,h=d.level,i=d.id,j=d.levelDetails;if(!j.targetduration)return void this._handleManifestParsingError(a,d,"invalid target duration",f);if(c.canHaveQualityLevels(d.type))this.hls.trigger(e.default.LEVEL_LOADED,{details:j,level:h||0,id:i||0,stats:b,networkDetails:f});else switch(g){case l.AUDIO_TRACK:this.hls.trigger(e.default.AUDIO_TRACK_LOADED,{details:j,id:i,stats:b,networkDetails:f});break;case l.SUBTITLE_TRACK:this.hls.trigger(e.default.SUBTITLE_TRACK_LOADED,{details:j,id:i,stats:b,networkDetails:f})}},c}(f.default);b.default=n}).call(this,c("./src/polyfills/number.js").Number)},"./src/observer.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./node_modules/eventemitter3/index.js"),f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.trigger=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];this.emit.apply(this,[a,a].concat(b))},b}(e.EventEmitter);b.Observer=f},"./src/polyfills/number.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/get-self-scope.js"),e=d.getSelfScope(),f=e.Number;b.Number=f,f.isFinite=f.isFinite||function(a){return"number"==typeof a&&isFinite(a)}},"./src/remux/aac-helper.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.getSilentFrame=function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},a}();b.default=d},"./src/remux/mp4-generator.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=Math.pow(2,32)-1,e=function(){function a(){}return a.init=function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))},a.box=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(b=new Uint8Array(d),b[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;e<f;e++)b.set(c[e],d),d+=c[e].byteLength;return b},a.hdlr=function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])},a.mdat=function(b){return a.box(a.types.mdat,b)},a.mdhd=function(b,c){c*=b;var e=Math.floor(c/(d+1)),f=Math.floor(c%(d+1));return a.box(a.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,e>>24,e>>16&255,e>>8&255,255&e,f>>24,f>>16&255,f>>8&255,255&f,85,196,0,0]))},a.mdia=function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))},a.mfhd=function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))},a.minf=function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))},a.moof=function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))},a.moov=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))},a.mvex=function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))},a.mvhd=function(b,c){c*=b;var e=Math.floor(c/(d+1)),f=Math.floor(c%(d+1)),g=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,e>>24,e>>16&255,e>>8&255,255&e,f>>24,f>>16&255,f>>8&255,255&f,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,g)},a.sdtp=function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)},a.stbl=function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))},a.avc1=function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))},a.esds=function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))},a.mp4a=function(b){var c=b.samplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))},a.mp3=function(b){var c=b.samplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))},a.stsd=function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))},a.tkhd=function(b){var c=b.id,e=b.duration*b.timescale,f=b.width,g=b.height,h=Math.floor(e/(d+1)),i=Math.floor(e%(d+1));return a.box(a.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,h>>24,h>>16&255,h>>8&255,255&h,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,f>>8&255,255&f,0,0,g>>8&255,255&g,0,0]))},a.traf=function(b,c){var e=a.sdtp(b),f=b.id,g=Math.floor(c/(d+1)),h=Math.floor(c%(d+1));return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,f>>24,f>>16&255,f>>8&255,255&f])),a.box(a.types.tfdt,new Uint8Array([1,0,0,0,g>>24,g>>16&255,g>>8&255,255&g,h>>24,h>>16&255,h>>8&255,255&h])),a.trun(b,e.length+16+20+8+16+8+8),e)},a.trak=function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))},a.trex=function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},a.trun=function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;d<k;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)},a.initSegment=function(b){a.types||a.init();var c,d=a.moov(b);return c=new Uint8Array(a.FTYP.byteLength+d.byteLength),c.set(a.FTYP),c.set(d,a.FTYP.byteLength),c},a}();b.default=e},"./src/remux/mp4-remuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/remux/aac-helper.js"),e=c("./src/remux/mp4-generator.js"),f=c("./src/events.js"),g=c("./src/errors.js"),h=c("./src/utils/logger.js"),i=1e4,j=function(){function a(a,b,c,d){this.observer=a,this.config=b,this.typeSupported=c;var e=navigator.userAgent;this.isSafari=d&&d.indexOf("Apple")>-1&&e&&!e.match("CriOS"),this.ISGenerated=!1}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(a){this._initPTS=this._initDTS=a},a.prototype.resetInitSegment=function(){this.ISGenerated=!1},a.prototype.remux=function(a,b,c,d,e,g,i){if(this.ISGenerated||this.generateIS(a,b,e),this.ISGenerated){var j=a.samples.length,k=b.samples.length,l=e,m=e;if(j&&k){var n=(a.samples[0].pts-b.samples[0].pts)/b.inputTimeScale;l+=Math.max(0,n),m+=Math.max(0,-n)}if(j){a.timescale||(h.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(a,b,e));var o=this.remuxAudio(a,l,g,i);if(k){var p=void 0;o&&(p=o.endPTS-o.startPTS),b.timescale||(h.logger.warn("regenerate InitSegment as video detected"),this.generateIS(a,b,e)),this.remuxVideo(b,m,g,p,i)}}else if(k){var q=this.remuxVideo(b,m,g,0,i);q&&a.codec&&this.remuxEmptyAudio(a,l,g,q)}}c.samples.length&&this.remuxID3(c,e),d.samples.length&&this.remuxText(d,e),this.observer.trigger(f.default.FRAG_PARSED)},a.prototype.generateIS=function(a,b,c){var d,i,j=this.observer,k=a.samples,l=b.samples,m=this.typeSupported,n="audio/mp4",o={},p={tracks:o},q=void 0===this._initPTS;if(q&&(d=i=1/0),a.config&&k.length&&(a.timescale=a.samplerate,h.logger.log("audio sampling rate : "+a.samplerate),a.isAAC||(m.mpeg?(n="audio/mpeg",a.codec=""):m.mp3&&(a.codec="mp3")),o.audio={container:n,codec:a.codec,initSegment:!a.isAAC&&m.mpeg?new Uint8Array:e.default.initSegment([a]),metadata:{channelCount:a.channelCount}},q&&(d=i=k[0].pts-a.inputTimeScale*c)),b.sps&&b.pps&&l.length){var r=b.inputTimeScale;b.timescale=r,o.video={container:"video/mp4",codec:b.codec,initSegment:e.default.initSegment([b]),metadata:{width:b.width,height:b.height}},q&&(d=Math.min(d,l[0].pts-r*c),i=Math.min(i,l[0].dts-r*c),this.observer.trigger(f.default.INIT_PTS_FOUND,{initPTS:d}))}Object.keys(o).length?(j.trigger(f.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,q&&(this._initPTS=d,this._initDTS=i)):j.trigger(f.default.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},a.prototype.remuxVideo=function(a,b,c,d,i){var j,k,l,m,n,o,p,q=8,r=a.timescale,s=a.samples,t=[],u=s.length,v=this._PTSNormalize,w=this._initPTS,x=this.nextAvcDts,y=this.isSafari;if(0!==u){y&&(c|=s.length&&x&&(i&&Math.abs(b-x/r)<.1||Math.abs(s[0].pts-x-w)<r/5)),c||(x=b*r),s.forEach(function(a){a.pts=v(a.pts-w,x),a.dts=v(a.dts-w,x)}),s.sort(function(a,b){var c=a.dts-b.dts,d=a.pts-b.pts;return c||d||a.id-b.id});var z=s.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(z<0){h.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(z/90)+" ms to overcome this issue");for(var A=0;A<s.length;A++)s[A].dts+=z}var B=s[0];n=Math.max(B.dts,0),m=Math.max(B.pts,0);var C=Math.round((n-x)/90);c&&C&&(C>1?h.logger.log("AVC:"+C+" ms hole between fragments detected,filling it"):C<-1&&h.logger.log("AVC:"+-C+" ms overlapping between fragments detected"),n=x,s[0].dts=n,m=Math.max(m-C,x),s[0].pts=m,h.logger.log("Video/PTS/DTS adjusted: "+Math.round(m/90)+"/"+Math.round(n/90)+",delta:"+C+" ms")),B=s[s.length-1],p=Math.max(B.dts,0),o=Math.max(B.pts,0,p),y&&(j=Math.round((p-n)/(s.length-1)));for(var D=0,E=0,A=0;A<u;A++){for(var F=s[A],G=F.units,H=G.length,I=0,J=0;J<H;J++)I+=G[J].data.length;E+=I,D+=H,F.length=I,F.dts=y?n+A*j:Math.max(F.dts,n),F.pts=Math.max(F.pts,F.dts)}var K=E+4*D+8;try{k=new Uint8Array(K)}catch(a){return void this.observer.trigger(f.default.ERROR,{type:g.ErrorTypes.MUX_ERROR,details:g.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:K,reason:"fail allocating video mdat "+K})}var L=new DataView(k.buffer);L.setUint32(0,K),k.set(e.default.types.mdat,4);for(var A=0;A<u;A++){for(var M=s[A],N=M.units,O=0,P=void 0,J=0,H=N.length;J<H;J++){var Q=N[J],R=Q.data,S=Q.data.byteLength;L.setUint32(q,S),q+=4,k.set(R,q),q+=S,O+=4+S}if(y)P=Math.max(0,j*Math.round((M.pts-M.dts)/j));else{if(A<u-1)j=s[A+1].dts-M.dts;else{var T=this.config,U=M.dts-s[A>0?A-1:A].dts;if(T.stretchShortVideoTrack){var V=T.maxBufferHole,W=Math.floor(V*r),X=(d?m+d*r:this.nextAudioPts)-M.pts;X>W?(j=X-U,j<0&&(j=U),h.logger.log("It is approximately "+X/90+" ms to the next segment; using duration "+j/90+" ms for the last video frame.")):j=U}else j=U}P=Math.round(M.pts-M.dts)}t.push({size:O,duration:j,cts:P,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:M.key?2:1,isNonSync:M.key?0:1}})}this.nextAvcDts=p+j;var Y=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,t.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var Z=t[0].flags;Z.dependsOn=2,Z.isNonSync=0}a.samples=t,l=e.default.moof(a.sequenceNumber++,n,a),a.samples=[];var $={data1:l,data2:k,startPTS:m/r,endPTS:(o+j)/r,startDTS:n/r,endDTS:this.nextAvcDts/r,type:"video",hasAudio:!1,hasVideo:!0,nb:t.length,dropped:Y};return this.observer.trigger(f.default.FRAG_PARSING_DATA,$),$}},a.prototype.remuxAudio=function(a,b,c,j){var k,l,m,n,o,p,q,r=a.inputTimeScale,s=a.timescale,t=r/s,u=a.isAAC?1024:1152,v=u*t,w=this._PTSNormalize,x=this._initPTS,y=!a.isAAC&&this.typeSupported.mpeg,z=a.samples,A=[],B=this.nextAudioPts;if(c|=z.length&&B&&(j&&Math.abs(b-B/r)<.1||Math.abs(z[0].pts-B-x)<20*v),z.forEach(function(a){a.pts=a.dts=w(a.pts-x,b*r)}),z=z.filter(function(a){return a.pts>=0}),0!==z.length){if(c||(B=j?b*r:z[0].pts),a.isAAC)for(var C=this.config.maxAudioFramesDrift,D=0,E=B;D<z.length;){var F,G=z[D],H=G.pts;F=H-E;var I=Math.abs(1e3*F/r);if(F<=-C*v)h.logger.warn("Dropping 1 audio frame @ "+(E/r).toFixed(3)+"s due to "+Math.round(I)+" ms overlap."),z.splice(D,1),a.len-=G.unit.length;else if(F>=C*v&&I<i&&E){var J=Math.round(F/v);h.logger.warn("Injecting "+J+" audio frame @ "+(E/r).toFixed(3)+"s due to "+Math.round(1e3*F/r)+" ms gap.");for(var K=0;K<J;K++){var L=Math.max(E,0);m=d.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),m||(h.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),m=G.unit.subarray()),z.splice(D,0,{unit:m,pts:L,dts:L}),a.len+=m.length,E+=v,D++}G.pts=G.dts=E,E+=v,D++}else Math.abs(F),G.pts=G.dts=E,E+=v,D++}for(var K=0,M=z.length;K<M;K++){var N=z[K],O=N.unit,H=N.pts;if(void 0!==q)l.duration=Math.round((H-q)/t);else{var P=Math.round(1e3*(H-B)/r),Q=0;if(c&&a.isAAC&&P){if(P>0&&P<i)Q=Math.round((H-B)/v),h.logger.log(P+" ms hole between AAC samples detected,filling it"),Q>0&&(m=d.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),m||(m=O.subarray()),a.len+=Q*m.length);else if(P<-12){h.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(B/r).toFixed(3)+"s/"+(H/r).toFixed(3)+"s/"+-P+"ms"),a.len-=O.byteLength;continue}H=B}if(p=H,!(a.len>0))return;var R=y?a.len:a.len+8;k=y?0:8;try{n=new Uint8Array(R)}catch(a){return void this.observer.trigger(f.default.ERROR,{type:g.ErrorTypes.MUX_ERROR,details:g.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:R,reason:"fail allocating audio mdat "+R})}if(!y){new DataView(n.buffer).setUint32(0,R),n.set(e.default.types.mdat,4)}for(var D=0;D<Q;D++)m=d.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount),m||(h.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),m=O.subarray()),n.set(m,k),k+=m.byteLength,l={size:m.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(l)}n.set(O,k);var S=O.byteLength;k+=S,l={size:S,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(l),q=H}var T=0,U=A.length;if(U>=2&&(T=A[U-2].duration,l.duration=T),U){this.nextAudioPts=B=q+t*T,a.len=0,a.samples=A,o=y?new Uint8Array:e.default.moof(a.sequenceNumber++,p/t,a),a.samples=[];var V=p/r,W=B/r,X={data1:o,data2:n,startPTS:V,endPTS:W,startDTS:V,endDTS:W,type:"audio",hasAudio:!0,hasVideo:!1,nb:U};return this.observer.trigger(f.default.FRAG_PARSING_DATA,X),X}return null}},a.prototype.remuxEmptyAudio=function(a,b,c,e){var f=a.inputTimeScale,g=a.samplerate?a.samplerate:f,i=f/g,j=this.nextAudioPts,k=(void 0!==j?j:e.startDTS*f)+this._initDTS,l=e.endDTS*f+this._initDTS,m=1024,n=i*m,o=Math.ceil((l-k)/n),p=d.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(h.logger.warn("remux empty Audio"),!p)return void h.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var q=[],r=0;r<o;r++){var s=k+r*n;q.push({unit:p,pts:s,dts:s}),a.len+=p.length}a.samples=q,this.remuxAudio(a,b,c)},a.prototype.remuxID3=function(a){var b,c=a.samples.length,d=a.inputTimeScale,e=this._initPTS,g=this._initDTS;if(c){for(var h=0;h<c;h++)b=a.samples[h],b.pts=(b.pts-e)/d,b.dts=(b.dts-g)/d;this.observer.trigger(f.default.FRAG_PARSING_METADATA,{samples:a.samples})}a.samples=[]},a.prototype.remuxText=function(a){a.samples.sort(function(a,b){return a.pts-b.pts});var b,c=a.samples.length,d=a.inputTimeScale,e=this._initPTS;if(c){for(var g=0;g<c;g++)b=a.samples[g],b.pts=(b.pts-e)/d;this.observer.trigger(f.default.FRAG_PARSING_USERDATA,{samples:a.samples})}a.samples=[]},a.prototype._PTSNormalize=function(a,b){var c;if(void 0===b)return a;for(c=b<a?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a},a}();b.default=j},"./src/remux/passthrough-remuxer.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/events.js"),e=function(){function a(a){this.observer=a}return a.prototype.destroy=function(){},a.prototype.resetTimeStamp=function(){},a.prototype.resetInitSegment=function(){},a.prototype.remux=function(a,b,c,e,f,g,h,i){var j=this.observer,k="";a&&(k+="audio"),b&&(k+="video"),j.trigger(d.default.FRAG_PARSING_DATA,{data1:i,startPTS:f,startDTS:f,type:k,hasAudio:!!a,hasVideo:!!b,nb:1,dropped:0}),j.trigger(d.default.FRAG_PARSED)},a}();b.default=e},"./src/task-loop.js":function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/event-handler.js"),f=function(a){function b(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var e=a.apply(this,[b].concat(c))||this;return e._tickInterval=null,e._tickTimer=null,e._tickCallCount=0,e._boundTick=e.tick.bind(e),e}return d(b,a),b.prototype.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.prototype.hasInterval=function(){return!!this._tickInterval},b.prototype.hasNextTick=function(){return!!this._tickTimer},b.prototype.setInterval=function(a){return!this._tickInterval&&(this._tickInterval=setInterval(this._boundTick,a),!0)},b.prototype.clearInterval=function(){return!!this._tickInterval&&(clearInterval(this._tickInterval),this._tickInterval=null,!0)},b.prototype.clearNextTick=function(){return!!this._tickTimer&&(clearTimeout(this._tickTimer),this._tickTimer=null,!0)},b.prototype.tick=function(){1===++this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=setTimeout(this._boundTick,0)),this._tickCallCount=0)},b.prototype.doTick=function(){},b}(e.default);b.default=f},"./src/utils/attr-list.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var c=/^(\d+)x(\d+)$/,d=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,e=function(){function b(a){"string"==typeof a&&(a=b.parseAttrList(a));for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c])}return b.prototype.decimalInteger=function(b){var c=parseInt(this[b],10);return c>a.MAX_SAFE_INTEGER?1/0:c},b.prototype.hexadecimalInteger=function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null},b.prototype.hexadecimalIntegerAsNumber=function(b){var c=parseInt(this[b],16);return c>a.MAX_SAFE_INTEGER?1/0:c},b.prototype.decimalFloatingPoint=function(a){return parseFloat(this[a])},b.prototype.enumeratedString=function(a){return this[a]},b.prototype.decimalResolution=function(a){var b=c.exec(this[a]);if(null!==b)return{width:parseInt(b[1],10),height:parseInt(b[2],10)}},b.parseAttrList=function(a){var b,c={};for(d.lastIndex=0;null!==(b=d.exec(a));){var e=b[2],f='"';0===e.indexOf(f)&&e.lastIndexOf(f)===e.length-1&&(e=e.slice(1,-1)),c[b[1]]=e}return c},b}();b.default=e}).call(this,c("./src/polyfills/number.js").Number)},"./src/utils/binary-search.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;c<=d;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(g<0))return f;d=e-1}}return null}};b.default=d},"./src/utils/buffer-helper.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}return a.isBuffered=function(a,b){try{if(a)for(var c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0}catch(a){}return!1},a.bufferInfo=function(a,b,c){try{if(a){var d=a.buffered,e=[],f=void 0;for(f=0;f<d.length;f++)e.push({start:d.start(f),end:d.end(f)});return this.bufferedInfo(e,b,c)}}catch(a){}return{len:0,start:b,end:b,nextStart:void 0}},a.bufferedInfo=function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;return c||b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&b<m)e=l,f=m,d=f-b;else if(b+c<l){g=l;break}}return{len:d,start:e,end:f,nextStart:g}},a}();b.BufferHelper=d},"./src/utils/cea-608-parser.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},e=function(a){var b=a;return d.hasOwnProperty(a)&&(b=d[a]),String.fromCharCode(b)},f=15,g=100,h={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},i={17:2,18:4,21:6,22:8,23:10,19:13,20:15},j={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},k={25:2,26:4,29:6,30:8,31:10,27:13,28:15},l=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],m={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){this.verboseFilter[a];this.verboseLevel}},n=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},o=function(){function a(a,b,c,d,e){this.foreground=a||"white",this.underline=b||!1,this.italics=c||!1,this.background=d||"black",this.flash=e||!1}return a.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.prototype.setStyles=function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}},a.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},a.prototype.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},a.prototype.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},a.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},a}(),p=function(){function a(a,b,c,d,e,f){this.uchar=a||" ",this.penState=new o(b,c,d,e,f)}return a.prototype.reset=function(){this.uchar=" ",this.penState.reset()},a.prototype.setChar=function(a,b){this.uchar=a,this.penState.copy(b)},a.prototype.setPenState=function(a){this.penState.copy(a)},a.prototype.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},a.prototype.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},a.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},a}(),q=function(){function a(){this.chars=[];for(var a=0;a<g;a++)this.chars.push(new p);this.pos=0,this.currPenState=new o}return a.prototype.equals=function(a){for(var b=!0,c=0;c<g;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;b<g;b++)this.chars[b].copy(a.chars[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;b<g;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a},a.prototype.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(m.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>g&&(m.log("ERROR","Too large cursor position "+this.pos),this.pos=g)},a.prototype.moveCursor=function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;c<b+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)},a.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.prototype.insertChar=function(a){a>=144&&this.backSpace();var b=e(a);if(this.pos>=g)return void m.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(b,this.currPenState),this.moveCursor(1)},a.prototype.clearFromPos=function(a){var b;for(b=a;b<g;b++)this.chars[b].reset()},a.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.prototype.getTextString=function(){for(var a=[],b=!0,c=0;c<g;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")},a.prototype.setPenStyles=function(a){this.currPenState.setStyles(a),this.chars[this.pos].setPenState(this.currPenState)},a}(),r=function(){function a(){this.rows=[];for(var a=0;a<f;a++)this.rows.push(new q);this.currRow=f-1,this.nrRollUpRows=null,this.reset()}return a.prototype.reset=function(){for(var a=0;a<f;a++)this.rows[a].clear();this.currRow=f-1},a.prototype.equals=function(a){for(var b=!0,c=0;c<f;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b},a.prototype.copy=function(a){for(var b=0;b<f;b++)this.rows[b].copy(a.rows[b])},a.prototype.isEmpty=function(){for(var a=!0,b=0;b<f;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a},a.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},a.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},a.prototype.insertChar=function(a){this.rows[this.currRow].insertChar(a)},a.prototype.setPen=function(a){this.rows[this.currRow].setPenStyles(a)},a.prototype.moveCursor=function(a){this.rows[this.currRow].moveCursor(a)},a.prototype.setCursor=function(a){m.log("INFO","setCursor: "+a),this.rows[this.currRow].setCursor(a)},a.prototype.setPAC=function(a){m.log("INFO","pacData = "+JSON.stringify(a));var b=a.row-1;if(this.nrRollUpRows&&b<this.nrRollUpRows-1&&(b=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==b){for(var c=0;c<f;c++)this.rows[c].clear();var d=this.currRow+1-this.nrRollUpRows,e=this.lastOutputScreen;if(e){var g=e.rows[d].cueStartTime;if(g&&g<m.time)for(var c=0;c<this.nrRollUpRows;c++)this.rows[b-this.nrRollUpRows+c+1].copy(e.rows[d+c])}}this.currRow=b;var h=this.rows[this.currRow];if(null!==a.indent){var i=a.indent,j=Math.max(i-1,0);h.setCursor(a.indent),a.color=h.chars[j].penState.foreground}var k={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(k)},a.prototype.setBkgData=function(a){m.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},a.prototype.setRollUpRows=function(a){this.nrRollUpRows=a},a.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void m.log("DEBUG","roll_up but nrRollUpRows not set yet");m.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),m.log("INFO","Rolling up")},a.prototype.getDisplayText=function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;e<f;e++){var g=this.rows[e].getTextString();g&&(d=e+1,a?b.push("Row "+d+": '"+g+"'"):b.push(g.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c},a.prototype.getTextAndFormat=function(){return this.rows},a}(),s=function(){function a(a,b){this.chNr=a,this.outputFilter=b,this.mode=null,this.verbose=0,this.displayedMemory=new r,this.nonDisplayedMemory=new r,this.lastOutputScreen=new r,this.currRollUpRow=this.displayedMemory.rows[f-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[f-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},a.prototype.getHandler=function(){return this.outputFilter},a.prototype.setHandler=function(a){this.outputFilter=a},a.prototype.setPAC=function(a){this.writeScreen.setPAC(a)},a.prototype.setBkgData=function(a){this.writeScreen.setBkgData(a)},a.prototype.setMode=function(a){a!==this.mode&&(this.mode=a,m.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},a.prototype.insertChars=function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";m.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(m.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.prototype.ccRCL=function(){m.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.prototype.ccBS=function(){m.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.prototype.ccAOF=function(){},a.prototype.ccAON=function(){},a.prototype.ccDER=function(){m.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.prototype.ccRU=function(a){m.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},a.prototype.ccFON=function(){m.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.prototype.ccRDC=function(){m.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.prototype.ccTR=function(){m.log("INFO","TR"),this.setMode("MODE_TEXT")},a.prototype.ccRTD=function(){m.log("INFO","RTD"),this.setMode("MODE_TEXT")},a.prototype.ccEDM=function(){m.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.prototype.ccCR=function(){m.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.prototype.ccENM=function(){m.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.prototype.ccEOC=function(){if(m.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,m.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.prototype.ccTO=function(a){m.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},a.prototype.ccMIDROW=function(a){var b={flash:!1};if(b.underline=a%2==1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}m.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)},a.prototype.outputDataUpdate=function(a){void 0===a&&(a=!1);var b=m.time;null!==b&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,b,this.lastOutputScreen),!0===a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:b):this.cueStartTime=b,this.lastOutputScreen.copy(this.displayedMemory))},a.prototype.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},a}(),t=function(){function a(a,b,c){this.field=a||1,this.outputs=[b,c],this.channels=[new s(1,b),new s(2,c)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return a.prototype.getHandler=function(a){return this.channels[a].getHandler()},a.prototype.setHandler=function(a,b){this.channels[a].setHandler(b)},a.prototype.addData=function(a,b){var c,d,e,f=!1;this.lastTime=a,m.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(m.log("DATA","["+n([b[g],b[g+1]])+"] -> ("+n([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else m.log("WARNING","No channel found yet. TEXT-MODE?");c?this.dataCounters.cmd+=2:f?this.dataCounters.char+=2:(this.dataCounters.other+=2,m.log("WARNING","Couldn't parse cleaned data "+n([d,e])+" orig: "+n([b[g],b[g+1]])))}else this.dataCounters.padding+=2},a.prototype.parseCmd=function(a,b){var c=null,d=(20===a||28===a)&&b>=32&&b<=47,e=(23===a||31===a)&&b>=33&&b<=35;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,m.log("DEBUG","Repeated command ("+n([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.parseMidrow=function(a,b){var c=null;if((17===a||25===a)&&b>=32&&b<=47){if((c=17===a?1:2)!==this.currChNr)return m.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[c-1].ccMIDROW(b),m.log("DEBUG","MIDROW ("+n([a,b])+")"),!0}return!1},a.prototype.parsePAC=function(a,b){var c=null,d=null,e=(a>=17&&a<=23||a>=25&&a<=31)&&b>=64&&b<=127,f=(16===a||24===a)&&b>=64&&b<=95;if(!e&&!f)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=a<=23?1:2,d=b>=64&&b<=95?1===c?h[a]:j[a]:1===c?i[a]:k[a];var g=this.interpretPAC(d,b);return this.channels[c-1].setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0},a.prototype.interpretPAC=function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1==(1&c),c<=13?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d},a.prototype.parseChars=function(a,b){var c=null,d=null,f=null;if(a>=25?(c=2,f=a-8):(c=1,f=a),f>=17&&f<=19){var g=b;g=17===f?b+80:18===f?b+112:b+144,m.log("INFO","Special char '"+e(g)+"' in channel "+c),d=[g]}else a>=32&&a<=127&&(d=0===b?[a]:[a,b]);if(d){var h=n(d);m.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d},a.prototype.parseBackgroundAttributes=function(a,b){var c,d,e,f,g=(16===a||24===a)&&b>=32&&b<=47,h=(23===a||31===a)&&b>=45&&b<=47;return!(!g&&!h)&&(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=l[d],b%2==1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=a<24?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0)},a.prototype.reset=function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null},a.prototype.cueSplitAtTime=function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)},a}();b.default=t},"./src/utils/codecs.js":function(a,b,c){"use strict";function d(a,b){var c=f[b];return!!c&&!0===c[a.slice(0,4)]}function e(a,b){return window.MediaSource.isTypeSupported((b||"video")+'/mp4;codecs="'+a+'"')}Object.defineProperty(b,"__esModule",{value:!0});var f={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};b.isCodecType=d,b.isCodecSupportedInMp4=e},"./src/utils/cues.js":function(a,b,c){"use strict";function d(a,b,c,d){for(var f,g,h,i,j,k=window.VTTCue||window.TextTrackCue,l=0;l<d.rows.length;l++)if(f=d.rows[l],h=!0,i=0,j="",!f.isEmpty()){for(var m=0;m<f.chars.length;m++)f.chars[m].uchar.match(/\s/)&&h?i++:(j+=f.chars[m].uchar,h=!1);f.cueStartTime=b,b===c&&(c+=1e-4),g=new k(b,c,e.fixLineBreaks(j.trim())),i>=16?i--:i++,navigator.userAgent.match(/Firefox\//)?g.line=l+1:g.line=l>7?l-2:l+1,g.align="left",g.position=Math.max(0,Math.min(100,i/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(g)}}Object.defineProperty(b,"__esModule",{value:!0});var e=c("./src/utils/vttparser.js");b.newCue=d},"./src/utils/discontinuities.js":function(a,b,c){"use strict";(function(a){function d(a,b){for(var c=null,d=0;d<a.length;d+=1){var e=a[d];if(e&&e.cc===b){c=e;break}}return c}function e(a,b){return l.default.search(a,function(a){return a.cc<b?1:a.cc>b?-1:0})}function f(a,b,c){var d=!1;return b&&b.details&&c&&(c.endCC>c.startCC||a&&a.cc<c.startCC)&&(d=!0),d}function g(a,b){var c=a.fragments,e=b.fragments;if(!e.length||!c.length)return void m.logger.log("No fragments to align");var f=d(c,e[0].cc);return!f||f&&!f.startPTS?void m.logger.log("No frag in previous level to align on"):f}function h(a,b){b.fragments.forEach(function(b){if(b){var c=b.start+a;b.start=b.startPTS=c,b.endPTS=c+b.duration}}),b.PTSKnown=!0}function i(a,b,c){j(a,c,b),!c.PTSKnown&&b&&k(c,b.details)}function j(a,b,c){if(f(a,c,b)){var d=g(c.details,b);d&&(m.logger.log("Adjusting PTS using last level due to CC increase within current level"),h(d.start,b))}}function k(b,c){if(c&&c.fragments.length){if(!b.hasProgramDateTime||!c.hasProgramDateTime)return;var d=c.fragments[0].programDateTime,e=b.fragments[0].programDateTime,f=(e-d)/1e3+c.fragments[0].start;a.isFinite(f)&&(m.logger.log("adjusting PTS using programDateTime delta, sliding:"+f.toFixed(3)),h(f,b))}}Object.defineProperty(b,"__esModule",{value:!0});var l=c("./src/utils/binary-search.js"),m=c("./src/utils/logger.js");b.findFirstFragWithCC=d,b.findFragWithCC=e,b.shouldAlignOnDiscontinuities=f,b.findDiscontinuousReferenceFrag=g,b.adjustPts=h,b.alignStream=i,b.alignDiscontinuities=j,b.alignPDT=k}).call(this,c("./src/polyfills/number.js").Number)},"./src/utils/ewma-bandwidth-estimator.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/ewma.js"),e=function(){function a(a,b,c,e){this.hls=a,this.defaultEstimate_=e,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new d.default(b),this.fast_=new d.default(c)}return a.prototype.sample=function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)},a.prototype.canEstimate=function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_},a.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.prototype.destroy=function(){},a}();b.default=e},"./src/utils/ewma.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a){this.alpha_=a?Math.exp(Math.log(.5)/a):0,this.estimate_=0,this.totalWeight_=0}return a.prototype.sample=function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a},a.prototype.getTotalWeight=function(){return this.totalWeight_},a.prototype.getEstimate=function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_},a}();b.default=d},"./src/utils/get-self-scope.js":function(a,b,c){"use strict";function d(){return"undefined"==typeof window?self:window}Object.defineProperty(b,"__esModule",{value:!0}),b.getSelfScope=d},"./src/utils/logger.js":function(a,b,c){"use strict";function d(){}function e(a,b){return b="["+a+"] > "+b}function f(a){var b=k.console[a];return b?function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c[0]&&(c[0]=e(a,c[0])),b.apply(k.console,c)}:d}function g(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];b.forEach(function(b){j[b]=a[b]?a[b].bind(a):f(b)})}Object.defineProperty(b,"__esModule",{value:!0});var h=c("./src/utils/get-self-scope.js"),i={trace:d,debug:d,log:d,warn:d,info:d,error:d},j=i,k=h.getSelfScope();b.enableLogs=function(a){if(!0===a||"object"==typeof a){g(a,"debug","log","info","warn","error");try{j.log()}catch(a){j=i}}else j=i},b.logger=j},"./src/utils/mediakeys-helper.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){return"undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null}();b.requestMediaKeySystemAccess=d},"./src/utils/mediasource-helper.js":function(a,b,c){"use strict";function d(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}Object.defineProperty(b,"__esModule",{value:!0}),b.getMediaSource=d},"./src/utils/output-filter.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){this.timelineController=a,this.trackName=b,this.startTime=null,this.endTime=null,this.screen=null}return a.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen),this.startTime=null)},a.prototype.newCue=function(a,b,c){(null===this.startTime||this.startTime>a)&&(this.startTime=a),this.endTime=b,this.screen=c,this.timelineController.createCaptionsTrack(this.trackName)},a}();b.default=d},"./src/utils/texttrack-utils.js":function(a,b,c){"use strict";function d(a,b){var c=null;try{c=new window.Event("addtrack")}catch(a){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)}function e(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}Object.defineProperty(b,"__esModule",{value:!0}),b.sendAddTrackEvent=d,b.clearCurrentCues=e},"./src/utils/time-ranges.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d={toString:function(a){for(var b="",c=a.length,d=0;d<c;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}};b.default=d},"./src/utils/vttcue.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(){function a(a){return"string"==typeof a&&(!!f[a.toLowerCase()]&&a.toLowerCase())}function b(a){return"string"==typeof a&&(!!g[a.toLowerCase()]&&a.toLowerCase())}function c(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]=c[d]}return a}function d(d,f,g){var h=this,i=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),j={};i?h=document.createElement("custom"):j.enumerable=!0,h.hasBeenReset=!1;var k="",l=!1,m=d,n=f,o=g,p=null,q="",r=!0,s="auto",t="start",u=50,v="middle",w=50,x="middle";if(Object.defineProperty(h,"id",c({},j,{get:function(){return k},set:function(a){k=""+a}})),Object.defineProperty(h,"pauseOnExit",c({},j,{get:function(){return l},set:function(a){l=!!a}})),Object.defineProperty(h,"startTime",c({},j,{get:function(){return m},set:function(a){if("number"!=typeof a)throw new TypeError("Start time must be set to a number.");m=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",c({},j,{get:function(){return n},set:function(a){if("number"!=typeof a)throw new TypeError("End time must be set to a number.");n=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",c({},j,{get:function(){return o},set:function(a){o=""+a,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",c({},j,{get:function(){return p},set:function(a){p=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",c({},j,{get:function(){return q},set:function(b){var c=a(b);if(!1===c)throw new SyntaxError("An invalid or illegal string was specified.");q=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",c({},j,{get:function(){return r},set:function(a){r=!!a,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",c({},j,{get:function(){return s},set:function(a){if("number"!=typeof a&&a!==e)throw new SyntaxError("An invalid number or illegal string was specified.");s=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",c({},j,{get:function(){return t},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",c({},j,{get:function(){return u},set:function(a){if(a<0||a>100)throw new Error("Position must be between 0 and 100.");u=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",c({},j,{get:function(){return v},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");v=c,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",c({},j,{get:function(){return w},set:function(a){if(a<0||a>100)throw new Error("Size must be between 0 and 100.");w=a,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",c({},j,{get:function(){return x},set:function(a){var c=b(a);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");x=c,this.hasBeenReset=!0}})),h.displayState=void 0,i)return h}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e="auto",f={"":!0,lr:!0,rl:!0},g={start:!0,middle:!0,end:!0,left:!0,right:!0};return d.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},d}()},"./src/utils/vttparser.js":function(a,b,c){"use strict";function d(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new k,this.regionList=[]}function e(a){function b(a,b,c,d){return 3600*(0|a)+60*(0|b)+(0|c)+(0|d)/1e3}var c=a.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return c?c[3]?b(c[1],c[2],c[3].replace(":",""),c[4]):c[1]>59?b(c[1],c[2],0,c[4]):b(0,c[1],c[2],c[4]):null}function f(){this.values=Object.create(null)}function g(a,b,c,d){var e=d?a.split(d):[a];for(var f in e)if("string"==typeof e[f]){var g=e[f].split(c);if(2===g.length){var h=g[0],i=g[1];b(h,i)}}}function h(a,b,c){function d(){var b=e(a);if(null===b)throw new Error("Malformed timestamp: "+j);return a=a.replace(/^[^\sa-zA-Z-]+/,""),b}function h(a,b){var d=new f;g(a,function(a,b){switch(a){case"region":for(var e=c.length-1;e>=0;e--)if(c[e].id===b){d.set(a,c[e].region);break}break;case"vertical":d.alt(a,b,["rl","lr"]);break;case"line":var f=b.split(","),g=f[0];d.integer(a,g),d.percent(a,g)&&d.set("snapToLines",!1),d.alt(a,g,["auto"]),2===f.length&&d.alt("lineAlign",f[1],["start",m,"end"]);break;case"position":f=b.split(","),d.percent(a,f[0]),2===f.length&&d.alt("positionAlign",f[1],["start",m,"end","line-left","line-right","auto"]);break;case"size":d.percent(a,b);break;case"align":d.alt(a,b,["start",m,"end","left","right"])}},/:/,/\s/),b.region=d.get("region",null),b.vertical=d.get("vertical","");var e=d.get("line","auto");"auto"===e&&-1===l.line&&(e=-1),b.line=e,b.lineAlign=d.get("lineAlign","start"),b.snapToLines=d.get("snapToLines",!0),b.size=d.get("size",100),b.align=d.get("align",m);var h=d.get("position","auto");"auto"===h&&50===l.position&&(h="start"===b.align||"left"===b.align?0:"end"===b.align||"right"===b.align?100:50),b.position=h}function i(){a=a.replace(/^\s+/,"")}var j=a;if(i(),b.startTime=d(),i(),"--\x3e"!==a.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+j);a=a.substr(3),i(),b.endTime=d(),i(),h(a,b)}function i(a){return a.replace(/<br(?: \/)?>/gi,"\n")}Object.defineProperty(b,"__esModule",{value:!0});var j=c("./src/utils/vttcue.js"),k=function(){return{decode:function(a){if(!a)return"";if("string"!=typeof a)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(a))}}};f.prototype={set:function(a,b){this.get(a)||""===b||(this.values[a]=b)},get:function(a,b,c){return c?this.has(a)?this.values[a]:b[c]:this.has(a)?this.values[a]:b},has:function(a){return a in this.values},alt:function(a,b,c){for(var d=0;d<c.length;++d)if(b===c[d]){this.set(a,b);break}},integer:function(a,b){/^-?\d+$/.test(b)&&this.set(a,parseInt(b,10))},percent:function(a,b){return!!(b.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(b=parseFloat(b))>=0&&b<=100)&&(this.set(a,b),!0)}};var l=new j.default(0,0,0),m="middle"===l.align?"middle":"center";b.fixLineBreaks=i,d.prototype={parse:function(a){function b(){var a=d.buffer,b=0;for(a=i(a);b<a.length&&"\r"!==a[b]&&"\n"!==a[b];)++b;var c=a.substr(0,b);return"\r"===a[b]&&++b,"\n"===a[b]&&++b,d.buffer=a.substr(b),c}function c(a){g(a,function(a,b){a},/:/)}var d=this;a&&(d.buffer+=d.decoder.decode(a,{stream:!0}));try{var e=void 0;if("INITIAL"===d.state){if(!/\r\n|\n/.test(d.buffer))return this;e=b();var f=e.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!f||!f[0])throw new Error("Malformed WebVTT signature.");d.state="HEADER"}for(var k=!1;d.buffer;){if(!/\r\n|\n/.test(d.buffer))return this;switch(k?k=!1:e=b(),d.state){case"HEADER":/:/.test(e)?c(e):e||(d.state="ID");continue;case"NOTE":e||(d.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){d.state="NOTE";break}if(!e)continue;if(d.cue=new j.default(0,0,""),d.state="CUE",-1===e.indexOf("--\x3e")){d.cue.id=e;continue}case"CUE":try{h(e,d.cue,d.regionList)}catch(a){d.cue=null,d.state="BADCUE";continue}d.state="CUETEXT";continue;case"CUETEXT":var l=-1!==e.indexOf("--\x3e");if(!e||l&&(k=!0)){d.oncue&&d.oncue(d.cue),d.cue=null,d.state="ID";continue}d.cue.text&&(d.cue.text+="\n"),d.cue.text+=e;continue;case"BADCUE":e||(d.state="ID");continue}}}catch(a){"CUETEXT"===d.state&&d.cue&&d.oncue&&d.oncue(d.cue),d.cue=null,d.state="INITIAL"===d.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var a=this;try{if(a.buffer+=a.decoder.decode(),(a.cue||"HEADER"===a.state)&&(a.buffer+="\n\n",a.parse()),"INITIAL"===a.state)throw new Error("Malformed WebVTT signature.")}catch(a){throw a}return a.onflush&&a.onflush(),this}},b.default=d},"./src/utils/webvtt-parser.js":function(a,b,c){"use strict";(function(a){Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/vttparser.js"),e=c("./src/demux/id3.js"),f=function(a,b,c){return a.substr(c||0,b.length)===b},g=function(b){var c=parseInt(b.substr(-3)),d=parseInt(b.substr(-6,2)),e=parseInt(b.substr(-9,2)),f=b.length>9?parseInt(b.substr(0,b.indexOf(":"))):0;return a.isFinite(c)&&a.isFinite(d)&&a.isFinite(e)&&a.isFinite(f)?(c+=1e3*d,c+=6e4*e,c+=36e5*f):-1},h=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return(b>>>0).toString()},i=function(a,b,c){var d=a[b],e=a[d.prevCC];if(!e||!e.new&&d.new)return a.ccOffset=a.presentationOffset=d.start,void(d.new=!1);for(;e&&e.new;)a.ccOffset+=d.start-e.start,d.new=!1,d=e,e=a[d.prevCC];a.presentationOffset=c},j={parse:function(a,b,c,j,k,l){var m,n=/\r\n|\n\r|\n|\r/g,o=e.utf8ArrayToStr(new Uint8Array(a)).trim().replace(n,"\n").split("\n"),p="00:00.000",q=0,r=0,s=0,t=[],u=!0,v=new d.default;v.oncue=function(a){var b=c[j],d=c.ccOffset;b&&b.new&&(void 0!==r?d=c.ccOffset=b.start:i(c,j,s)),s&&(d=s-c.presentationOffset),a.startTime+=d-r,a.endTime+=d-r,a.id=h(a.startTime.toString())+h(a.endTime.toString())+h(a.text),a.text=decodeURIComponent(encodeURIComponent(a.text)),a.endTime>0&&t.push(a)},v.onparsingerror=function(a){m=a},v.onflush=function(){if(m&&l)return void l(m);k(t)},o.forEach(function(a){if(u){if(f(a,"X-TIMESTAMP-MAP=")){u=!1,a.substr(16).split(",").forEach(function(a){f(a,"LOCAL:")?p=a.substr(6):f(a,"MPEGTS:")&&(q=parseInt(a.substr(7)))});try{b+(9e4*c[j].start||0)<0&&(b+=8589934592),q-=b,r=g(p)/1e3,s=q/9e4,-1===r&&(m=new Error("Malformed X-TIMESTAMP-MAP: "+a))}catch(b){m=new Error("Malformed X-TIMESTAMP-MAP: "+a)}return}""===a&&(u=!1)}v.parse(a+"\n")}),v.flush()}};b.default=j}).call(this,c("./src/polyfills/number.js").Number)},"./src/utils/xhr-loader.js":function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c("./src/utils/logger.js"),e=window.performance,f=window.XMLHttpRequest,g=function(){function a(a){a&&a.xhrSetup&&(this.xhrSetup=a.xhrSetup)}return a.prototype.destroy=function(){this.abort(),this.loader=null},a.prototype.abort=function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},a.prototype.load=function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:e.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()},a.prototype.loadInternal=function(){var a,b=this.context;a=this.loader=new f;var c=this.stats;c.tfirst=0,c.loaded=0;var d=this.xhrSetup;try{if(d)try{d(a,b.url)}catch(c){a.open("GET",b.url,!0),d(a,b.url)}a.readyState||a.open("GET",b.url,!0)}catch(c){return void this.callbacks.onError({code:a.status,text:c.message},b,a)}b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.responseType=b.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()},a.prototype.readystatechange=function(a){var b=a.currentTarget,c=b.readyState,f=this.stats,g=this.context,h=this.config;if(!f.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===f.tfirst&&(f.tfirst=Math.max(e.now(),f.trequest)),4===c){var i=b.status;if(i>=200&&i<300){f.tload=Math.max(f.tfirst,e.now());var j=void 0,k=void 0;"arraybuffer"===g.responseType?(j=b.response,k=j.byteLength):(j=b.responseText,k=j.length),f.loaded=f.total=k;var l={url:b.responseURL,data:j};this.callbacks.onSuccess(l,f,g,b)}else f.retry>=h.maxRetry||i>=400&&i<499?(d.logger.error(i+" while loading "+g.url),this.callbacks.onError({code:i,text:b.statusText},g,b)):(d.logger.warn(i+" while loading "+g.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,h.maxRetryDelay),f.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),h.timeout)},a.prototype.loadtimeout=function(){d.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},a.prototype.loadprogress=function(a){var b=a.currentTarget,c=this.stats;c.loaded=a.loaded,a.lengthComputable&&(c.total=a.total);var d=this.callbacks.onProgress;d&&d(c,this.context,null,b)},a}();b.default=g}}).default}),function(c){"use strict";function d(){var a=c.crypto||c.msCrypto;if(!j&&a&&a.getRandomValues)try{var b=new Uint8Array(16);m=j=function(){return a.getRandomValues(b),b},j()}catch(a){}if(!j){var d=new Array(16);k=j=function(){for(var a,b=0;b<16;b++)0==(3&b)&&(a=4294967296*Math.random()),d[b]=a>>>((3&b)<<3)&255;return d},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function e(){if("function"==typeof b)try{var a=b("crypto").randomBytes;l=j=a&&function(){return a(16)},j()}catch(a){}}function f(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){e<16&&(b[d+e++]=q[a])});e<16;)b[d+e++]=0;return b}function g(a,b){var c=b||0,d=p;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function h(a,b,c){var d=b&&c||0,e=b||[];a=a||{};var f=null!=a.clockseq?a.clockseq:u,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:w+1,j=h-v+(i-w)/1e4;if(j<0&&null==a.clockseq&&(f=f+1&16383),(j<0||h>v)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=h,w=i,u=f,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;e[d++]=k>>>24&255,e[d++]=k>>>16&255,e[d++]=k>>>8&255,e[d++]=255&k;var l=h/4294967296*1e4&268435455;e[d++]=l>>>8&255,e[d++]=255&l,e[d++]=l>>>24&15|16,e[d++]=l>>>16&255,e[d++]=f>>>8|128,e[d++]=255&f;for(var m=a.node||t,n=0;n<6;n++)e[d+n]=m[n];return b||g(e)}function i(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"===a?new o(16):null,a=null),a=a||{};var e=a.random||(a.rng||j)();if(e[6]=15&e[6]|64,e[8]=63&e[8]|128,b)for(var f=0;f<16;f++)b[d+f]=e[f];return b||g(e)}var j,k,l,m,n;c?d():e();for(var o="function"==typeof Buffer?Buffer:Array,p=[],q={},r=0;r<256;r++)p[r]=(r+256).toString(16).substr(1),q[p[r]]=r;var s=j(),t=[1|s[0],s[1],s[2],s[3],s[4],s[5]],u=16383&(s[6]<<8|s[7]),v=0,w=0,x=i;x.v1=h,x.v4=i,x.parse=f,x.unparse=g,x.BufferClass=o,x._rng=j,x._mathRNG=k,x._nodeRNG=l,x._whatwgRNG=m,"undefined"!=typeof module&&module.exports?module.exports=x:"function"==typeof a&&a.amd?a(function(){return x}):(n=c.uuid,x.noConflict=function(){return c.uuid=n,x},c.uuid=x)}("undefined"!=typeof window?window:null),function(){function a(a){var b=a.__resizeTriggers__,c=b.firstElementChild,d=b.lastElementChild,e=c.firstElementChild;d.scrollLeft=d.scrollWidth,d.scrollTop=d.scrollHeight,e.style.width=c.offsetWidth+1+"px",e.style.height=c.offsetHeight+1+"px",c.scrollLeft=c.scrollWidth,c.scrollTop=c.scrollHeight}function b(a){return a.offsetWidth!=a.__resizeLast__.width||a.offsetHeight!=a.__resizeLast__.height}function c(c){var d=this;a(this),this.__resizeRAF__&&h(this.__resizeRAF__),this.__resizeRAF__=g(function(){b(d)&&(d.__resizeLast__.width=d.offsetWidth,d.__resizeLast__.height=d.offsetHeight,d.__resizeListeners__.forEach(function(a){a.call(d,c)}))})}function d(){if(!f){var a=(r||"")+".resize-triggers { "+(s||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',b=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css",c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c),f=!0}}var e=document.attachEvent,f=!1;if(!e){var g=function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};return function(b){return a(b)}}(),h=function(){var a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(b){return a(b)}}(),i=!1,j="",k="animationstart",l="Webkit Moz O ms".split(" "),m="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),n="",o=document.createElement("fakeelement");if(void 0!==o.style.animationName&&(i=!0),!1===i)for(var p=0;p<l.length;p++)if(void 0!==o.style[l[p]+"AnimationName"]){n=l[p],n+"Animation",j="-"+n.toLowerCase()+"-",k=m[p],i=!0;break}var q="resizeanim",r="@"+j+"keyframes "+q+" { from { opacity: 0; } to { opacity: 0; } } ",s=j+"animation: 1ms "+q+"; "}window.addResizeListener=function(b,f){e?b.attachEvent("onresize",f):(b.__resizeTriggers__||("static"==getComputedStyle(b).position&&(b.style.position="relative"),d(),b.__resizeLast__={},b.__resizeListeners__=[],(b.__resizeTriggers__=document.createElement("div")).className="resize-triggers",b.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',b.appendChild(b.__resizeTriggers__),a(b),b.addEventListener("scroll",c,!0),k&&b.__resizeTriggers__.addEventListener(k,function(c){c.animationName==q&&a(b)})),b.__resizeListeners__.push(f))},window.removeResizeListener=function(a,b){e?a.detachEvent("onresize",b):(a.__resizeListeners__.splice(a.__resizeListeners__.indexOf(b),1),a.__resizeListeners__.length||(a.removeEventListener("scroll",c),a.__resizeTriggers__=!a.removeChild(a.__resizeTriggers__)))}}(),function(b,c){"object"==typeof module&&module.exports?module.exports=c():"function"==typeof a&&a.amd?a(c):b.Spinner=c()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(k.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",k.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;if(b=b.charAt(0).toUpperCase()+b.slice(1),void 0!==e[b])return b;for(d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}k.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.scale*d.width,left:d.scale*d.radius,top:-d.scale*d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.scale*(d.length+d.width),k=2*d.scale*j,l=-(d.width+d.length)*d.scale*2+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,(e=e&&e.firstChild)&&(e.opacity=c))}}var j,k,l=["webkit","Moz","ms","O"],m={},n={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=a(null,{className:d.className});if(e(f,{position:d.position,width:0,zIndex:d.zIndex,left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function a(){h++;for(var b=0;b<d.lines;b++)g=Math.max(1-(h+(d.lines-b)*n)%l*m,d.opacity),c.opacity(f,b*d.direction+i,g,d);c.timeout=c.el&&setTimeout(a,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.scale*(f.length+f.width)+"px",height:f.scale*f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.scale*f.radius+"px,0)",borderRadius:(f.corners*f.scale*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.scale*f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}}),"undefined"!=typeof document){k=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}();var o=e(a("group"),{behavior:"url(#default#VML)"});!d(o,"transform")&&o.adj?i():j=d(o,"animation")}return h}),window.uvpjs={debug:!1,log:function(){},warn:function(){},error:function(){},EventType:{AD_BLOCKED:"onAdBlocked",AD_BUFFERING:"onAdBuffering",AD_END:"onAdEnd",AD_ERROR:"adError",AD_CLICK:"adClick",AD_PLUGIN_CONTENT_PAUSE_REQUEST:"adPluginContentPauseRequest",AD_PLUGIN_CONTENT_RESUME_REQUEST:"adPluginContentResumeRequest",AD_POD_START:"onAdPodStart",AD_POD_END:"onAdPodEnd",AD_SKIPPED:"onAdSkipped",AD_LOADED:"onAdLoaded",AD_REQUEST:"onAdRequest",AD_RESPONSE:"onAdResponse",AD_START:"onAdStart",AD_VOLUME_CHANGE:"onAdVolumeChange",CAPTIONS_READY:"onCaptionsReady",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:"onCdnUpdated",CONTAINER_RESIZE:"containerResize",CONTENT_DATA_LOADED:"onContentDataLoaded",CONTENT_END:"onContentEnd",CONTENT_START:"onContentStart",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",FIRST_GESTURE:"firstGesture",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",NO_AD_CONTENT:"onNoAdContent",PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",PLAYER_INIT:"playerInit",PLAYER_LOADED:"onPlayerLoaded",PLAYBACK_LIBRARY_LOADED:"onPlaybackLibraryLoaded",PLAYER_START_ERROR:"playerStartError",RESOURCE_END:"onResourceEnd",RESOURCE_START:"onResourceStart",VIDEO_CUEPOINT:"videoCuepoint",VIDEO_DONE:"onVideoDone",VIDEO_LOADING:"onVideoLoading",VIDEO_PLAYBACK_ERROR:"videoPlaybackError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_START_ERROR:"videoStartError",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_TRANSITION_START:"onVideoTransitionStart",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",LEVEL_LOADED:"onLevelLoaded"},ErrorCode:{1001:"1200",1002:"",1003:"",2000:"1000",2001:"1101",2002:"1100",2003:"1106",2004:"2004",2005:"2000",3000:"3400",3001:"3100",3002:"3001",3003:"3200",3004:"3101",3005:"",3006:"3002",3007:"3102",3008:"3202",3009:"3401",3011:"3300",3012:"3301",3013:"",4000:"4000",4001:"4300"},mapErrorCode:function(a){return uvpjs.ErrorCode[a]||a},domConstants:{AD_ID_PREFIX:"ad_",AD_LEARNMORE_ID_PREFIX:"learnMore_",CAPTIONS_ID_PREFIX:"cc_",CONTENT_ID_PREFIX:"content_",CONTROLS_ID_PREFIX:"controls_",VIDEO_ID_PREFIX:"video_",ID_SELECTOR_PREFIX:"#"},Type:{Button:{FULLSCREEN:"btn-fullscreen",PLAYSTATE:"btn-playstate",SETTINGS:"btn-settings",CLOSED_CAPTION:"btn-captions",VOLUME:"btn-volume"},Gesture:{GLOBAL_RESUME:"globalResume",LOCAL_RESUME:"localResume",CONT_CANCEL:"cont_cancel",RELATED_OVERLAY:"related",RELATED_CLICK_GESTURE:"related_click",SHARE_OVERLAY:"share",SHARE_NETWORK_GESTURE:"share_network",SEND_GESTURE:"send",EMBED_GESTURE:"embed",LINK_GESTURE:"copylink",REPLAY_GESTURE:"replay",END_CARD_OVERLAY:"endCard",ERROR_OVERLAY:"error",RECOMMEND_NOW:"recommend_now",RECOMMEND_NEXT:"recommend_next",RECOMMEND_CLOSE:"recommend_close"},QOSVendor:{CONVIVA:"conviva",AKAMAI:"akamai",MUX:"mux",NPAW:"npaw"}},tracking:{AKAMAI:"AkamaiQOSPluginJS",CONVIVA:"ConvivaQOSPluginJS",COMSCORE:"ComScore_ss",MUX:"MuxQOSPluginJS",NIELSEN:"NielsenTracking_SDK",HEARTBEAT:"SiteCatalyst",OZTAM:"OzTam"},getVideoManager:function(){return uvpjs.VideoManager.getInstance()},register:function(a){var b,c,d=a.split("."),e=window,f=d.length;for(b=0;b<f;b++)c=d[b],void 0===e[c]&&(e[c]={}),e=e[c];return e},getClass:function(a){var b,c,d,e,f,g;if("string"!=typeof a)return a;for(b=a.split("."),c=window,d=b.length,e="",f=0;f<d;f++){if(g=b[f],e+=g,void 0===c[g])throw new Error("uvpjs.getClass(): "+e+" is undefined.");f<d-1&&(e+="."),c=c[g]}return c},getObject:function(a){return uvpjs.getClass(a)}},function(){var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.subClass=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e,f,g,h,i=this.prototype;a=!0,f=new this,a=!1,e=function(a,b){return function(){var c,d=this._super;return this._super=i[a],c=b.apply(this,arguments),this._super=d,c}};for(h in c)c.hasOwnProperty(h)&&(g=c[h],f[h]="function"==typeof g&&"function"==typeof i[h]&&b.test(g)?e(h,g):g);return d.prototype=f,d.prototype.constructor=d,d.subClass=arguments.callee,d}}(),uvpjs.Class=Class,uvpjs._=_.noConflict(),function(a){a.b64TestVideo="data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAuhtZGF0AUAigKN4SIUtLS0tLS0tLS0tLS0tLS0tLS0tLS0vAAACsAYF//+s3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0OCByMjc5NSBhYWE5YWE4IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTE2IGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDM6MHgxMzMgbWU9dW1oIHN1Ym1lPTEwIHBzeT0xIHBzeV9yZD0xLjAwOjAuMDAgbWl4ZWRfcmVmPTEgbWVfcmFuZ2U9MjQgY2hyb21hX21lPTEgdHJlbGxpcz0yIDh4OGRjdD0xIGNxbT0wIGRlYWR6b25lPTIxLDExIGZhc3RfcHNraXA9MSBjaHJvbWFfcXBfb2Zmc2V0PS0yIHRocmVhZHM9MSBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTggYl9weXJhbWlkPTIgYl9hZGFwdD0yIGJfYmlhcz0wIGRpcmVjdD0zIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MiBrZXlpbnQ9MjUwIGtleWludF9taW49MjUgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD02MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTUxLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAKZYiBAAn/Ix39GwAABOltb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAACL3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAIgAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAA445AAIAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAACIAAAAAAAEAAAAAAadtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAC7UAAABkBXHAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAFSbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABEnN0YmwAAACuc3RzZAAAAAAAAAABAAAAnmF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAgACAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAA4YXZjQwFkAAr/4QAeZ2QACqxyBF+IiP/ABAACRAAAAwGQAABdqDxIlhGAAQAHaOhDgZSyLAAAABBwYXNwAAAAEAAAAAkAAAAYc3R0cwAAAAAAAAABAAAAAQAAAZAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAACwgAAAAEAAAAUc3RjbwAAAAAAAAABAAAATgAAAeR0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAAAC8AAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAAAAAAEAAABAAAAAAFcbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAABWIgAABAAVxwAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAABB21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAAy3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAABWIgAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVAAAAAAAULwAAFC8FgICAAhOIBoCAgAECAAAAGHN0dHMAAAAAAAAAAQAAAAEAAAQAAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABRzdHN6AAAAAAAAAB4AAAABAAAAFHN0Y28AAAAAAAAAAQAAADAAAABidWR0YQAAAFptZXRhAAAAAAAAACFoZGxyAAAAAAAAAABtZGlyYXBwbAAAAAAAAAAAAAAAAC1pbHN0AAAAJal0b28AAAAdZGF0YQAAAAEAAAAATGF2ZjU3LjcxLjEwMA=="}(uvpjs.register("uvpjs")),function(a){"use strict";a.util={isLocalStorageSupported:null,xhrMessages:{0:"Request blocked or timed out",500:"Server error encountered.",404:"Resource not found.",403:"Access denied."},getErrorMessageForXHRStatus:function(a){return a&&this.xhrMessages[a]||"XHR status: "+a},getLocationQueryObject:function(){return this.objFromQueryStr(window.location.search.substring(1))},parseUrl:function(a){var b=document.createElement("a");return b.href=a,{host:b.hostname,pathname:b.pathname,protocol:b.protocol,search:b.search}},objFromQueryStr:function(a){var b,c,d,e="string"==typeof a?a:"",f=e.indexOf("?")>-1?e.split("?")[1]:e,g=f.split("&"),h={};for(c=0,d=g.length;c<d;c++)b=g[c].split("="),h[b[0]]=b[1];return h},queryStrFromObj:function(a,b){var c,d="",e=!1;for(c in a)d+=(e?"&":"")+c+"="+(b?encodeURIComponent(a[c]):a[c]),e=!0;return d},uid8:function(){var a=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return a()+a()},getUserStatusForQuery:function(a){var b="";switch(a){case"anon":b="sb=0";break;case"reg;sub;pay":b="sb=1";break;case"reg":b="sb=2";break;case"reg;sub;susp":b="sb=3";break;case"reg;sub;exsub":b="sb=4";break;case"reg;sub;trial":b="sb=5";break;default:if(a.indexOf("|")>-1){var c,d,e,f,g,h="",i=a.split(","),j=i.length;for(i.sort(),g=0;g<j;g++)c=i[g],d=c.split("|"),2==d.length&&(e=d[0],f=d[1],h!=e?(b.length>0&&(b+="&"),b+=e+"="+f):b+=","+f,h=e)}}return""==b&&(b="sb=0"),b},firstInt:function(){var a,b,c=arguments.length;for(b=0;b<c;b++)if(a=arguments[b],parseInt(a)===a)return a},inRange:function(a,b,c){return"number"==typeof a&&a>=b&&a<=c},isEmpty:function(a){return null===a||void 0===a||Array.isArray(a)&&0===a.length||"object"==typeof a&&0===Object.keys(a).length||"string"==typeof a&&""===a},isPlainObject:function(a){return a&&"object"==typeof a&&a.constructor===Object},isFunction:function(a){return"function"==typeof a},isDefinedString:function(a){return!!(a&&"string"==typeof a&&a.length>0)},isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isDefined:function(a){return void 0!==a},isFlagTrue:function(a){return!0===a||"true"===a||1===a||"1"===a},getDefinedString:function(){var a,b,c=arguments.length;for(b=0;b<c;b++)if(a=arguments[b],this.isDefinedString(a))return a;return""},supportsLocalStorage:function(){var a,b="test";if(null===this.isLocalStorageSupported)try{localStorage.setItem(b,"1"),a=localStorage.getItem(b),this.isLocalStorageSupported="1"===a,localStorage.removeItem(b)}catch(a){this.isLocalStorageSupported=!1}return this.isLocalStorageSupported},htmlToElement:function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild},createStyleSheet:function(a,b){var c,d,e,f,g,h,i,j,k,l,m=document.styleSheets,n=m.length;for(k=function(){l||(a(g),l=!0)},c=0;c<n;c++){g=m[c];try{if((g.href&&g.href.replace(/http(s)?:/,""))===b)return void k()}catch(a){null}}d="string"==typeof b&&""!==b,e=uvpjs.mediaCapabilities.isFirefox(),f=!d||e?"style":"link",g=document.createElement(f),g.setAttribute("type","text/css"),g.appendChild(document.createTextNode("")),d&&(g.setAttribute("rel","stylesheet"),g.setAttribute("href",b),g.textContent='@import "'+b+'"'),"function"==typeof a&&(g.onload=k,g.addEventListener&&g.addEventListener("load",k,!1),g.onreadystatechange=function(){"loaded"!==(h=g.readyState)&&"complete"!==h||(link.onreadystatechange=null,k())},i=setInterval(function(){document.styleSheets.length>n&&(k(),clearInterval(i))},10),e&&(j=setInterval(function(){try{g.sheet.cssRules,clearInterval(j),k()}catch(a){}},10)),document.getElementsByTagName("head")[0].appendChild(g))},addCSSObject:function(a,b,c,d){var e,f=uvpjs.util,g="#"+b.id+" "+(d||"");for(e in c)f.addCSSRule(a,g,e,c[e])},addCSSRule:function(a,b,c,d){var e,f,g,h,i=uvpjs.mediaCapabilities,j="string"==typeof d&&d.match(/NaN(%|px)/);if(a&&a.sheet)if(!j||i.isAndroid()&&i.isChrome()||(d="0"),e=a.sheet,f=e.rules||e.cssRules,g=f.length,h=c+":"+d+";",e.insertRule)try{e.insertRule(b+"{"+h+"}",g)}catch(a){console.warn("Unable to add CSS rule: "+a.message)}else e.addRule&&e.addRule(b,h,g)},addCSSRules:function(a,b,c){for(var d,e=c.length;e--;)d=c[e],uvpjs.util.addCSSRule(a,b,d.name,d.value)},copyObjectWithKeyMap:function(a){var b=a,c=null;return this.from=function(a){return c=a,this},this.to=function(a){if(!(b&&c&&a))return a;for(var d in b)b.hasOwnProperty(d)&&c.hasOwnProperty(d)&&null!==c[d]&&(a[b[d]]=c[d]);return a},this}}}(uvpjs.register("uvpjs")),function(a){var b=uvpjs._,c={mediaRefId:/\{mediaReferenceId}/g,partner:/PARTNER/g,ptype:/\{ptype}/g,vguid:/\{VGUID}/g,ptypeAlt:/%7Bptype%7D/g,vguidAlt:/%7BVGUID%7D/g,session:/;/g};a.adUtil={MOAT_PARTNER_CODE:"cbsiimajsint708425247896",context:{IMA:"ima",DAI:"dai"},vpaidEvents:["AdImpression","AdLoaded","AdStopped","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdPaused","AdPlaying","AdSkipped","AdVolumeChange"],moatEventMapping:{ima:{start:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,pause:8,resume:9,skip:10,volumeChange:11,mute:11},dai:{started:3,firstquartile:4,midpoint:5,thirdquartile:6,complete:7,controlPause:8,controlPlay:9,controlVolumeSet:11,controlMute:11,controlUnmute:11}},populateImaAdCallValues:function(a,d,e,f){var g,h,i,j,k,l,m,n,o=uvpjs.util,p="cust_params",q=a.split("?"),r=q[1],s=a.indexOf("%7Bptype%7D")>-1,t=a.indexOf("{ptype}")>-1,u=this.getAdParams(d,e,f);return r=r.replace(c.mediaRefId,u.vid).replace(c.partner,u.partner),s&&(r=r.replace(c.vguidAlt,u.vguid).replace(c.ptypeAlt,u.ptype)),t&&(r=r.replace(c.vguid,u.vguid).replace(c.ptype,u.ptype)),h=o.objFromQueryStr(r),this.isExcludedFromVpaid(d)&&delete h.pp,i=h[p],i&&(g=o.objFromQueryStr(decodeURIComponent(i)),delete h[p]),j=u[p],delete u[p],delete u.partner,delete u.vguid,delete u.ptype,k=b.assign(u,h),l=b.assign(j,g||{}),decodeURIComponent(k.iu).indexOf("/22309610186/")>=0&&d.isMuteAtPlayStart&&!d.userHasUnmuted&&(k.sz="640x483"),this.removeEmpty(k),this.removeEmpty(l),m=o.queryStrFromObj(k,!1),n=o.queryStrFromObj(l,!1),m+="&"+p+"="+encodeURIComponent(n),q[0]+"?"+m},getAdParams:function(a,c,d){var e,f,g=a.dwPageParams,h=this.getDwViewGuid(a),i=this.getPpidValue(a),j=a.contentVideoState,k=encodeURIComponent(a.sessionOptions.partner),l=g.pagetype||"",m=this.getUserStatusKey(a.getSessionOption("userStatus")),n=""!==j.contPlayState,o=n&&!uvpjs.util.isFlagTrue(d)?"1":"0",p=a.getSessionOption("isEmbedded")?"1":"0",q=this.getHost("1"===p,a),r=j.pid,s={cust_params:{}},t=uvpjs.Configuration.env,u=a.getAdCallParams();e=c?this.getVideoDfpId(a):"",s.vid=e,s.partner=k,s.ptype=l,s.vguid=h,s.cust_params.vguid=h,s.cust_params.embed=p,q&&(s.cust_params.host=q),this.populateCustParamsWithAdSessionValues(s.cust_params,r),j.podsToSkip.length>0&&(s.cust_params.resume=1,s.cust_params.skippod=j.podsToSkip);for(f in m)s.cust_params[f]=m[f];if(i&&(s.ppid=i,s.cust_params.ppid=i),"cbs"===k&&(s.cust_params.cpSession=o,s.cust_params.cpPre=o,s.cust_params.sub=b.isEmpty(a.sessionOptions.userId)?"":a.sessionOptions.userId),u&&!uvpjs.util.isEmpty(u.standardParams))for(f in u.standardParams)s[f]=u.standardParams[f];if(u&&!uvpjs.util.isEmpty(u.customParams))for(f in u.customParams)s.cust_params[f]=u.customParams[f];return this.isExcludedFromVpaid(a)?s.pp="ssai":("local"===t||"dev"===t)&&(s.pp="vpaid_js"),s},getVideoDfpId:function(a){return uvpjs.util.isEmpty(a.contentVideoState.dfpMediaId)?a.contentVideoState.cmsRefGuid:a.contentVideoState.dfpMediaId},isExcludedFromVpaid:function(a){return"AA Original"===a.contentVideoState.contentType},getDwViewGuid:function(a){var b=a.dwPageParams;return b&&b.viewguid||b.pguid||""},extractAdInfo:function(a,c){var d,e,f=c===this.context.DAI?"extractAdInfoDai":"extractAdInfoIma";return uvpjs.util.isEmpty(a)||!c?(!c&&console.error("No 'context' arg supplied"),null):(d={adId:a.getAdId(),adSystem:a.getAdSystem(),creativeAdId:a.getCreativeAdId(),creativeId:a.getCreativeId()},d.adPodInfo=this.extractPodInfo(a.getAdPodInfo()),e=this[f](a),b.assign(d,e))},extractAdStateData:function(a,b,c){var d=a.getAdPodInfo(),e=d.getPodIndex(),f=d.getAdPosition(),g=a.getDuration(),h=c?"mid":0===e?"pre":e>=1?"mid":-1===e?"post":"",i=("mid"!==h?h+"_0":"mid_"+e)+"_"+f,j=b===this.context.IMA,k=j?this.extractIdInfo(a):null,l=this.getAdStateBlank();return l.adPosition=f,l.adBitrate=a.getVastMediaBitrate?a.getVastMediaBitrate():NaN,l.adServerName=j?this.context.IMA:this.context.DAI,l.adVideoTitle=a.getTitle(),l.duration=g,l.adType=h,l.adClipID=i,l.wrapperAdId=j?k.wrapperAdId||"":"",l.adVideoId=j?k.wrapperAdId||k.adId:a.getAdId(),l.creativeId=j?k.wrapperCreativeId||k.creativeId:a.getCreativeId(),b===this.context.DAI&&(l.sourceWidth=a.getVastMediaWidth(),l.sourceHeight=a.getVastMediaHeight()),l},getAdStateBlank:function(){return{adPosition:null,adServerName:null,adVideoTitle:null,duration:null,adType:null,adClipID:null,wrapperAdId:null,adVideoId:null,creativeId:null}},extractIdInfo:function(a){var b=a.getWrapperAdIds(),c=a.getWrapperCreativeIds(),d=Array.isArray(b)&&b.length||0,e=Array.isArray(c)&&c.length||0,f=null,g=null,h=a.getAdId()||"",i=a.getCreativeId()||"";return d&&(d>1&&(f=b[1]),h=b[0]),e&&(e>1&&(g=c[1]),i=c[0]),{adId:h,wrapperAdId:f,creativeId:i,wrapperCreativeId:g}},getHost:function(a,b){var c,d,e;return a?(c=b.getSessionOption("referrer"))&&(d=uvpjs.util.parseUrl(c),e=d.host):e=window.location.hostname,e&&""!==e?e:null},getUserStatusKey:function(a){for(var b,c=uvpjs.util.getUserStatusForQuery(a),d=c.split("&"),e=d.length,f={};e--;)b=d[e].split("="),f[b[0]]=b[1];return f},trackAd:function(a){var b,c,d,e=a.model,f=a.context,g=e.getAdVideoState(),h=f===this.context.IMA,i=f===this.context.DAI,j=h||i;return j?(c=e.dwPageParams.pagetype||"",b={level1:"",level2:"",level3:g.adVideoId,level4:g.creativeId,slicer1:"vaw-can",slicer2:e.sessionOptions.partner,slicer3:c,moatVASTSystem:g.adServerName,moatVASTAdID:g.wrapperAdId},d=this.getDwViewGuid(e),""!==d&&(b.zMoatVGUID=d),""!==c&&(b.zMoatPT=c),this.initMoatTracking(a.adVideoContainer,b,g.duration,this.MOAT_PARTNER_CODE,null)):void console.error("Invalid DFP context supplied to method.")},trackAdEvent:function(a){var b=this.getVpaidEventForEvent(a.eventName,a.context);b&&a.trackingHandle.dispatchEvent({type:b,adVolume:a.volume})},checkForAdBlocker:function(a){var b=a.getSessionOption("adBlockerCallback");return b&&b()},populateCustParamsWithAdSessionValues:function(a,b){var d,e,f;if("function"==typeof window.getVideoAdSessionValues&&"string"==typeof(d=window.getVideoAdSessionValues(b))&&""!==d){d=d.replace(c.session,"&"),e=uvpjs.util.objFromQueryStr(d);for(f in e)a[f]=e[f]}},removeEmpty:function(a){for(var b in a)(null===a[b]||""===a[b])&&delete a[b]},extractAdInfoIma:function(a){return{contentType:a.getContentType(),isLinear:a.isLinear()}},extractAdInfoDai:function(a){return{advertiserName:a.getAdvertiserName(),description:a.getDescription(),duration:a.getDuration(),title:a.getTitle()}},extractPodInfo:function(a){return a?{adPosition:a.getAdPosition(),podIndex:a.getPodIndex(),timeOffset:a.getTimeOffset(),totalAds:a.getTotalAds()}:null},getPpidValue:function(a){var b=a.getSessionOption("userPPID");return uvpjs.util.isDefinedString(b)?b:null},initMoatTracking:function(a,b,c,d,e){var f,g,h,i=document.createElement("script"),j=[];b={adData:{ids:b,duration:c,url:e},dispatchEvent:function(a){this.sendEvent?(j&&(j.push(a),a=j,j=!1),this.sendEvent(a)):j.push(a)}},h="_moatApi"+Math.floor(1e8*Math.random());try{f=a.ownerDocument,g=f.defaultView||f.parentWindow}catch(a){g=window}return g[h]=b,i.type="text/javascript",a&&a.insertBefore(i,a.childNodes[0]||null),i.src="https://z.moatads.com/"+d+"/moatvideo.js#"+h,b},getVpaidEventForEvent:function(a,b){var c=this.moatEventMapping[b][a];return uvpjs.util.isEmpty(c)?null:this.vpaidEvents[c]}}}(uvpjs.register("uvpjs")),function(a){"use strict";a.Configuration={env:"prod",hostname:"",name:"UVPJS",version:"3.1.8",date:"07/07/21 10:19:20 PM (GMT+0000)",path:"/a/video-player/uvpjs-rv/3.1.8/",playerName:"video-player"}}(uvpjs),function(a){a.AutoplayDetectionService=uvpjs.Class.subClass({init:function(a){this.mc=a.mediaCapabilities,this.completeCallback=a.completeCallback,this.testDom=this.createTestDom(),this.testVidPath=a.testVidPath,this.isMobile=this.mc.isMobile(),this.vidEl=null,this.detectCapabilities()},destroy:function(){this.killVid(),this.testDom&&this.testDom.parentNode.removeChild(this.testDom),this.testDom=null,this.mc=null,this.completeCallback=Function.prototype},setInfo:function(a,b){this.mc.setAutoplayInfo({supportsUnmutedAutoplay:a,supportsMutedAutoplay:b})},detectCapabilities:function(){this.checkUnmutedAutoplay()},finishCheck:function(a,b){this.killVid(),this.setInfo(a,b),setTimeout(this.completeCallback,2)},checkUnmutedAutoplay:function(){var a,b;this.vidEl=b=this.createVideoElement(!1),b.load(),a=b.play(),void 0===a?this.isMobile?this.detectMobileCapabilities():this.finishCheck(!0,!0):a.then(this.finishCheck.bind(this,!0,!0)).catch(this.checkMutedAutoplay.bind(this))},checkMutedAutoplay:function(){var a,b;if(this.killVid(),this.checkForEarlySafari())return void this.finishCheck(!1,!1);this.vidEl=b=this.createVideoElement(!0),b.load(),a=b.play(),a.then(this.finishCheck.bind(this,!1,!0)).catch(this.finishCheck.bind(this,!1,!1))},killVid:function(){this.vidEl&&(this.vidEl.pause(),this.vidEl.removeAttribute("src"),this.testDom&&this.testDom.removeChild(this.vidEl),this.vidEl=null)},checkForEarlySafari:function(){var a=this.mc.getBrowserName()===this.mc.SAFARI,b=this.mc.isDesktop(),c=a&&b?this.mc.getBrowserVersion():null,d=c&&c.split("."),e=d?11===parseInt(d[0])&&0===parseInt(d[1]):null;return null!==c&&(e&&(!d[2]||parseInt(d[2])<3))},detectMobileCapabilities:function(){var a=this.isAutoplayEligibleAndroid()||this.isAutoplayEligibleIos();this.finishCheck(!1,a)},isAutoplayEligibleAndroid:function(){return this.mc.isAndroid()&&this.mc.isChrome()&&this.isChromeAutoplayEligible()},isAutoplayEligibleIos:function(){var a=this.mc.isIOSTen(),b=a&&this.mc.isSafari(),c=a&&!b&&this.mc.isChrome()&&this.isChromeAutoplayEligible();return b||c},isChromeAutoplayEligible:function(){return parseInt(this.mc.getBrowserMajorVersion())>=54},createVideoElement:function(a){var b=document.createElement("video");return a&&(b.muted=!0,b.setAttribute("muted","muted")),this.mc.setVideoForInlinePlay(b,!0),b.volume=.005,b.style.width="100%",b.style.height="100%",b.src=this.testVidPath,this.testDom.appendChild(b),b},createTestDom:function(){var a=document.createElement("div"),b=a.style,c="-1000px";return b.position="absolute",b.top=c,b.left=c,b.width="320px",b.height="180px",document.body.appendChild(a),a}})}(uvpjs.register("uvpjs")),uvpjs.MediaCapabilities=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=uvpjs._,p=uuid.noConflict(),q=!1,r=!1,s={EMPTY:-2,LOADING:-1,STOPPED:0,PLAYING:1,PAUSED:2,BUFFERING:3,DATA_LOADING_ERROR_STATE:130,VIDEO_NOT_AVAILABLE_ERROR_STATE:110,GEO_BLOCK_ERROR_STATE:120,RP_URL:"rp_url",RP_DAI:"rp_dai",RP_IMA:"rp_ima",RP_MDIALOG:"rp_mDialog",RP_PLATFORM:"rp_platform",HTML5:"HTML5",HLSJS:"HLSJS",DASHJS:"DASHJS",SHAKA:"SHAKA",FLASH_HLS:"FLASH-HLS",PLATFORM:"platform",IMA:"ima",PLATFORM_OUTLET_ACCOUNT_ID:"",CAN_DYNAMIC_VARIANT_SERVICE_BASE_URL:"",STRING:"string",OBJECT:"object",BOOLEAN:"boolean",FUNCTION:"function",MAC:"Macintosh",WINDOWS:"Windows",LINUX:"Linux",OSX:"OS X",WINDOWS7:"Windows 7",WINDOWS8:"Windows 8",WINDOWS10:"Windows 10",WINDOWS_VISTA:"Windows Vista",IOS:"iOS",ANDROID:"Android",CHROMEOS:"CrOS",PHONE:"Phone",TABLE:"Tablet",DESKTOP:"Desktop",IPHONE:"iPhone",IPAD:"iPad",IPOD:"iPod",ANDROID_PHONE:"Android Phone",ANDROID_TABLET:"Android Tablet",WINDOWS_PHONE:"Windows Phone",WINDOWS_TABLET:"Windows Tablet",CHROME:"Chrome",FIREFOX:"Firefox",FIREFOX_IOS:"FxiOS",SAFARI:"Safari",IE:"IE",EDGE:"Edge",OPERA:"Opera",OPERA_MOBILE:"Opera Mobile",ANDROID_BROWSER:"Android Browser",CHROMECAST:"Chromecast",AMAZON_KINDLE:"Silk",CHROMECAST_USER_AGENT:"CrKey",PLAYSTATION:"Playstation",FACEBOOK_IOS:"Facebook Browser iOS",PROGRESSIVE:"progressive",STREAMING:"streaming",IOS_INLINE_PLAY_ATTRIBUTE:"playsinline",VIDEO:"video",AUDIO:"audio",PROBABLY:"probably",MAYBE:"maybe",MP4:"mp4",M3U:"m3u",MP3:"mp3",MPD:"mpd",MT_MP4:"video/mp4",hasMse:null,systemInfo:{browser:null,version:null,isMobile:null,isDesktop:null,os:null,supportsMse:null,isHlsjsEligible:null,supportsNativeHls:null,supportsMp4:null,supportsDash:null,supportsUnmutedAutoplay:null,supportsMutedAutoplay:null,trackingAvailability:null},apDetectionService:null,_detectEnvironment:function(c,d){var g=this.systemInfo;return typeof c===this.STRING?(a=c,b=!0):(a=navigator.userAgent||null,b=!1),e=document.createElement(this.VIDEO),f=document.createElement(this.AUDIO),typeof d===this.BOOLEAN&&(q=d),t(),x(),L(),r="https:"===location.protocol,g.browser=this.getBrowserName(),g.version=parseInt(this.getBrowserMajorVersion()),g.isMobile=this.isMobile(),g.isDesktop=this.isDesktop(),g.os=this.getOS()+"; ver. "+this.getOSVersion(),g.supportsMse=this.hasMediaSourceSupport(),g.isHlsjsEligible=this.canPlayHLSJS(),g.supportsNativeHls=this.canPlayNativeHLS(),g.supportsMp4=this.canPlayH264(),g.supportsDash=this.canPlayDASH(),this},determineAutoplayCapabilities:function(a){var b;if(null!==this.systemInfo.supportsUnmutedAutoplay)return void a();b=function(){this.apDetectionService&&this.apDetectionService.destroy(),this.apDetectionService=null,a()}.bind(this),this.apDetectionService=new uvpjs.AutoplayDetectionService({mediaCapabilities:this,completeCallback:b,testVidPath:this.getPreferredPlaceholderURL()})},setTrackingInfo:function(a){var b,c,d=uvpjs.tracking,e={};for(c in d)b=d[c],e[c]=!!a[b];this.systemInfo.trackingAvailability=e},setAutoplayInfo:function(a){this.systemInfo.supportsUnmutedAutoplay=a.supportsUnmutedAutoplay,this.systemInfo.supportsMutedAutoplay=a.supportsMutedAutoplay},getAutoplayInfo:function(){return{supportsMutedAutoplay:this.systemInfo.supportsMutedAutoplay,supportsUnmutedAutoplay:this.systemInfo.supportsUnmutedAutoplay}},getSessionId:function(){return p.v1().replace(/-/g,"")},checkBrowserName:function(a){return typeof a===this.STRING&&this.getBrowserName()===a},canPlayHTML5Video:function(){var a=document.createElement(this.VIDEO);return typeof a===this.OBJECT&&typeof a.canPlayType===this.FUNCTION},canPlayHTML5Audio:function(){var a=document.createElement(this.AUDIO);return typeof a===this.OBJECT&&typeof a.canPlayType===this.FUNCTION},getBrowserName:function(){return l||"unknown"},getBrowserVersion:function(){return m||-1},getBrowserMajorVersion:function(){return n||-1},getBrowserVendorPrefix:function(){return this.isFirefox()?"moz":this.isWebKit()?"webkit":this.isIE()?"ms":this.isOpera()?"o":void 0},setBrowserVersion:function(a,b){if(typeof b===this.OBJECT){var c=b.exec(this.getUserAgent()),d="",e="";if(c&&typeof c===this.OBJECT&&c.length&&c.length>1){if(d=c[1]||"",d.indexOf(".")){var f=d.split(".");"object"==typeof f&&f.length&&f.length>0&&(e=f[0])}else e=d;return l=a,m=d,n=e,!0}}return!1},hasTealium:function(){return o.has(window,"utag")||o.has(window,"utag_data")},isPlaystation:function(){return this.checkBrowserName(this.PLAYSTATION)},isChrome:function(){return this.checkBrowserName(this.CHROME)},isWebKit:function(){return"WebkitAppearance"in document.documentElement.style},isFirefox:function(){return this.checkBrowserName(this.FIREFOX)||this.checkBrowserName(this.FIREFOX_IOS)},isSafari:function(){return this.checkBrowserName(this.SAFARI)},isIE:function(){return this.checkBrowserName(this.IE)},isEdge:function(){return this.checkBrowserName(this.EDGE)},isOpera:function(){return this.checkBrowserName(this.OPERA)},isOperaMobile:function(){return this.checkBrowserName(this.OPERA_MOBILE)},isAndroidBrowser:function(){return this.checkBrowserName(this.ANDROID_BROWSER)},setUserAgent:function(a){return typeof a===this.STRING&&(this._detectEnvironment(a),!0)},getUserAgent:function(){return a},getMimeTypesObj:function(){return c||(typeof navigator===this.OBJECT&&navigator.mimeTypes&&navigator.mimeTypes.length>0&&(c=navigator.mimeTypes),c)},getMimeTypes:function(){if(typeof d===this.OBJECT)return d;var a={length:0},b=this.getMimeTypesObj();if(typeof b===this.OBJECT){for(var c=0;c<this.length;c++){var e=b[c].enabledPlugin&&b[c].enabledPlugin.name?b[c].enabledPlugin.name:"";a[b[c].type]={type:b[c].type,description:b[c].description,suffixes:b[c].suffixes,enabledPlugin:b[c].enabledPlugin,enabledPluginName:e},a.length++}return d=a}},getPlatform:function(){return typeof h===this.STRING?h:null},getOS:function(){return typeof i===this.STRING?i:null},getOSVersion:function(){return typeof j===this.STRING?j:null},isWindows:function(){return this.getPlatform()===this.WINDOWS},isMac:function(){return this.getPlatform()===this.MAC},isLinux:function(){return this.getPlatform()===this.LINUX},isChromeOS:function(){return this.getUserAgent().toLowerCase().indexOf(this.CHROMEOS.toLowerCase())>=0},isOSX:function(){return this.getOS()===this.OSX},isIOS:function(){return this.getOS()===this.IOS},isAndroid:function(){return this.getDevice()===this.ANDROID},isChromecast:function(){return this.getDevice()===this.CHROMECAST},isWindowsPhone:function(){return this.getOS()===this.WINDOWS_PHONE},isDesktop:function(){return typeof k===this.BOOLEAN?k:k=this.isWindows()&&!this.isWindowsPhone()||this.isMac()&&!this.isIOS()||this.isLinux()&&!this.isAndroid()||this.isChromeOS()},canPlayNativeHLS:function(){return y()&&this.canPlayVideoType("application/vnd.apple.mpegurl")},canUseP2p:function(){return this.canPlayHLSJS()&&!this.isIE()&&!this.isEdge()},hasMediaSourceSupport:function(){if(null===this.hasMse){var a='video/mp4; codecs="avc1.42E01E,mp4a.40.2"',b=window.MediaSource||window.WebKitMediaSource,c=window.SourceBuffer||window.WebKitSourceBuffer,d=b&&"function"==typeof b.isTypeSupported&&b.isTypeSupported(a),e=!c||c.prototype&&"function"==typeof c.prototype.appendBuffer&&"function"==typeof c.prototype.remove;this.hasMse=!(!d||!e)}return this.hasMse},canPlayHLSJS:function(a){var b=this.isMobile(),c=!!y(),d=this.hasMediaSourceSupport(),e=this.isFirefox()||this.isChrome(),f=this.isIE()&&this.getBrowserMajorVersion()>=11||this.isEdge(),g=this.isOpera()&&this.getBrowserMajorVersion()>=30,h=this.isPlaystation();return!(!d||!c||h||b&&!this.canPlayHlsjsAndriod(a))&&(!!a||(e||f||g))},canPlayHlsjsAndriod:function(a){var b=this.getUserAgent();if(b.indexOf("Android")>=0){if(parseFloat(b.slice(b.indexOf("Android")+8))>=5&&a)return!0}return!1},canPlayNativeHLSAudio:function(){return z()&&this.canPlayVideoType("audio/mpegurl")},canPlayDASHMP2TS:function(){return null},canPlayH264:function(){return y()&&this.canPlayVideoType('video/mp4; codecs="avc1.42001E, mp4a.40.2"')},canPlayVP8:function(){return y()&&this.canPlayVideoType('video/webm; codecs="vp8.0, vorbis, opus"')},canPlayVP9:function(){return y()&&this.canPlayVideoType('video/webm; codecs="vp9.0, vorbis, opus"')},canPlayVideoType:function(a,b){return y()&&this.canPlayMediaType(this.VIDEO,a,b||!1)},canPlayAudioType:function(a,b){return y()&&this.canPlayMediaType(this.AUDIO,a,b||!1)},canPlayMediaType:function(a,b,c){var d=a===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return c=1==c,!(typeof d!==this.OBJECT||typeof d.canPlayType!==this.FUNCTION||!(c&&d.canPlayType(b)===this.PROBABLY||!c&&""!==d.canPlayType(b)))},canPlayType:function(a,b){b=1==b;var c=/audio\//,d=c.test(a)?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return!(typeof d!==this.OBJECT||typeof d.canPlayType!==this.FUNCTION||!(b&&d.canPlayType(a)===this.PROBABLY||!b&&""!==d.canPlayType(a)))},nativeCanPlayType:function(a,b){var c=a===this.AUDIO?document.createElement(this.AUDIO):document.createElement(this.VIDEO);return typeof c===this.OBJECT&&typeof c.canPlayType===this.FUNCTION?c.canPlayType(b)||null:null},canPlayDASHType:function(a){if(typeof a!==this.STRING||a.length<1)return null;var b=window.MediaSource||window.WebKitMediaSource||null;return this.canPlayType(a)&&this.hasMSE()&&b.isTypeSupported(a)},canPlayDASH264:function(a){return a=typeof a===this.STRING?a:'video/mp4; codecs="avc1.4D401E,mp4a.40.2"',this.canPlayDASHType(a)},canPlayDASH:function(){return this.canPlayDASH264()},canPlayDASHWebM:function(){return this.canPlayDASHType('video/webm; codecs="vp9"')},requiresSeparateTagsForIMA:function(){var a=this.getUserAgent();return a&&!(this.isChromecast()||this.isIOS()||a.indexOf("Android 2.")>-1||a.indexOf("Android 4.0")>-1||a.indexOf("Android 4.1")>-1)},isSingleVideoIma:function(){return this.isIOS()},requiresPlaceholderContent:function(a){return(!a||!this.supportsAutoplay())&&(!this.isChromecast()&&!this.supportsUnmutedAutoplay())},supportsMutedAutoplay:function(){return this.systemInfo.supportsMutedAutoplay},supportsUnmutedAutoplay:function(){return this.systemInfo.supportsUnmutedAutoplay},supportsAutoplay:function(){return this.supportsMutedAutoplay()},supportsIntelligentMobileAutoplay:function(){return this.isIOSTen()&&this.isIPhone()},requiresInlinePlayAttribute:function(a){return a&&this.supportsAutoplay()&&this.isIOSTen()},playRequiresUserGesture:function(a){return!a&&!this.supportsUnmutedAutoplay()},setVideoForInlinePlay:function(a,b){var c=this.getInlinePlayAttribute(),d=c&&c.name;b&&c?c&&a.setAttribute(d,c.value):!b&&d&&a.removeAttribute(d)},getInlinePlayAttribute:function(){return this.isIPhone()&&this.isIOSTen()?{name:this.IOS_INLINE_PLAY_ATTRIBUTE,value:"true"}:null},getCaptionsLineOffset:function(){return this.isSafari()?-1:0},getCaptionsCenterAlignToken:function(){return this.isSafari()?"middle":"center"},isIOSTen:function(){return this.isIOS()&&parseInt(this.getBrowserVersion())>=10},getPreferredPlaceholderURL:function(){return uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/video/uvp_blank.mp4"},hasMSE:function(){return!!window.MediaSource&&!!window.MediaSource.isTypeSupported},hasEME:function(){var a="MediaKeys"in window||"WebKitMediaKeys"in window||"MSMediaKeys"in window;return a&&!a.setMediaKeys},hasGoogle:function(){return"undefined"!=typeof google},getStandaloneMode:function(){return navigator.standalone||null},hasNativeFullscreen:function(){return!uvpjs.util.isEmpty(this._fullscreenEventName)},getFullscreenEventName:function(){return this._fullscreenEventName},getFullscreenEnterEventName:function(){return this._fullscreenEnterEventName||null},getFullscreenExitEventName:function(){return this._fullscreenExitEventName||null},getFullscreenErrorEventName:function(){return this._fullscreenErrorEventName},getEnterFullscreenMethodName:function(){return this._enterFullscreenMethodName},getExitFullscreenMethodName:function(){return this._exitFullscreenMethodName},getIsFullscreenPropertyName:function(){return this._isFullscreenPropertyName},getFullScreenElementName:function(){return this._fullscreenElementName},supportsFullscreenApi:function(){var a,b;return void 0===this._hasFullscreenApiSupport&&(this.isIOS()?this._hasFullscreenApiSupport=!1:(a=document.createElement("div"),b=uvpjs.util,this._hasFullscreenApiSupport=!!(b.isFunction(a.requestFullscreen)||b.isFunction(a.webkitRequestFullscreen)||b.isFunction(a.mozRequestFullScreen)||b.isFunction(a.msRequestFullscreen)))),this._hasFullscreenApiSupport},isFullscreenAvailable:function(a){var b=document,c=this.supportsFullscreenApi()&&(b.fullscreenEnabled||b.webkitFullscreenEnabled||b.mozFullScreenEnabled||b.msFullscreenEnabled);return!c&&(c=a&&a.webkitSupportsFullscreen),c},getDevice:function(){return g||null},isIPhone:function(){return this.getDevice()===this.IPHONE},isIPad:function(){return this.getDevice()===this.IPAD},isIPod:function(){return this.getDevice()===this.IPHONE},isMobile:function(){return this.getOS()===this.IOS||this.getOS()===this.ANDROID||this.getOS()===this.WINDOWS_PHONE||this.getOS()===this.OPERA_MOBILE},supportsMute:function(){var a=this.isIOS();return!a||a&&parseInt(this.getBrowserVersion())>=10},supportsCaptionsCSS:function(){return!this.isFirefox()&&!this.isIE()&&!this.isEdge()},supportsVolume:function(){return!this.isIOS()},isTouch:function(){return"ontouchstart"in window||navigator.maxTouchPoints},isConsole:function(){},isOTT:function(){return!1},isHlsUrl:function(a){return/\.m3u|assetType=hls/i.test(a)},isDashUrl:function(a){return/\.mpd/i.test(a)},isSecure:function(){return r},setUrlProtocol:function(a){return r?a.replace("http:","https:"):a},getDrmType:function(a){var b="none";return a.enabled?((this.isIOS()||this.isSafari())&&null!==a.fairplay.appCertURL?b="Fairplay":(this.isIE()||this.isEdge())&&null!==a.dash.playreadyURL?b="PlayReady":(this.isChrome()||this.isFirefox()||this.isOpera())&&null!==a.dash.widevineURL&&(b="Widevine"),b):b}},t=function(){var a=/\s(\([^)]+\))/,b=new RegExp(a),c=b.exec(s.getUserAgent());c&&c.length&&c.length>1&&(c=c[1].replace(/_/gi,"."),v(c)||w(c)||u(c)||C(c))},u=function(a){if(-1!==a.indexOf(s.LINUX)||-1!==a.indexOf(s.ANDROID)){if(h=s.LINUX,-1!==a.indexOf(s.ANDROID)){var b=/\ Android\ ([^\s]+);/;a=new RegExp(b).exec(a),g=s.ANDROID,i=s.ANDROID,j=a&&a[1]?a[1]:""}return!0}return!1},v=function(a){var b,c,d="like Mac OS X";if(-1!==a.indexOf(s.MAC))return h=s.MAC,g=s.DESKTOP,-1!==a.indexOf(s.OSX)&&(b=/Mac\ OS\ X\ ([\d\.]+)/,c=new RegExp(b),a=c.exec(a),i=s.OSX,j=a&&a[1]?a[1]:null),!0;if(-1!==a.indexOf(d)){h=s.MAC,i=s.IOS;var e=/\(iPhone;/,f=/\(iPad;/,k=/\(iPod;/;c=/\sOS\s([^\s]*)\s/;var l=c.exec(a);if(l&&l[1]&&(j=l[1]),e.test(a))g=s.IPHONE;else if(f.test(a))g=s.IPAD;else{if(!k.test(a))return!1;g=s.IPOD}return!0}return!1},w=function(a){var b=/(Windows\ Phone\ |Windows\ Phone\ OS\ )([^\s]+);/,c=/Windows\ NT\ ([^\s]+)[;\)]/,d=new RegExp(b);if((a=d.exec(s.getUserAgent()))&&a[2])return h=s.WINDOWS,i=s.WINDOWS_PHONE,j=a[2],g=s.PHONE,!0;if(d=new RegExp(c),(a=d.exec(s.getUserAgent()))&&a[1]){h=s.WINDOWS,i=s.WINDOWS;var e=a[1];return 6==e?i=s.WINDOWS_VISTA:6.1==e?(i=s.WINDOWS7,j=7):6.2==e?(i=s.WINDOWS8,j=8):10==parseInt(e)&&(i=s.WINDOWS10,j=e),g=s.DESKTOP,!0}return!1},x=function(){return!!A()||(!!D()||(!!E()||(!!F()||(!!G()||(!!H()||(!!I()||(!!B()||!!K())))))))},y=function(){return e},z=function(){return f},A=function(){var a=/Chrome\/(\S+)/,b=/CriOS\/(\S+)/,c=/(Opera|OPR)/,d=/Edge/,e=/CrKey/,f=s.getUserAgent(),g=b.test(f);return!(!a.test(f)&&!g||c.test(f)||d.test(f)||e.test(f)||(s.setBrowserVersion(s.CHROME,g?b:a),0))},B=function(){var a=/Playstation (\S+)/i;return!!a.test(s.getUserAgent())&&(s.setBrowserVersion(s.PLAYSTATION,a),!0)},C=function(){return null!=s.getUserAgent()&&s.getUserAgent().indexOf(s.CHROMECAST_USER_AGENT)>-1&&(h=s.LINUX,g=s.CHROMECAST,i=s.ANDROID,!0)},D=function(){var a=/MSIE\ ([^\s]+)[\)\;]\ Windows\ /,b=/\ Edge\/([^\s]+)/,c=/Trident.[^\s]+;.*rv:([^\s]+)[\)\;]/;return a.test(s.getUserAgent())?(s.setBrowserVersion(s.IE,a),!0):b.test(s.getUserAgent())?(s.setBrowserVersion(s.EDGE,b),!0):!!c.test(s.getUserAgent())&&(s.setBrowserVersion(s.IE,c),!0)},E=function(){var a=/Firefox\/(\S+)/,b=/FxiOS\/(\S+)/,c=s.getUserAgent(),d=b.test(c),e=!d&&a.test(c)?s.FIREFOX:d?s.FIREFOX_IOS:null;return!!e&&(s.setBrowserVersion(e,d?b:a),!0)},F=function(){var a,b=/Version\/(\S+).*Safari\//,c=b.test(s.getUserAgent());return a=i===s.ANDROID?s.ANDROID:s.SAFARI,!!c&&(s.setBrowserVersion(a,b),!0)},G=function(){var a=/Opera|OPR\/(\S+)/,b=new RegExp(a),c=b.exec(s.getUserAgent());if(c){var d=-1!==c.indexOf("Opera Mini/")||-1!==c.indexOf("Opera Mobi")?s.OPERA_MOBILE:s.OPERA;return s.setBrowserVersion(d,/Opera|OPR\/(\S+)/),!0}return!1},H=function(){return!!/Silk/i.test(s.getUserAgent())&&(s.setBrowserVersion(s.AMAZON_KINDLE,/Silk\/(\S+)/),!0)},I=function(){return!!/Android/.test(s.getUserAgent())&&(l=s.ANDROID_BROWSER,!0)},J=function(a){var b=a.match(/\[(.*)\]/),c=null,d={},e=[];return b&&b.length>0&&(c=b[1]),e=c.split(";"),e.forEach(function(a){var b=a.split("/");b.length>0&&(d[b[0]]=b[1])}),d},K=function(){var a=s.getUserAgent();if(!/FBAN/.test(a))return!1;var b=J(a),c=/iOS/i;return b.FBSN&&(i=b.FBSN),b.FBSV&&(j=b.FBSV),!(!b.FBAN||!c.test(b.FBAN))&&(l=s.FACEBOOK_IOS,!0)},L=function(){var a=y(),b=function(a,b){a._fullscreenEventName=b?b[0]:null,a._fullscreenEnterEventName=b?b[1]:null,a._fullscreenExitEventName=b?b[2]:null,a._enterFullscreenMethodName=b?b[3]:null,a._exitFullscreenMethodName=b?b[4]:null,a._isFullscreenPropertyName=b?b[5]:null,a._fullscreenElementName=b?b[6]:null,a._fullscreenErrorEventName=b?b[7]:null},c=["fullscreenchange",null,null,"requestFullscreen","exitFullscreen","fullscreen","fullscreenElement","fullscreenError"],d=[null,"webkitbeginfullscreen","webkitendfullscreen","webkitEnterFullscreen","webkitExitFullscreen","webkitDisplayingFullscreen",null,"webkitfullscreenerror"],e=null;s.isIOS()?e=d:a.requestFullscreen?e=c:a.webkitRequestFullscreen?e=["webkitfullscreenchange",null,null,"webkitRequestFullscreen","webkitExitFullscreen","webkitIsFullScreen","webkitFullscreenElement","webkitfullscreenerror"]:a.mozRequestFullScreen?e=["mozfullscreenchange",null,null,"mozRequestFullScreen","mozCancelFullScreen","mozFullScreen","mozFullScreenElement","mozfullscreenerror"]:a.msRequestFullscreen?s.getBrowserVersion()<12?e=["MSFullscreenChange",null,null,"msRequestFullscreen","msExitFullscreen",null,"msFullscreenElement","MSFullscreenError"]:(e=c.slice(),e[5]=null):s.isAndroid()&&(e=d),b(s,e)};return s},uvpjs.mediaCapabilities=uvpjs.MediaCapabilities()._detectEnvironment(),uvpjs.DebugManager={CONFIG_MODULE_NAME:"UVPJSDebug",configParams:{SHOW_ALL:"showAll",SHOW_TIMESTAMPS:"showTimestamps",SHOW_CLOCK_TIME:"showClockTime",CODE_LOADER:"CodeLoader",CONFIG_MANAGER:"ConfigManager",CORE_VIDEO_INSTANCE:"CoreVideoInstance",CVI_MODEL:"CVI_Model",DEBUG_MANAGER:"DebugManager",DOM_MANAGER:"DOMManager",EVENTS_MANAGER:"EventsManager",RESOURCE_CONFIG_OBJECT:"ResourceConfigObject",RESOURCE_PLAYLIST_MANAGER:"ResourcePlaylistManager",RESOURCE_PROVIDER:"ResourceProvider",SKIN_MANAGER:"SkinManager",CONTENT_DATA_PROXY:"ContentDataProxy",VIDEO_CONTROL_INTERFACE:"VideoControlInterface",VIDEO_MANAGER:"VideoManager",STUCK_AD:"StuckAd",FAIRPLAY_DRM:"FairPlayDRM",P2P_CLIENT:"P2pClient",SDK_LOAD_MANAGER:"SdkLoadManager",CAPTIONS_MANAGER:"CaptionsManager",CAPTIONS_AGENT:"CaptionsDisplayAgent",TRACKING_MANAGER:"TrackingManager",TRACKING_LIB:"TrackingLib",MUX_DEBUG:"MuxDebug",VIDEO_PLAYER_FACADE:"VideoPlayerFacade",VPF_HTML5:"VPF_HTML5",VPF_HLSJS:"VPF_HLSJS",HLSJS_LIB:"HLSJS_LIB",HLSJS_LEVEL:"HLSJS_LEVEL",HLSJS_FRAG:"HLSJS_FRAG",HLSJS_FRAME_DROP:"HLSJS_FRAME_DROP",VPF_DASHJS:"VPF_DASHJS",DASHJS_LIB:"DASHJS_LIB",VPF_SHAKA:"VPF_SHAKA",SHAKA_LIB:"SHAKA_LIB"},isEnabled:!1,showAll:!1,showTimestamps:!1,showClockTime:!1,sessionStartTime:0,timezoneOffset:0,adjustedStartTime:0,adjustedTimezone:0,supportsFormatting:!1,COOKIE_NAME:"UVPJSDebug",cookie:{},initialize:function(a){var b=uvpjs._,c=uvpjs.mediaCapabilities;if(this.DEBUG_ID=this.configParams.DEBUG_MANAGER,this.debugCount=0,!b.isObject(a))return void this.warn(this.DEBUG_ID,"DebugManager requires an instance of the ConfigDataObject.");this.cookie=this._getCookie(),this.CDO=a,this.isEnabled=!0===this.cookie.enabled||this._isEnabled(),this.showAll=!0===this.cookie.showAll||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_ALL),this.showTimestamps=!0===this.cookie.showTimestamps||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_TIMESTAMPS),this.showClockTime=!0===this.cookie.showClockTime||this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,this.configParams.SHOW_CLOCK_TIME),this.supportsFormatting=c.isChrome()||c.isFirefox()||c.isSafari(),this.setSessionStartTime()},setSessionStartTime:function(){this.sessionStartTime=this.sessionStartTime||new Date,this._setupTime()},log:function(){[].unshift.call(arguments,"log"),this.output.apply(this,arguments)},warn:function(){[].unshift.call(arguments,"warn"),this.output.apply(this,arguments)},error:function(){[].unshift.call(arguments,"error"),this.output.apply(this,arguments)},output:function(a,b,c){this.debugCount++;var d=uvpjs._;if(this.isEnabled||d.isUndefined(this.CDO)){if(!d.isString(a)||!d.isString(b)||d.isUndefined(c))return void console.warn("UVPJS DebugManager unable to display to console because of missing arguments."+c,b);if(this.showAll||d.isUndefined(this.CDO)||this.isParamEnabled(b)||!0===this.cookie[b]){var e=this.showTimestamps?"["+this._timestamp()+"] ":"",f=d.drop(arguments,3),g=d.isEmpty(f)?"":f,h={bold:";font-weight:bold;",normal:";text-decoration:none;",underline:";text-decoration:underline;"};if(!this.supportsFormatting)return void console[a]("%sUVPJS %s %s",e,b,c,g);console[a]("%s%cUVPJS %c%s%c %s",e,h.bold,h.underline,b,h.normal,c,g)}}},isParamEnabled:function(a){return!0===this.CDO.getModuleParam(this.CONFIG_MODULE_NAME,a)},_setupTime:function(){this.timezoneOffset=this.sessionStartTime.getTimezoneOffset()/60,this.adjustedStartTime=this.showClockTime?0:this.sessionStartTime,this.adjustedTimezone=this.showClockTime?this.timezoneOffset:0},_isEnabled:function(){return!!window.console&&!0===this.CDO.isModuleEnabled(this.CONFIG_MODULE_NAME)},_timestamp:function(){var a=uvpjs._,b=new Date,c=b-this.adjustedStartTime,d=c%1e3;c=(c-d)/1e3;var e=c%60;c=(c-e)/60;var f=c%60;c=(c-f)/60;var g=c%24-this.adjustedTimezone;return a.padStart(g,2,"0")+":"+a.padStart(f,2,"0")+":"+a.padStart(e,2,"0")+"."+a.padStart(d,3,"0")},_getCookie:function(){var a=this._readCookie(this.COOKIE_NAME),b={};if(!a)return b;uvpjs.log(this.DEBUG_ID,"_getCookie cookie",a);try{b=JSON.parse(a)}catch(a){uvpjs.error(this.DEBUG_ID,"Error reading cookie.",a)}return uvpjs.log(this.DEBUG_ID,"_getCookie obj",b),b},_readCookie:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0,e=c.length;d<e;d++){for(var f=c[d];" "===f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(b))return f.substring(b.length,f.length)}return null}},function(a){var b,c=a._;a.DOMManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.DOM_MANAGER,PLAY:"play",PAUSE:"pause",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",LOADED_METADATA:"loadedmetadata",init:function(a){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",a),this.mc=null,this._createControls=a.createControls,this._createAds=a.createAds,this._useInlinePlayAttribute=a.useInlinePlayAttribute,this._useMutedAttribute=a.useMutedAttribute,this._DOMReadyCB=a.callback,this._useAutoplayAttribute=a.useAutoplayAttribute,this._userAgent=null,this.adClickElement=null,this.dom=b(),this.dom.outer.id=a.containerID},initialize:function(){uvpjs.log(this.DEBUG_ID,"initialize"),this.mc=uvpjs.mediaCapabilities,this._userAgent=this.mc.getUserAgent(),this._setupDOM()},destroy:function(){var a=this.dom.video.el;a&&a instanceof HTMLElement&&(a.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),a.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),a.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),a.removeEventListener(this.PLAY,this._handleEvent,!1),a.removeEventListener(this.PAUSE,this._handleEvent,!1)),this.mc=null,this.dom=null,this._DOMReadyCB=null},getDOM:function(){return c.clone(this.dom)},createAdClickElement:function(){var a={position:"absolute","z-index":100,padding:"4px 6px",height:"16px","text-align":"center","line-height":"16px","font-size":"12px",color:"#000",background:"#dedede",top:0,right:0,display:"none"};this.adClickElement=document.createElement("div");for(var b in a)this.adClickElement.style[b]=a[b];this.adClickElement.innerHTML="<span>Learn More</span>",this.dom.outer.el.appendChild(this.adClickElement)},showAdContainer:function(a){this.dom.ad.el&&(this.dom.ad.el.style.display=a?"block":"none")},showAdClickElement:function(a){this.adClickElement&&(this.adClickElement.style.display=a?"inline-block":"none")},getAdClickElement:function(){return this.adClickElement||this.createAdClickElement(),this.adClickElement},_disableVideoContextMenu:function(){var a=this.dom.video.el;a.addEventListener?a.addEventListener("contextmenu",function(a){a.preventDefault()},!1):a.attachEvent("oncontextmenu",function(){window.event.returnValue=!1})},_setupDOM:function(){var a=this.dom;if(a.outer.el=document.getElementById(a.outer.id),c.isNull(this.dom.outer.el))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Fatal error: UVPJS outer container does not exist. UVPJS initialization failed!",a.outer.id));a.content.id=this._getIdByPrefix("CONTENT_ID_PREFIX"),a.video.id=this._getIdByPrefix("VIDEO_ID_PREFIX"),a.ad.id=this._getIdByPrefix("AD_ID_PREFIX"),a.controls.id=this._getIdByPrefix("CONTROLS_ID_PREFIX"),a.content.el=this._getOrCreateElement("content"),a.outer.el.insertBefore(a.content.el,a.outer.el.firstChild),this._createVideoElement(),this._createAds&&(this._useSeparateTags=this.mc.requiresSeparateTagsForIMA(),a.ad.el=this._getOrCreateElement("ad"),a.outer.el.insertBefore(a.ad.el,a.content.el.nextSibling)),this._createControls?(a.controls.el=this._getOrCreateElement("controls"),a.outer.el.appendChild(a.controls.el)):this._addInlineStyles(),this._disableVideoContextMenu(),this._DOMReadyCB()},_createVideoElement:function(){var a,b=[this.dom.outer.id,this.dom.content.id,this.dom.video.id].join(" "),c=document.querySelectorAll(b);if(c instanceof NodeList&&c[0]instanceof HTMLElement&&c[0].id)return void this._checkVideoTagAttributes(c);if(b=[this.dom.outer.id,this.dom.video.id].join(" "),(c=document.querySelectorAll(b))instanceof NodeList&&c[0]instanceof HTMLElement){if(c[0].id)return;return c[0].id=this.dom.video.id,void this.dom.content.el.appendChild(c[0])}a=this._getOrCreateElement("video"),this._checkVideoTagAttributes(a),this.dom.content.el.appendChild(a),this.dom.video.el=a},_createPlaceholderContent:function(){var a=this.dom.video.el;uvpjs.log(this.DEBUG_ID,"_createPlaceholderContent"),this.dom.video.url=this.mc.getPreferredPlaceholderURL(),this._useSeparateTags||c.isNull(this._userAgent)&&this.mc.isIPhone()?a.innerHTML='<source src="'+this.dom.video.url+'">':a.src=this.dom.video.url,this._handleEvent=this._handleEvent.bind(this),a.addEventListener(this.LOADED_METADATA,this._handleEvent,!1),a.addEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),a.addEventListener(this.CAN_PLAY,this._handleEvent,!1),a.addEventListener(this.PLAY,this._handleEvent,!1),a.addEventListener(this.PAUSE,this._handleEvent,!1),a.style.width="100%",this._DOMReadyCB()},_handleEvent:function(a){var b=this.dom.video.el;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent",a),!c.isNull(b)){var d=this._useSeparateTags?b.getElementsByTagName("source")[0]:b;if(!c.isNull(d)){if(a.type===this.LOADED_METADATA&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_handleEvent this._areAdsRequired, this._useSeparateTags",this._areAdsRequired,this._useSeparateTags),this._createAds&&this._useSeparateTags,this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",this.LOADED_METADATA,a.target),b.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1)),-1===d.src.indexOf(this.dom.video.url))return b.removeEventListener(this.LOADED_METADATA,this._handleEvent,!1),b.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1),b.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),b.removeEventListener(this.PLAY,this._handleEvent,!1),void b.removeEventListener(this.PAUSE,this._handleEvent,!1);switch(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener",a.type),a.type){case this.CAN_PLAY:b.removeEventListener(this.CAN_PLAY,this._handleEvent,!1),b.removeAttribute("controls","");break;case this.CAN_PLAY_THROUGH:b.removeEventListener(this.CAN_PLAY_THROUGH,this._handleEvent,!1);break;case this.PLAY:if(b.removeEventListener(this.PLAY,this._handleEvent,!1),b.pause(),!c.isFunction(this.dom.video.callback)){this.debug&&uvpjs.warn(this.DEBUG_ID,"No video placeholder callback specified.");break}this.dom.video.callback();break;case this.PAUSE:b.removeEventListener(this.PAUSE,this._handleEvent,!1)}}}},_checkVideoTagAttributes:function(a){this._useMutedAttribute&&a.setAttribute("muted","muted"),this._useAutoplayAttribute&&a.setAttribute("autoplay","autoplay"),this.mc.setVideoForInlinePlay(a,this._useInlinePlayAttribute)},_addInlineStyles:function(){if(this.dom.outer.el.style.position="relative",this.dom.video.el.style.width="100%",this._createAds){var a=this.dom.ad.el;a.style.position="absolute",a.style.width="100%",a.style.height="100%",a.style.left="0",a.style.top="0"}},_getIdByPrefix:function(a){if(!c.isNull(a))return uvpjs.domConstants[a]+this.dom.outer.id},_getOrCreateElement:function(a){var b=this.dom[a],d=document.getElementById(b.id);return c.isNull(d)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Creating element <"+b.type+' id="'+b.id+'">.'),d=document.createElement(b.type),d.id=b.id),d}}),b=function(){return{outer:{id:null,el:null},content:{id:null,el:null,type:"div"},video:{id:null,el:null,type:"video",url:null,callback:null},ad:{id:null,el:null,type:"div"},controls:{id:null,el:null,type:"div"}}}}(uvpjs.register("uvpjs")),function(a){var b=a._;a.CVI_Model=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CVI_MODEL,PREROLL:"pre",MIDROLL:"mid",POSTROLL:"post",ALT_AD_BLOCK_URL:"https://dai.google.com/ssai/content/{cmsid}/vid/{vid-id}/master.m3u8",AD_SETTINGS:"AdSettings",DFP_CMS_ID:"dfpCmsId",VIDEO_PLAYBACK_SETTINGS:"VideoPlaybackSettings",START_BITRATE:"startBitrate",MIN_BITRATE:"minBitrate",MAX_BITRATE:"maxBitrate",LIVE_SYNC_DURATION_COUNT:"liveSyncDurationCount",CAP_LEVEL_TO_PLAYER_SIZE:"capLevelToPlayerSize",DASHJS_FAST_SWITCH_ABR:"enableDashJSFastSwitchABR",TRACKING_CONFIG_OVERRIDES:"trackingConfigOverrides",contentVideoStateDefaults:{abrInfo:[],assetURL:"",audioPreviewImageUrl:"",category:"",cdn:"",chapterStartTimes:[],closedCaptionDivName:"",closedCaptionPath:"",closedCaptionType:"",cms:"",cmsRefGuid:"",contentType:"",contextMetadata:null,contPlayState:"",copyright:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,dfpMediaId:null,duration:-1,endTime:-1,episodeAbstract:"",episodeFlag:!1,episodeNumber:"",episodeTitle:"",excludeNielsenTracking:!1,fileType:"",isAffiliateFeed:!1,isEmbedable:!1,isGeoRestricted:!1,isLive:!1,isPaidContent:!1,isResumed:!1,isFlash:!1,keywords:"",mediaId:"",overrideAssetURL:null,ozTamMediaId:null,ozTamOptOut:null,pid:"",restrictionCheckResult:"",liveSyncDurationCount:3,sendResumeEvent:!1,elapsedTime:0,showPreroll:!0,playedChapterTime:0,previousSessionId:"",podsToSkip:"",resumePid:"",resumeContentTime:0,resumeEpochTime:0,resumeSessionId:"",seasonNumber:"",seriesTitle:"",sourceHeight:0,sourceOwner:"",sourceWidth:0,startTime:0,useWatermark:!1,uvpc:null,videoTitle:"",is360:!1,drm:{enabled:!1,sessionId:null,ticket:null,fairplay:{appCertURL:null,licenseURL:null,header:{}},dash:{widevineURL:null,playreadyURL:null,widevine:{url:null,header:{}},playready:{url:null,header:{}}}}},contentPlaybackStateDefaults:{abrInfo:[],absoluteStreamTime:0,averageDroppedFPS:0,audioInfo:{},bufferLength:0,currentMaxBandwidth:0,currentContentSegment:1,currentTime:0,duration:-1,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,maxBitrate:this.maxBitrate||-1,minBitrate:this.minBitrate||-1,startBitrate:this.startBitrate||-1,liveSyncDurationCount:this.liveSyncDurationCount||3,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},adVideoStateDefaults:{adClipID:"",adBitrate:0,adParameters:"",adPosition:-1,adServerName:"",adType:"",adVatId:"",adVideoId:"",adVideoTitle:"",adVideoUrl:"",assetURL:"",clickThru:"",creativeId:"",defaultBitrate:0,deliveryType:uvpjs.mediaCapabilities.PROGRESSIVE,duration:-1,isCustomClickTrackingUsed:!1,isLinear:!0,isRewindable:!1,isVPAID:!1,sourceHeight:0,sourceWidth:0,wrapperAdId:"",adAssetUrl:""},adPlaybackStateDefaults:{currentTime:0,absoluteStreamTime:0,duration:-1,errorInfo:"",isAd:!0,lastPercentageCompleted:0,lastSecondCompleted:0,playbackBitrate:0,playbackComplete:!1,playbackStarted:!1,playbackState:uvpjs.mediaCapabilities.EMPTY,sourceBitrate:0},init:function(){this.initTime=Date.now(),this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.CDO={},this.sessionOptions={},this.sessionId=uvpjs.mediaCapabilities.getSessionId(),this.isAutoplay=!1,this.isMuteAtPlayStart=!1,this.userHasUnmuted=!1,this.contentVideoState={},this.adVideoState={},this.contentPlaybackState={},this.adPlaybackState={},this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.resetAdPlaybackState(),this.resetAdVideoState(),this.resetContentPlaybackState(),this.resetContentVideoState(),this.nativeControls=!1,this.volume=1,this.isMuted=!1,this.useDynamicSwitching=!0,this.isFullscreen=!1,this.startBitrate=-1,this.maxBitrate=-1,this.minBitrate=-1,this.liveSyncDurationCount=3,this.adNum=0,this.medNum=0,this.capLevelToPlayerSize=!1,this.enableDashJSFastSwitchABR=!1,this.errorRecovery=null,this.isCurrVideoAd=!1,this.daiStreamId=null,this.APM=null,this.dwPageParams=window.DW&&window.DW.pageParams||{},this.trackingConfigOverrides=null},initialize:function(a,c,d,e){if(!b.isString(a)||!b.isObject(c)||!b.isObject(d))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize ------------------------------- ERROR BAD INITIALIZATION PARAMS RETURN"));this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId = "+a),this.vidContId=a,this.cviMgr=c,this.CDO=d,this.sessionOptions=e,this.eventsMgr=c.getEventsMgr(),this.internalNS="."+this.vidContId+".cvi_model",this.addEventListeners(),this.setAbrMinBitrateFromCDO(),this.setAbrMaxBitrateFromCDO(),this.setAbrStartBitrateFromCDO(),this.setLiveSyncDurationCountFromCDO(),this.setCapLevelToPlayerSizeFromCDO(),this.setDashJSFastSwitchABRFromCDO(),null!==this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]&&(this.trackingConfigOverrides=this.sessionOptions[this.TRACKING_CONFIG_OVERRIDES]),this.mergeCDOData()},addEventListeners:function(){this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE+this.internalNS,this.onVideoStateChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET+this.internalNS,this.onVideoVolumeChange.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_MUTE+this.internalNS,this.onVideoMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_UNMUTE+this.internalNS,this.onVideoUnMute.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN+this.internalNS,this.onFullscreen.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_START+this.internalNS,this.onResourceStart.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTEXT_METADATA+this.internalNS,this.onContextMetadata.bind(this))},onVideoStateChange:function(a){if(b.isPlainObject(a)&&a.target===this.vidContId&&b.isNumber(a.payload.newState)){this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoStateChange  this.vidContId = "+this.vidContId+" current this.playbackState = "+this.playbackState+" CHANGE TO evtObj.payload.newState = "+a.payload.newState);var c=a.payload.newState;c!==uvpjs.mediaCapabilities.EMPTY&&c!==uvpjs.mediaCapabilities.LOADING&&c!==uvpjs.mediaCapabilities.STOPPED&&c!==uvpjs.mediaCapabilities.PLAYING&&c!==uvpjs.mediaCapabilities.PAUSED&&c!==uvpjs.mediaCapabilities.BUFFERING||(this.playbackState=c,this.isCurrVideoAd?this.adPlaybackState.playbackState=this.playbackState:this.contentPlaybackState.playbackState=this.playbackState)}},onVideoProgress:function(a){var b=a.payload;a.target===this.vidContId&&(this.isCurrVideoAd=b.isAd,this.playbackState=b.playbackState,this.isCurrVideoAd?(this.adPlaybackState.currentTime=b.currentTime,this.adPlaybackState.absoluteStreamTime=b.absoluteStreamTime||b.currentTime,this.adPlaybackState.duration=b.duration,this.adPlaybackState.isAd=!0,this.adPlaybackState.playbackStarted=b.playbackStarted,this.adPlaybackState.playbackComplete=b.playbackComplete,this.adPlaybackState.sourceBitrate=b.sourceBitrate,this.adPlaybackState.playbackBitrate=b.playbackBitrate,this.adPlaybackState.errorInfo=b.errorInfo,this.adPlaybackState.lastSecondCompleted=b.lastSecondCompleted,this.adPlaybackState.lastPercentageCompleted=b.lastPercentageCompleted,this.adPlaybackState.playbackState=this.playbackState):(this.contentPlaybackState.currentTime=b.currentTime,this.contentPlaybackState.absoluteStreamTime=b.absoluteStreamTime||b.currentTime,this.contentPlaybackState.duration=this.contentVideoState.duration,this.contentPlaybackState.isAd=!1,this.contentPlaybackState.playbackStarted=b.playbackStarted,this.contentPlaybackState.playbackComplete=b.playbackComplete,this.contentPlaybackState.sourceBitrate=b.sourceBitrate,this.contentPlaybackState.playbackBitrate=b.playbackBitrate,this.contentPlaybackState.videoFramerate=b.videoFramerate,this.contentPlaybackState.isSeeking=b.isSeeking,this.contentPlaybackState.isHDStreamLive=b.isHDStreamLive,this.contentPlaybackState.isPlayingLive=b.isPlayingLive,this.contentPlaybackState.currentContentSegment=b.currentContentSegment,this.contentPlaybackState.currentMaxBandwidth=b.currentMaxBandwidth,this.contentPlaybackState.averageDroppedFPS=b.averageDroppedFPS,this.contentPlaybackState.lastSecondCompleted=b.lastSecondCompleted,this.contentPlaybackState.lastPercentageCompleted=b.lastPercentageCompleted,this.contentPlaybackState.bufferLength=b.bufferLength,this.contentPlaybackState.switchingMode=!0===this.useDynamicSwitching?"auto":"manual",this.contentPlaybackState.playbackState=this.playbackState,this.contentPlaybackState.facadeState=b.facadeState,this.contentPlaybackState.startBitrate=this.startBitrate,this.contentPlaybackState.minBitrate=this.minBitrate,this.contentPlaybackState.maxBitrate=this.maxBitrate,this.contentPlaybackState.liveSyncDurationCount=this.liveSyncDurationCount))},onVideoVolumeChange:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&b.isNumber(a.payload.vol)&&(this.volume=a.payload.vol,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoVolumeChange       this.volume now = ",this.volume))},onVideoMute:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoMute ***********************************       onVideoMute          this.isMuted now true;"),this.isMuted=!0)},onVideoUnMute:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoUnMute ***********************************      onVideoUnMute        this.isMuted now false;"),this.isMuted=!1)},onFullscreen:function(a){b.isPlainObject(a)&&a.target===this.vidContId&&(this.isFullscreen=a.payload.isFs)},onContextMetadata:function(a){!b.isPlainObject(a)||a.target!==this.vidContId||b.isPlainObject(a.target.contextMetadata)},onResourceStart:function(a){this.resetAdPlaybackState(),this.resetContentPlaybackState()},resetAdPlaybackState:function(){b.assign(this.adPlaybackState,this.adPlaybackStateDefaults)},resetAdVideoState:function(){this.setAdVideoState()},resetContentPlaybackState:function(){b.assign(this.contentPlaybackState,this.contentPlaybackStateDefaults)},resetContentVideoState:function(){b.assign(this.contentVideoState,this.contentVideoStateDefaults)},getAdCallParams:function(){return this.CDO.getAdCallParams()},setAdCallParams:function(a){this.CDO.setAdCallParams(a)},isId3HandlingRequired:function(){return this.getConfiguredId3OwnerIds()||this.isNielsenTrackingEnabled()},getConfiguredId3OwnerIds:function(){var a=this.CDO.getSessionOption("id3OwnerIds");return"string"==typeof a&&a.length?a:null},isNielsenTrackingEnabled:function(){return!0===this.getModule("NielsenTracking_SDK").enabled},getValueForKey:function(a){var c=void 0;return a&&b.isString(a)&&this.hasOwnProperty(a)&&!b.isFunction(this[a])&&(c=this[a]),c},getModule:function(a){if(b.isString(a))return this.CDO.getModule(a)},getModuleParam:function(a,c){if(b.isString(a)&&b.isString(c))return this.CDO.getModuleParam(a,c)},getModules:function(){return this.CDO.getModules()},copyModules:function(a){this.CDO.copyModules(a)},isModuleEnabled:function(a){return!(!a||!b.isString(a))&&this.CDO.isModuleEnabled(a)},isModuleSet:function(a){return!uvpjs.util.isEmpty(a)&&this.CDO.isModuleSet(a)},getSessionOption:function(a){return a?this.sessionOptions[a]:null},getClass:function(a){if(b.isString(a))return this.CDO.getClass(a)},getClasses:function(){return this.CDO.getClasses()},getClassProperty:function(a,b){return this.CDO.getClassProperty(a,b)},getClassListItems:function(a){return this.CDO.getClassListItems(a)},getClassListItemProperty:function(a,b,c){return this.CDO.getClassListItemProperty(a,b,c)},getCurrentPlaybackState:function(){return this.isCurrVideoAd?this.getAdPlaybackState():this.getContentPlaybackState()},getCurrentVideoState:function(){return this.isCurrVideoAd?this.getAdVideoState():this.getContentVideoState()},getContentVideoState:function(){var a={};return b.assign(a,this.contentVideoState),a},getAdVideoState:function(){var a={};return b.assign(a,this.adVideoState),a},getContentPlaybackState:function(){var a={};return b.assign(a,this.contentPlaybackState),a},getAdPlaybackState:function(){return b.assign({},this.adPlaybackState)},getNumberOfAdPods:function(){return this.APM?this.APM.getNumberOfPods():this.contentVideoState.chapterStartTimes&&this.contentVideoState.chapterStartTimes.length||0},setAbrInfo:function(a){this.contentVideoState.abrInfo=a,this.contentPlaybackState.abrInfo=a},setAdVideoState:function(a){this.adVideoState=b.assign({},this.adVideoStateDefaults,a||{})},setContentVideoStateItems:function(a){this._addItemsToInstanceObj("contentVideoState",a)},setContentPlaybackStateItems:function(a){this._addItemsToInstanceObj("contentPlaybackState",a)},setAdVideoStateItems:function(a){this._addItemsToInstanceObj("adVideoState",a)},setAdPlaybackStateItems:function(a){this._addItemsToInstanceObj("adPlaybackState",a)},setNonDefaultContentVideoStateItems:function(a){this.setContentVideoStateItems(this._removeDefaults(a,this.contentVideoStateDefaults))},setNonDefaultAdVideoStateItems:function(a){this.setAdVideoStateItems(this._removeDefaults(a,this.adVideoStateDefaults))},incrementAdNum:function(){this.adNum++},incrementMedNum:function(){this.medNum++},getVideoPlaybackCDOProperty:function(a){var b=this.VIDEO_PLAYBACK_SETTINGS,c=this.isModuleEnabled(b),d=this.getModuleParam(b,a);if(c&&d)return d},setAbrStartBitrateFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.START_BITRATE);void 0!==a&&this.setStartBitrate(a)},setAbrMinBitrateFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.MIN_BITRATE);void 0!==a&&this.setMinBitrate(a)},setAbrMaxBitrateFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.MAX_BITRATE);void 0!==a&&this.setMaxBitrate(a)},setLiveSyncDurationCountFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.LIVE_SYNC_DURATION_COUNT);void 0!==a&&this.setLiveSyncDurationCount(a)},setCapLevelToPlayerSizeFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.CAP_LEVEL_TO_PLAYER_SIZE);void 0!==a&&this.setCapLevelToPlayerSize(a)},setDashJSFastSwitchABRFromCDO:function(){var a=this.getVideoPlaybackCDOProperty(this.DASHJS_FAST_SWITCH_ABR);void 0!==a&&this.setDashJSFastSwitchABR(a)},setStartBitrate:function(a){this.startBitrate=a,this.setContentPlaybackStateItems({startBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Start Bitrate:",this.startBitrate)},setMinBitrate:function(a){this.minBitrate=a,this.setContentPlaybackStateItems({minBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Min Bitrate:",this.minBitrate)},setMaxBitrate:function(a){this.maxBitrate=a,this.setContentPlaybackStateItems({maxBitrate:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Max Bitrate:",this.maxBitrate)},setLiveSyncDurationCount:function(a){this.liveSyncDurationCount=a,this.setContentPlaybackStateItems({liveSyncDurationCount:a}),this.debug&&uvpjs.log(this.DEBUG_ID,"Set Live Sync Duration Count:",this.liveSyncDurationCount)},setCapLevelToPlayerSize:function(a){this.capLevelToPlayerSize=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Cap Level To Player Size:",this.capLevelToPlayerSize)},setDashJSFastSwitchABR:function(a){this.enableDashJSFastSwitchABR=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set Dash.js FastSwitchABR to: ",this.enableDashJSFastSwitchABR)},setAudioTrackInfo:function(a){this.contentPlaybackState.audioInfo=a},getAudioTrackInfo:function(){return this.contentPlaybackState.audioInfo},setErrorRecovery:function(a){this.errorRecovery=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set errorRecovery to : ",this.errorRecovery)},setUseDynamicSwitching:function(a){this.useDynamicSwitching=a,this.debug&&uvpjs.log(this.DEBUG_ID,"Set useDynamicSwitching to: ",this.useDynamicSwitching)},mergeCDOData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState before merge",this.contentVideoState);var a=this;b.forOwn(this.sessionOptions,function(c,d){if(b.isString(c))return b.has(a.contentVideoState,d)?void(a.contentVideoState[d]=c):b.has(a.adVideoState,d)?void(a.adVideoState[d]=c):void 0}),this.debug&&(uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData this.contentVideoState after merge",this.contentVideoState),uvpjs.log(this.DEBUG_ID,"CVI_Model mergeCDOData      this.adVideoState after merge",this.adVideoState))},_removeDefaults:function(a,c){return b.omitBy(a,function(b,d){return a[d]===c[d]})},_addItemsToInstanceObj:function(a,c){var d,e,f;if(!(d=this[a]))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj instance object named "+a));if(!b.isObject(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"_addItemsToInstanceObj `items` is not an object. ",c));this.debug;for(e in d)f=c[e],!c.hasOwnProperty(e)||b.isUndefined(f)||b.isFunction(f)||(d[e]=f)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.CodeLoader=uvpjs.Class.subClass({init:function(){this.debug=uvpjs.debug,this._setUrlProtocol=uvpjs.mediaCapabilities.setUrlProtocol,this.DEBUG_ID=uvpjs.DebugManager.configParams.CODE_LOADER,this.REQUEST_TIMEOUT=4e3,this.timeout=0,this.timeoutHandle=0,this.urls=[],this.scriptsLoadedCB={}},initialize:function(){},destroy:function(){this._setUrlProtocol=null,clearTimeout(this.timeoutHandle),this.timeoutHandle=null},loadScript:function(a,c,d){var e,f;for(this.debug&&uvpjs.log(this.DEBUG_ID,"loadScript urls",a),this.scriptsLoadedCB=c,this.timeout=d||this.REQUEST_TIMEOUT,b.isString(a)&&this.urls.push(a),b.isArray(a)&&(this.urls=a),f=this.urls.length,e=0;e<f;e++)this._getScript(this.urls[e])},_getScript:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_getScript url",a);var c=this,d=function(a,d){if(!b.isFunction(c._onScriptLoaded)||c._onScriptLoaded.done)return void(c.debug&&uvpjs.warn(c.DEBUG_ID,"_getScript _doCallback callback not a function or already called."));c.urls=b.without(c.urls,a),c._onScriptLoaded({url:a,error:d})},e=document.createElement("script");e.src=this._setUrlProtocol(a),e.async=!0,e.onreadystatechange=e.onload=function(){e.readyState&&!/loaded|complete/.test(e.readyState)||d(a)},e.onerror=function(b){uvpjs.error(c.DEBUG_ID,"_getScript "+b.target.src+" is not accessible."),d(a,b)},document.querySelector("head").appendChild(e),this.timeoutHandle=setTimeout(function(a){-1===b.indexOf(c.urls,a)||(this.debug&&uvpjs.warn(c.DEBUG_ID,"_getScript request timeout"),d(a,"timeout"))}.bind(this,a),this.timeout)},_onScriptLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded");var c=b.isEmpty(this.urls);this.debug&&uvpjs.log(this.DEBUG_ID,"_onScriptLoaded scriptsLoaded",this.urls),c&&b.isFunction(this.scriptsLoadedCB)&&(this.scriptsLoadedCB.done=!0,this.scriptsLoadedCB(a))},createCORSRequest:function(a,b){var c=new XMLHttpRequest;return b=this._setUrlProtocol(b),"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=!1,c},loadXHR:function(a,c,d,e){var f,g;if(a=this._setUrlProtocol(a),!1===(f=this.createCORSRequest("GET",a)))return g="loadXHR CORS not supported for url = "+a,uvpjs.warn(this.DEBUG_ID,g),void d(f);e&&!uvpjs.util.isEmpty(e)&&(f.responseType=e),f.timeout=this.REQUEST_TIMEOUT,f.onload=function(){if(b.inRange(f.status,200,400))return void c(f);d(f)},f.onerror=function(){d(f)},f.ontimeout=function(){d(f)},f.send()},loadXML:function(a,b,c){this.loadXHR(a,b,c,"document")},loadArrayBuffer:function(a,b,c){this.loadXHR(a,b,c,"arraybuffer")}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.CoreVideoInstanceManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(a){var b=a.vidContId;if(!a.readyCallback)throw new Error("readyCallback missing from CoreVideoInstanceManager.options");this.debug=uvpjs.debug,this.vidContId=b,this.eventsMgr=a.eventsMgr,this.cviModel=new uvpjs.CVI_Model,this.RPM={},this.trackingMgr={},this.imaAdDisplayContainer={},this.adsLoader={},this.pauseAdRetriever=null,this.contentInitializedForIMA=!1,this.adVideoDiv={},this.containers=null,this.deliveryPluginSvc=null,this.readyCallback=a.readyCallback,this.cachedOptions={suppressFacadePlay:a.suppressFacadePlay,deferLoadingCaptions:a.playerOptions.deferLoadingCaptions},this.cviModel.initialize(b,this,a.CDO,a.playerOptions),this.initialPlaybackInfo={},setTimeout(this.initialize.bind(this),1)},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"Checking video delivery plugins... ",this.vidContId),this.deliveryPluginSvc=new uvpjs.VideoDeliveryPluginService(this.finishInit.bind(this),this.cviModel),this.deliveryPluginSvc.createPlugins()},setContainers:function(a){if(!this.RPM)throw new Error("Must be called after cviMgr init completes");this.RPM.setContainers(a)},setAdCallParams:function(a){this.cviModel.setAdCallParams(a)},setInitialPlaybackType:function(a,b){this.initialPlaybackInfo.isAutoplay=a,this.initialPlaybackInfo.isMuteAtPlayStart=b},setContextMetadata:function(a){this.cviModel.contentVideoState.contextMetadata=a||null},setPlaybackInfoOnModel:function(){this.cviModel.isAutoplay=this.initialPlaybackInfo.isAutoplay,this.cviModel.isMuteAtPlayStart=this.initialPlaybackInfo.isMuteAtPlayStart},finishInit:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"Initializing... ",this.vidContId);var c=this.cachedOptions;this.RPM=new uvpjs.ResourcePlaylistManager({vidContId:this.vidContId,suppressFacadePlay:c.suppressFacadePlay,p2pClient:a||null,multiCdnClient:b||null,deferLoadingCaptions:c.deferLoadingCaptions,cviMgr:this}),this.trackingMgr=new uvpjs.TrackingManager({vidContId:this.vidContId,cviMgr:this}),this.captionsMgr=new uvpjs.CaptionsManager({containerId:this.vidContId,cviModel:this.cviModel,eventsMgr:this.eventsMgr,deferLoadingCaptions:c.deferLoadingCaptions}),this.cachedOptions=null,this.checkForPauseAd(),this.deliveryPluginSvc.destroy(),this.deliveryPluginSvc=null,this.readyCallback()},constructSharedIMAClasses:function(a){var c=this.cviModel.getSessionOption("adBlockerCallback"),d=!(!c||!c()),e=this.eventsMgr.eventTypes,f=uvpjs.ErrorInfo,g=window.google&&google.ima;if(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses; ads blocked =  "+d),d&&this.eventsMgr.dispatchEvent(e.AD_BLOCKED,{errorInfo:new f({eventType:e.AD_BLOCKED,errorCode:f.errorCodes.AD_BLOCKING_DETECTED,message:f.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId),!d&&!g)return void this.eventsMgr.dispatchEvent(e.PLAYER_START_ERROR,{errorInfo:new f({eventType:e.PLAYER_START_ERROR,errorCode:f.errorCodes.IMA_SDK_MISSING,message:f.messages.IMA_SDK_MISSING,isFatal:!1})},this.vidContId);if(g){if(!b.isEmpty(this.imaAdDisplayContainer))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"constructSharedIMAClasses RETURN constructSharedIMAClasses already constructed"));this.imaAdDisplayContainer=this._createIMAAdDisplayContainer(a),this.imaAdDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.imaAdDisplayContainer);var h=this.adsLoader.getSettings();h.setAutoPlayAdBreaks(!0),h.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.INSECURE),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}},_createIMAAdDisplayContainer:function(a){var b,c,d;return this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer"),this.adVideoDiv=document.getElementById(uvpjs.domConstants.AD_ID_PREFIX+this.vidContId),b=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),c=b.getElementsByTagName("video")[0],d=new google.ima.AdDisplayContainer(this.adVideoDiv,c,a),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer     adClickElement = ",a),this.debug&&uvpjs.log(this.DEBUG_ID,"_createIMAAdDisplayContainer adDisplayContainer = ",d),d},onAdsManagerLoaded:function(a){var b,c=uvpjs.util,d=c.isEmpty(this.RPM),e=c.isEmpty(this.RPM.currRP),f=this.RPM.currRP.getProviderType()!==uvpjs.mediaCapabilities.RP_IMA;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdsManagerLoaded; event = ",a),d||e||f)return b="CVI mgr: onAdsManagerLoaded; ",b+=d?"no RPM found":e?"no current RP found":"RP not of type RP_IMA",this.debug&&uvpjs.log(this.DEBUG_ID,b),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+b,isFatal:!1})},this.vidContId);this.RPM.currRP.onAdsManagerLoaded(a)},onAdError:function(a){var c=!b.isEmpty(this.RPM)&&this.RPM,d=c&&!b.isEmpty(c.currRP)&&c.currRP;if(this.debug&&uvpjs.log(this.DEBUG_ID,"onAdError; adErrorEvent = ",a),!c||!d)return this.debug&&uvpjs.log(this.DEBUG_ID,"CVI.onAdError: this.RPM or this.RPM.currRP is empty; early return"),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" Encountered null ResourcePlaylistManager and/or ResourceProvider",isFatal:!1})},this.vidContId);"function"==typeof d.handleAdsLoaderError&&d.handleAdsLoaderError(a)},destroyIMAAdsLoader:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyIMAAdsLoader this.adsLoader = ",this.adsLoader),this.adsLoader&&(this.debug&&uvpjs.log(this.DEBUG_ID," destroyIMAAdsLoader this.adsLoader  exists so destroy it"),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1),this.adsLoader=null)},loadDynamicAdCall:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),this.RPM.loadDynamicAdCall(a)},forceDynamicMidrollPodEnd:function(){this.RPM.forceDynamicMidrollPodEnd()},getEventsMgr:function(){return this.eventsMgr},getModelRef:function(){return this.cviModel},playVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideoRequest this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PLAY,{},this.vidContId)},pauseVideoRequest:function(a){void 0===a&&(a={}),this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_PAUSE,a,this.vidContId)},seekToRequest:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRequest = "+a),b.isNaN(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"invalid seekToRequest value = "+a));-1===a&&this.seekToLiveRequest(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK,{seekTime:a},this.vidContId)},seekToLiveRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLiveRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SEEK_TO_LIVE_POINT,{},this.vidContId)},stopVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_STOP,{},this.vidContId)},clearVideoRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideoRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_CLEAR,{},this.vidContId)},muteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"muteRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_MUTE,{},this.vidContId)},unmuteRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unmuteRequest"),this.cviModel.isMuteAtPlayStart&&(this.cviModel.userHasUnmuted=!0),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_UNMUTE,{},this.vidContId)},getPlayerMuted:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerMuted"),this.cviModel.isMuted},volumeChangeRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"volumeChangeRequest newVolume = ",a),b.isNaN(a)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_SET,{vol:a},this.vidContId)},getVolume:function(){return this.cviModel.volume},loadCaptionsRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptionsRequest captionsPath = ",a),b.isString(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_LOAD_CAPTIONS,{url:a},this.vidContId)},showCaptionsRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_SHOW_CAPTIONS,{language:a},this.vidContId)},setCaptionLanguage:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SET_CAPTIONS_LANG,{language:a},this.vidContId)},hideCaptionsRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptionsRequest"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_HIDE_CAPTIONS,{},this.vidContId)},getCaptionInfo:function(){return this.captionsMgr.getCaptionInfo()},setCaptionsStyleRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleRequest",a),this.cviModel.contentVideoState.isFlash?this.RPM.setCaptionStyle(a):this.captionsMgr.setStyles(a)},setCaptionsCuePropertyRequest:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCuePropertyRequest",a,b),this.captionsMgr.setCueProperty(a,b)},getCaptionsStyleRequest:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyleRequest"),this.captionsMgr.getStyles()},getAudioTrackInfo:function(){return this.cviModel.getAudioTrackInfo()},setAudioTrack:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_AUDIO_TRACK,{id:a})},resizeRequest:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"resizeRequest  width = "+a+"  height = "+c),!b.isNaN(a)&&!b.isNaN(c)&&a>=0&&c>=0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESIZE,{width:a,height:c},this.vidContId)},fullscreenRequest:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreenRequest onOrOff = ",a),b.isBoolean(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_FULLSCREEN,{isFs:a},this.vidContId)},setUserGesture:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:a},this.vidContId)},getCurrentPlaybackState:function(){return this.cviModel.getCurrentPlaybackState()},getContentVideoData:function(){return this.cviModel.getContentVideoState()},getAdVideoData:function(){return this.cviModel.getAdVideoState()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.cviModel.sessionId},setPageContextMetadata:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata contextData = ",a),b.isPlainObject(a)},setNativeControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setNativeControls onOff = ",a),b.isBoolean(a)&&(this.cviModel.nativeControls=a)},createPauseAdRetriever:function(){var a=this.cviModel.getModuleParam("PauseAd","adcallurl")||this.cviModel.getModuleParam("PauseAd","adCallURL")||this.cviModel.getModuleParam("PauseAd","adCallUrl"),b={eventsMgr:this.eventsMgr,adCallUrl:a,partner:this.cviModel.getSessionOption("partner"),userStatus:this.cviModel.getSessionOption("userStatus"),model:this.cviModel,vidContId:this.vidContId,debugId:this.DEBUG_ID};return a?uvpjs.PauseAdRetriever?void(this.pauseAdRetriever=new uvpjs.PauseAdRetriever(b)):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Class 'PauseAdRetriever' not loaded; please confirm path.")):void(this.debug&&uvpjs.warn(this.DEBUG_ID,"PauseAd module enabled with invalid ad call url: "+a))},checkForPauseAd:function(){var a,b=this.cviModel.isModuleEnabled("PauseAd"),c=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/PauseAdRetriever.js";b&&(uvpjs.PauseAdRetriever?this.createPauseAdRetriever():(a=new uvpjs.CodeLoader,a.loadScript(c,this.createPauseAdRetriever.bind(this))))}})}(uvpjs.register("uvpjs")),function(a){a.ErrorInfo=uvpjs.Class.subClass({init:function(a){var b=a||{};this.errorCode=b.errorCode||null,this.eventType=b.eventType||null,this.isFatal=!!b.isFatal,this.imaErrorCode=null,this.imaVastErrorCode=null,this.message=b.message||null,this.adInfo=b.adInfo||null,this.serverCode=b.serverCode||null,this.hlsjsErrorCode=null}}),a.ErrorInfo.errorCodes={IMA_SDK_MISSING:1001,DAI_SDK_MISSING:1003,IMA_SCENARIO_UNKNOWN:1002,FLASH_RELATED_ERROR:1003,INVALID_RESOURCE_FORMAT:2e3,RESOURCE_GEOBLOCKED:2001,RESOURCE_UNAVAILABLE:2002,SELECTOR_CALL_ERROR:2003,DASH_START_ERROR:2004,DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:2005,USER_GESTURE_REQUIRED:2006,UNSPECIFIED_VIDEO_PLAYBACK_ERROR:3e3,MEDIA_ERR_ABORTED:3001,MEDIA_ERR_NETWORK:3002,MEDIA_ERR_DECODE:3003,MEDIA_ERR_SRC_NOT_SUPPORTED:3004,HLSJS_PLAYBACK_ERROR:3005,HLSJS_NETWORK_ERROR:3006,HLSJS_MEDIA_ERROR:3007,HLSJS_MUX_ERROR:3008,HLSJS_OTHER_ERROR:3009,DAI_STREAM_ERROR:3010,FAIRPLAY_APP_CERT_ERROR:3011,FAIRPLAY_LIC_ERROR:3012,FLASH_PLAYBACK_ERROR:3013,IMA_AD_ERROR:4e3,DAI_AD_ERROR:4002,AD_BLOCKING_DETECTED:4001,STUCK_AD_ERROR:4003,UNEXPECTED_CONDITION:9e3},a.ErrorInfo.messages={AD_BLOCKING_DETECTED:"Ad blocking detected; one or more SDKs may be unusable.",DAI_ASSET_URL_ERROR:"DAI stream 'loaded' event has no asset url.",DASH_ERROR_TEMPLATE:"dash.js Error. Type = {TYPE}, ID = {ID}, Message = {MESSAGE}",DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR:"Error parsing dynamic variant manifest.",FAIRPLAY_APP_CERT_LOAD:"Request to load FairPlay Application Certificate failed",FAIRPLAY_NO_CONTENTID:"FairPlay URI does not contain ContentId",FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED:"FairPlay Key System(com.apple.fps.1_0) is not supported in this browser",FAIRPLAY_CREATE_MEDIAKEYS:"Could not create WebKit MediaKeys",FAIRPLAY_CREATE_SESSION:"Could not create FairPlay Key Session",FAIRPLAY_LIC_RESPONSE_CODE:"FairPlay getckc request returned an error response code",FAIRPLAY_LIC_REQUEST:"FairPlay getckc request failed",FAIRPLAY_KEY_ERROR:"Failed to load FairPlay key",HLSJS_NETWORK_ERROR:"An HLSJS network error occurred: {INFO}",HLSJS_MEDIA_ERROR:"An HLSJS media error occurred: {INFO}",HLSJS_MUX_ERROR:"An HLSJS mux error occurred: {INFO}",HLSJS_OTHER_ERROR:"An HLSJS other error occurred: {INFO}",IMA_AD_ERROR_EVENT_RECEIVED:"An IMA ad error occurred.",IMA_ADPOD_ERROR:"Ad event received but current ad pod is undefined.",DAI_ADPOD_ERROR:"Ad start event received but current ad pod is undefined.",IMA_ADSMGR_ERROR:"google.ima.AdsManager failed to start.",IMA_AD_START_FAILED:"Ad load request made but ad start event not received.",IMA_SCENARIO_UNKNOWN:"Possible resource configuration issue.",IMA_SDK_MISSING:"Ad (IMA) SDK is missing.",INVALID_RESOURCE_FORMAT:"Error parsing requested resource.",MEDIA_ERR_ABORTED:"Fetching of resource aborted by user.",MEDIA_ERR_NETWORK:"A network error caused resource to stop being fetched",MEDIA_ERR_DECODE:"A decoding error caused resource to stop being fetched.",MEDIA_ERR_SRC_NOT_SUPPORTED:"Resource format not supported.",RESOURCE_GEOBLOCKED:"Resource is geo-blocked.",RESOURCE_UNAVAILABLE:"Resource PID is expired or otherwise unavailable.",SELECTOR_CALL_ERROR:"Unable to create selector call; possible resource configuration issue.",UNSPECIFIED_VIDEO_PLAYBACK_ERROR:"An unspecified video playback error occurred.",UNEXPECTED_CONDITION:"An unexpected condition was encountered.",UNEXPECTED_NULL_VALUE_FOR_AD:"Unexpected null value for ad.",UNEXPECTED_ABSENCE_OF_VIDEO:"Unable to locate a video node in SMIL response.",USER_GESTURE_REQUIRED:"A user gesture is required to initiate playback."}}(uvpjs.register("uvpjs")),function(a){var b=a._,c=Math.random();a.EventsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.EVENTS_MANAGER,sessionStartTime:0,sessionMilliseconds:0,uvpjsClockInterval:100,TENTH_SECOND:100,QUARTER_SECOND:250,HALF_SECOND:500,ONE_SECOND:1e3,THREE_SECONDS:3e3,internalNS:"EventsManager",init:function(a){if(this.debug=uvpjs.debug,!a||a!==c)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","EventsManager is a Singleton; obtain instance via EventsManager.getInstance()."));this.timerCBOs=[],this.registeredEventsTable={},this._startUVPJSClock(this.uvpjsClockInterval)},destroy:function(){this.registeredEventsTable={},this.timerCBOs=[],uvpjs.EventsManager.destroyInstance()},addEventListener:function(a,c){if(!(a&&b.isString(a)&&c&&b.isFunction(c)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var d=this._returnValidEvtTypeAndNameSpace(a);if(!1===d)return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsMgr addEventLr; ivalid namespace "+a},this.internalNS);var e=d[0],f=d[1];if(this.registeredEventsTable[e]||(this.registeredEventsTable[e]={}),this.registeredEventsTable[e][f])return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"addEventListener  DUPLICATE CALLBACK FOR EVENTTYPE.NS RETURN evtType = ",e," ns = ",f));this.debug&&uvpjs.log(this.DEBUG_ID,"addEventListener ADD LISTENER evtType = ",e," ns = ",f),this.registeredEventsTable[e][f]=c},removeEventListener:function(a){if(!a||!b.isString(a))return this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener evt_ns MISSING or not a STRING evt_ns = ",a),void this.dispatchEvent(this.eventTypes.UVPJS_ERROR,{msg:"EventsManager removeEventListener EventsManager removeEventListener evt_ns MISSING or not a STRING"},this.internalNS);var c=this._returnValidEvtTypeAndNameSpace(a);if(!1===c)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener INVALID EVENTTYPE OR BROKEN NAME SPACE evt_ns = ",a));var d=c[0],e=c[1];if(!this.registeredEventsTable[d]||!this.registeredEventsTable[d][e])return void(this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener name space not found in this.registeredEventsTable[evtType][ns] evt_ns = ",a));this.debug&&uvpjs.log(this.DEBUG_ID,"removeEventListener delete this.registeredEventsTable[evtType][ns]; evt_ns = ",a),delete this.registeredEventsTable[d][e]},dispatchEvent:function(a,c,d){var e={};if(!a||!b.isString(a))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:'EventsManager dispatchEvent evtType "'+a+'" MISSING, UNDEFINED, or INCORRECT TYPE *EXIT METHOD*'},this.internalNS);if(!b.isUndefined(c)&&!b.isPlainObject(c))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent payload IS NOT A PLAIN OBJECT"},this.internalNS);if(!b.isUndefined(d)&&!b.isString(d))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager dispatchEvent target IS NOT A STRING"},this.internalNS);var f=this.registeredEventsTable[a];if(f){b.isUndefined(c)&&(c={}),b.isUndefined(d)&&(d=""),e.type=a,e.payload=c,e.target=d;for(var g in f)f.hasOwnProperty(g)&&f[g](e)}},_returnValidEvtTypeAndNameSpace:function(a){var b=[],c=a.split(".");if(c.length<2)return!1;var d=c[0];c.shift();var e=c.join("_");return!(!this._validateEventType(d)||e.indexOf("undefined")>-1)&&(b[0]=d,b[1]=e,b)},_validateEventType:function(a){var b=!1,c=this.eventTypes;for(var d in c)if(c.hasOwnProperty(d)&&c[d]===a){b=!0;break}return b},getAllEventTypes:function(){return this.eventTypes},_startUVPJSClock:function(a){this.sessionStartTime=Date.now(),this.sessionMilliseconds=0,0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0,this.uvpjsClockId=setInterval(this.uvpClockTick.bind(this),a)},destroyUVPJSClock:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyUVPJSClock"),0!=this.uvpjsClockId&&clearInterval(this.uvpjsClockId),this.uvpjsClockId=0},addTimedEventCallback:function(a,c,d,e){this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ns =",c);var f={};if(!a||!b.isNumber(a)||!c||!b.isString(c)||!d||!b.isFunction(d)||e&&!b.isNumber(e)&&(e>=1||-1===e))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager addTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);a<this.uvpjsClockInterval&&(a=this.uvpjsClockInterval),c=c.split(".").join("_"),f={freq:a,ns:c,cb:d,rptCnt:-1,nextTime:Date.now()+a},e&&(f.rptCnt=e),this.debug&&uvpjs.log(this.DEBUG_ID,"addTimedEventCallback ADD Timed Callback freq =",a),this.timerCBOs.push(f)},removeTimedEventCallback:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback freq = ",a+" ns = "+c),!(a&&b.isNumber(a)&&c&&b.isString(c)))return void this.dispatchEvent(this.eventTypes.UVPJS_WARNING,{msg:"EventsManager removeTimedEventCallback MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS);var d,e,f=c.split(".");for(c=f.join("_"),d=this.timerCBOs.length;d--;)e=this.timerCBOs[d],e.freq===a&&e.ns===c&&(this.debug&&uvpjs.log(this.DEBUG_ID,"removeTimedEventCallback delete this.timerCBOs[freq][ns]; CBO.freq = ",e.freq+" CBO.ns = "+e.ns),this.timerCBOs.splice(d,1))},uvpClockTick:function(){this.sessionMilliseconds=Date.now()-this.sessionStartTime;var a,b,c=Date.now();for(a=this.timerCBOs.length-1;a>=0;a--)b=this.timerCBOs[a],c>=b.nextTime&&(b.cb(),b.nextTime=c+b.freq,-1!==b.rptCnt&&(b.rptCnt=b.rptCnt-1,0===b.rptCnt&&this.timerCBOs.splice(a,1)))},eventTypes:{SWITCH_AUDIO_TRACK:"switchAudioTrack",FIRST_GESTURE:"firstGesture",UVPJS_ERROR:"uvpjs_error",UVPJS_WARNING:"uvpjs_warning",NO_AD_CONTENT:uvpjs.EventType.NO_AD_CONTENT,PLAYER_DATA_LOADED:"onPlayerDataLoaded",CONTENT_DATA_LOADED:uvpjs.EventType.CONTENT_DATA_LOADED,RESOURCE_AD_DATA_LOADED:uvpjs.EventType.RESOURCE_AD_DATA_LOADED,PLAYER_LOADED:uvpjs.EventType.PLAYER_LOADED,PLAYBACK_LIBRARY_LOADED:uvpjs.EventType.PLAYBACK_LIBRARY_LOADED,PLAYER_INIT:uvpjs.EventType.PLAYER_INIT,PLATFORM_XML_LOADED:"onPlatformXmlLoaded",RESOURCE_LOAD_REQUEST:"resourceLoadRequest",RESOURCE_ADD_REQUEST:"resourceAddRequest",RESOURCE_REMOVE_REQUEST:"resourceRemoveRequest",RESOURCE_PLAYLIST_PAUSE:"resourcePlaylistPause",RESOURCE_PLAYLIST_RESUME:"resourcePlaylistResume",RESOURCE_PLAYLIST_ADVANCE:"resourcePlaylistAdvance",RESOURCE_PLAYLIST_DESTROY:"resourcePlaylistDestroy",RESOURCE_START:uvpjs.EventType.RESOURCE_START,RESOURCE_END:uvpjs.EventType.RESOURCE_END,CONTENT_START:uvpjs.EventType.CONTENT_START,CONTENT_END:uvpjs.EventType.CONTENT_END,AD_LOADED:uvpjs.EventType.AD_LOADED,AD_REQUEST:uvpjs.EventType.AD_REQUEST,AD_RESPONSE:uvpjs.EventType.AD_RESPONSE,AD_START:uvpjs.EventType.AD_START,AD_END:uvpjs.EventType.AD_END,AD_SKIPPED:uvpjs.EventType.AD_SKIPPED,AD_CLICK:uvpjs.EventType.AD_CLICK,AD_POD_START:uvpjs.EventType.AD_POD_START,AD_POD_END:uvpjs.EventType.AD_POD_END,AD_BLOCKED:uvpjs.EventType.AD_BLOCKED,AD_BUFFERING:uvpjs.EventType.AD_BUFFERING,AD_VOLUME_CHANGE:uvpjs.EventType.AD_VOLUME_CHANGE,CAPTIONS_READY:"onCaptionsReady",CAPTIONS_DISPLAYED:"onCaptionsDisplayed",CAPTION_AVAILABLE:"onCaptionAvailable",CAPTIONS_UNAVAILABLE:"onCaptionsUnavailable",CDN_UPDATED:uvpjs.EventType.CDN_UPDATED,CAPTIONS_ERROR:"onCaptionsError",SET_CAPTIONS_LANG:"onSetCaptionLang",CONTROL_LOAD_CAPTIONS:"controlLoadCaptions",CONTROL_SHOW_CAPTIONS:"controlShowCaptions",CONTROL_HIDE_CAPTIONS:"controlHideCaptions",AD_QUARTILE:"adQuartile",PLAYBACK_DURATION_RESUME:"playbackDurationResume",LIVE_SEGMENT_START:"onLiveSegmentStart",LIVE_SEGMENT_END:"onLiveSegmentEnd",VIDEO_STATE_CHANGE:"onStateChange",VIDEO_DURATION_CHANGE:"onVideoDurationChange",VIDEO_LOADING:"onVideoLoading",VIDEO_PROGRESS:uvpjs.EventType.VIDEO_PROGRESS,VIDEO_RESUME:"onVideoResume",VIDEO_DONE:uvpjs.EventType.VIDEO_DONE,VIDEO_CUEPOINT:"videoCuepoint",SEEK_DONE:"seekDone",CONTROL_PLAY:"controlPlay",CONTROL_PAUSE:"controlPause",CONTROL_STOP:"controlStop",CONTROL_CLEAR:"controlClear",CONTROL_MUTE:"controlMute",CONTROL_UNMUTE:"controlUnmute",CONTROL_VOLUME_CHANGE:"controlVolumeChange",CONTROL_VOLUME_SET:"controlVolumeSet",CONTROL_FULLSCREEN:"controlFullscreen",CONTROL_SEEK:"controlSeek",CONTROL_SEEK_TO_LIVE_POINT:"controlSeekToLivePoint",PREVIEW_BUTTON:"previewButton",DIAGNOSTIC_WINDOW_CLOSE_BUTTON:"diagnosticWindowCloseButton",USER_GESTURE:"controlGesture",RESIZE:"resize",CONTEXT_METADATA:"contextMetadata",FORCE_TRACK_SESSION_END:"forceTrackSessionEnd",SWITCH_REQUEST:"switchRequest",USE_DYNAMIC_SWITCHING:"useDynamicSwitching",MAXIMUM_BITRATE_ALLOWED:"maximumBitrateAllowed",MINIMUM_BITRATE_ALLOWED:"minimumBitrateAllowed",VIDEO_TRANSITION_START:"onVideoTransitionStart",LEVEL_LOADED:"onLevelLoaded",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_NOT_AVAILABLE:"videoNotAvailable",DATA_LOADING_ERROR:"dataLoadingError",VIDEO_GEO_BLOCKED:"videoGeoBlocked",VIDEO_ISP_BLOCKED:"videoIspBlocked",VIDEO_DEVICE_BLOCKED:"videoDeviceBlocked",AD_LOAD_ERROR:"adLoadError",AD_PLUGIN_CONTENT_PAUSE_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_PAUSE_REQUEST,AD_PLUGIN_CONTENT_RESUME_REQUEST:uvpjs.EventType.AD_PLUGIN_CONTENT_RESUME_REQUEST,PAUSE_AD_REQUEST:"pauseAdRequest",PAUSE_AD_LOADED:"pauseAdLoaded",CONTAINER_RESIZE:"containerResize",QOS_METADATA:"QOSMetadata",CONTENT_FACADE_CREATED:"contentFacadeCreated",AD_ERROR:"adError",PLAYER_START_ERROR:"playerStartError",VIDEO_START_ERROR:"videoStartError",VIDEO_PLAYBACK_ERROR:"videoPlaybackError"}}),a.EventsManager._instance=null,a.EventsManager.destroyInstance=function(){this._instance=null},a.EventsManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.EventsManager(c)),this._instance}}(uvpjs.register("uvpjs")),function(a){var b="www.nielsen.com";a.AbstractId3Parser=uvpjs.Class.subClass({init:function(a){this.findNielsen=a.findNielsen,this.dataCallback=a.dataCallback,this.ownerIds=this.assembleOwnerIds(a.ownerIdList,this.findNielsen),this.idLengths=this.setLengths(this.ownerIds),this.totalIds=this.idLengths.length},destroy:function(){this.dataCallback=null},parse:function(a){throw new Error("Abstract method parse() must be implemented in subclass")},setLengths:function(a){for(var b=a.length,c=[];b--;)c[b]=a[b].length;return c},assembleOwnerIds:function(a,c){var d,e,f=[];if("string"==typeof a)for(d=a.split(","),e=d.length;e--;)f.push(d[e].trim());return c&&-1===f.indexOf(b)&&f.push(b),f}})}(uvpjs.register("uvpjs")),function(a){a.FrameId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(a){var b,c=a.length;for(b=0;b<c;b++)a[b].data&&this.findId3(a[b])},findId3:function(a){var b,c,d,e,f,g,h,i=0,j=a.data;h=this.readStr(j,i,3),i+=3,"ID3"===h&&(i+=3,b=127&j[i++],c=127&j[i++],d=127&j[i++],e=127&j[i++],f=(b<<21)+(c<<14)+(d<<7)+e,g=i+f,this.findId3PrivateFrame(a,i,g))},findId3PrivateFrame:function(a,b,c){for(var d,e=a.data;b+8<=c;)d=this.readStr(e,b,4),b+=4,e[b++],e[b++],e[b++],e[b++],e[b++],e[b++],"PRIV"===d&&this.parseFrame(a,b)},parseFrame:function(a,b){for(var c,d,e,f=this.idLengths,g=this.totalIds,h=a.data;g--;)if(e=f[g],(d=this.readStr(h,b,e))===this.ownerIds[g]){b+=e,c="www.nielsen.com"===d?this.parseNielsen(d,h,b):this.readStr(h,++b,h.length),this.dataCallback({name:d,data:c,pts:a.pts});break}},parseNielsen:function(a,b,c){var d=a+this.readStr(b,c,b.length-(c+2));return 249===d.length?d:null},readStr:function(a,b,c){var d="",e=b||0,f=b+c;do{d+=String.fromCharCode(a[e++])}while(e<f);return d}})}(uvpjs.register("uvpjs")),function(a){a.TrackId3Parser=uvpjs.AbstractId3Parser.subClass({parse:function(a){if(1===a.length){var b=a[0];if("PRIV"===b.value.key)for(var c=0;c<this.ownerIds.length;c++){var d=this.ownerIds[c];-1!==b.value.info.indexOf(d)&&this.dataCallback({name:d,data:"www.nielsen.com"===d?b.value.info:String.fromCharCode.apply(null,new Uint8Array(b.value.data)),pts:b.startTime})}}}})}(uvpjs.register("uvpjs")),function(a){a.SdkLoadManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.SDK_LOAD_MANAGER,initCallback:null,cdo:null,historyItems:{},getHistory:function(){var a={};for(var b in this.historyItems)a[b]=this.historyItems[b];return a},sdkModules:{AkamaiQOSPluginJS:{isDefined:function(){return void 0!==window.AkaHTML5MediaAnalytics},getPath:function(a){var b="//79423.analytics.edgesuite.net/js/csma.js";return b=a&&a.getModuleParam("AkamaiQOSPluginJS","libpath")||b,uvpjs.mediaCapabilities.isSecure()?[b.replace("edgesuite","edgekey")]:[b]}},ConvivaQOSPluginJS:{isDefined:function(){return void 0!==window.Conviva},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/conviva-uvpjs-sdk.min.js"]}},ComScore_ss:{isDefined:function(){return void 0!==window.ns_&&void 0!==window.ns_.ReducedRequirementsStreamingAnalytics},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/comscore/comscore.streaming.6.1.1.171219.min.js"]}},MuxQOSPluginJS:{isDefined:function(){return void 0!==window.mux},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/mux.js"]}},NielsenTracking_SDK:{isDefined:function(){return void 0!==window.NOLCMB},getPath:function(){return["//cdn-gl.imrworldwide.com/novms/js/2/ggcmb510.js"]}},SiteCatalyst:{isDefined:function(){return!("undefined"==typeof ADB||"undefined"===a._.get(ADB,"va.Heartbeat"))},getPath:function(a){var b="2.3.0";try{var c=a.modules.find(function(a,b){return"SiteCatalyst"===a.name}),d=c.params.find(function(a,b){return"appMeasurementVersion"===a.name});d&&d.value&&(b=d.value)}catch(a){}var e=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-"+b+".min.js",f=uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js";return a.sessionOptions.usesTealium?[f]:[e,f]}},OzTam:{isDefined:function(){return void 0!==window.OzTAMService},getPath:function(){return[uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/oztam-service.js"]}}},init:function(a,b){var c=[],d=a.getModules(),e=uvpjs.util;if(this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init",a),this.cdo=a,this.initCallback=b,e.isEmpty(d))return void this.invokeCallbackWithHistory();a.getModule("MuxQOSPluginJS")||d.push({name:"MuxQOSPluginJS",enabled:"true"});for(var f=d.length;f--;){var g,h,i=d[f],j=i.name,k=this.sdkModules[i.name];if(i.enabled&&k)if(k.isDefined())this.addToHistory({name:i.name,loaded:!0});else for(g=k.getPath(a),h=g.length;h--;)c.push({name:j,path:g[h]})}e.isEmpty(c)?this.invokeCallbackWithHistory():this.bulkLoad(c)},invokeCallbackWithHistory:function(){var a=this.initCallback,b=this.getHistory();setTimeout(function(){a(b)},1)},bulkLoad:function(a){var b=a,c=[],d=(this.handleAllLoadResults,function(a,d,f){c.push({name:a,result:f}),d.destroy(),0===b.length?this.handleAllLoadResults(c):e()}),e=function(){var a=b.shift(),c=new uvpjs.CodeLoader;c.loadScript(a.path,d.bind(this,a.name,c))}.bind(this);e()},handleAllLoadResults:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"handleAllLoadResults",a);for(var b=a.length;b--;){var c=a[b];c.result.error&&uvpjs.warn(this.DEBUG_ID,"Tracking  SDK load error: "+c.result.error),this.addToHistory({name:c.name,loaded:!c.result.error})}this.initCallback(this.getHistory())},addToHistory:function(a){if(!a.name)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"module name not found",a));!1!==this.historyItems[a.name]&&(this.historyItems[a.name]=!a.error&&a.loaded)},destroy:function(){this.initCallback=null,this.cdo=null,this.historyItems=null}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.ResourcePlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PLAYLIST_MANAGER,init:function(a){this.debug=uvpjs.debug,this.vidContId="",this.cviMgr={},this.eventsMgr={},this.cviModel={},this.internalNS="",this.rscProviders=[],this.usedRPs=[],this.currRP={},this.p2pClient=a.p2pClient||null,this.multiCdnClient=a.multiCdnClient||null,this.mc=uvpjs.mediaCapabilities,this.suppressFacadePlay=a.suppressFacadePlay,this.deferLoadingCaptions=a.deferLoadingCaptions,this.playlistPaused=!1,!b.isEmpty(a)&&this.initialize(a.vidContId,a.cviMgr)},initialize:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize  vidContId = ",a),!b.isString(a)||!b.isObject(c))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"initialize BAD PARAMS"));this.vidContId=a,this.cviMgr=c,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.internalNS="."+this.vidContId+".rpm",this.containers=null,this._addEventListeners()},setContainers:function(a){this.containers=a},setCaptionStyle:function(a){!uvpjs.util.isEmpty(this.currRP)&&this.currRP.setCaptionStyle(a)},onResourceLoadRequest:function(a){if(a.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceLoadRequest evtObj.payload.rcObj = ",a.payload.rcObj),this.playlistPaused=!1;var b=this._createResourceProvider(a.payload.rcObj);this.rscProviders.unshift(b),this.playlistInterruptionCleanup()}},onResourceAddRequest:function(a){if(a.target===this.vidContId){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest evtObj.payload.rcObjs= ",a.payload.rcObjs);var c,d,e=a.payload.rcObjs,f=e.length;for(c=0;c<f;c++)d=this._createResourceProvider(e[c]),this.rscProviders.push(d);b.isEmpty(this.currRP)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourceAddRequest finished creating Resource Providers and there is no Current Resource Provider -> call this._loadNextRP()"),this._loadNextRP())}},onResourceRemoveRequest:function(a){if(a.target===this.vidContId){for(var b,c=a.payload.rcObjs,d=c.length,e=this.rscProviders,f=this.usedRPs,g=!1,h=!uvpjs.util.isEmpty(this.currRP);d--;)b=c[d],this.removeFromList(b,e),this.removeFromList(b,f),h&&!g&&(g=this.isMatchingResource(b,this.currRP.rco.rcoSeed));g&&this.advancePlaylist()}},removeFromList:function(a,b){for(var c=b.length;c--;)this.isMatchingResource(a,b[c].rco.rcoSeed)&&b.splice(c,1)},isMatchingResource:function(a,b){var c=uvpjs.util;return a.type===b.type&&(!c.isEmpty(a.pid)&&a.pid===b.pid||!c.isEmpty(a.assetURL)&&a.assetURL===b.assetURL||!c.isEmpty(a.selectorCall)&&a.selectorCall===b.selectorCall)},onResourcePlaylistPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistPause this.vidContId = ",this.vidContId),a.target!==this.vidContId||this.playlistPaused||(this.playlistPaused=!0)},onResourcePlaylistResume:function(a){a.target===this.vidContId&&this.playlistPaused&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume this.vidContId = ",this.vidContId),this.playlistPaused=!1,b.isEmpty(this.currRP)&&this.rscProviders.length>0&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistResume  (_.isEmpty(this.currRP) && this.rscProviders.length > 0) LOAD NEXT RP this._loadNextRP();"),this._loadNextRP()))},onResourcePlaylistAdvance:function(a){a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistAdvance this.vidContId = ",this.vidContId),this.advancePlaylist())},onResourcePlaylistDestroy:function(a){a.target===this.vidContId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onResourcePlaylistDestroy this.vidContId = ",this.vidContId),this.rscProviders=[],this.playlistInterruptionCleanup(),this.currRP=null)},advancePlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"advancePlaylist"),this.playlistPaused=!1,this.playlistInterruptionCleanup()},loadDynamicAdCall:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),b.isEmpty(this.currRP)||b.isEmpty(this.currRP.rco)||this.currRP.rco.type!==this.mc.RP_IMA?this.debug&&uvpjs.warn(this.DEBUG_ID,"loadDynamicAdCall trying to load a dynamic ad call but currRP is either empty or not rco.type === RP_IMA"):this.currRP.loadDynamicAdCall(a)},forceDynamicMidrollPodEnd:function(){!b.isEmpty(this.currRP)&&this.currRP.forceDynamicMidrollPodEnd&&this.currRP.forceDynamicMidrollPodEnd()},playlistInterruptionCleanup:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup this.vidContId = ",this.vidContId),b.isEmpty(this.currRP)||b.isNull(this.currRP.rco)?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup NO PREVIOUS RP so this._loadNextRP();"),this._loadNextRP()):this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"playlistInterruptionCleanup CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE. non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())},_createResourceProvider:function(a){var b,c,d={rco:a,cviMgr:this.cviMgr,vidContId:this.vidContId,containers:this.containers,p2pClient:this.p2pClient,deferLoadingCaptions:this.deferLoadingCaptions,multiCdnClient:this.multiCdnClient};switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_createResourceProvider rcObj = ",a),a.type){case this.mc.RP_URL:b=new uvpjs.RP_URL(d);break;case this.mc.RP_PLATFORM:b=new uvpjs.RP_Platform(d);break;case this.mc.RP_DAI:c=a.useSsb()?uvpjs.DaiSsbResourceProvider:uvpjs.DaiResourceProvider,b=new c(d);break;case this.mc.RP_IMA:b=new uvpjs.RP_IMA(d);break;case this.mc.RP_MDIALOG:b=new uvpjs.RP_Mdialog(d)}return b},_loadNextRP:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = ",this.rscProviders.length),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.playlistPaused = ",this.playlistPaused),b.isEmpty(this.currRP)||b.isNull(this.currRP.rco)||(this.currRP.rco.type===this.mc.RP_IMA?(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.         IMA case calling -> this.currRP.cleanUpRP_IMA()"),this.currRP.cleanUpRP_IMA()):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP CLEANUP PREVIOUS RP BEFORE LOADING NEXT ONE.     non-IMA case calling -> this.currRP.cleanUp()"),this.currRP.cleanUp())),this.rscProviders.length>0&&!this.playlistPaused?(this.currRP=this.rscProviders.shift(),this.usedRPs.push(this.currRP),this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP JUST AFTER SETTING NEW currRP  this.currRP.rco.id = ",this.currRP.rco.id),this.currRP.loadData(this.rpDataLoadCB.bind(this),this.rpDataLoadErrorCB.bind(this))):(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadNextRP this.rscProviders.length = 0 OR this.playlistPaused TRUE SETTING NEW this.currRP = {}; "),this.currRP={})},rpDataLoadCB:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB"),this.debug&&uvpjs.log(this.DEBUG_ID,"rpDataLoadCB this.currRP =",this.currRP),!b.isObject(this.currRP))return this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadCB  WARNING !_.isObject(this.currRP) RETURN WITHOUT PLAYING VIDEO"),void this.advancePlaylist();this.currRP.loadVideoAndBeginPlayback(this.suppressFacadePlay)},rpDataLoadErrorCB:function(a){this.debug&&uvpjs.warn(this.DEBUG_ID,"rpDataLoadErrorCB  WARNING Data Load Error Skip current video rpDataLoadErrorCB errMsg = ",a.message),this.eventsMgr.dispatchEvent(a.eventType,{errorInfo:a},this.vidContId),this.advancePlaylist()},resourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceStart dispatch RESOURCE_START rcoSeed = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_START,{rco:a},this.vidContId)},resourceEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch RESOURCE_END rcoSeed = ",a),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd this.currRP.rco = ",this.currRP.rco),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_END,{rco:a,playlistLength:this.rscProviders.length},this.vidContId),this.currRP&&this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch AFTER this.currRP.rco = ",this.currRP.rco),this.rscProviders.length>0&&!b.isEmpty(this.currRP)&&b.isNull(this.currRP.rco)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"resourceEnd dispatch _loadNextRP()"),this._loadNextRP())},_addEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS,this.onResourceLoadRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS,this.onResourceAddRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS,this.onResourceRemoveRequest.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS,this.onResourcePlaylistPause.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS,this.onResourcePlaylistResume.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS,this.onResourcePlaylistAdvance.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS,this.onResourcePlaylistDestroy.bind(this))},_removeEventListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners this.internalNS = ",this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE+this.internalNS),this.eventsMgr.removeEventListener(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY+this.internalNS)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.VideoControlInterface=uvpjs.Class.subClass({AD_SETTINGS:"AdSettings",init:function(){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_CONTROL_INTERFACE,this.vciReadyCB={},this.skinMgr=null,this.DOMMgr={},this.vidContId="",this.eventsMgr={},this.CDO={},this.CVI_Mgr={},this.mc=uvpjs.mediaCapabilities,this.rcoIdIndex=0,this.namespace=null,this.diagnostic=null,this._loadSkinFlag=!1,this._vciReadySent=!1,this._playBlankVideoDone=!1,this._previewButtonDone=!1,this._playBlankVideoCallback=null,this._replayRco=null,this._isUnmutedAutoplay=!1,this._isMutedAutoplay=!1,this._autoPlay=!1,this.hasDispatchedFirstGesture=!1,this.useBrowserNativeControls=!1,this.isWaitingForFirstTouch=!1,this.isPreparedForAutoplay=!1,this.autoplayRestrictionChecked=!1,this.contentStartReceived=!1},initialize:function(a,c,d,e,f){var g=!0===f.skin;if(this.debug&&uvpjs.log(this.DEBUG_ID,"initialize vidContId =",a),!(b.isString(a)&&b.isObject(c)&&b.isObject(d)&&b.isFunction(e)))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"-"));this.vidContId=a,this.namespace=".vci_"+a,this.eventsMgr=c,this.CDO=d,this.vciReadyCB=e,this._usesIMA=f.usesIMA,this._loadSkinFlag=g,this._isPreviewBtnInternallyManaged=g,this._isUnmutedAutoplay=f.enableUnmutedAutoplay,this._isMutedAutoplay=f.enableMutedAutoplay,this._autoPlay=this._isUnmutedAutoplay||this._isMutedAutoplay,this.playRequiresUserGesture=this.mc.playRequiresUserGesture(this._autoPlay),this.listenForAdEvents(),this.useBrowserNativeControls=!!f.useBrowserControls,this.CVI_Mgr=new uvpjs.CoreVideoInstanceManager({vidContId:a,eventsMgr:c,CDO:d,playerOptions:f,suppressFacadePlay:this.checkNativeAutoplay(f.enableNativeMobileAutoplay),readyCallback:this.handleCviMgrReady.bind(this,f)})},destroy:function(){this._replayRco=null,this.skinMgr&&this.skinMgr.destroy(),this.diagnostic&&this.diagnostic.destroy(),removeResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this))},handleCviMgrReady:function(a){var b={skin:!0===a.skin,isUnmutedAutoplay:this._isUnmutedAutoplay,isMutedAutoplay:this._isMutedAutoplay,customCSS:a.customCSS,enableReplay:a.enableReplay,previewImage:a.previewImage,themeName:a.themeName,controls:a.controls,template:a.template};this.CVI_Mgr.setInitialPlaybackType(this._autoPlay,this._isMutedAutoplay),this.useBrowserNativeControls&&this.CVI_Mgr.setNativeControls(!0),this.DOMMgr=new uvpjs.DOMManager({containerID:this.vidContId,createControls:this._loadSkinFlag,createAds:this._usesIMA,useMutedAttribute:this._isMutedAutoplay,useInlinePlayAttribute:a.playsInline||this.mc.requiresInlinePlayAttribute(this._autoPlay),useAutoplayAttribute:this.checkNativeAutoplay(a.enableNativeMobileAutoplay),callback:this.onDOMReady.bind(this,b)}),this.DOMMgr.initialize()},listenForAdEvents:function(){this.addEventListener(uvpjs.EventType.AD_LOADED+this.namespace,this.onAdLoaded.bind(this)),this.addEventListener(uvpjs.EventType.AD_START+this.namespace,this.onAdStart.bind(this)),this.addEventListener(uvpjs.EventType.AD_END+this.namespace,this.onAdEnd.bind(this)),this.addEventListener(uvpjs.EventType.AD_POD_END+this.namespace,this.onAdPodEnd.bind(this)),this.addEventListener(uvpjs.EventType.CONTENT_START+this.namespace,this.onContentStart.bind(this)),this.addEventListener(this.eventsMgr.eventTypes.AD_CLICK+this.namespace,this.hAdClick.bind(this))},onAdPodEnd:function(){this.isWaitingForFirstTouch=!1,this.removeEventListener(uvpjs.EventType.AD_POD_END+this.namespace)},onAdLoaded:function(a){},onAdStart:function(a){var b=a.payload.adData;this.DOMMgr.showAdContainer(!0),!this.autoplayRestrictionChecked&&this.checkAutoplayRestriction(b),b.isCustomClickTrackingUsed&&this.DOMMgr.showAdClickElement(!0)},onAdEnd:function(a){this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},onContentStart:function(){this.contentStartReceived=!0,this.isWaitingForFirstTouch=!1,this.DOMMgr.showAdClickElement(!1),this.DOMMgr.showAdContainer(!1)},hAdClick:function(){if(this.handleFirstGesture(),this.skinMgr){var a=this.skinMgr,b=this.mc.PAUSED;setTimeout(function(){a.setPlaystate(b)},200)}},setAdCallParams:function(a){this.CVI_Mgr.setAdCallParams(a)},checkAutoplayRestriction:function(a){this.autoplayRestrictionChecked=!0,!this.contentStartReceived&&"pre"===a.adType&&"ima"===a.adServerName&&this._isMutedAutoplay&&!this.mc.isSingleVideoIma()&&!this.mc.supportsUnmutedAutoplay()&&!this.isPreparedForAutoplay&&(this.isWaitingForFirstTouch=!0)},dispatchFirstGesture:function(a){this.eventsMgr.dispatchEvent(uvpjs.EventType.FIRST_GESTURE,a,this.vidContId)},prepForRestrictedAutoplay:function(a){var b=this.dom.video.el,c=function(){this.isPreparedForAutoplay=!0,b.removeEventListener("play",c,!1),b.muted=!1,a&&(this._playBlankVideoDone=!0,this._playBlankVideoCallback())}.bind(this);this.debug&&uvpjs.log(this.DEBUG_ID,"Prep for restricted autoplay..."),b.src=this.mc.getPreferredPlaceholderURL(),b.addEventListener("play",c,!1),b.muted=!0,b.load();var d=b.play();void 0!==d&&d.then(Function.prototype).catch(function(a){console.warn("UVPJS:VCI.prepForRestrictedAutoplay: priming Promise rejected.")})},handleFirstGesture:function(a){this.isWaitingForFirstTouch&&(this.isWaitingForFirstTouch=!1,this.prepForRestrictedAutoplay()),this.hasDispatchedFirstGesture||(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FIRST_GESTURE,{info:a||null},this.vidContId),this.hasDispatchedFirstGesture=!0)},onDOMReady:function(a){if(this.dom=this.DOMMgr.getDOM(),this.useBrowserNativeControls?(this.CVI_Mgr.setNativeControls(!0),this.dom.video.el.setAttribute("controls","controls")):addResizeListener(this.dom.outer.el,this._dispatchResizeEvent.bind(this)),this.CVI_Mgr.setContainers({playerDom:this.dom.outer.el,contentVideoDom:this.dom.content.el}),this.mc.isDesktop()&&!0===this.CDO.getSessionOption("enableDiagnosticWindow")&&(this.diagnostic=new uvpjs.Diagnostic({eventsMgr:this.eventsMgr,containerEl:this.dom.outer.el,videoEl:this.dom.video.el})),!this.useBrowserNativeControls&&this._loadSkinFlag)return void(this.skinMgr=new uvpjs.SkinManager({vci:this,skinReadyCallback:this.onVCIReady.bind(this),skinConfig:a}));this.onVCIReady()},checkNativeAutoplay:function(a){return a&&this.mc.supportsIntelligentMobileAutoplay()},onVCIReady:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady"),!this._vciReadySent){if(!this._autoPlay&&this._isPreviewBtnInternallyManaged&&!this._previewButtonDone)return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_INIT,{player:this},this.vidContId);this._usesIMA&&!this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onVCIReady   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses(this.DOMMgr.getAdClickElement())),this._isMutedAutoplay&&this.mute(),this._vciReadySent=!0,this.vciReadyCB(this)}},loadDynamicAdCall:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall adCall =",a),!b.isString(a))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"loadDynamicAdCall !_.isString(adCall)"));this.CVI_Mgr.loadDynamicAdCall(a)},forceDynamicMidrollPodEnd:function(){this.CVI_Mgr.forceDynamicMidrollPodEnd()},onPreviewButton:function(a){return uvpjs.log(this.DEBUG_ID,"onPreviewButton"),uvpjs.util.isFunction(a)?(this._usesIMA&&this.playRequiresUserGesture&&(this.debug&&uvpjs.log(this.DEBUG_ID,"onPreviewButton   call this.CVI_Mgr.constructSharedIMAClasses()"),this.CVI_Mgr.constructSharedIMAClasses()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PREVIEW_BUTTON,{},this.vidContId),this._previewButtonDone=!0,this.playRequiresUserGesture&&!this._playBlankVideoDone?(uvpjs.log(this.DEBUG_ID,"onPreviewButton playing blank video in mobile."),this._playBlankVideoCallback=a,void this.playBlankVideo()):(uvpjs.log(this.DEBUG_ID,"onPreviewButton executing callback in desktop."),void a())):void(this.debug&&uvpjs.error(this.DEBUG_ID,"onPreviewButton method called without a callback function."))},canOverrideUserGesture:function(){return!this.playRequiresUserGesture||this.playRequiresUserGesture&&this._playBlankVideoDone},overrideUserGesture:function(a){var b,c;if(!0!==a&&!this.canOverrideUserGesture())return b=uvpjs.ErrorInfo,c=this.eventsMgr,void c.dispatchEvent(c.eventTypes.PLAYER_START_ERROR,{errorInfo:new b({eventType:c.eventTypes.PLAYER_START_ERROR,errorCode:b.errorCodes.USER_GESTURE_REQUIRED,message:b.messages.USER_GESTURE_REQUIRED,isFatal:!1})},this.vidContId);this.onPreviewButton(this.onVCIReady.bind(this))},addEventListener:function(a,c){if(!a||!b.isString(a)||!b.isFunction(c))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.vidContId);this.eventsMgr.addEventListener(a,c)},removeEventListener:function(a){if(!a||!b.isString(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface removeEventListener !evt || evt !== string INVALID RETURN"},this.vidContId);this.eventsMgr.removeEventListener(a)},getVidContId:function(){return this.vidContId},playBlankVideo:function(){uvpjs.log(this.DEBUG_ID,"playBlankVideo"),this.prepForRestrictedAutoplay(!0)},loadAndPlayResource:function(a){var c;if(this.debug&&uvpjs.log(this.DEBUG_ID,"loadAndPlayResource -> dispatches RESOURCE_LOAD_REQUEST event    rcObj = ",a),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAndPlayResource was called before a mobile touch event."),this._playBlankVideoCallback=this.loadAndPlayResource.bind(this,a),void this.playBlankVideo();c=this.createResourceConfig(a),b.isObject(c)?this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_LOAD_REQUEST,{rcObj:c},this.vidContId):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface  loadAndPlayResource INVALID RESOURCE CONFIG OBJECT RETURN"},this.vidContId)},addResourcesToPlaylist:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"addResourcesToPlaylist rcObjsArray = ",a),this.playRequiresUserGesture&&!this._playBlankVideoDone)return this.debug&&uvpjs.warn(this.DEBUG_ID,"addResourcesToPlaylist was called before a mobile touch event."),this._playBlankVideoCallback=this.addResourcesToPlaylist.bind(this,a),void this.playBlankVideo();if(b.isArray(a)&&a.length>0){var c,d,e=[];for(c in a)d=this.createResourceConfig(a[c]),b.isObject(d)?e.push(d):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist INVALID RESOURCE CONFIG OBJECT IN rcObjsArray DO NOT ADD TO PLAYLIST"},this.vidContId);e.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_ADD_REQUEST,{rcObjs:e},this.vidContId)}else this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoControlInterface addResourcesToPlaylist rcObjsArray argument is EMPTY OR NOT AN ARRAY    RETURN"},this.vidContId)},createResourceConfig:function(a){var b,c,d,e,f,g,h,i="",j=!1,k=a.type===this.mc.RP_IMA,l="",m=!1,n=null;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createResourceConfig rcObj = ",a),h=this.prevalidateRcObj(a),h.error)return i="Resource configuration error: "+h.message+" this.vidContId = "+this.vidContId,this.dispatchStartError(i,null),!1;switch(a.type){case this.mc.RP_URL:c=uvpjs.RCO_URL;break;case this.mc.RP_PLATFORM:c=uvpjs.RCO_Platform;break;case this.mc.RP_IMA:this._usesIMA||(i="Resource type is IMA, but sessionOptions.usesIMA is set to FALSE",j=!0),m=!0,c=uvpjs.RCO_IMA;break;case this.mc.RP_MDIALOG:c=uvpjs.RCO_Mdialog;break;case this.mc.RP_DAI:m=!a.useSsb,c=uvpjs.DaiRco;break;default:l="Unknown resource type "+a.type,i="VCI createResourceConfig "+l+"; this.vidContId = "+this.vidContId,j=!0}return j?(this.dispatchStartError(i,null),!1):(this.rcoIdIndex++,b=this.rcoIdIndex+"_"+this.vidContId,d=new c(a,b,this.vidContId),h=d.getValidationInfo(),m&&this.checkForAdBlocker()?(!0===h.missingSDK&&(n=k?"IMA":"DAI"),this.dispatchAdBlocked(n,!0),!1):h.error?(i="VCI error initializing RCO: "+h.message,e=uvpjs.ErrorInfo,f=e.errorCodes,!0===h.missingSDK?(g=k?f.IMA_SDK_MISSING:f.DAI_SDK_MISSING,this.dispatchStartError(i,g)):this.dispatchStartError(i,null),!1):(this._replayRco=a,d))},prevalidateRcObj:function(a){var b=uvpjs.util,c="",d=!1;return b.isPlainObject(a)?b.isDefinedString(a.type)||(c="Invalid resource type encountered",d=!0):(c="Invalid resource config object format",d=!0),{error:d,message:c}},dispatchStartError:function(a,b){this.debug&&uvpjs.error(this.DEBUG_ID,a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:b||uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:uvpjs.ErrorInfo.messages.UNEXPECTED_CONDITION+" "+a,isFatal:!0})},this.vidContId)},dispatchAdBlocked:function(a,b){var c=a?" (Missing "+a+" SDK)":"";this.debug&&uvpjs.error(this.DEBUG_ID,"Ad Blocking detected"+c,this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED+c,isFatal:!!b})},this.vidContId)},checkForAdBlocker:function(){return uvpjs.adUtil.checkForAdBlocker(this.CVI_Mgr.cviModel)},pausePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_PAUSE,{},this.vidContId)},resumePlaylist:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_RESUME,{},this.vidContId)},advancePlayList:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_ADVANCE,{},this.vidContId)},removeResourcesFromPlaylist:function(a){b.isArray(a)&&a.length>0&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_REMOVE_REQUEST,{rcObjs:a},this.vidContId)},destroyPlaylist:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroyPlaylist RESOURCE_PLAYLIST_DESTROY this.vidContId = ",this.vidContId),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.RESOURCE_PLAYLIST_DESTROY,{},this.vidContId)},playVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.playVideoRequest()},pauseVideo:function(a){void 0===a&&(a={}),this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo this.vidContId = ",this.vidContId),this.CVI_Mgr.pauseVideoRequest(a)},replayVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"replayVideo",this._replayRco),this._replayRco&&this.loadAndPlayResource(this._replayRco)},seekTo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToRealTime = ",a),isNaN(a)||this.CVI_Mgr.seekToRequest(a)},seekToLive:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"seekToLive Attempt"),this.CVI_Mgr.seekToLiveRequest()},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"stopVideo"),this.CVI_Mgr.stopVideoRequest()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearVideo"),this.CVI_Mgr.clearVideoRequest()},mute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"mute"),this.CVI_Mgr.muteRequest()},unMute:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"unMute"),this.CVI_Mgr.unmuteRequest()},disableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",a),b.isEmpty(this.skinMgr)||b.isEmpty(a)||this.skinMgr.disableButton(a)},enableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",a),b.isEmpty(this.skinMgr)||b.isEmpty(a)||this.skinMgr.enableButton(a)},getPlayerMuted:function(){return this.CVI_Mgr.getPlayerMuted()},setVolume:function(a){b.isNaN(a)||this.CVI_Mgr.volumeChangeRequest(a)},getVolume:function(){return this.CVI_Mgr.getVolume()},loadCaptions:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"loadCaptions captionsPath = ",a),b.isString(a)&&this.CVI_Mgr.loadCaptionsRequest(a)},showCaptions:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"showCaptions"),this.CVI_Mgr.showCaptionsRequest(a)},setCaptionLanguage:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionLanguage to "+a),this.CVI_Mgr.setCaptionLanguage(a)},getCaptionInfo:function(){return this.CVI_Mgr.getCaptionInfo()},hideCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideCaptions"),this.CVI_Mgr.hideCaptionsRequest()},showDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"showDiagnosticWindow"),this.diagnostic&&this.diagnostic.show()},hideDiagnosticWindow:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"hideDiagnosticWindow"),this.diagnostic&&this.diagnostic.hide()},getAudioTrackInfo:function(){return this.CVI_Mgr.getAudioTrackInfo()},setAudioTrack:function(a){this.CVI_Mgr.setAudioTrack(a)},usesDiagnosticWindow:function(){return!!this.diagnostic},setCaptionsStyle:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyle",a),this.CVI_Mgr.setCaptionsStyleRequest(a)},setCaptionsStyleProperty:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsStyleProperty",a,b),this.CVI_Mgr.setCaptionsStyleRequest([{name:a,value:b}])},getCaptionsStyle:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this.CVI_Mgr.getCaptionsStyleRequest()},setCaptionsCueProperty:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"setCaptionsCueProperty",a,b),this.CVI_Mgr.setCaptionsCuePropertyRequest(a,b)},setSize:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"setSize  width = "+a+"  height = "+c),b.isNumber(a)||b.isNumber(c)||this.CVI_Mgr.resizeRequest(a,c)},getAutoplayInfo:function(){return this.mc.getAutoplayInfo()},setUserGesture:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"setUserGesture info = ",a),!b.isEmpty(a)&&(b.isArray(a)&&a.length>0||uvpjs.util.isDefinedString(a))&&this.CVI_Mgr.setUserGesture(a)},setQosMetadata:function(a,c){this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata vendorArray = ",a),this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata   paramsObj = ",c),b.isEmpty(a)||b.isEmpty(c)||!b.isArray(a)||(this.debug&&uvpjs.log(this.DEBUG_ID,"setQosMetadata dispatch QOS_METADATA event"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.QOS_METADATA,{vendorArray:a,paramsObj:c},this.vidContId))},fullscreen:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"fullscreen onOff = ",a),b.isBoolean(a)&&this.CVI_Mgr.fullscreenRequest(a)},getCurrentPlaybackState:function(){return this.CVI_Mgr.getCurrentPlaybackState()},getContentVideoData:function(){return this.CVI_Mgr.getContentVideoData()},getAdVideoData:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getAdVideoData"),this.CVI_Mgr.getAdVideoData()},getPlayerSessionId:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getPlayerSessionId"),this.CVI_Mgr.getPlayerSessionId()},setPageContextMetadata:function(a){a&&b.isPlainObject(a)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"setPageContextMetadata",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTEXT_METADATA,{contextMetadata:a},this.vidContId))},forceTrackSessionEnd:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.FORCE_TRACK_SESSION_END,{},this.vidContId)},removeNativeControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"removeNativeControls onOff = ",a),b.isBoolean(a)&&this.CVI_Mgr.setNativeControls(a)},useDynamicSwitching:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"useDynamicSwitching",a),b.isBoolean(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USE_DYNAMIC_SWITCHING,{data:a},this.vidContId)},switchUp:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchUp"),this.switchTo("up")},switchDown:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"switchDown"),this.switchTo("down")},switchBitrateTo:function(a){if(!a||"number"!=typeof a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate based on the value:",a));this.debug&&uvpjs.log(this.DEBUG_ID,"switch to bitrate:",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:a},this.vidContId)},switchTo:function(a){var b="up,down",c=null!==a&&void 0!==a&&"string"==typeof a&&-1!==b.indexOf(a),d=null!==a&&void 0!==a&&"number"==typeof a&&!isNaN(a);if(!c&&!d)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to value",a,c,d,typeof a));this.debug&&uvpjs.log(this.DEBUG_ID,"Switch To:",a),d?this.switchBitrateTo(a):this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.SWITCH_REQUEST,{bitrate:a},this.vidContId)},setMinimumBitrateAllowed:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Minimum Bitrate:",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MINIMUM_BITRATE_ALLOWED,{bitrate:a},this.vidContId)},setMaximumBitrateAllowed:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Set Maximum Bitrate:",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.MAXIMUM_BITRATE_ALLOWED,{bitrate:a},this.vidContId)},pauseAdRequest:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"pauseAdRequest called"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PAUSE_AD_REQUEST,{width:a||null,height:b||null},this.vidContId)},_dispatchResizeEvent:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTAINER_RESIZE,{e:a},this.vidContId)},liveSegmentStart:function(a){var b=this.eventsMgr.eventTypes.LIVE_SEGMENT_START,c={liveSegmentData:a};this.eventsMgr.dispatchEvent(b,c,this.vidContId)},liveSegmentEnd:function(a){var b=this.eventsMgr.eventTypes.LIVE_SEGMENT_END,c={liveSegmentData:a};this.eventsMgr.dispatchEvent(b,c,this.vidContId)}})}(uvpjs.register("uvpjs")),function(a){var b=Math.random(),c=a._;a.VideoManager=uvpjs.Class.subClass({init:function(a){if(this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.VIDEO_MANAGER,uvpjs.VideoManager._instance)return void console.warn("UVPJS: An instance of VideoManager has already been created.");uvpjs.VideoManager._instance=this,this.initComplete=!1,this.initializing=!1,this.successCallbacks=[],this.internalNS=".Video_Manager",this.VCIs={},this.CDO={},this.currActiveVCI=null,this._allowConcurrentPlayback=!1,this._disableAutoplay=!1,this.mc=uvpjs.mediaCapabilities,this.eventsMgr=null,this.configMgr=null,this.autoplayChecked=!1},destroy:function(){for(var a in this.VCIs)this.destroyVideoPlayer(a);this.VCIs=null,this.eventsMgr&&this.eventsMgr.destroy(),this.configMgr&&this.configMgr.destroy(),this.eventsMgr=null,this.configMgr=null,this.currActiveVCI=null,this.CDO=null,this.mc=null,this.sdkLoadMgr=null,uvpjs.VideoManager.destroyInstance()},initialize:function(a,b,c){var d=uvpjs.Configuration,e=uvpjs.VideoManager._instance,f=uvpjs.DebugManager,g=this.validateParams(a,b,c),h=g.message,i=g.isValid;if(!h||(console[i?"warn":"error"](h),!i&&g.errorCb&&g.errorCb(h),i)){if(e){if(e.isInitializing())return void e.addInitCallback(b);if(e.isReady())return void(uvpjs.util.isFunction(b)&&b(this.mc.systemInfo))}console.log([d.name,d.version,d.date].join(" ")),uvpjs.log=f.log.bind(f),uvpjs.warn=f.warn.bind(f),uvpjs.error=f.error.bind(f),f.setSessionStartTime(),this.initializing=!0,this.useNativeAutoplay=!(!a.enableNativeMobileAutoplay||!this.mc.supportsIntelligentMobileAutoplay()),this.addInitCallback(b),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize options = ",a),this.eventsMgr=uvpjs.EventsManager.getInstance(),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_ERROR+this.internalNS,this.uvpjsError.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.UVPJS_WARNING+this.internalNS,this.uvpjsWarning.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.CONTROL_PLAY+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.PREVIEW_BUTTON+this.internalNS,this.onVideoPlaybackInitiated.bind(this)),this.eventsMgr.addEventListener(this.eventsMgr.eventTypes.VIDEO_PROGRESS+this.internalNS,this.onVideoProgress.bind(this)),this.configMgr=uvpjs.ConfigManager.getInstance(a,this.onCongfigMgrReady.bind(this))}},validateParams:function(a,b,d){var e=uvpjs.util,f=null,g=!1,h="VideoManager.initialize()",i=e.isFunction(d)?d:null;return a&&c.isPlainObject(a)||(f=h+" was invoked with invalid session options.",g=!0),e.isFunction(b)||(f=h+": A success callback function is required.",g=!0),i||(f=h+" did not receive a valid error callback function.",g=!1),{errorCb:i,message:f,isValid:!g}},isReady:function(){return this.initComplete},isInitializing:function(){return this.initializing},addInitCallback:function(a){var b=this.successCallbacks.length;if(uvpjs.util.isFunction(a)){for(;b--;)if(this.successCallbacks[b]===a)return;this.successCallbacks.push(a)}},onCongfigMgrReady:function(a){if(!c.isObject(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager onCongfigMgrReady CDO MISSING OR MISS-TYPED - RETURN"},this.internalNS);this.CDO=a,this.checkForForcedHlsjs(this.CDO),this.setupDebugManager(),this.sdkLoadMgr=new uvpjs.SdkLoadManager(this.CDO,this.onSdkLoadManagerReady.bind(this))},onSdkLoadManagerReady:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"onSdkLoadManagerReady",a),uvpjs.mediaCapabilities.setTrackingInfo(a),this.autoplayChecked||(this.autoplayChecked=!0,this.checkAutoplay())},checkForForcedHlsjs:function(a){var b,c=a.isModuleEnabled("VideoPlaybackSettings"),d=c&&a.getModuleParam("VideoPlaybackSettings","forceHlsjs"),e="string"==typeof d,f=e&&d.toLowerCase();d&&!uvpjs.util.isEmpty(d)&&(!0===d||1===d||e&&("1"===f||"y"===f||"yes"===f))&&(b=this.mc.canPlayHLSJS(!0),b&&(this.mc.canPlayHLSJS=this.mc.canPlayHLSJS.bind(this.mc,!0)),this.mc.systemInfo.isHlsjsEligible=b)},checkAutoplay:function(){uvpjs.mediaCapabilities.determineAutoplayCapabilities(this.onAutoplayCheckComplete.bind(this))},onAutoplayCheckComplete:function(){for(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_LOADED,{},this.internalNS),this._allowConcurrentPlayback=this._determineConcurrentPlaybackStatus(),this.initComplete=!0,this.initializing=!1;this.successCallbacks.length;)this.successCallbacks.shift()(this.mc.systemInfo)},_determineConcurrentPlaybackStatus:function(){return!0===this.useNativeAutoplay||!!this.CDO.sessionOptions.allowConcurrentPlayback},setupDebugManager:function(){uvpjs.DebugManager.initialize(this.CDO),uvpjs.debug=uvpjs.DebugManager.isEnabled},addEventListener:function(a,b){if(this.eventsMgr)return a&&c.isString(a)&&c.isFunction(b)?void this.eventsMgr.addEventListener(a,b):void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager addEventListener MISSING OR MISS-TYPED PARAMS RETURN"},this.internalNS)},removeEventListener:function(a){if(!a||!c.isString(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager removeEventListener !evt || evt !== string INVALID RETURN"},this.internalNS);this.eventsMgr.removeEventListener(a)},getVideoPlayers:function(){var a,b={};for(a in this.VCIs)b[a]=this.VCIs[a];return b},createVideoPlayer:function(a,b,d){if(this.debug&&uvpjs.log(this.DEBUG_ID,"createVideoPlayer"),!c.isString(a)||!c.isFunction(b)||d&&!c.isPlainObject(d))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createVideoPlayer initialization PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);var e=[a,b];d&&e.push(d),this.createMultipleVideoPlayers([e])},destroyVideoPlayer:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"destroyVideoPlayer"),c.isString(a)?c.isEmpty(this.VCIs)||!this.VCIs[a]?(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer container VCI does not exist "+a},this.internalNS),!1):(this.VCIs[a].destroy(),delete this.VCIs[a]):(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager destroyVideoPlayer missing parameters"},this.internalNS),!1)},getAutoplayInfo:function(){return this.mc?this.mc.getAutoplayInfo():{supportsMutedAutoplay:null,supportsUnmutedAutoplay:null}},createMultipleVideoPlayers:function(a){var b,d,e,f,g,h,i,j;if(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers"),this._disableAutoplay&&(this._disableAutoplay=!c.isEmpty(this.VCIs)),!c.isArray(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers PARAMS IS NOT AN ARRAY - RETURN"},this.internalNS);for(f=a.length,e=0;e<f;e++)if(g=a[e],h=g[0],i=g[1],j=g[2],g.length<2||!c.isString(h)||!c.isFunction(i)||!c.isUndefined(j)&&!c.isPlainObject(j))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"VideoManager createMultipleVideoPlayers initialization ARRAY PARAMS MISSING OR MISS-TYPED - RETURN"},this.internalNS);for(this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers Arrays OK. Create VCIs."),e=0;e<f;e++)g=a[e],h=g[0],i=g[1],j=g[2]||{},this.debug&&uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers LOOP containerID = args[0] = ",h),j=this.CDO.getSessionOptions(j),b=this.validateAutoplay(j),!1===this._allowConcurrentPlayback&&b&&(this._disableAutoplay&&(j.enableMutedAutoplay=!1,j.enableUnmutedAutoplay=!1),this._disableAutoplay=!0),d=new uvpjs.VideoControlInterface,this.VCIs[h]=d,d.initialize(h,this.eventsMgr,this.CDO,i,j);this.debug&&(uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers after loop this._disableAutoplay",this._disableAutoplay),uvpjs.log(this.DEBUG_ID,"createMultipleVideoPlayers this.VCIs = ",this.VCIs))},validateAutoplay:function(a){var b=a.enableUnmutedAutoplay&&this.mc.supportsUnmutedAutoplay(),c=!!(a.enableMutedAutoplay&&this.mc.supportsMutedAutoplay()||b);return b&&(a.enableMutedAutoplay=!1),c||(a.enableMutedAutoplay=!1,a.enableUnmutedAutoplay=!1),c},overrideSessionOptions:function(a){a&&c.isPlainObject(a)&&this.CDO.overrideSessionOptions(a)},onVideoProgress:function(a){if(!(this._allowConcurrentPlayback||!c.isPlainObject(a)||c.isUndefined(a.target)||c.isUndefined(a.payload)||c.isUndefined(a.payload.playbackState)||a.payload.playbackState!==this.mc.PLAYING)){var b=a.target;c.isEmpty(this.currActiveVCI)&&!c.isUndefined(this.VCIs[b])&&(this.currActiveVCI=this.VCIs[b]),b===this.currActiveVCI.vidContId||c.isUndefined(this.VCIs[b])||(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoProgress this.VCIs[vidContId].pauseVideo();",b),this.VCIs[b].pauseVideo({autoPause:!0}))}},onVideoPlaybackInitiated:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated",a),!this._allowConcurrentPlayback&&c.isPlainObject(a)&&!c.isUndefined(a.target)){var b=a.target;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated this.VCIs",Object.keys(this.VCIs),this.VCIs),c.isEmpty(this.VCIs)||c.isUndefined(this.VCIs[b])||this.currActiveVCI&&this.currActiveVCI.vidContId===b||(this.currActiveVCI=this.VCIs[b],this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoPlaybackInitiated   RESET this.currActiveVCI NEW = ",this.currActiveVCI))}},uvpjsError:function(a){a?this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ",a.payload.msg):this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: uvpjsError MISSING evtObj !!!!!!!!!!!")},uvpjsWarning:function(a){a?this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: ",a.payload.msg):this.debug&&uvpjs.warn(this.DEBUG_ID,"WARNING: uvpjsWarning MISSING evtObj !!!!!!!!!!!")}}),a.VideoManager._instance=null,a.VideoManager.destroyInstance=function(){this._instance=null},a.VideoManager.getInstance=function(){return this._instance||(this._instance=new uvpjs.VideoManager(b)),this._instance}}(uvpjs.register("uvpjs")),function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=a._;a.CaptionsManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CAPTIONS_MANAGER,VIDEO_ID_PREFIX:uvpjs.domConstants.VIDEO_ID_PREFIX,CAPTIONS_ID_PREFIX:uvpjs.domConstants.CAPTIONS_ID_PREFIX,CAPTIONS_CONTAINER_CLASSNAME:"uvpjs__cc-container",CAPTIONS_TEXT_CLASSNAME:"uvpjs__cc-text",CONFIG_MODULE_NAME:"ClosedCaptions",BASE_CONTROLS_HEIGHT:"50px",BASE_FONT_SIZE:"22px",BASE_VIDEO_WIDTH:"848px",MIN_FONT_SIZE:"10px",init:function(a){var b=uvpjs.mediaCapabilities;this.debug=uvpjs.debug,a&&(this._cviModel=a.cviModel,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this.useNativeBrowserControls=!!this._cviModel.getSessionOption("useBrowserControls"),this._videoId=this.VIDEO_ID_PREFIX+this._containerId,this._captionsId=this.CAPTIONS_ID_PREFIX+this._containerId,this._namespace="."+this._containerId+".captionsMgr",this._supportsVTTCue=void 0!==window.VTTCue,this.debug&&uvpjs.log(this.DEBUG_ID,"init",this._containerId),this.styles=c(),this._props={},this._videoEl=null,this._ccEl=null,this._pageStyles={},this._configStyles=null,this._inlineStyles=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,this._lineOffset=b.getCaptionsLineOffset(),this._lineAlign=b.getCaptionsCenterAlignToken(),this._captionsUrl=null,this._deferLoadingCaptions=a.deferLoadingCaptions,this._trackCount=0,this._trackId=null,this._disabled=!1,this.subtitleLanguage="en",this.subtitleMasterList=null,this.ccDisplayRequested=!1,this.isAndroidOnHlsjs=uvpjs.mediaCapabilities.canPlayHlsjsAndriod(this._cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._onAddTrack=this._onAddTrack.bind(this),this._onLoadedData=this._onLoadedData.bind(this),this._onTimeUpdate=this._onTimeUpdate.bind(this),this._finalizeInit=this._finalizeInit.bind(this),uvpjs.util.createStyleSheet(this._finalizeInit),this._setCDOParams(),this._addEventListeners())},destroy:function(){this.styles=null,this._cviModel=null,this._eventsMgr=null,this._videoEl=null,this._videoId=null,this._captionsId=null,this._ccEl=null,this._styleSelector=null,this._containerId=null,this._namespace=null,this._pageStyles=null,this._configStyles=null,this._inlineStyles=null,this._defaultStyles=null,this._captionsJson=null,this._captionsUrl=null,this._props=null,this._supportsVTTCue=!1,this._liveCaptionsInitalized=!1,this._lineOffset=null,this._lineAlign=null,this._onLoadedData=null,this._trackCount=0,this._trackId=null,this._removeEventListeners()},_finalizeInit:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeInit"),this._styleEl=a,this.isAndroidOnHlsjs||!this._ccEl&&this._createCaptionsElement()},showCaptions:function(a){if(this._deferLoadingCaptions&&!this._hasCaptions())return this._loadCaptionsUrl(this._captionsUrl),void this._eventsMgr.addEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace,this.showCaptions.bind(this));this.setCaptionLanguage(a),this.ccDisplayRequested=!0,!this._getActiveTrack()&&uvpjs.mediaCapabilities.isIOS()&&this.enableCaptionsTracks(),this._eventsMgr.removeEventListener(this._eventsMgr.eventTypes.CAPTIONS_READY+this._namespace),this._toggleVisibility(a,"showing")},setCaptionLanguage:function(a){var b=a.payload.language;if(uvpjs.util.isDefinedString(b)){var c=this._getActiveTrack();c&&c.language===this.subtitleLanguage&&this.subtitleLanguage!==b&&this._clearCaptionTrack(c),this.clearCcElInnerHtml(),this.subtitleLanguage=b}},getCaptionInfo:function(){for(var a=[],b=this.subtitleMasterList||this._getTextTracks(),c=this._getActiveTrack(),d=0;d<b.length;d++){var e=b[d];enabled=c&&c.language===e.language||!1,a.push({language:e.language,label:e.label,kind:e.kind,enabled:enabled})}return b.length>0&&(this.subtitleMasterList=a),this.subtitleMasterList},hideCaptions:function(a){this.ccDisplayRequested=!1,this._toggleVisibility(a,"hidden")},getStyles:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"getCaptionsStyle"),this._disabled?{}:q.clone(this.styles)},setStyles:function(a){var b,c,d,e=this._pageStyles,f=a.length;if(!this._disabled){for(this.debug&&uvpjs.log(this.DEBUG_ID,"setStyles",a);f--;)d=a[f],b=n(d.name),c=d.value,e[b]=c;this._updateStylesObject(e),this._applyStyles(),this._setPosition(e["text-position"]||null)}},setCueProperty:function(a,b){var c;if(!this._disabled){if(c=this._getActiveTrack(),!(a&&b&&c&&this._supportsVTTCue))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set captions cue property:",a,b));this.debug&&uvpjs.log(this.DEBUG_ID,"setCueProperty",c,a,b),this._props[a]=isNaN(b)?b:Number(b)}},_addEventListeners:function(){var a=this._eventsMgr,b=a.eventTypes,c=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_addEventListeners"),a.addEventListener(b.CONTAINER_RESIZE+c,this._onContainerResize.bind(this)),a.addEventListener(b.CONTROL_LOAD_CAPTIONS+c,this._onControlLoadCaptions.bind(this)),a.addEventListener(b.CONTENT_DATA_LOADED+c,this._onContentDataLoaded.bind(this)),a.addEventListener(b.CONTROL_SHOW_CAPTIONS+c,this.showCaptions.bind(this)),a.addEventListener(b.CONTROL_HIDE_CAPTIONS+c,this.hideCaptions.bind(this)),a.addEventListener(b.SET_CAPTIONS_LANG+c,this.setCaptionLanguage.bind(this)),a.addEventListener(b.CONTENT_FACADE_CREATED+c,this._onContentFacadeCreated.bind(this)),a.addEventListener(b.RESOURCE_END+c,this._onVideoComplete.bind(this)),a.addEventListener(b.VIDEO_PROGRESS+c,this._onVideoProgress.bind(this)),a.addEventListener(b.AD_START+c,this._onAdStart.bind(this))},_removeEventListeners:function(){var a=this._eventsMgr,b=a.eventTypes,c=this._namespace;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeEventListeners"),a.removeEventListener(b.CONTAINER_RESIZE+c),a.removeEventListener(b.CONTROL_LOAD_CAPTIONS+c),a.removeEventListener(b.CONTENT_DATA_LOADED+c),a.removeEventListener(b.CONTROL_SHOW_CAPTIONS+c),a.removeEventListener(b.CONTROL_HIDE_CAPTIONS+c),a.removeEventListener(b.SET_CAPTIONS_LANG+c),a.removeEventListener(b.CONTENT_FACADE_CREATED+c),a.removeEventListener(b.RESOURCE_END+c),a.removeEventListener(b.VIDEO_PROGRESS+c),a.removeEventListener(b.AD_START+c)},_createTrackElement:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_createTrackElement",a);var b=document.createElement("track");b.default=!0,b.kind="captions",b.label="English",b.srclang="en",b.id=this._trackId,b.src=a,this._videoEl.appendChild(b)},_createCaptionsElement:function(){var a=uvpjs.util,b=this._styleEl,c=document.createElement("div"),d=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this._containerId);if(c.id=this._captionsId,this.debug&&uvpjs.log(this.DEBUG_ID,"_createCaptionsElement"),!d)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Can't create captions container. No video content container."));d.appendChild(c),this._ccEl=c,a.addCSSObject(b,c,{width:"100%",height:"100%",position:"absolute",top:0,bottom:0,left:0,right:0,display:"none","font-size":this.BASE_FONT_SIZE}),a.addCSSObject(b,c,{position:"absolute",top:"auto",bottom:this.BASE_CONTROLS_HEIGHT,left:0,right:0,"text-align":"center","font-size":"100%"},"."+this.CAPTIONS_CONTAINER_CLASSNAME),a.addCSSObject(b,c,{display:"inline-block",padding:"3px 5px","font-size":"100%"},"."+this.CAPTIONS_TEXT_CLASSNAME)},_dispatchCaptionsError:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsError",a),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_ERROR,{msg:a},this._containerId)},_dispatchCaptionsReady:function(){this.hasDispatchedCaptionsReady||(this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsReady"),this.hasDispatchedCaptionsReady=!0,this.adjustVttCuesLinePosition(),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_READY,{},this._containerId))},_dispatchCaptionsUnavailable:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_dispatchCaptionsUnavailable"),this._eventsMgr.dispatchEvent(this._eventsMgr.eventTypes.CAPTIONS_UNAVAILABLE,{},this._containerId)},_onContainerResize:function(a){a.target===this._containerId&&this._setRect()},_onAdStart:function(a){this.clearCcElInnerHtml()},clearCcElInnerHtml:function(){this._ccEl&&(this._ccEl.innerHTML="")},_onVideoComplete:function(a){var b,c,d=a.target,e=this._videoEl;d===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoComplete",d),this._clearAllCaptionTracks(),this._captionsUrl=null,this._captionsJson=null,this._liveCaptionsInitalized=!1,this.hasDispatchedCaptionsReady=!1,e&&e.removeEventListener("loadeddata",this._onLoadedData),e&&e.removeEventListener("timeupdate",this._onTimeUpdate),c=this._getTextTracks(),c&&(c.onaddtrack=null),b=this._getActiveTrack(),b instanceof window.TextTrack&&h(b)&&(b.mode="disabled",b.oncuechange=null),this._trackCount++)},_onContentDataLoaded:function(a){var b,c=uvpjs.util,d=a.target,e=a.payload.vidState,f=e.closedCaptionPath;e.isLive;d===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentDataLoaded",d),this._videoEl=document.getElementById(this._videoId),this._videoEl.addEventListener("loadeddata",this._onLoadedData),this._trackId="track_"+this._trackCount,b=this._getTextTracks(),b&&(b.onaddtrack=this._onAddTrack),this._styleSelector=this._getStyleSelector(),c.isDefinedString(f)&&(this._captionsUrl=f))},_onLoadedData:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadedData",a),this._checkForLiveCaptions()},_onTimeUpdate:function(a){!this.hasDispatchedCaptionsReady&&!!this._getActiveTrack()&&this._dispatchCaptionsReady(),this._setActiveCueProps(a)},_onControlLoadCaptions:function(a){var b;a.target===this._containerId&&(b=a.payload.url,q.isString(b)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onControlLoadCaptions",a.target),this._loadCaptionsUrl(b)))},_onContentFacadeCreated:function(a){a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentFacadeCreated",a.target),this._cviModel.contentVideoState.isFlash?(this._disabled=!0,this._removeEventListeners(),this._dispatchCaptionsReady()):(this._disabled=!1,this._loadOrDeferCaptions(this._captionsUrl)))},_onLoadComplete:function(a){var b=a.responseText;this.debug&&uvpjs.log(this.DEBUG_ID,"_onLoadComplete xhr",a);try{b=b.replace(/\n/g,""),b=b.substr(b.indexOf("<?xml"));var c=new DOMParser,d=c.parseFromString(b,"text/xml");this._xmlToCues(d)}catch(a){var e="Error parsing closed captions XML.";this._dispatchCaptionsError(e),this.debug&&uvpjs.error(this.DEBUG_ID,e,a)}},_onLoadError:function(a){var b=a.status,c="Unknown error";switch(b){case 404:c="File not found";break;case 500:c="Server error";break;case 0:c="Request aborted"}c+=" "+b,this._dispatchCaptionsError(c),this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError",c)},_onAddTrack:function(a){var b=a.track;b.id=this._trackId,this.useNativeBrowserControls||this._syncCCTrackMode(b,!1),h(b)&&(this._finalizeTrackElement(),this._finalizeLiveCaptions()),this.debug&&uvpjs.log(this.DEBUG_ID,"_onAddTrack",a)},_syncCCTrackMode:function(a,b){if(a)return b?void(a.mode="disabled"):void(this.useNativeBrowserControls||uvpjs.mediaCapabilities.isIOS()?this._cviModel.isFullscreen&&(a.mode="showing"):"hidden"!==a.mode&&(a.mode="hidden"))},_onVideoProgress:function(a){var b;if(a.target===this._containerId){var c=this._getActiveTrack();if(this.isAndroidOnHlsjs||this._syncCCTrackMode(c,!1),!this._hasCaptions())return void(this._liveCaptionsInitalized&&(this._dispatchCaptionsUnavailable(),this._liveCaptionsInitalized=!1));if(!this._liveCaptionsInitalized)return void this._checkForLiveCaptions();if(c&&c.activeCues&&(b=c.activeCues.length))for(this.ccDisplayRequested&&this.showCcContainer(!0);b--;)a.payload.currentTime-c.activeCues[b].endTime>1&&this.showCcContainer(!1);else this.showCcContainer(!1)}},_finalizeLiveCaptions:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeLiveCaptions."),this._finalizeCaptions(!0)},_finalizeCaptions:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeCaptions"),this._setRect(),!a||!this._liveCaptionsInitalized){try{!a&&this._applyCueStyles(),this._finalizeStyles(),this._applyStyles(),this._checkBottomPosition()}catch(a){this.debug&&uvpjs.error(this.DEBUG_ID,"Error applying cue styling.",a),this._dispatchCaptionsError(a)}a&&(this._liveCaptionsInitalized=!0),!!this._getActiveTrack()&&this._dispatchCaptionsReady()}},_finalizeTrackElement:function(){var a=this._getActiveTrack(),b=this._onTimeUpdate;this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeTrackElement"),a&&(a.oncuechange=b)||this._videoEl.addEventListener("timeupdate",b)},_finalizeStyles:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_finalizeStyles"),this._updateStylesObject(this._configStyles),this._updateStylesObject(this._pageStyles),this._applyStyles()},_applyCueStyles:function(){var a=q.get(this._captionsJson,"tt.head.styling.style");if(a=q.isArray(a)?a[0]:a,this.debug&&uvpjs.log(this.DEBUG_ID,"_applyCueStyles style",a),!a)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"No styling found in XML file."));this._inlineStyles={backgroundColor:a["tts:backgroundColor"],color:a["tts:color"],fontFamily:a["tts:fontFamily"],fontSize:a["tts:fontSize"],fontStyle:a["tts:fontStyle"],fontWeight:a["tts:fontWeight"],textAlign:a["tts:textAlign"],textDecoration:a["tts:textDecoration"]}},_applyStyles:function(){var a,c,d,e=uvpjs.util,f=this.styles,g=this._styleSelector,h=[];this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles styles",f);for(c in f){switch(d=f[c],a=!1,c){case"background-opacity":case"font-opacity":a=!0;break;case"text-position":a=!0,this._setPosition(d);break;case"background-color":d=b(d,f["background-opacity"]);break;case"color":case"font-color":c="color",d=b(d,f["font-opacity"]);break;case"text-edge-style":c="text-shadow",d=o(d)}a||(i(c,d)?h.push({name:c,value:d}):this.debug&&uvpjs.warn(this.DEBUG_ID,"Invalid CSS.",c,d))}this.debug&&uvpjs.log(this.DEBUG_ID,"_applyStyles selector, rules",g,h),e.addCSSRules(this._styleEl,g,h)},_updateStylesObject:function(a){var b,c,e;for(b in a){if(!(c=a[b])||!b)return;if((e=n(b))in this.styles){switch(e){case"font-size":c=d(c)}this.styles[e]=c}else this.debug&&uvpjs.warn(this.DEBUG_ID,"Unsupported captions style property.",e)}},_hasCaptions:function(){return h(this._getActiveTrack())},_loadOrDeferCaptions:function(a){this._deferLoadingCaptions?this._dispatchCaptionsReady():this._loadCaptionsUrl(a)},_loadCaptionsUrl:function(a){var b,c=uvpjs.util.isDefinedString(a),d=c&&-1!==a.indexOf(".vtt");if(c&&!this._cviModel.contentVideoState.isFlash){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_loadCaptionsUrl"),this._videoEl=document.getElementById(this._videoId),d)return void this._createTrackElement(a);b=new uvpjs.CodeLoader,b.loadXHR(a,this._onLoadComplete.bind(this),this._onLoadError.bind(this))}},_checkForLiveCaptions:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_checkForLiveCaptions"),!this._hasCaptions())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"No captions track to finalize."));this._finalizeTrackElement(),this._finalizeLiveCaptions()},_clearAllCaptionTracks:function(){var a=this._getTextTracks(),b=a&&a.length||0;for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearAllCaptionTracks",a);b--;)this._clearCaptionTrack(a[b]);this.clearCcElInnerHtml()},_clearCaptionTrack:function(a){var b,c;if(h(a)){for(this.debug&&uvpjs.log(this.DEBUG_ID,"_clearCaptionTrack",a),b=a&&a.cues,c=b&&b.length||0;c--;)a.removeCue(b[c]);this._syncCCTrackMode(a,!0),a.cues=null}},_toggleVisibility:function(a,b){a.target===this._containerId&&this._hasCaptions()&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_toggleVisibility",b),this.showCcContainer("hidden"!==b))},showCcContainer:function(a){if(this.isAndroidOnHlsjs){this._getActiveTrack().mode=a?"showing":"hidden"}else this._ccEl&&(a?this._ccEl.style.display="block":(this._ccEl.style.display="none",this._ccEl.innerHTML=""))},_getTextTracks:function(){return this._videoEl&&this._videoEl.textTracks},_getActiveTrack:function(){var a,b,c,d=this._getTextTracks(),e=d&&d.length||0;for(c=0;c<e;c++)if(a=d[c],(b=a&&a.cues)&&b.length&&h(a))return a},enableCaptionsTracks:function(){for(var a,b=this._getTextTracks(),c=b&&b.length||0;c--;)a=b[c],h(a)&&(a.mode="hidden")},_getTrackById:function(a){var b=this._getTextTracks();return b&&b.getTrackById(a||this._trackId)},_getActiveCues:function(){var a=this._getActiveTrack();return a&&a.activeCues},_getAllCues:function(){var a=this._getActiveTrack();return a&&a.cues},_getStyleSelector:function(){return"#"+this._captionsId+" ."+this.CAPTIONS_TEXT_CLASSNAME},_setCDOParams:function(){var a,b,c,d=this._cviModel.getModule(this.CONFIG_MODULE_NAME),e={};return this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams module",d),d?!0!==d.enabled?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module not enabled.")):q.isEmpty(d.params)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams Config module params array empty.")):(q.each(d.params,function(d){a=d.name,b=d.value,a&&b&&(c=n(a),e[a]=b)}),this.debug&&uvpjs.log(this.DEBUG_ID,"Config module styles. "+JSON.stringify(e,null,2)),void(this._configStyles=e)):void(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCDOParams No config module found."))},_setPosition:function(a){var b=["top-left","top-center","top-right","middle-left","middle-center","middle-right","bottom-left","bottom-center","bottom-right","bottom-left-floated","bottom-center-floated","bottom-right-floated"],c=b.indexOf(a)>-1?a:"bottom-center-floated";this._setPositionCSS(c)},_setPositionCSS:function(a){var b,c,d,e,f,g,h,i,j=uvpjs.util,k=this._styleEl,l=this._ccEl,m=l&&l.style.marginBottom,n=parseInt(this.BASE_CONTROLS_HEIGHT),o=10;k&&l&&(c=a.split("-"),e=c[0],d=c[1],h="inherit"===m?0:parseInt(m),i=isNaN(h)?n+"px":(h>n?o:n-h)+"px",f={top:o+"px",middle:"50%",bottom:"auto"}[e],g={top:"auto",middle:"auto",bottom:i}[e],b={top:f,bottom:g,"text-align":d,transform:"initial"},"middle"===e&&(b.transform="translateY(-50%)"),j.addCSSObject(k,l,b,"."+this.CAPTIONS_CONTAINER_CLASSNAME))},_checkBottomPosition:function(){var a=this.styles;a&&this._setPosition(a["text-position"])},_setRect:function(){function a(){q.assign(r.style,k),s&&(q.assign(s.style,k),this._checkBottomPosition())}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,r=this._videoEl,s=this._ccEl,t=r&&r.parentNode;r&&t&&(i=r.videoHeight,(j=r.videoWidth)&&i&&(c=r.getBoundingClientRect(),b=t.getBoundingClientRect(),d=c.height,e=c.width,h=i/j,g=d/e,f=g/h,n=b.height-c.height,m=b.width-c.width,o=f>1||0===m&&0!==n,p=f<1||0!==m&&0===n,k=o?{height:"auto","max-height":"100%",width:"100%",margin:0}:p?{height:"100%","max-width":"100%",width:"auto",margin:0}:{height:"100%",width:"100%",margin:0},k&&a.call(this),c=r.getBoundingClientRect(),b=t.getBoundingClientRect(),n=b.height-c.height,m=b.width-c.width,o?(l=n/2+"px",k={margin:"inherit","margin-top":l,"margin-bottom":l}):p&&(l=m/2+"px",k={margin:"inherit","margin-left":l,"margin-right":l}),s&&(k["font-size"]=this._calculateFontSize(c.width)),k&&a.call(this)))},_calculateFontSize:function(a){var b;try{b=a/parseInt(this.BASE_VIDEO_WIDTH)*parseInt(this.BASE_FONT_SIZE),b=Math.max(b,parseInt(this.MIN_FONT_SIZE))}catch(a){console.error(a)}return b&&b+"px"||this.BASE_FONT_SIZE},_setActiveCueProps:function(a){var b=a&&a.target,c=b&&b.activeCues||this._getActiveCues();this._setCueProps(c)},adjustVttCuesLinePosition:function(){if(this.isAndroidOnHlsjs){var a=this._getAllCues();if(a&&a.length>0){this._syncCCTrackMode(this._getActiveTrack(),!1);for(var b=0;b<a.length;b++){var c=a[b];!c||"auto"!==c.line&&-1!==c.line&&-2!==c.line||(c.line=-3)}}}},_setCueProps:function(a){this._addCuesToCaptionsElement(a)},_xmlToCues:function(a){var b,c,d,g,h,i,j,l,m,n,o,r=p(a);if(this._captionsJson=r,this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues json =",r),!q.isEmpty(r)&&q.isPlainObject(r)){if(c=q.get(r,"tt.body.div.p"),this.debug&&uvpjs.log(this.DEBUG_ID,"_xmlToCues cues",c),q.isUndefined(c)||q.isEmpty(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"No cues found in XML file."));if(!(b=this._supportsVTTCue?window.VTTCue:window.TextTrackCue))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"Browser does not support dynamic captions."));for(h=this._videoEl.addTextTrack("captions","English","en"),h.id=this._trackId,n=c.length,l=0;l<n;l++)if(m=l+1,j=c[l],g=c[m],i=j.text,!q.isEmpty(i)){for(i=i.replace(/(.*)<span.*tts:fontStyle="italic">(.*)<\/span>(.*)/g,"$1<i>$2</i>$3"),i=i.replace(/(.*)<span.*tts:fontWeight="bold">(.*)<\/span>(.*)/g,"$1<b>$2</b>$3"),i=i.replace(/(.*)<span.*tts:textDecoration="under">(.*)<\/span>(.*)/g,"$1<u>$2</u>$3"),o=e(i),j._lineCountPrev=j._lineCountPrev||0,j._lineCountNext=j._lineCountNext||0;(g&&g.begin)===j.begin;)g._lineCountPrev=o+j._lineCountNext,j._lineCountNext+=e(g.text),g=c[++m];d=new b(f(j.begin),f(j.end),i),d._lineCount=o,d._lineCountPrev=j._lineCountPrev,d._lineCountNext=j._lineCountNext,d._metadata=j.metadata,d=k.call(this,d),h.addCue(d)}this._finalizeCaptions()}},_addCuesToCaptionsElement:function(a){var b,c,d,e=uvpjs.util,f=this._ccEl,g='<div class="{{cntrClass}}">{{spans}}</div>',h="",i=a&&a.length;if(i){for(b=0;b<i;b++)c=a[b],d=c.text,e.isDefinedString(d)&&(d=d.replace(/(\r\n|\n|\r)/g,"<br/>"),h+='<span class="{{txtClass}}">'+d+"</span>",b+1!==i&&(h+="<br/>"));g=g.replace("{{spans}}",h),g=g.replace("{{cntrClass}}",this.CAPTIONS_CONTAINER_CLASSNAME),g=g.replace(/{{txtClass}}/g,this.CAPTIONS_TEXT_CLASSNAME),f&&(f.innerHTML=g)}}}),b=function(a,b){var c=l(a)||g(a)||g(j(a));return c&&b?m(c.r,c.g,c.b,b):a},c=function(){return{"background-opacity":"1","background-color":"#000000","font-color":"#FFFFFF","font-family":"Arial, sans-serif","font-opacity":"1","font-size":"100%","font-weight":"normal","line-height":"1","text-position":"default","text-decoration":"none","text-edge-style":"none"}},d=function(a){var b="100%";return a.indexOf("px")>-1?(b=a.replace("px",""),b/=18,b=100*b+"%"):a.indexOf("%")>-1&&(b=a),b},e=function(a){return a&&(a.match(/\n/g)||[]).length+1},f=function(a){var b,c,d,e,f,g;if(!q.isNull(a)&&!q.isUndefined(a))return g=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},f=a.split(":"),b=60*Number(f[0])*60,c=60*Number(f[1]),d=Number(f[2]),e=b+c+d,g(e,2)},g=function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},h=function(a){return a instanceof window.TextTrack&&("captions"===a.kind||"subtitles"===a.kind)},i=function(a,b){if(a&&b)return q.get(window,"CSS.supports")?window.CSS.supports(a,b):"string"==typeof document.createElement("div").style[a]},k=function(a){var b,c=a._metadata;if(c){a.snapToLines=!0,b=Math.round(c.cccol/35*100),a.position=b;try{a.align=b<45?"start":b>55?"end":this._lineAlign}catch(b){a.align="center"}a.positionAlign=b<45?"line-left":b>55?"line-right":"center",a.line=c.ccrow-17+this._lineOffset,a._defaults={line:a.line,position:a.position,align:a.align,positionAlign:a.positionAlign}}return a},j=function(a){return{white:"#ffffff",yellow:"#ffff00",green:"#008000",cyan:"#00ffff",blue:"#0000ff",magenta:"#ff00ff",red:"#ff0000",black:"#000000"}[a.toLowerCase()]},l=function(a){var b;if(-1!==a.indexOf("rgba"))return b=a.substr(5,a.length).split(","),{r:b[0],g:b[1],b:b[2]}},n=function(a){if(q.isString(a)&&!q.isEmpty(a))return a.replace(/([A-Z])/g,"-$1").toLowerCase()},m=function(a,b,c,d){return"rgba("+[a,b,c,d].join(",")+")"},o=function(a){return{"drop-shadow":"2px 2px 3px #000",outline:"-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000",raised:"-1px -1px 1px #FFF, 1px 1px 1px #000"}[a]||"none"},p=function(a){var b={};if(1===a.nodeType&&a.attributes.length>0)for(var c=0,d=a.attributes.length;c<d;c++){var e=a.attributes.item(c);b[e.nodeName]=e.nodeValue}else 3===a.nodeType&&(b=a.nodeValue);if("p"===a.nodeName&&(b.text="",q.each(a.childNodes,function(a){if("metadata"!==a.nodeName){var c=(new XMLSerializer).serializeToString(a);1===a.nodeType&&(b.text+="br"===a.tagName?"\n":c),3===a.nodeType&&(b.text+=c)}})),a.hasChildNodes())for(var f=0,g=a.childNodes.length;f<g;f++){var h=a.childNodes.item(f),i=h.nodeName;if(void 0!==b[i]){if(void 0===b[i].push){var j=b[i];b[i]=[],b[i].push(j)}b[i].push(p(h))}else b[i]=p(h)}return b}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.ConfigDataObject=uvpjs.Class.subClass({debug:!0,adCallParams:{standardParams:null,customParams:null},sessionOptions:{adBlockerCallback:null,cms:"",id3OwnerIds:null,ftag:"",mapp:"",netwk:"",partner:"",uvpc:"",ursuid:"",usesIMA:!1,usesTealium:!1,skin:!0,useBrowserControls:!1,enableDiagnosticWindow:!0,enableUnmutedAutoplay:!1,enableMutedAutoplay:!1,customCSS:null,enableReplay:!1,previewImage:null,themeName:"default",controls:null,template:null,allowConcurrentPlayback:!1,browserVer:"",contsess:"",deviceCPU:"",deviceScreenSize:"",deviceType:"",deviceVers:"",host:"",mso:"",pageUrl:"",playerCoords:"",playerId:"",playerVersion:"",playsInline:!1,preloadContent:!1,preventFlashPlayback:!1,referrer:"",resumeBeaconInterval:10,sessionId:"",useDynamicSwitching:!0,enableNativeMobileAutoplay:!1,userCountry:"",userISP:"",userId:"",userPPID:"",userStatus:"",isEmbedded:!1,deferLoadingCaptions:!1,capLevelToPlayerSize:null,enableDashJSFastSwitchABR:null,trackingConfigOverrides:null,userConnectionType:"unknown",minBitrate:-1,maxBitrate:-1,startBitrate:-1,liveSyncDurationCount:-1,errorRecovery:null},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.modules=[],this.classes=[],window.top!==window.self&&(this.sessionOptions.isEmbedded=!0,this.sessionOptions.referrer=document.referrer),this.initialize(a)},initialize:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject initialize options = ",a),this.overrideSessionOptions(a)},destroy:function(){this.modules=null,this.classes=null},getAdCallParams:function(){return this.adCallParams},setAdCallParams:function(a){var b;if(!uvpjs.util.isEmpty(a.standardParams)&&null===this.adCallParams.standardParams){this.adCallParams.standardParams={};for(b in a.standardParams)this.adCallParams.standardParams[b]=a.standardParams[b]}if(!uvpjs.util.isEmpty(a.customParams)&&null===this.adCallParams.customParams){this.adCallParams.customParams={};for(b in a.customParams)this.adCallParams.customParams[b]=a.customParams[b]}},overrideSessionOptions:function(a){var c=this.getSessionOptions(a);if(!c||!b.isPlainObject(c))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConfigDataObject overrideSessionOptions options undefined or not the correct type."));this.sessionOptions=c},getSessionOption:function(a){return this.sessionOptions[a]||null},getSessionOptions:function(a){var c,d,e;if(c=b.clone(this.sessionOptions),!a||!b.isPlainObject(a))return c;if((d=a.skinConfig)&&!b.isEmpty(d)){uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The `skinConfig` session option parameter no longer exists. Please relocate the properties to the `sessionOption` object.");for(e in d)c.hasOwnProperty(e)&&(c[e]=d[e])}for(e in c)a.hasOwnProperty(e)&&(c[e]=a[e]);return c},getModule:function(a){return d(this.modules,a)},getModules:function(){return this.modules},getModuleParam:function(a,b){var c=d(this.modules,a),e=d(c.params,b);if(e&&e.hasOwnProperty("value"))return e.value},setModule:function(a){g(this.modules,a,"name",this.DEBUG_ID)},isModuleEnabled:function(a){var b=this.getModule(a);if(!b){var c="ConfigDataObject isModuleEnabled module not found: "+a;return this.debug&&uvpjs.log(this.DEBUG_ID,c),!1}return this.debug&&uvpjs.log(this.DEBUG_ID,"ConfigDataObject isModuleEnabled "+a+":",b.enabled),b.enabled},isModuleSet:function(a){return!!this.getModule(a)},getClass:function(a){return d(this.classes,a)},getClasses:function(){return this.classes},getClassProperty:function(a,b){var c=d(this.classes,a),e=f.call(this,c,"properties",this.DEBUG_ID),g=d(e,b);return f.call(this,g,"value",this.DEBUG_ID)},getClassListItems:function(a){var b=d(this.classes,a);return f.call(this,b,"list",this.DEBUG_ID)},getClassListItemProperty:function(a,b,c){var g=this.getClassListItems(a),h=e(g,b),i=f.call(this,h,"properties",this.DEBUG_ID),j=d(i,c);return f.call(this,j,"value",this.DEBUG_ID)},setClass:function(a){g(this.classes,a,"name",this.DEBUG_ID)},isCAN:function(){return b.isString(this.sessionOptions.netwk)&&"can"==this.sessionOptions.netwk.toLowerCase()},copyModules:function(a){for(var b=a.length;b--;)for(var c=a[b],d=this.modules.length;d--;){var e=this.modules[d];if(e.name===c.name){this.modules[d]=c;break}}}});var c=function(a,b,c){for(var d in a)if(a[d][b]==c)return a[d];return!1},d=function(a,b){return c(a,"name",b)},e=function(a,b){return c(a,"id",b)},f=function(a,b,c){return a?a.hasOwnProperty(b)?a[b]:(this.debug&&uvpjs.warn(c,"ConfigDataObject findItemProperty no item property:",a,b),!1):(this.debug&&uvpjs.warn(c,"ConfigDataObject findItemProperty item not found:",a),!1)},g=function(a,b,c,d){for(var e in a)if(a[e][c]==b[c])return this.debug&&uvpjs.log(d,"ConfigDataObject _addItemToArray updating existing item",b),void(a[e]=b);this.debug&&uvpjs.log(d,"ConfigDataObject _addItemToArray creating item",b),a.push(b)}}(uvpjs.register("uvpjs")),function(a){var b=a._,c=Math.random();a.ConfigManager=uvpjs.Class.subClass({init:function(a,b,d){if(this.debug=uvpjs.debug,!a||a!==c)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"ERROR: ","ConfigManager is a Singleton; obtain instance via ConfigManager.getInstance()."));this.initCallback=d,this.DEBUG_ID=uvpjs.DebugManager.configParams.CONFIG_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init sessionOptions =",b),this.CDO=new uvpjs.ConfigDataObject(b),this.debug&&uvpjs.log(this.DEBUG_ID,"init CDO =",this.CDO),this.configSources=[],this.configSources.push(this.CDO.sessionOptions.uvpc),this.debug&&uvpjs.log(this.DEBUG_ID,"init configSources =",this.configSources),this.loadConfig()},initialize:function(){},destroy:function(){this.initCallback=null,this.CDO.destroy(),this.CDO=null,uvpjs.ConfigManager.destroyInstance()},loadConfig:function(){if(!this.configSources.length)return void(b.isFunction(this.initCallback)&&this.initCallback(this.CDO));var a=this.configSources.shift();if(null!==a&&void 0!==a)switch(a.constructor){case String:if(""===a)break;return void(new uvpjs.CodeLoader).loadXHR(a,this.onLoadComplete.bind(this),this.onLoadError.bind(this));case Array:this.configSources=a.concat(this.configSources);break;case Object:this.updateCDO(a)}this.loadConfig()},onLoadComplete:function(a){var b,c,d,e=a.responseText,f=a.getResponseHeader("Content-Type");f.indexOf("application/json")>-1?d=JSON.parse(e):f.indexOf("text/xml")>-1||f.indexOf("application/xml")>-1?(b=new DOMParser,c=b.parseFromString(e,"text/xml"),d=this.xmlToCDO(c)):this.debug&&uvpjs.error(this.DEBUG_ID,"Unknwon content-type.",f),d&&this.updateCDO(d),this.loadConfig()},onLoadError:function(a){var b="unknown error";switch(a.status){case 0:b="request timeout"}this.debug&&uvpjs.error(this.DEBUG_ID,"onLoadError error =",b,a),this.loadConfig()},updateCDO:function(a){if(b.isEmpty(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"updateCDO newObj is empty"));["classes","modules"].map(function(b){a.hasOwnProperty(b)&&(this.CDO[b]=d(this.CDO[b],a[b]))},this)},xmlToCDO:function(a){var b={},c=function(a){return"y"===a||"n"===a},d=function(a){return"y"===a},g=e(a);return g.hasOwnProperty("player-config")&&(g=g["player-config"]),b.modules=function(){var a,b=[];if(g.modules){a=f(g.modules.module);for(var e in a){var h=a[e],i={name:h.name,category:h.category,enabled:d(h.enabled),params:[]};if(a[e].hasOwnProperty("params")){var j=f(h.params.param);for(var k in j){var l=j[k];l.name&&(c(l.value)&&(l.value=d(l.value)),i.params.push(l))}}h.category;b.push(i)}return b}}(),b.classes=function(){var a=f(g.classes),b=[];for(var c in a){var d=a[c];if(d.hasOwnProperty("classDef")&&(d=d.classDef),d.name){var e={name:d.name,className:d.className,properties:[],list:[]};if(d.hasOwnProperty("list")){var h=f(d.list.listitem);for(var i in h){var j=h[i];j.id&&(j.hasOwnProperty("properties")&&(j.properties=j.properties.property),e.list.push(j))}}d.hasOwnProperty("properties")&&(e.properties=d.properties.property),b.push(e)}}return b}(),b},getCDO:function(){return this.CDO}}),a.ConfigManager._instance=null,a.ConfigManager.destroyInstance=function(){this._instance=null},a.ConfigManager.getInstance=function(a,b){return this._instance||(this._instance=new uvpjs.ConfigManager(c,a,b)),this._instance};var d=function(a,b){for(var c in b){var d=!1;for(var e in a)if(a[e].name===b[c].name){d=!0;break}d||a.push(b[c])}return a},e=function(a){var b,c={};if(1===a.nodeType&&a.attributes.length>0){b=a.attributes.length;for(var d=0;d<b;d++){var f=a.attributes.item(d);c[f.nodeName]=f.nodeValue}}if(a.hasChildNodes()){b=a.childNodes.length;for(var g=0;g<b;g++){var h=a.childNodes.item(g),i=h.nodeName;if(3!==h.nodeType)if(void 0!==c[i]){if(void 0===c[i].push){var j=c[i];c[i]=[],c[i].push(j)}c[i].push(e(h))}else c[i]=e(h)}}return c},f=function(a){if(void 0!==a&&a.constructor!==String)return a.constructor===Object&&(a=[a]),a}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=null,c=null,d=a._;a.VideoPlayerFacade=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,WARNINGS:{ABR_NOT_SUPPORTED:"Adaptive Bitrate Streaming not supported.",FACADE_MUST_BE_INITIALIZED:"Facade must be initialized before you call this method",ABR_INDEX_OUT_OF_RANGE:"ABR Index is out of range",ARG_MUST_BE_BOOLEAN:"The argument must be (boolean) true or false",STARTING_BITRATE_BELOW_MIN_ALLOWED:"Unable to set start bitrate below minimum bitrate allowed threshold, upping to min threshold",STARTING_BITRATE_ABOVE_MAX_ALLOWED:"Unable to set start bitrate above maximun bitrate allowed threshold, lowering to max threshold"},MEDIA_TYPES:{VIDEO:"video",AUDIO:"audio",TEXT:"text"},eventTypes:{HTML5:{ABORT:"abort",CAN_PLAY:"canplay",CAN_PLAY_THROUGH:"canplaythrough",CLICK:"click",DURATION_CHANGE:"durationchange",ENDED:"ended",EMPTIED:"emptied",ERROR:"error",LOAD_START:"loadstart",LOADED_DATA:"loadeddata",LOADED_METADATA:"loadedmetadata",PAUSE:"pause",PLAY:"play",PLAYING:"playing",PROGRESS:"progress",RATE_CHANGE:"ratechanged",SEEKED:"seeked",SEEKING:"seeking",TIME_UPDATE:"timeupdate",VOL_CHANGE:"volumechange",STALLED:"stalled",SUSPEND:"suspend",TOUCH_END:"touchend",WAITING:"waiting",ADD_TRACK:"addtrack",CUE_CHANGE:"cuechange",WEBKIT_NEED_KEY:"webkitneedkey"},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},networkState:{NETWORK_EMPTY:0,NETWORK_IDLE:1,NETWORK_LOADING:2,NETWORK_NO_SOURCE:3},errors:{MEDIA_ERROR_ABORTED:1,MEDIA_ERROR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4}},PREFIX_CONTENT:"content_",PREFIX_ADS:"ad_",CONTROLS:"controls",errors:{DATA_LOADING_ERROR_STATE:130},errorRecovery:{networkRetryAttempts:10,mediaRetryAttempts:3,MSG_NETWORK_ERROR:"fatal network error encountered - ",MSG_MEDIA_ERROR:"fatal media error encountered - ",MSG_TRYING_TO_RECOVER_PREFIX:"trying to recover",MSG_MAX_ATTEMPS_REACHED_PREFIX:"recovery attempts exceeded maximum : "},responseHeaders:{MULTI_CDN:"x-cdn"},CDN_GEO_BLOCKED_HTTP_STATUS_CODE:{AKAMAI:464},SOURCE:"source",OBJECT:"object",POSTER:"poster",VIDEO:"video",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.playbackState=uvpjs.mediaCapabilities.EMPTY,this.videoTagRef=null,this.supportsTouchEvents=!1,this.resourceProvider={},this.vidContId="",this.vidContentId="",this.internalNS="",this.facadeState={},this.multiCDNEnabled=!0,this.hasPlaybackStarted=!1,this.isMobile=!1},initialize:function(a){var d=a.resourceProvider,e=d.vidContId;this.resourceProvider=d,this.eventsMgr=this.resourceProvider.eventsMgr,this.vidContId=e,this.assetURL=a.assetURL,this.vidContentId=this.PREFIX_CONTENT+e,this.internalNS="."+e+".facade",this.videoTagRef=document.getElementById(this.VIDEO+"_"+e),this.deferLoadingCaptions=a.deferLoadingCaptions,this._updateVolumeSettings(a),d.createWatermark()&&!a.suppressWatermark&&(b=new uvpjs.Watermark({containerId:e,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),d.is360()&&!a.suppress360&&(c=new uvpjs.Kaleidoscope360({containerId:e,eventsMgr:this.eventsMgr,videoEl:this.videoTagRef})),!0!==a.suppressCreatedEvent&&this.dispatchCreated()},dispatchCreated:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_FACADE_CREATED,{},this.vidContId)},destroy:function(){if(d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider is empty; facade already destroyed."));this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade cleanUp this.resourceProvider.rco.id = ",this.resourceProvider.rco.id),this.removeEvents(),b&&(b.destroy(),b=null),c&&(c.destroy(),c=null),this.resourceProvider=null,this.vidContId=null,this.videoTagRef=null,this.vidContId=null,this.vidContentId=null,this.internalNS=null,this.supportsTouchEvents=null,this.hasPlaybackStarted=!1},_updateVolumeSettings:function(a){var a=a||{},b=a.volume,c=!0===a.isMuted,d=this.videoTagRef;this.debug&&uvpjs.log(this.DEBUG_ID,"_updateVolumeSettings",a),uvpjs.util.inRange(b,0,1)&&d.volume!==b&&(d.volume=b),"isMuted"in a&&d.muted!==c&&this.muteVideo(c)},_addHTML5Events:function(){var a,b=this.eventTypes.HTML5,c=this.supportsTouchEvents?"TOUCH_END":"CLICK";this.debug&&uvpjs.log(this.DEBUG_ID,"_addHTML5Events");for(a in b)"CLICK"!==a&&"TOUCH_END"!==a&&this.videoTagRef.addEventListener(b[a],this,!1);this.videoTagRef.addEventListener(b[c],this,!1)},_removeHTML5Events:function(){var a,b=this.eventTypes.HTML5,c=this.supportsTouchEvents?"TOUCH_END":"CLICK";this.debug&&uvpjs.log(this.DEBUG_ID,"_removeHTML5Events");for(a in b)"CLICK"!==a&&"TOUCH_END"!==a&&this.videoTagRef.removeEventListener(b[a],this,!1);this.videoTagRef.removeEventListener(b[c],this,!1)},handleEvent:function(a){var b=this.eventTypes.HTML5;if(this.videoTagRef)switch(a.type){case b.ABORT:break;case b.CAN_PLAY:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY"),this.videoTagRef.removeEventListener(b.CAN_PLAY,this,!1);break;case b.CAN_PLAY_THROUGH:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent CAN_PLAY_THROUGH"),this.videoTagRef.removeEventListener(b.CAN_PLAY_THROUGH,this,!1),uvpjs.mediaCapabilities.isIOS()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade handleEvent  CAN_PLAY_THROUGH iDevice CASE    CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case b.CLICK:case b.DURATION_CHANGE:break;case b.EMPTIED:this.playbackStateChange(uvpjs.mediaCapabilities.EMPTY);break;case b.ENDED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ENDED"),this.videoDone();break;case b.ERROR:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent ERROR"),this.error(a.target.error);break;case b.LOAD_START:if(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOAD_START"),d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  this.resourceProvider === {}   RETURN !!!!!"));if(uvpjs.mediaCapabilities.isIOS())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START  uvpjs.mediaCapabilities.isIOS()  RETURN !!!!!"));break;case b.LOADED_METADATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_METADATA"),uvpjs.mediaCapabilities.isIOS()||(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade  handleEvent LOAD_START NON-iDEVICE CASE CALL this.resourceProvider.facadeDisplayReady()"),this.resourceProvider.facadeDisplayReady());break;case b.LOADED_DATA:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent LOADED_DATA");break;case b.PAUSE:this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE ENCOUNTERED"),this.getPlaybackState()===uvpjs.mediaCapabilities.PLAYING&&(this.debug&&uvpjs.log(this.DEBUG_ID,">>>>>>> playbackstate changed in fascade: PAUSE is new playback state, dispatch new state"),this.playbackStateChange(uvpjs.mediaCapabilities.PAUSED));break;case b.PLAY:break;case b.PLAYING:this.hasPlaybackStarted=!0,this.playbackStateChange(uvpjs.mediaCapabilities.PLAYING);break;case b.PROGRESS:this.videoLoading();break;case b.RATE_CHANGE:break;case b.SEEKING:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKING",a);break;case b.SEEKED:this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade handleEvent SEEKED",a),this.seeked(a.target.currentTime);break;case b.STALLED:case b.SUSPEND:break;case b.TIME_UPDATE:this.timeUpdated();break;case b.VOL_CHANGE:this.volumeChanged();break;case b.WAITING:}},seeked:function(a){var b=this.videoTagRef.paused,c=uvpjs.mediaCapabilities;this.playbackStateChange(b?c.PAUSED:c.PLAYING),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade seeked "+JSON.stringify({currentTime:a,paused:b,playbackState:this.playbackState},null,2)),this.resourceProvider.facadeSeeked({seekToTime:a})},videoLoading:function(){var a;try{a=this.videoTagRef.buffered.end(0)||0}catch(b){a=0}var b={bufferLength:a,duration:this.videoTagRef.duration};this.resourceProvider.facadeLoading(b)},volumeChanged:function(){var a=this.videoTagRef.volume;!d.isNumber(a)||a<0?a=0:a>1&&(a=1),this.resourceProvider.facadeVolumeChange(a)},timeUpdated:function(){var a=this.videoTagRef.currentTime;"number"==typeof a&&this.resourceProvider.facadeTimeUpdate(a)},error:function(a){var b=uvpjs.ErrorInfo.messages,c=uvpjs.ErrorInfo.errorCodes,e=b.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,f=c.UNSPECIFIED_VIDEO_PLAYBACK_ERROR,g=!0;if(a)switch(a.code){case a.MEDIA_ERR_ABORTED:g=!1,e=b.MEDIA_ERR_ABORTED,f=c.MEDIA_ERR_ABORTED;break;case a.MEDIA_ERR_NETWORK:e=b.MEDIA_ERR_NETWORK,f=c.MEDIA_ERR_NETWORK;break;case a.MEDIA_ERR_DECODE:e=b.MEDIA_ERR_DECODE,f=c.MEDIA_ERR_DECODE;break;case a.MEDIA_ERR_SRC_NOT_SUPPORTED:e=b.MEDIA_ERR_SRC_NOT_SUPPORTED,f=c.MEDIA_ERR_SRC_NOT_SUPPORTED}if(this.debug&&uvpjs.error(this.DEBUG_ID,"VideoPlayerFacade Error: "+e),d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade error(); no RP - early return."));this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:f,message:e,isFatal:g}))},hideVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="hidden")},showVideo:function(){this.videoTagRef&&(this.videoTagRef.style.visibility="visible")},stopVideo:function(){this.videoTagRef&&(this.videoTagRef.pause(),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED))},playVideo:function(){var a;this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"playVideo"),void 0!==(a=this.videoTagRef.play())&&a.then(Function.prototype).catch(this.handlePlayPromiseRejection.bind(this)))},handlePlayPromiseRejection:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Browser appears to be preventing autoplay: "+a.message),this.resourceProvider&&this.resourceProvider.facadeBrowserPlayFailure(a.message)},pauseVideo:function(){this.videoTagRef&&(this.debug&&uvpjs.log(this.DEBUG_ID,"pauseVideo"),this.videoTagRef.pause())},seekTo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"seekTo",a),isNaN(a)||this.videoTagRef&&a>=0&&a<this.videoTagRef.duration&&(this.videoTagRef.currentTime=a)},seekToLive:function(){if(this.isHDStreamLive()||this.debug&&uvpjs.warn(this.DEBUG_ID,"seekToLive attempted on non-Live Stream"),this.videoTagRef){var a=this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&this.videoTagRef.seekable.end(0);!isNaN(a)&&a>this.videoTagRef.currentTime&&(this.videoTagRef.currentTime=a)}},toggleMute:function(){var a;this.videoTagRef&&(a=!this.videoTagRef.muted,this.muteVideo(a))},setFullscreenState:function(a){},loadVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideo"),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY_THROUGH,this,!1),this.videoTagRef.load()},muteVideo:function(a){var b=!1!==a;this.videoTagRef&&(this.videoTagRef.muted=b,b&&!this.videoTagRef.getAttribute("muted")&&this.videoTagRef.setAttribute("muted","muted"),!b&&this.videoTagRef.removeAttribute("muted"))},unMuteVideo:function(){this.muteVideo(!1)},getVolume:function(){return this.videoTagRef&&this.videoTagRef.volume||0},setVolume:function(a){this.videoTagRef&&a>=0&&a<=1&&(this.videoTagRef.volume=a)},getDuration:function(){var a=0;return this.videoTagRef&&(a=this.videoTagRef.duration)===Number.POSITIVE_INFINITY&&null!==this.videoTagRef.seekable&&this.videoTagRef.seekable.length>0&&(a=this.videoTagRef.seekable.end(0)),a},getCurrentTime:function(){return this.hasPlaybackStarted&&this.videoTagRef&&this.videoTagRef.currentTime||0},isPlayingLive:function(){return!1},isHDStreamLive:function(){return!1},isAbrStreamingSupported:function(){return!1},useDynamicSwitching:function(a){(!this.isAbrStreamingSupported()||"boolean"!=typeof a)&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchUp:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchDown:function(){!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},switchToBitrate:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getMinBitrate:function(){return-1},getMaxBitrate:function(){return-1},getMinBitrateAllowed:function(){return-1},getMaxBitrateAllowed:function(){return-1},setMinBitrateAllowed:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},setMaxBitrateAllowed:function(a){return!this.isAbrStreamingSupported()&&this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),-1},getIndexForBitrate:function(a,b,c){if(a.length>0){var d=a.length,e=a[0].hasOwnProperty("bitrate")?"bitrate":"bandwidth";if(b>=a[d-1][e])return d-1;for(;d--;){if(b>=a[d][e])return c?d+1:d}}return 0},addSessionIdAndTicketToURL:function(a,b,c){if(!a)return a;var d=function(a){return-1!==a.indexOf("?")?"&":"?"};return b&&-1===a.indexOf("SessionId=")&&(a+=d(a)+"SessionId="+b),c&&-1===a.indexOf("Ticket=")&&(a+=d(a)+"Ticket="+c),a},processResponseHeader:function(a,b){switch(b){case this.responseHeaders.MULTI_CDN:this.resourceProvider.getContentVideoStateCdn()!==a&&this.resourceProvider.setContentVideoStateCdn(a)}},getCdnNameAtStartup:function(a){return""},videoDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    videoDone     uvpjs.mediaCapabilities.STOPPED   this.resourceProvider.facadeDone()   "),this.playbackStateChange(uvpjs.mediaCapabilities.STOPPED),this.resourceProvider.facadeDone()},clearVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade    clearVideo     call -> this.cleanUp();"),this.cleanUp()},removeEvents:function(){},setSize:function(a,b){},getBuffered:function(){var a,b=this.videoTagRef,c=b&&b.buffered,d=0,e=0;return c&&c.length>0&&(d=c.start&&c.start(0),e=c.end&&c.end(0)),(a=e-d)>0&&a||0},getCurrentSrc:function(){if(this.videoTagRef)return this.videoTagRef.src},getError:function(){if(this.videoTagRef)return this.videoTagRef.error},getReadyState:function(){if(this.videoTagRef)return this.videoTagRef.readyState},getNetworkState:function(){if(this.videoTagRef)return this.videoTagRef.networkState},manageNativeControls:function(a){if(this.videoTagRef){var b=this.videoTagRef.hasAttribute(this.CONTROLS);a&&!b?this.videoTagRef.setAttribute("controls",this.CONTROLS):!a&&b&&this.videoTagRef.removeAttribute(this.CONTROLS)}},playbackStateChange:function(a){if(a!==this.playbackState){if(this.playbackState=a,this.debug&&uvpjs.log(this.DEBUG_ID,"playbackStateChange this.vidContId = "+this.vidContId+" newState = "+a),d.isEmpty(this.resourceProvider))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"playbackStateChange  this.resourceProvider === {}   RETURN !!!!!"));this.resourceProvider.facadePlaybackStateChange(a)}},getPlaybackState:function(){return this.playbackState},getPlaybackFramerate:function(){return-1},getCurrentBandwidth:function(){return-1},getCurrentMaxBandwidth:function(){return-1},getDroppedFramesCount:function(){return-1},getAverageDroppedFPS:function(){return-1},getFacadeState:function(){return this.facadeState},getStreamType:function(){return""},getAssetURL:function(){var a=this.resourceProvider.getAltURL();return this.usingDynamicVariantPlaylist=!d.isUndefined(a),!this.hasManifestParsingError&&this.usingDynamicVariantPlaylist||(this.usingDynamicVariantPlaylist=!1,a=this.resourceProvider.getAssetURL()),this.debug&&uvpjs.log(this.DEBUG_ID,"VideoPlayerFacade getAssetURL assetURL",a),a},normalizeAudioTrackInfo:function(a,b){if(a){for(var c=[],d=0;d<a.length;d++){var e=a[d];this.checkCodecForWeb(e)&&c.push({index:d,id:e.id,type:e.type||e.kind,codec:e.codec||"n/a",label:b===uvpjs.mediaCapabilities.DASHJS?e.lang:e.label||e.name})}return c}},checkCodecForWeb:function(a){return!a.codec||-1!==a.codec.indexOf("mp4a")}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b="www.nielsen.com";a.VPF_Flash=uvpjs.VideoPlayerFacade.subClass({init:function(){this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"Playback will use UVP Flash."),this.player=null,this.isPaused=!1,this.isReady=!1,this.swfService=null,this.id3Options=null,this.initOptions={},this.currFlashVideoState={averageDroppedFPS:-1,bufferLength:-1,videoFramerate:-1,curMaxBandwidth:-1,isHDStreamLive:!1,isPlayingLive:!1,isSeekable:!1},this.hasCaptions=!1,this.hasSetStartBitrate=!1,this.captionsUrl=null,this.windowLabels={},this.bitrateInfo={bitrates:null,abrInfo:null,min:null,max:null},this.pendingSwitchMode=null,this.facadeType=uvpjs.mediaCapabilities.FLASH_HLS},initialize:function(a){for(var b in a)this.initOptions[b]=a[b];a.suppress360=!0,a.suppressCreatedEvent=!0,this._super(a),this.swfService=a.swfService,this.player=this.swfService.getSwf(),this.initializeCaptionStyles(),this.addUvpFlashEventListeners(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.dispatchCreated()},destroy:function(){var a;for(a in this.windowLabels)window[this.windowLabels[a]]=null;this.player&&this.player.stopVideo(),this.player&&this.player.clearVideo(),this.player=null,this.swfService=null,this._super()},pauseVideo:function(){this.isPaused=!0,this.player.pauseVideo()},playVideo:function(){this.hasPlaybackStarted?this.isPaused&&this.player.playVideo():this.loadVideo(),this.isPaused=!1},muteVideo:function(){this.player&&this.player.mute()},unMuteVideo:function(){this.player&&this.player.unMute()},getVolume:function(){return this.player&&this.player.getVolume()},setVolume:function(a){this.player&&this.player.setVolume(a)},seekTo:function(a){this.player&&this.player.seekTo(a)},seekToLive:function(){},hideVideo:function(){this.player&&(this.player.style.visibility="hidden",this.player.mute())},showVideo:function(){this.player&&(this.player.style.visibility="visible",this.player.unMute())},setFullscreenState:function(a){this.swfService.resetSize()},loadCaptions:function(a){this.captionsUrl=uvpjs.util.isEmpty(a)?null:a,this.captionsUrl&&(this.deferLoadingCaptions||(this.hasCaptions=!0,this.player.loadCaptions(a)))},showCaptions:function(){!this.hasCaptions&&this.captionsUrl?(this.player.loadCaptions(this.captionsUrl),this.hasCaptions=!0,this.player.showCaptions()):this.player.showCaptions()},hideCaptions:function(){this.player.hideCaptions()},setCaptionStyle:function(a){for(var b,c,d,e=Array.isArray(a)&&a.length||0,f=uvpjs.util,g=uvpjs.VPF_Flash.styleTransform;e--;)b=a[e],c=this.dashToCamel(b.name),d=g[c]?g[c](b.value):b.value,!f.isEmpty(b.value)&&this.player.setStyleAttribute(c,d)},setId3Options:function(a){this.id3Options=a},getAbrInfo:function(){return this.bitrateInfo.abrInfo||null},getStreamType:function(){return"HLS"},getBuffered:function(){return this.currFlashVideoState.bufferLength||-1},getAverageDroppedFPS:function(){return this.currFlashVideoState.averageDroppedFPS||-1},getPlaybackFramerate:function(){return this.currFlashVideoState.videoFramerate||-1},getDuration:function(){return this.player&&this.player.getDuration()},getCurrentTime:function(){return this.player&&this.player.getCurrentTime()},getCurrentMaxBandwidth:function(){return this.currFlashVideoState.curMaxBandwidth||-1},isHDStreamLive:function(){return this.currFlashVideoState.isHDStreamLive||!1},isPlayingLive:function(){return this.currFlashVideoState.isPlayingLive||!1},getDroppedFramesCount:function(){return-1},getCurrentBandwidth:function(){return-1},getFacadeState:function(){return{currentBitrate:this.currFlashVideoState.sourceBitrate,abrInfo:this.bitrateInfo.abrInfo}},isAbrStreamingSupported:function(){return!0},useDynamicSwitching:function(a){var b=!1===a?"false":"true";this.player.enableDynamicStreaming(b)},switchToBitrate:function(a){var b=this.findClosestBitrate(a);-1!==b.index&&this.player.switchStreamingIndex(b.index)},setMinBitrateAllowed:function(a){var b=this.findClosestBitrate(a);-1!==b.index&&(this.bitrateInfo.min=b.bitrate,this.player.setMinimumStreamingIndex(b.index))},setMaxBitrateAllowed:function(a){var b=this.findClosestBitrate(a);-1!==b.index&&(this.bitrateInfo.max=b.bitrate,this.player.setMaximumStreamingIndex(b.index))},switchUp:function(){var a=this.currFlashVideoState.playbackBitrate,b=this.findClosestBitrate(a),c=-1!==b.index&&this.bitrateInfo.bitrates.length;-1!==b.index&&b.index<c-1&&this.player.switchStreamingIndex(b.index+1)},switchDown:function(){var a=this.currFlashVideoState.playbackBitrate,b=this.findClosestBitrate(a);-1!==b.index&&b.index>0&&this.player.switchStreamingIndex(b.index-1)},getMinBitrateAllowed:function(){return this.bitrateInfo.min||-1},getMaxBitrateAllowed:function(){return this.bitrateInfo.max||-1},getMinBitrate:function(){return this.bitrateInfo.bitrates?this.bitrateInfo.bitrates[0]:-1},getMaxBitrate:function(){var a=this.bitrateInfo.bitrates&&this.bitrateInfo.bitrates.length;return a?this.bitrateInfo.bitrates[a-1]:-1},getStartBitrate:function(){return this.currFlashVideoState.defaultBitrate||-1},getCurrentBitrate:function(){return this.currFlashVideoState.sourceBitrate||-1},findClosestBitrate:function(a){for(var b,c=this.bitrateInfo.bitrates,d=c?c.length:0,e={bitrate:0,delta:1/0,index:-1};d--;)(b=Math.abs(a-c[d]))<e.delta&&(e.bitrate=c[d],e.index=d,e.delta=b);return e},hContentEvent:function(a){var b=uvpjs.VPF_Flash.uvpFlashEvent.content;switch(a){case b.CONTENT_START:this.isReady||(this.isReady=!0,this.hasPlaybackStarted=!0,this.initOptions.isMuted&&this.muteVideo(),this.resourceProvider.facadeDisplayReady());break;case b.CONTENT_END:}},hPlaybackEvent:function(a,b){var c,d=uvpjs.VPF_Flash.uvpFlashEvent.playback;switch(a){case d.VIDEO_STATE_CHANGE:this.isReady&&this.playbackStateChange(+b);break;case d.VIDEO_PROGRESS:this.processCvioPayload(b);break;case d.VIDEO_CUEPOINT:this.id3Options&&this.processCuepointPayload(b);break;case d.VIDEO_ERROR:this.processCvioPayload(b),this.dispatchError();break;case d.VIDEO_DONE:this.processCvioPayload(b),uvpjs.util.isEmpty(this.currFlashVideoState.errorInfo)?this.videoDone():this.dispatchError();break;case d.VIDEO_TRANSITION_COMPLETE:c=this.parsePayload(b),this.resourceProvider.facadeVideoTransitionComplete(c.newRate.rate,this.pendingSwitchMode),this.pendingSwitchMode=null;break;case d.VIDEO_TRANSITION_START:c=this.parsePayload(b),this.pendingSwitchMode=c.reason.toLowerCase().indexOf("manual")>=0?"manual":"auto",this.resourceProvider.facadeVideoTransitionStart(c.newRate.rate,this.pendingSwitchMode)}},dispatchError:function(){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({eventType:uvpjs.EventType.VIDEO_PLAYBACK_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.FLASH_PLAYBACK_ERROR,message:"Error from UVP Flash: "+this.currFlashVideoState.errorInfo||null,isFatal:!0}))},processCvioPayload:function(a){var b,c,d=this.parsePayload(a,"ContentVIO");if(d){c=d.ContentVIO;for(b in c)this.currFlashVideoState[b]=this.getCvioValue(c[b]);null===this.bitrateInfo.bitrates&&c.currentTime>0&&this.captureBitrateInfo()}},setStartBitrate:function(){this.hasSetStartBitrate=!0},captureBitrateInfo:function(){for(var a=[],b=[],c=this.player.getContentBitrateInfo(),d="string"==typeof c&&c.split(","),e=Array.isArray(d)?d.length:0;e--;)a[e]=+d[e],b[e]={bitrate:+d[e]};this.bitrateInfo.bitrates=a,this.bitrateInfo.abrInfo=b},processCuepointPayload:function(a){var c=this.parsePayload(a,"Cuepoint"),d=this.id3Options,e={pts:null};!c||!d.dataCallback||c.text.indexOf("syncbak.cc")>=0||(e.name=d.findNielsen&&c.text.indexOf(b)>-1?b:c.name,e.data=c.text,d.dataCallback(e))},getCvioValue:function(a){var b,c,d,e,f;return"boolean"==typeof a||"number"==typeof a?a:"string"==typeof a?(b="NaN"===a||"null"===a||""===a,c=!b&&"true"===a.toLowerCase(),d=!b&&!c&&"false"===a.toLowerCase(),e=!b&&!c&&!d&&parseInt(a),f=isNaN(e)?a:e,b?-1:!!c||!d&&f):void 0},parsePayload:function(a,b){var c=null;if(0===a.indexOf("{")||0===a.indexOf("[")){try{c=JSON.parse(a)}catch(a){return this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to parse "+b+"as JSON; "+a.message),null}return c}return a},addUvpFlashEventListeners:function(){var a,b,c,d,e,f=uvpjs.VPF_Flash.uvpFlashEvent,g={},h=function(a,b,c){return a["h"+(b.charAt(0).toUpperCase()+b.substr(1))+"Event"].bind(a,c)};for(c in f){b=f[c];for(e in b)d=b[e],g[d]=h(this,c,d)}a=this.windowLabels=uvpjs.UvpSwfService.setWindowMethods(g);for(c in a)this.player.addEventJSCallback(c,a[c])},loadVideo:function(){var a={cdn:uvpjs.UvpSwfService.constant.CDN,fileType:"m3u8"};this.initOptions.startTime&&(a.startTime=this.initOptions.startTime),this.player.loadVideoByUrl(this.assetURL,a)},initializeCaptionStyles:function(){var a,b={fontSize:14,fontColor:"0xffff00",backgroundOpacity:"75",backgroundDisplayWidth:"auto",padding:"10",yOffset:"40"};for(a in b)this.player.setStyleAttribute(a,b[a])},dashToCamel:function(a){return a.replace(/(-\w)/g,function(a){return a[1].toUpperCase()})}}),a.VPF_Flash.uvpFlashEvent={content:{CONTENT_END:"onContentEnd_cbsi",CONTENT_START:"onContentStart_cbsi"},playback:{VIDEO_CUEPOINT:"onVideoCuePoint",VIDEO_DONE:"onVideoDone",VIDEO_ERROR:"onVideoError",VIDEO_PROGRESS:"onVideoProgress",VIDEO_STATE_CHANGE:"onStateChange_cbsi",VIDEO_TRANSITION_COMPLETE:"onVideoTransitionComplete",VIDEO_TRANSITION_START:"onVideoTransitionStart"}},a.VPF_Flash.styleTransform={_opacity:function(a){return 100*+a},backgroundOpacity:function(a){return uvpjs.VPF_Flash.styleTransform._opacity(a)},fontOpacity:function(a){return uvpjs.VPF_Flash.styleTransform._opacity(a)},fontSize:function(a){var b=a.substr(0,a.indexOf("%")),c=.01*+b;return Math.round(14*c)}}}(uvpjs.register("uvpjs")),function(a){var b=a._;a.VPF_HTML5=uvpjs.VideoPlayerFacade.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HTML5,init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 Init"),this.facadeType=uvpjs.mediaCapabilities.HTML5,this.onStalledEvent=this.onStalledEvent.bind(this),this.fairplayDRM=null,this.startTime=null,this.hCueChange=this.onCueChange.bind(this),this.hTextTrackAdded=this.onAddTextTrack.bind(this),this.hVideoEvent=this.onVideoEvent.bind(this),this.activeMetadataTrack=null,this._super()},destroy:function(){this.fairplayDRM&&this.fairplayDRM.destroy(),this.fairplayDRM=null,this.videoTagRef.removeAttribute("src"),this.videoTagRef.load(),this._super(),this.activeMetadataTrack=null,this.hCueChange=Function.prototype,this.hTextTrackAdded=Function.prototype},initialize:function(a){this.debug&&(uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize resourceProvider.rco.id = ",a.resourceProvider.rco.id),uvpjs.log(this.DEBUG_ID,"VPF_HTML5 initialize this.options = ",a)),this._super(a),a.drm.enabled&&(this.fairplayDRM=new uvpjs.FairPlayDRM({drm:a.drm,videoTagRef:this.videoTagRef,eventTypes:this.eventTypes,errorCallback:this.handleFairPlayError.bind(this)})),!uvpjs.util.isEmpty(a.startTime)&&(this.startTime=Math.floor(a.startTime)),this.addEvents(),this.setSource(),this.processResponseHeader(this.getCdnNameAtStartup(this.assetURL),this.responseHeaders.MULTI_CDN),this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5  initialize  COMPLETE   this.options = ",a)},handleEvent:function(a){var b=this.eventTypes.HTML5;this.videoTagRef&&(this._super(a),a.type===b.LOADED_METADATA&&this.startTime&&(this.videoTagRef.currentTime=this.startTime,this.startTime=null))},handleFairPlayError:function(a,b){this.resourceProvider.facadeError(new uvpjs.ErrorInfo({errorCode:a,message:b,isFatal:!0}))},setSource:function(){try{this.videoTagRef.src=this.assetURL}catch(a){console.log("Error caught at setSource: ",a)}this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 setSource this.videoTagRef.src",this.videoTagRef.src)},addEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 addEvents"),this._addHTML5Events(),this.videoTagRef.addEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.addEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.videoTagRef.textTracks.addEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1)},onVideoEvent:function(a){a.type===this.eventTypes.HTML5.CAN_PLAY&&(this.videoTagRef.removeEventListener(this.eventTypes.HTML5.CAN_PLAY,this.hVideoEvent,!1),this.updateAudioTracksInfo())},switchAudioTrack:function(a){this.videoTagRef.audioTracks?(this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+a),this.videoTagRef.audioTracks[a].enabled=!0,this.updateAudioTracksInfo()):this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switching is not supported on this user agent")},updateAudioTracksInfo:function(){var a=this.normalizeAudioTrackInfo(this.videoTagRef.audioTracks,uvpjs.mediaCapabilities.HTML5);if(a){var b=this.getCurrentEnabledAudioTrackIndex(this.videoTagRef.audioTracks),c={tracks:a,track:a[b],index:b};this.resourceProvider.facadeSetAudioTrackInfo(c)}},getCurrentEnabledAudioTrackIndex:function(a){for(var b=a.length;b--;)if(a[b].enabled)return b;return b},onAddTextTrack:function(a){a.track&&"metadata"===a.track.kind&&(this.activeMetadataTrack=a.track),a.track.addEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},onCueChange:function(a){a&&a.target&&a.target.activeCues&&a.target.activeCues.length>=1&&("metadata"===a.target.kind?this.resourceProvider.facadeId3Data(a.target.activeCues):"captions"!==a.target.kind&&"subtitles"!==a.target.kind||(a.target.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1),this.resourceProvider.facadeSetCaptionReady()))},showCaptions:function(a){if(uvpjs.util.isDefinedString(a)){for(var b=this.videoTagRef.textTracks,c=!1,d=0,e=b.length;d<e;d++){var f=b[d];f.language===a?(c=!0,f.mode="hidden"):f.mode="disabled"}c||(uvpjs.log(this.DEBUG_ID,"Language string was supplied but nothing matched in the stream. Enabling the first track in the list as best effort",b,a),b[0].mode="hidden")}},removeEvents:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 removeEvents"),this._removeHTML5Events(),this.videoTagRef.removeEventListener(this.eventTypes.HTML5.STALLED,this.onStalledEvent,!1),this.videoTagRef.textTracks&&this.videoTagRef.textTracks.removeEventListener(this.eventTypes.HTML5.ADD_TRACK,this.hTextTrackAdded,!1),this.activeMetadataTrack&&this.activeMetadataTrack.removeEventListener(this.eventTypes.HTML5.CUE_CHANGE,this.hCueChange,!1)},getFacadeState:function(){return this.facadeState||{}},getStreamType:function(){return uvpjs.mediaCapabilities.isSafari()?"HLS":"MP4"},onStalledEvent:function(a){if(b.isEmpty(this.resourceProvider)||b.isEmpty(this.resourceProvider.cviModel))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event,(_.isEmpty(this.resourceProvider) || _.isEmpty(this.resourceProvider.cviModel) RETURN event = ",a));var c=this.resourceProvider.cviModel.contentPlaybackState.playbackStarted;this.debug&&uvpjs.log(this.DEBUG_ID,"VPF_HTML5 onStalledEvent event, hasPlaybackStarted",a,c)}})}(uvpjs.register("uvpjs")),function(a){a.VPF_HLSJS=uvpjs.VideoPlayerFacade.subClass({debug:"prod"!==uvpjs.Configuration.env,DEBUG_ID:uvpjs.DebugManager.configParams.VPF_HLSJS,LIB_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LIB,LEVEL_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_LEVEL,FRAG_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAG,FRAME_DROP_DEBUG_ID:uvpjs.DebugManager.configParams.HLSJS_FRAME_DROP,LIVE_POINT_GRACE_SECONDS:11,init:function(){this.debug=uvpjs.debug,this._super(),this.debug&&uvpjs.log(this.DEBUG_ID,"HLS.js version: "+Hls.version),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this._isHdStreamLive=!1,this.id3HandlingEnabled=!1,this.mc=uvpjs.mediaCapabilities,this.facadeType=this.mc.HLSJS,this.withCredentials=!1,this.startTime=-1,this.maxBitrate=-1,this.minBitrate=-1,this.startBitrate=-1,this.bitrateList=null,this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0,this.levelDetails=null,this.isMobile=uvpjs.mediaCapabilities.isMobile(),this.libConfig={debug:uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),enableWorker:!0,autoStartLoad:!1,enableCEA708Captions:!0,initialLiveManifestSize:1,liveSyncDurationCount:3,capLevelToPlayerSize:!1,xhrSetup:this.onRequest.bind(this)},this.onLibraryEvent=this.onLibraryEvent.bind(this),this.onLevelEvent=this.onLevelEvent.bind(this),this.onAudioEvent=this.onAudioEvent.bind(this),this.onFragmentEvent=this.onFragmentEvent.bind(this),this.onID3Event=this.onID3Event.bind(this),this.onError=this.onError.bind(this)},destroy:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"destroy");for(var a=this.videoTagRef.textTracks,b=0;b<a.length;b++){var c=a[b];"captions"!==c.kind&&"subtitles"!==c.kind||(c.textTrack1&&(c.textTrack1=!1),c.textTrack2&&(c.textTrack2=!1))}this.player.destroy(),this._super(),this._currentBandwidth=null,this._currentMaxBandwidth=null,this._playbackFramerate=null,this.bitrateList=null,this.levelDetails=null},initialize:function(a){return this._super(a),this.id3HandlingEnabled=a.enableId3Handling,"number"==typeof a.liveSyncDurationCount&&a.liveSyncDurationCount>0&&(this.libConfig.liveSyncDurationCount=a.liveSyncDurationCount),!0===a.capLevelToPlayerSize&&(this.libConfig.capLevelToPlayerSize=a.capLevelToPlayerSize),this.isMobile&&(this.libConfig.maxBufferLength=20,this.libConfig.maxMaxBufferLength=60,this.libConfig.liveBackBufferLength=30),uvpjs.util.isEmpty(a.hlsjsLoader)||(this.debug&&uvpjs.log(this.DEBUG_ID,"Hlsjs using custom loader."),this.libConfig.loader=a.hlsjsLoader),this.player=new Hls(this.libConfig),this.addEvents(),"number"==typeof a.startBitrate&&a.startBitrate>-1&&(this.startBitrate=a.startBitrate),"number"==typeof a.maxBitrate&&a.maxBitrate>-1&&(this.maxBitrate=a.maxBitrate),"number"==typeof a.minBitrate&&a.minBitrate>-1&&(this.minBitrate=a.minBitrate),a.startTime&&(this.startTime=Math.round(a.startTime)),a.errorRecovery&&this.setErrorRecoveryOverrides(a.errorRecovery),this.resourceProvider.rco.withCredentials&&(this.withCredentials=this.resourceProvider.rco.withCredentials),this.player.loadSource(this.assetURL),this.player.attachMedia(this.videoTagRef),this.player},seekToLive:function(){this.player&&this._isHdStreamLive?this.seekTo(this.getLiveEdgeOffset()):uvpjs.warn(this.DEBUG_ID,"Unable to seekToLive - isHDStreamLive? "+isHDStreamLive)},isAbrStreamingSupported:function(){return this.bitrateList?this.bitrateList.length>0:this._super()},useDynamicSwitching:function(a){this._super(),this.player?this.player.nextLevel=a?-1:this.player.currentLevel:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchAudioTrack:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switch requested - id: "+a),this.player.audioTrack=a},switchUp:function(){this.player?this.switchToIndex(this.player.nextLoadLevel+1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchDown:function(){this.player?this.switchToIndex(this.player.nextLoadLevel-1):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},switchToBitrate:function(a){this.switchToIndex(this.getIndexForBitrate(this.bitrateList,a,!1))},switchToIndex:function(a){if(this.isAbrStreamingSupported()){this.getMinBitrateAllowed()>0&&this.setMinBitrateAllowed(0),!this.player.config.capLevelToPlayerSize&&this.getMaxBitrateAllowed()>0&&this.setMaxBitrateAllowed(-1);var b=-1!==this.player.autoLevelCapping?this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1):NaN,c=isNaN(b)?this.bitrateList.length-1:b;a>=0&&a<=c?this.player.nextLevel=a:uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_INDEX_OUT_OF_RANGE,"Range=",0,"-",c," : Index=",a)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED)},showCaptions:function(){this.player.subtitleTracks.length>0&&(this.player.subtitleTrack=0)},getStartBitrate:function(){var a=this.player;return this.startBitrate||this.minBitrate||a&&a.levels&&a.levels[0]&&a.levels[0].bitrate||-1},setStartBitrate:function(a){this.player?(a<this.getMinBitrateAllowed()&&(a=this.getMinBitrateAllowed(),this.debug&&uvpjs.warn(this.DEBUG_ID,this.WARNINGS.STARTING_BITRATE_BELOW_MIN_ALLOWED)),this.player.config.startLevel=this.getIndexForBitrate(this.bitrateList,a,!1)):uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMinBitrateAllowed:function(){if(this.player){var a=this.player.minAutoLevel;return this.bitrateList?this.bitrateList[a].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMinBitrateAllowed:function(a){if(this.player){this.player.config.minAutoBitrate=a-1;var b=this.getIndexForBitrate(this.bitrateList,a,!0);this.player.currentLevel<b&&(this.player.nextAutoLevel=b),uvpjs.warn(this.DEBUG_ID,"setMinBitrateAllowed",a)}else uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED)},getMaxBitrateAllowed:function(){if(this.player){var a=this.player.maxAutoLevel;return void 0!==a?this.bitrateList[a].bitrate:this._super()}return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super()},setMaxBitrateAllowed:function(a){if(!this.player)return uvpjs.warn(this.DEBUG_ID,this.WARNINGS.FACADE_MUST_BE_INITIALIZED),this._super();this.player.autoLevelCapping=-1===a?a:this.getIndexForBitrate(this.bitrateList,a,!1),uvpjs.warn(this.DEBUG_ID,"setMaxBitrateAllowed",a)},getMinBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[0].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getMaxBitrate:function(){return this.isAbrStreamingSupported()?this.bitrateList[this.bitrateList.length-1].bitrate:(uvpjs.warn(this.DEBUG_ID,this.WARNINGS.ABR_NOT_SUPPORTED),this._super())},getCurrentBitrate:function(){var a=-1;return this.bitrateList&&this.bitrateList[this.player.currentLevel]&&(a=this.bitrateList[this.player.currentLevel].bitrate),a},getPlaybackFramerate:function(){return this._playbackFramerate||0},getCurrentBandwidth:function(){return this._currentBandwidth||0},getCurrentMaxBandwidth:function(){return this._currentMaxBandwidth||0},getDroppedFramesCount:function(){var a,b,c=this.player;if(c)return a=this.player.media,(b=a.getVideoPlaybackQuality)&&"function"==typeof b?b.call(a).droppedVideoFrames:a.webkitDroppedFrameCount||0},getAverageDroppedFPS:function(){return this.getDroppedFramesCount()/this.getDuration()},getCappedAbrInfo:function(){var a=this.getIndexForBitrate(this.bitrateList,this.getMaxBitrateAllowed(),!1)+1,b=this.getIndexForBitrate(this.bitrateList,this.getMinBitrateAllowed(),!0);return this.bitrateList.slice(b,a)},getFacadeState:function(){this.videoTagRef&&this.videoTagRef.textTracks.length>0&&void 0!==this.videoTagRef.textTracks[0]&&this.player&&-1===this.player.subtitleTrack&&this.showCaptions();var a={startBitrate:-1,currentBitrate:-1,minBitrate:-1,maxBitrate:-1,droppedFrames:this.getDroppedFramesCount(),droppedFPS:this.getAverageDroppedFPS(),playbackFramerate:this.getPlaybackFramerate(),abrInfo:[],currentAbr:{bitrate:0,levelId:{},info:{},detail:{},stats:{},updated:!1}};return this.player&&this.bitrateList&&(a.abrInfo=this.bitrateList,a.currentAbr=this.bitrateList[this.player.currentLevel],a.cappedAbrInfo=this.getCappedAbrInfo(),a.startBitrate=this.getStartBitrate(),a.currentBitrate=this.getCurrentBitrate(),a.minBitrate=this.getMinBitrateAllowed(),a.maxBitrate=this.getMaxBitrateAllowed()),a},getStreamType:function(){return"HLS"},isPlayingLive:function(){var a=!1;if(this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.currentTime>=0){var b=Math.floor(this.getLiveEdgeOffset());a=Math.ceil(this.videoTagRef.currentTime)>=b}return a},getLiveEdgeOffset:function(){var a=Number.POSITIVE_INFINITY;if(this._isHdStreamLive&&this.levelDetails&&this.videoTagRef.duration>0)var a=this.videoTagRef.duration-this.player.config.liveSyncDurationCount*this.levelDetails.targetduration;return a},isHDStreamLive:function(){return this._isHdStreamLive},addEvents:function(){this._addHTML5Events();var a=Hls.Events,b=this.onLibraryEvent,c=this.onLevelEvent,d=this.onAudioEvent,e=this.onFragmentEvent;this.player.on(a.MEDIA_ATTACHING,b,!1),this.player.on(a.MEDIA_ATTACHED,b,!1),this.player.on(a.MEDIA_DETACHING,b,!1),this.player.on(a.MANIFEST_PARSED,b,!1),this.player.on(a.MANIFEST_LOADED,b,!1),this.player.on(a.MANIFEST_LOADING,b,!1),this.player.on(a.FPS_DROP,b,!1),this.player.on(a.SUBTITLE_TRACKS_UPDATED,b,!1),this.player.on(a.LEVEL_SWITCHING,c,!1),this.player.on(a.LEVEL_SWITCHED,c,!1),this.player.on(a.LEVEL_LOADING,c,!1),this.player.on(a.LEVEL_LOADED,c,!1),this.player.on(a.LEVEL_UPDATED,c,!1),this.player.on(a.LEVEL_PTS_UPDATED,c,!1),this.player.on(a.AUDIO_TRACKS_UPDATED,d,!1),this.player.on(a.AUDIO_TRACK_SWITCHED,d,!1),this.player.on(a.FRAG_LOADING,e,!1),this.player.on(a.FRAG_LOAD_PROGRESS,e,!1),this.player.on(a.FRAG_LOADED,e,!1),this.player.on(a.FRAG_PARSED,e,!1),this.player.on(a.FRAG_BUFFERED,e,!1),this.player.on(a.FRAG_CHANGED,e,!1),this.player.on(a.FRAG_PARSING_DATA,e,!1),this.id3HandlingEnabled&&this.player.on(a.FRAG_PARSING_METADATA,this.onID3Event,!1),this.player.on(a.ERROR,this.onError,!1)},removeEvents:function(){this._removeHTML5Events();var a=Hls.Events,b=this.onLibraryEvent,c=this.onLevelEvent,d=this.onAudioEvent,e=this.onFragmentEvent;this.player.off(a.MEDIA_ATTACHING,b),this.player.off(a.MEDIA_ATTACHED,b),this.player.off(a.MEDIA_DETACHING,b),this.player.off(a.MANIFEST_PARSED,b),this.player.off(a.MANIFEST_LOADED,b),this.player.off(a.MANIFEST_LOADING,b),this.player.off(a.FPS_DROP,b),this.player.off(a.SUBTITLE_TRACKS_UPDATED,b),this.player.off(a.LEVEL_SWITCHING,c),this.player.off(a.LEVEL_SWITCHED,c),this.player.off(a.LEVEL_LOADING,c),this.player.off(a.LEVEL_LOADED,c),this.player.off(a.LEVEL_UPDATED,c),this.player.off(a.LEVEL_PTS_UPDATED,c),this.player.off(a.AUDIO_TRACKS_UPDATED,d,!1),this.player.off(a.AUDIO_TRACK_SWITCHED,d,!1),this.player.off(a.FRAG_LOADING,e),this.player.off(a.FRAG_LOAD_PROGRESS,e),this.player.off(a.FRAG_LOADED,e),this.player.off(a.FRAG_PARSED,e),this.player.off(a.FRAG_BUFFERED,e),this.player.off(a.FRAG_CHANGED,e),this.player.off(a.FRAG_PARSING_DATA,e),this.id3HandlingEnabled&&this.player.off(a.FRAG_PARSING_METADATA,this.onID3Event),this.player.off(a.ERROR,this.onError)},handleManifestData:function(a){this.bitrateList=this.player.levels;for(var b,c=a.levels,d=c.length,e=[];d--;)b=c[d],e.unshift({name:b.name||null,rate:b.bitrate,width:b.width,height:b.height});e.sort(function(a,b){var c=a.rate,d=b.rate;return c<d?-1:c>d?1:0}),this.resourceProvider.facadeMetadataParsed({abrInfo:e})},onRequest:function(a,b){this.withCredentials=this.withCredentials||b.indexOf("akamaihd")>-1&&b.indexOf("csmil")>-1,a.withCredentials=this.withCredentials;var c=function(c){if(-1!==b.indexOf(".ts")&&a.readyState===XMLHttpRequest.HEADERS_RECEIVED&&this.multiCDNEnabled){var d=a.getAllResponseHeaders();this.multiCDNEnabled=-1!==d.indexOf(this.responseHeaders.MULTI_CDN);var e=this.multiCDNEnabled?a.getResponseHeader(this.responseHeaders.MULTI_CDN.toUpperCase()):this.getCdnNameAtStartup(b);this.processResponseHeader(e,this.responseHeaders.MULTI_CDN)}};(this.multiCDNEnabled||-1!==b.indexOf(".m3u8"))&&a.addEventListener("readystatechange",c.bind(this))},onLibraryEvent:function(a,b){this.debug&&uvpjs.log(this.LIB_DEBUG_ID,a,b);var c=Hls.Events;switch(a){case c.MEDIA_ATTACHING:case c.MEDIA_ATTACHED:case c.MEDIA_DETACHING:case c.MANIFEST_LOADING:break;case c.MANIFEST_PARSED:this.handleManifestData(b);break;case c.FPS_DROP:break;case c.MANIFEST_LOADED:this.maxBitrate>-1&&(this.setMaxBitrateAllowed(this.maxBitrate),this.resourceProvider.facadeMaximumBitrateAllowedChanged(this.maxBitrate)),this.minBitrate>-1&&(this.setMinBitrateAllowed(this.minBitrate),this.resourceProvider.facadeMinimumBitrateAllowedChanged(this.minBitrate)),this.startBitrate>-1&&this.setStartBitrate(this.startBitrate),this.player.autoStartLoad||this.player.startLoad(this.startTime);break;case c.SUBTITLE_TRACKS_UPDATED:this.player.subtitleDisplay=!1}},onLevelEvent:function(a,b){this.debug&&uvpjs.log(this.LEVEL_DEBUG_ID,a,b);var c=Hls.Events;switch(a){case c.LEVEL_LOADED:this.resourceProvider.facadeVideoLevelLoaded(b.details);break;case c.LEVEL_LOADING:break;case c.LEVEL_UPDATED:b.details&&(this.levelDetails=b.details,this._isHdStreamLive=b.details.live);break;case c.LEVEL_PTS_UPDATED:break;case c.LEVEL_SWITCHING:this.resourceProvider.facadeVideoTransitionStart(this.bitrateList[b.level].bitrate);break;case c.LEVEL_SWITCHED:this.resourceProvider.facadeVideoTransitionComplete(this.bitrateList[b.level].bitrate)}},onAudioEvent:function(a,b){if(a===Hls.Events.AUDIO_TRACKS_UPDATED||a===Hls.Events.AUDIO_TRACK_SWITCHED){var c=this.normalizeAudioTrackInfo(this.player.audioTracks,this.mc.HLSJS),d={tracks:c,track:c[this.player.audioTrack],index:this.player.audioTrack};this.resourceProvider.facadeSetAudioTrackInfo(d),this.debug&&uvpjs.log(this.DEBUG_ID,"Audio Track switched "+d.track.id)}},onFragmentEvent:function(a,b){var c,d,e=Hls.Events;switch(a){case e.FRAG_LOAD_PROGRESS:break;case e.FRAG_PARSING_DATA:"video"===b.type&&(this._playbackFramerate=b.nb/(b.endPTS-b.startPTS));break;case e.FRAG_LOADED:d=b.stats,c=8e3*d.loaded/Number(window.performance.now()-d.trequest),this._currentBandwidth=c,this._currentMaxBandwidth=Math.max(c,this._currentMaxBandwidth),this.networkErrorRecoveryCount=0,this.mediaErrorRecoveryCount=0;break;case e.FRAG_CHANGED:}},onID3Event:function(a,b){this.resourceProvider.facadeId3Data(b.samples)},onError:function(a,b){var c=!1,d=[Hls.ErrorDetails.MANIFEST_LOAD_ERROR,Hls.ErrorDetails.MANIFEST_PARSING_ERROR];if(b.fatal&&-1===d.indexOf(b.details))switch(this.debug&&uvpjs.error(this.DEBUG_ID,a,b.type,b.details,"isFatal: "+b.fatal),b.type){case Hls.ErrorTypes.NETWORK_ERROR:c=this.networkErrorRecoveryCount<this.errorRecovery.networkRetryAttempts,c&&(this.networkErrorRecoveryCount++,this.player.startLoad(this.startTime)),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(c).network());break;case Hls.ErrorTypes.MEDIA_ERROR:c=this.tryRecoveryFromMediaError()}else b.details===Hls.ErrorDetails.BUFFER_APPENDING_ERROR?this.mc.isFirefox()&&parseInt(this.mc.getBrowserMajorVersion())<49&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"Handling Firefox buffer appending error.",b.type,b.details,"isFatal: "+b.fatal),c=this.tryRecoveryFromMediaError(),setTimeout(function(){this.player.startLoad(),this.player.media.play()}.bind(this),100)):this.debug&&uvpjs.warn(this.DEBUG_ID,a,b.type,b.details,"isFatal: "+b.fatal);c||(b.response&&b.response.code&&b.response.code===this.CDN_GEO_BLOCKED_HTTP_STATUS_CODE.AKAMAI?(this.resourceProvider.facadeError(this.getErrorInfoForType(uvpjs.ErrorInfo.errorCodes.RESOURCE_GEOBLOCKED,b.details,b.fatal)),this.debug&&uvpjs.warn(this.DEBUG_ID,uvpjs.ErrorInfo.messages.RESOURCE_GEOBLOCKED)):this.resourceProvider.facadeError(this.getErrorInfoForType(b.type,b.details,b.fatal)))},tryRecoveryFromMediaError:function(){var a=this.mediaErrorRecoveryCount<this.errorRecovery.mediaRetryAttempts;return a&&(this.mediaErrorRecoveryCount++,this.player.recoverMediaError()),uvpjs.warn(this.DEBUG_ID,this.getErrorMsg(a).media()),a},getErrorMsg:function(a){var b=a?this.errorRecovery.MSG_TRYING_TO_RECOVER_PREFIX:this.errorRecovery.MSG_MAX_ATTEMPS_REACHED_PREFIX,c=" attempt : ";return{network:function(){return c+=this.networkErrorRecoveryCount+"/"+this.errorRecovery.networkRetryAttempts,this.errorRecovery.MSG_NETWORK_ERROR+b+c}.bind(this),media:function(){return c+=this.mediaErrorRecoveryCount+"/"+this.errorRecovery.mediaRetryAttempts,this.errorRecovery.MSG_MEDIA_ERROR+b+c}.bind(this)}},getErrorInfoForType:function(a,b,c){var d=uvpjs.ErrorInfo,e=Hls.ErrorTypes,f=uvpjs.ErrorInfo.errorCodes;switch(a){case e.NETWORK_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_NETWORK_ERROR,message:d.messages.HLSJS_NETWORK_ERROR.replace("{INFO}",b),isFatal:c});case e.MEDIA_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_MEDIA_ERROR,message:d.messages.HLSJS_MEDIA_ERROR.replace("{INFO}",b),isFatal:c});case e.MUX_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_MUX_ERROR,message:d.messages.HLSJS_MUX_ERROR.replace("{INFO}",b),isFatal:c});case e.OTHER_ERROR:return new d({errorCode:f.HLSJS_PLAYBACK_ERROR,hlsjsErrorCode:f.HLSJS_OTHER_ERROR,message:d.messages.HLSJS_OTHER_ERROR.replace("{INFO}",b),isFatal:c});case f.RESOURCE_GEOBLOCKED:return new d({errorCode:f.RESOURCE_GEOBLOCKED,hlsjsErrorCode:f.HLSJS_OTHER_ERROR,message:d.messages.RESOURCE_GEOBLOCKED,isFatal:c})}},setErrorRecoveryOverrides:function(a){["network","media"].forEach(function(b){a[b]&&a[b].attempts&&"number"==typeof a[b].attempts&&(this.errorRecovery[b+"RetryAttempts"]=a[b].attempts)}.bind(this))}})}(uvpjs.register("uvpjs")),function(a){"use strict";function b(a){if(!isNaN(a))return a<1048576?(a/1024).toFixed(2)+"k":a<1073741824?(a/1048576).toFixed(2)+"M":(a/1073741824).toFixed(2)+"G"}a.Diagnostic=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"diagnostic_",init:function(a){var b,c=uvpjs.Configuration;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Create diagnostic window."),a&&(b=a.videoEl,this._videoEl=b,this._containerEl=a.containerEl,this._eventsMgr=a.eventsMgr,this._containerId=this._containerEl.id,this._diagnosticId=this.PREFIX+this._containerId,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".diagnostic",this._menuEl=null,this._diagEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._params={"player version":c.version,"stream type":null,"playback state":null,duration:null,"current time":null,"buffer length":null,"total dropped frames":null,"average dropped (fps)":null,"playback framerate (fps)":null,"switching mode":null,"available indexes":null,"transition state":null,"start index bitrate (B/s)":null,"current index bitrate (B/s)":null,"current bandwidth (B/s)":null},uvpjs.util.createStyleSheet(this._finalize.bind(this)))},destroy:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Removing diagnostic window."),!this._diagEl||!this._contentEl)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnostic: unable to remove window."));this._removeEventListeners(),this._removeDiag(),this._eventsMgr=null,this._containerEl=null,this._diagnosticId=null,this._contentEl=null,this._videoEl=null,this._diagEl=null,this._menuEl=null,this._styleEl=null,this._diagTableEl=null,this._showDiagBtn=null,this._hideDiagBtn=null,this._namespace=null,this._params=null},show:function(){this._showDiag()},hide:function(){this._hideDiag()},_finalize:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _finalize"),this._styleEl=a,this._createDiag(),this._addEventListeners()},_createDiag:function(){var a,b,c,d=uvpjs.util,e=this._styleEl,f=this._contentEl;this._template,this._params;f&&(a=document.createElement("div"),a.id=this._diagnosticId,f.insertBefore(a,f.firstChild),c=uvpjs.util.htmlToElement("<span>x</span>"),c.addEventListener("click",this._handleCloseButton.bind(this),!0),a.appendChild(c),b=document.createElement("table"),a.appendChild(b),d.addCSSObject(e,a,{background:"rgba(28, 28, 28, 0.7)",border:0,"border-radius":"4px",color:"white",display:"none","font-family":"Arial, Tahoma, Geneva, sans-serif","font-size":"12px",left:"5px","line-height":"1",padding:"5px",position:"absolute",top:"5px","z-index":10}),d.addCSSObject(e,a,{color:"#777",cursor:"pointer",float:"right","font-size":"14px","line-height":"1",margin:"-15px -10px",padding:"10px"},"span"),d.addCSSObject(e,a,{color:"#fff"},"span:hover"),d.addCSSObject(e,a,{"border-spacing":"auto","margin-right":"20px",border:0,padding:0,margin:0},"table"),d.addCSSObject(e,a,{background:"transparent"},"table td"),d.addCSSObject(e,a,{color:"#c9c9c9",padding:"0 5px"},"table td:first-child"),d.addCSSObject(e,a,{width:"60px"},"table td:last-child"),this._diagEl=a,this._diagTableEl=b,this._hideDiagBtn=c)},_removeDiag:function(){var a=this._diagEl,b=this._hideDiagBtn;b&&b.removeEventListener("click",this._handleCloseButton.bind(this)),a&&a.remove()},_hideDiag:function(){var a=this._diagEl,b=this._eventsMgr;a&&(a.style.display="none"),b.dispatchEvent(b.eventTypes.DIAGNOSTIC_WINDOW_CLOSED,{},this._containerId)},_showDiag:function(){var a=this._diagEl;a&&(a.style.display="block")},_toggleDiag:function(){var a=this._diagEl;if(a)return"block"===a.style.display?void this._hideDiag():void this._showDiag()},_handleCloseButton:function(){var a=this._eventsMgr;this.debug&&uvpjs.log(this.DEBUG_ID,"_handleCloseButton"),this._hideDiag(),a.dispatchEvent(a.eventTypes.DIAGNOSTIC_WINDOW_CLOSE_BUTTON,{},this._containerId)},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;this._containerEl;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to add event listeners."));this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: Adding event listeners."),b.addEventListener(c.VIDEO_PROGRESS+a,this._onVideoProgress.bind(this)),b.addEventListener(c.VIDEO_STATE_CHANGE+a,this._onVideoStateChange.bind(this)),b.addEventListener(c.VIDEO_TRANSITION_START+a,this._onVideoTransitionStart.bind(this)),b.addEventListener(c.VIDEO_TRANSITION_COMPLETE+a,this._onVideoTransitionComplete.bind(this))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;this._containerEl;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Diagnsotic: unable to remove event listeners."));b.removeEventListener(c.VIDEO_PROGRESS+a),b.removeEventListener(c.VIDEO_STATE_CHANGE+a),b.removeEventListener(c.VIDEO_TRANSITION_START+a),b.removeEventListener(c.VIDEO_TRANSITION_COMPLETE+a)},_updateTableHtml:function(){var a,b,c="",d=this._params;for(a in d)null!==(b=d[a])&&void 0!==b&&(c+="<tr><td>"+a+"</td><td>"+b+"</td></tr>");this._diagTableEl.innerHTML=c},_onVideoProgress:function(a){var c=a.payload,d=c.facadeState,e=this._params,f=d.minABRLevel,g=d.maxABRLevel;a.target===this._containerId&&(e["stream type"]=c.streamType,e.duration=c.duration,e["current time"]=c.currentTime.toFixed(2),e["buffer length"]=c.bufferLength.toFixed(2),e["total dropped frames"]=c.droppedFrames>=0&&c.droppedFrames||null,e["average dropped (fps)"]=c.averageDroppedFPS>=0&&c.averageDroppedFPS.toFixed(2)||null,e["playback framerate (fps)"]=c.playbackFramerate>=0&&c.playbackFramerate.toFixed(2)||null,e["current bandwidth (B/s)"]=c.currentBandwidth>=0&&b(c.currentBandwidth)||null,e["switching mode"]=c.switchingMode,e["current index bitrate (B/s)"]=b(d.currentAbr&&d.currentAbr.bitrate),e["start index bitrate (B/s)"]=b(d.startBitrate),void 0!==f&&void 0!==g&&(e["available indexes"]=f+" to "+g),this._updateTableHtml())},_onVideoStateChange:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(c["playback state"]=b.newState,this._updateTableHtml())},_onVideoTransitionStart:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionStart",b),c["transition state"]="start",this._updateTableHtml())},_onVideoTransitionComplete:function(a){var b=a.payload,c=this._params;a.target===this._containerId&&(this.debug&&uvpjs.log(this.DEBUG_ID,"Diagnostic: _onVideoTransitionComplete",b),c["transition state"]="complete",this._updateTableHtml())}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.Watermark=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,IMAGE:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAAAqCAYAAABY4gKWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGNTVGM0ZGMTBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGNTVGM0ZGMjBGN0IxMUUzOEQxQ0UwRUY4QzJFQzczMyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkY1NUYzRkVGMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkY1NUYzRkYwMEY3QjExRTM4RDFDRTBFRjhDMkVDNzMzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+PHDLXgAACblJREFUeNrsXAdz2zoMBjU8Yzuz+f//7rWNM7yn9Ky7DxHCUhIoS26aC+94SRuJAoEPk8OkaUrf7bud26JvFnzZFpx659S7px5D1gY9awn6/tR3p7499UPdj5lvi/TlWgacK/wMAZwyITOwjgDVCj25FJAiIL6D3wNBFIF4RvwWPfXQpKZbCmYdlXRUtVDMPwbdJAQn589af2wRQL1TH4OeQNDghQf0zDItTn2uHcMXSBnzBiC6g3+TAvEpiNuc+hJMLWrZuI8tMTuBMHfQuk2NMfrggUbjjaVUO3xz1SCoMtBMTn2I35MGxmRAZcr/ip+NACkjcARiozPRnoCRbwXMzID0o0XNNUL4KzBKI9TM6lxDicyZPMi+t4bG78+YS8arG4A6aYlXKWQ1PxdIfTAwrsm8ImBmDHxxWIW2geSi46lCoAMILGxY448Q0LwGXzPw3EGxkwvwaQalqwWkCfwuNQQgF9pf4O7+BpCYSZnL+VUgkMwK37bEA/7+BkLaeYDoXsRCl+JTIZiCkhdvAaS0JWJTgOkWGv+3WgLwjktcB7UosARWv+eR5Nx5gsiUdB86x8gI1XWkG7zQtsmUYDp4aGQbdAyRqRwE868V6XMTmr6EtmsAcatwZ0b8PIqeWM+E+H6ojPsS8GRvB+AuIF0hsPYBkXEwXBuQMphu4F58tMwHKFV/D2EZ5iKd7ireLZu7JqPlWFHTRqArUdSEtgjot2J+gSUXLoXEmHtXlDLKvnFtyyoqyEx8hJkIgg94l2tBfYxZxdAUkxhb8VJZ2yqFHIGJmjlFVmykKeZxKUHOPcK8O0Lbi3jwoswaI/AnKQHQHoqwxnMG4BsIINl1vi3eeRXufATZuebPshpJKxo5gmtNLUKmhcsCRqzxIc76QkW9petR23kmXUmf6yxXCjAHFgCrQJTNcVoxrxiCHFguKQD/Nh7WyCWbAHx4A6BT4VnGVrkmddQFh6BtJQL+Keie4G/2uynGf5d9ZGUCfSWIDvjYTuEyVnjuXpQQbLewE5oUeVhDbZD4Isx2FZh47EDx/ZVivJ2YHws3EIqmDbCHDtkYxHWyJmdEjJtWyFMCZAhrxHLlsgiXPgLLXTNNMztru1IIh4O3356B8QFEHQV4AoH+n0B3m8H9UTG3pCTuKUrDfb7/hthiDXBrQ4i+JSsj3OKzNTeZKPkkCQnAcW8p8wo07xyukd3f+x8CZWCZQvB1VokPMJ1cen8CgcsL1UJCxTM7h6aWMT4T2IOIQbSx3S/yq2j3LWuZgH8Lh/s7J9tmS3NrGZU9jMdaYIaD9Ei6tq4iIA1A+PYMYa5hfbYNAEMLvgDuJK6IZfYiXklFNlnlunroR5EWH/D7oQEl4cVxSc/UEVvxMta530swn4GV+CT47r3IHAP8vpdA0jBt2YDwtw1ZmBtlPBejV9Vd5uIZXmSOPADNTO0LIHJtbCviDt8WW7J5KQjQr6i55RIOpu0YkMH0IBQzw848EsRq0tymQNBE63lqWVVB0HYTK8ulaAWQWiDoCHfDtZ016Vf/QxGzzUqUuU/NhQgp5Vtkto5YL4vLfoii5ru/CxWavafP1VKPXlZInIMx5ADS3rPw6aIxEUDuIf54hBsyHkDaIVgveiaiZmNNI2qArljyDfgJyKqbnJv1/Gttg3itKHviBeWmwZ9A8DfQ6kgBpBSJSloBtksmKAvw0BtIX21PbiDijzKwPZP/AqcWULzTIVZ4g03FM20AyShiZkOKoludAuC/0jIh3sHNlG3tXSL1PdCf24mbAFRI+Wp+0TNxRUzY5g6NMjwM+ZlAEYz61GH+pSatwkOFVWA3yLspmwQUB7bjkpCCF0rLwo42gFQWzgxFGeAdSEfFZD/b0SXj2csyutBRhHM9NwOgpsi8uLYTnOleUtRtgoLvMtgmJQI/tGAt9yUliYlMJBgch4o6kkwHd58ESNpVc94e0iuZX0L5MZ65QkuX6HySJBY/ZbqudTmsqF0AVLaDGGcM/q8LrGa3IcvEcdmuILa8E0nAh0XbDRXsfLMGGDYApLihUsKG9Es1C1icYYWyDPCsVhhHUReSKTNXo7si/tKM2XGAZG+9m83jyVHfWUCGTWy/NQV8MABRh/LK9k66Ns2Zq4TyFeK6rYfg9o78CopNBP8zql4Jjwtc+KgihpJj8P6kV7jB3xC6hl6Xa+PqOFu4QAjTBvWsAfcWgN6lg9+39HGHSMLZpIyRdqRb/b+tGXgHlG9dHSDAfQBhl2iJiGl8inADzPmhJvg3IuurK+QNfdwcF1K+WCzbHAAIzlBOrlynVnhwTx+3shgB8g8fXCg1LqY/txpoQHRP+eIj9x4Y8gimtFli6FD1wrS9DykUQSUL77qGIlXtC6KK7Hlt/U1aponFt2dYRN/MMgCI7KNZPdS67L1qRrrhwEL9RoHmVBTShgpimRDXIT6Zgt+jGw/h+MRl18ox5bj2eT4OeB8hwFj5/ZFQorJWFPPxmXzjoHUC/vbE/z/BtSYKQBkBil8i9soMxQ2UJ3KA6CiNj21V3ki3WSsVKfOYivdsD8R4VTsLDPmdj9eu/jMt2tMgB+HSXLsSE2GpRpRXnXnbiNxK21FkjHLcskRmTu5jW7IWtsFzG8oXeEeitGAc727FO4yJK8y96EAoB+PvsnIdkBwphWQjWmqtIb+LDDjd/ImJPCrfoQatF2vZf/j9kXSHBlzzJ08eGBFLlbWJcLVlPGFwr0XsG9LHNTl5RCmkfAtMh8pPFLOsPhwojQqQH5N+p53NKFPh74vGeFEEw3Vdm1YhtqDbZc5950+eyqjZ6zWj/AKPtIQnXNca0Z/n2uT+qVB0Cfoqul/tZ6KSYl8Ak9jmPmrWZldd5NIthRIFdNkqPu+HWilp5L1AQUVNLBUJQ6gYN1HS+kqOBeSyhcIp/GDTC5W25k6VTGxbmDO4gQQuZtPi3OV3d1RyOUNB4D31sN5192u5aF1QwcmXQIH+KeULlU0ykFPN5V8EkCH3kekDwCQznzZAxIcgfPd6bTzB1AStC3JvACwMtl2NT3n2RQBa924gPuv2VpDuXuI2Ep9rZWLKT57Wnbv93QTgfTszdOghMYqpvfuROG4utZq+N7bFlG8fiJUptRFavqXqkyht3tjGAbCkRbteF1F+W11MutvqJA98bq3zaSHqXYOGkxC+O+qV3IvEZwFJMiYWTLVvTJUBHDNvqzThAZ2/DlcFosOZ4/BKvX1/pqtgaN+j2VbyMqD82FVdQElLvfKxmE3eamss7WsjRf/M7TPM38AFD0l/xycJd8tKv/BVtu/rkb9uY6vZLbCa8oQLX5K6qwv+/wUYAJgTliFeAJfvAAAAAElFTkSuQmCC",PREFIX:"watermark_",OFFSET:10,SIZE:.1,RATIO:42/146,init:function(a){var b;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Create CBS watermark."),a&&(b=a.videoEl,this._videoEl=b,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this._watermarkId=this.PREFIX+this._containerId,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".waterkmark",this._imgEl=null,this._createImage(),this._addEventListeners())},destroy:function(){if(!this._imgEl||!this._contentEl)return void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove watermark."));this._removeEventListeners(),this._removeImage(),this._eventsMgr=null,this._containerId=null,this._watermarkId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._imgEl=null},_createImage:function(){var a;this._contentEl&&(a=document.createElement("img"),a.id=this._watermarkId,a.src=this.IMAGE,a.style.position="absolute",a.style.display="none",this._imgEl=a,this._contentEl.appendChild(a))},_removeImage:function(){var a=this._imgEl;a&&a.parentNode&&a.parentNode.removeChild(a)},_ensureImage:function(){document.getElementById(this._watermarkId)||(this._createImage(),this._setPosition(),this._showImage())},_hideImage:function(){var a=this._imgEl;a&&(a.style.display="none")},_showImage:function(){var a=this._imgEl;a&&(a.style.display="block")},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."));b.addEventListener(c.AD_START+a,this._hideImage.bind(this)),b.addEventListener(c.CONTENT_START+a,this._showImage.bind(this)),b.addEventListener(c.CONTENT_END+a,this._hideImage.bind(this)),b.addEventListener(c.CONTAINER_RESIZE+a,this._onContainerResize.bind(this)),this._videoEl.addEventListener("canplay",this._onCanPlay.bind(this)),b.addTimedEventCallback(b.HALF_SECOND,a,this._ensureImage.bind(this))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."));b.removeEventListener(c.AD_START+a),b.removeEventListener(c.CONTENT_START+a),b.removeEventListener(c.CONTENT_END+a),b.removeEventListener(c.CONTAINER_RESIZE+a),b.removeTimedEventCallback(this.TIMER_INTERVAL,a),this._videoEl.removeEventListener(this.HTML5_CAN_PLAY,this._onCanPlay.bind(this))},_onCanPlay:function(){this._setPosition(),this._showImage()},_onContainerResize:function(a){a.target===this._containerId&&this._setPosition()},_setPosition:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;b=this._contentEl,c=this._videoEl,(a=this._imgEl)&&c&&b&&(n=c.videoHeight,(o=c.videoWidth)&&n&&(f=this.OFFSET,j=this.SIZE,g=c.getBoundingClientRect(),p=b.getBoundingClientRect(),h=g.height,i=g.width,m=n/o,l=h/i,k=l/m,d=i*m,e=h/m,q=p.bottom-g.bottom,r=p.right-g.right,k>1?(s=(h-d)/2,t=0,v=i*j+"px",u="auto"):(s=0,t=(i-e)/2,v="auto",u=h*j*(this.RATIO/m)+"px"),a.style.width=v,a.style.height=u,a.style.bottom=s+q+f+"px",a.style.right=t+r+f+"px"))}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.Kaleidoscope360=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.VIDEO_PLAYER_FACADE,PREFIX:"360_",KALEIDOSCOPE_SDK_PATH:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/kaleidoscope.min.js",init:function(a){var b;this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"Setup Kaleidoscope for 360 playback"),a&&(b=a.videoEl,this._videoEl=b,this._eventsMgr=a.eventsMgr,this._containerId=a.containerId,this._360Id=this.PREFIX+this._containerId,this._360El=null,this._contentEl=b.parentNode,this._namespace="."+this._containerId+".kaleidoscope360",this._kaleidoscopeViewer=null,this._loadKaleidoscope(this._setupKaleidoscope.bind(this)),this._addEventListeners())},destroy:function(){if(!this._360El||!this._kaleidoscopeViewer)return void(this.debug&&uvpjs.warn(this.DEBUG,"Unable to remove Kaleidoscope360."));this._removeEventListeners(),this._kaleidoscopeViewer&&this._kaleidoscopeViewer.destroy(),this._remove360Dom(),this._eventsMgr=null,this._containerId=null,this._contentEl=null,this._videoEl=null,this._namespace=null,this._kaleidoscopeViewer=null,this._360El=null},_loadKaleidoscope:function(a){return"function"!=typeof a?void(this.debug&&uvpjs.warn(this.DEBUG_ID,"VideoPlayerFacade _loadKaleidoscope: no callback supplied.")):(this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),window.Kaleidoscope&&window.Kaleidoscope.Video?void this.pluginLoadedCB():(this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(this.KALEIDOSCOPE_SDK_PATH,this.pluginLoadedCB)))},_setupKaleidoscope:function(){this._kaleidoscopeViewer||(this._create360Dom(),this._kaleidoscopeViewer=new window.Kaleidoscope.Video({source:this._videoEl,container:this._360El,height:this._contentEl.clientHeight,width:this._contentEl.clientWidth}))},_create360Dom:function(){this._360El=document.createElement("div"),this._360El.id=this._360Id,this._360El.style.position="absolute",this._360El.style.zIndex="1",this._contentEl.appendChild(this._360El)},_remove360Dom:function(){this._360El&&this._360El.remove()},_startKaleidoscopeRender:function(){this._kaleidoscopeViewer&&this._kaleidoscopeViewer.render()},_handleContainerResize:function(){this._kaleidoscopeViewer&&this._contentEl&&this._kaleidoscopeViewer.setSize({height:this._contentEl.clientHeight,width:this._contentEl.clientWidth})},_addEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to add event listeners."));b.addEventListener(c.CONTAINER_RESIZE+a,this._handleContainerResize.bind(this)),b.addEventListener(c.CONTENT_START+a,this._startKaleidoscopeRender.bind(this))},_removeEventListeners:function(){var a=this._namespace,b=this._eventsMgr,c=b.eventTypes;if(!b||!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to remove event listeners."));b.removeEventListener(c.CONTAINER_RESIZE+a),b.removeEventListener(c.CONTENT_START+a)}})}(uvpjs.register("uvpjs")),function(a){a.ResourceConfigObject=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_CONFIG_OBJECT,init:function(a,b,c){this.debug=uvpjs.debug,this.validationInfo=null,this.id=b,this.vidContId=c,this.rcoSeed={},this.initialize(a)},initialize:function(a){this.validationInfo=this.validateUserRco(a),this.validationInfo&&(this.rcoSeed=a,this.populateSelf(a))},getContextMetadata:function(){return this.contextMetadata||null},populateSelf:function(a){var b;for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},has:function(a){return!uvpjs.util.isEmpty(this[a])},getValidationInfo:function(){return this.validationInfo},validateUserRco:function(a){return{error:!1,message:""}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_URL=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=this._super(a),c=uvpjs.util.isDefinedString(a.assetURL);return{error:b.error||!c,message:b.error?b.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(a){a.DaiRco=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this.daiParams={adTagParameters:null,contentSourceId:null,daiVideoId:null,dfpMediaId:null,assetKey:null,apiKey:null,useSsb:!1},this._super(a,b,c)},useSsb:function(){return this.daiParams.useSsb},setCmsRefGuid:function(a){this.cmsRefGuid=a,this.daiParams.daiVideoId=a},canMakePlatformCall:function(a){var b=uvpjs.util.isDefinedString(a),c=this.has("selectorCall")&&this.selectorCall||b&&a;return!!c&&(c.indexOf("$PID$")>-1?this.has("pid"):!(c.indexOf("$GUID$")>-1)||this.has("cmsRefGuid"))},getAdTagParameters:function(){return this.daiParams.adTagParameters},getVideoId:function(){var a=this.daiParams.dfpMediaId,b=this.daiParams.daiVideoId,c=a||b||!this.has("cmsRefGuid")?null:this.cmsRefGuid;return a||b||c},getContentSourceId:function(){return this.daiParams.contentSourceId},getAssetKey:function(){return this.daiParams.assetKey},getApiKey:function(){return this.daiParams.apiKey},validateUserRco:function(a){var b=window.google&&google.ima&&google.ima.dai,c=this.validateDaiConfig(a),d=this._super(a),e=(a.useSsb||b)&&c&&!d.error,f=b?c?"":"Supplied RCO is not valid for rp_dai":"DAI SDK is missing.";return{error:!e,missingSDK:!b,message:d.error?d.message:f}},populateSelf:function(a){var b,c;for(b in a)c=a.hasOwnProperty(b),c&&void 0!==this.daiParams[b]?this.daiParams[b]=a[b]:c&&(this[b]=a[b]);this.daiParams.daiVideoId&&!this.cmsRefGuid&&(this.cmsRefGuid=this.daiParams.daiVideoId),this.checkCustomAdTagParams()},validateDaiConfig:function(a){var b=uvpjs.util,c=!b.isEmpty(a.adTagParameters),d=!b.isEmpty(a.contentSourceId),e=!b.isEmpty(a.assetKey);return a.useSsb||e||c&&d?a.useSsb?!b.isEmpty(a.assetURL):e||c&&d:(this.debug&&uvpjs.error("DaiRco: missing contentSourceId or adTagParameters."),c&&d)},checkCustomAdTagParams:function(){var a,b=uvpjs.util,c=this.daiParams.adTagParameters?this.daiParams.adTagParameters.cust_params:null;c&&"string"!=typeof c&&b.isPlainObject(c)&&(a=b.queryStrFromObj(c),this.daiParams.adTagParameters.cust_params=encodeURIComponent(a))}})}(uvpjs.register("uvpjs")),function(a){a.RCO_IMA=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=window.google&&google.ima,c=this._super(a);return{error:!(b&&!c.error),missingSDK:!b,message:c.error?c.message:"IMA SDK is missing."}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_Mdialog=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=this._super(a);return{error:b.error||!uvpjs.util.isDefinedString(a.assetURL),message:b.err?b.message:"Invalid assetURL"}}})}(uvpjs.register("uvpjs")),function(a){a.RCO_Platform=uvpjs.ResourceConfigObject.subClass({init:function(a,b,c){this._super(a,b,c)},validateUserRco:function(a){var b=uvpjs.util,c=b.isDefinedString(a.pid),d=!c&&b.isDefinedString(a.cmsRefGuid)&&!b.isDefinedString(a.assetURL),e=this._super(a);return{error:!(!e.error&&(c||d||b.isDefinedString(a.selectorCall))),message:e.error?e.message:"Supplied RCO is not valid for type rp_platform"}}})}(uvpjs.register("uvpjs")),function(a){"use strict";a.UvpSwfService=uvpjs.Class.subClass({init:function(a){this.debugId=a.debugId,this.debug=uvpjs.debug,this.containerId=a.containerId,this.dom=a.contentVideoDom,this.playerDom=a.playerDom,this.callback=a.readyCallback,this.id3OwnerIds=a.id3OwnerIds||"",this.capLevelToPlayerSize=a.capLevelToPlayerSize,this.swf=null,this.swfName=this.containerId+"UvpSwf",this.windowLabels=null,this.initTimeoutHandle=null,this.svcC=uvpjs.UvpSwfService,this.resizeTimeoutHandle=null,setTimeout(this.initialize.bind(this),1)},destroy:function(){var a;this.dom&&this.swf&&this.dom.removeChild(this.swf),this.dom=null,this.swf=null,this.callback=Function.prototype;for(a in this.windowLabels)window[this.windowLabels[a]]=null;this.windowLabels=null},getSwf:function(){return this.swf},getContainerSize:function(){return this.dom.getBoundingClientRect()},resetSize:function(){clearTimeout(this.resizeTimeoutHandle),this.resizeTimeoutHandle=setTimeout(this.setSize.bind(this),40)},setSize:function(){var a=this.getContainerSize(),b=a.width,c=a.height;this.swf&&this.swf.setSize(b,c,0,0)},playerReadyHandler:function(){clearTimeout(this.initTimeoutHandle),this.swf=-1!==navigator.appName.indexOf("Microsoft")?window[this.swfName]:document[this.swfName],this.startTimer(),this.swf.addEventJSCallback(this.svcC.constant.PLAYER_LOADED_EVENT,this.windowLabels.playerLoaded),this.swf.addEventJSCallback(this.svcC.constant.PLUGINS_AVAILABLE,this.windowLabels.pluginsAvailable)},playerLoadedHandler:function(){this.debug&&uvpjs.log(this.debugId,"UvpSwfService: playerLoaded event rec'd from SWF."),clearTimeout(this.initTimeoutHandle),this.callback(this.swf)},pluginsAvailableHandler:function(a){},startTimer:function(){this.initTimeoutHandle=setTimeout(function(){this.callback(null,this.svcC.error.PLAYER_INIT_TIMEOUT)}.bind(this),this.svcC.constant.INIT_TIMEOUT)},embedCompleteHandler:function(a){if(!a.success)return void this.callback(null,this.svcC.error.EMBED_FAILED);this.startTimer()},embed:function(a){var b=this.windowLabels;this.svcC.swfobject.embedSWF(this.svcC.constant.SWF_URL,a,"100%","100%","10.3.0",!1,{cfg:"false",clts:this.capLevelToPlayerSize?"true":"false",smode:"fit",jsReady:b.jsReady,playerReady:b.playerReady,oid:this.id3OwnerIds||""},{allowScriptAccess:"always",allowFullScreen:"true",scale:"noscale",salign:"lt",wmode:"opaque"},!1,this.embedCompleteHandler.bind(this))},initialize:function(){var a,b,c=this.dom;if(!this.svcC.hasFlash())return void this.callback(null,this.svcC.error.FLASH_NOT_DETECTED);this.windowLabels=this.svcC.setWindowMethods({jsReady:function(){return!0},playerReady:this.playerReadyHandler.bind(this),playerLoaded:this.playerLoadedHandler.bind(this),pluginsAvailable:this.pluginsAvailableHandler.bind(this)}),a=document.createElement("div"),a.id=this.swfName,b=c.querySelector("video"),b.style.display="none",c.style.height="100%",this.playerDom.style.height="100%",c.insertBefore(a,b),this.embed(a)}}),a.UvpSwfService.constant={PLAYER_LOADED_EVENT:"onPlayerLoaded_cbsi",PLUGINS_AVAILABLE:"pluginsAvailable",SWF_URL:"",INIT_TIMEOUT:3e4,CDN:"akamai_hd"},a.UvpSwfService.error={FLASH_NOT_DETECTED:"Unable to use Flash; Flash Player not available.",EMBED_FAILED:"Embed of UVP Flash via swfobject failed.",PLAYER_INIT_TIMEOUT:"Player failed to initialize before timeout of 30 sec."},a.UvpSwfService.hasFlash=function(){var a=this.swfobject.getFlashPlayerVersion().major;return!uvpjs.util.isEmpty(a)&&parseInt(a)>0},a.UvpSwfService.setWindowMethods=function(a){var b,c,d,e="f_",f=uvpjs.util;for(b in a)c=a[b],d=e+f.uid8(),window[d]=c,a[b]=d;return a},a.UvpSwfService.swfobject=function(){function a(){if(!T&&document.getElementsByTagName("body")[0]){try{var a,b=r("span");b.style.display="none",a=M.getElementsByTagName("body")[0].appendChild(b),a.parentNode.removeChild(a),a=null,b=null}catch(a){return}T=!0;for(var c=P.length,d=0;d<c;d++)P[d]()}}function b(a){T?a():P[P.length]=a}function c(a){if(typeof L.addEventListener!=E)L.addEventListener("load",a,!1);else if(typeof M.addEventListener!=E)M.addEventListener("load",a,!1);else if(typeof L.attachEvent!=E)t(L,"onload",a);else if("function"==typeof L.onload){var b=L.onload;L.onload=function(){b(),a()}}else L.onload=a}function d(){var a=M.getElementsByTagName("body")[0],b=r(F);b.setAttribute("style","visibility: hidden;"),b.setAttribute("type",I);var c=a.appendChild(b);if(c){var d=0;!function f(){if(typeof c.GetVariable!=E)try{var g=c.GetVariable("$version");g&&(g=g.split(" ")[1].split(","),X.pv=[s(g[0]),s(g[1]),s(g[2])])}catch(a){X.pv=[8,0,0]}else if(d<10)return d++,void setTimeout(f,10);a.removeChild(b),c=null,e()}()}else e()}function e(){var a=Q.length;if(a>0)for(var b=0;b<a;b++){var c=Q[b].id,d=Q[b].callbackFn,e={success:!1,id:c};if(X.pv[0]>0){var j=q(c);if(j)if(!u(Q[b].swfVersion)||X.wk&&X.wk<312)if(Q[b].expressInstall&&g()){var k={};k.data=Q[b].expressInstall,k.width=j.getAttribute("width")||"0",k.height=j.getAttribute("height")||"0",j.getAttribute("class")&&(k.styleclass=j.getAttribute("class")),j.getAttribute("align")&&(k.align=j.getAttribute("align"));for(var l={},m=j.getElementsByTagName("param"),n=m.length,o=0;o<n;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));h(k,l,c,d)}else i(j),d&&d(e);else w(c,!0),d&&(e.success=!0,e.ref=f(c),e.id=c,d(e))}else if(w(c,!0),d){var p=f(c);p&&typeof p.SetVariable!=E&&(e.success=!0,e.ref=p,e.id=p.id),d(e)}}}function f(a){var b=null,c=q(a);return c&&"OBJECT"===c.nodeName.toUpperCase()&&(b=typeof c.SetVariable!==E?c:c.getElementsByTagName(F)[0]||c),b}function g(){return!U&&u("6.0.65")&&(X.win||X.mac)&&!(X.wk&&X.wk<312)}function h(a,b,c,d){var e=q(c);if(c=p(c),U=!0,A=d||null,B={success:!1,id:c},e){"OBJECT"==e.nodeName.toUpperCase()?(y=j(e),z=null):(y=e,z=c),a.id=J,(typeof a.width==E||!/%$/.test(a.width)&&s(a.width)<310)&&(a.width="310"),(typeof a.height==E||!/%$/.test(a.height)&&s(a.height)<137)&&(a.height="137");var f=X.ie?"ActiveX":"PlugIn",g="MMredirectURL="+encodeURIComponent(L.location.toString().replace(/&/g,"%26"))+"&MMplayerType="+f+"&MMdoctitle="+encodeURIComponent(M.title.slice(0,47)+" - Flash Player Installation");if(typeof b.flashvars!=E?b.flashvars+="&"+g:b.flashvars=g,X.ie&&4!=e.readyState){var h=r("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",n(e)}l(a,b,c)}}function i(a){if(X.ie&&4!=a.readyState){a.style.display="none";var b=r("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(j(a),b),n(a)}else a.parentNode.replaceChild(j(a),a)}function j(a){var b=r("div");if(X.win&&X.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(F)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;f<e;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function k(a,b){var c=r("div");return c.innerHTML="<object classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'><param name='movie' value='"+a+"'>"+b+"</object>",c.firstChild}function l(a,b,c){var d,e=q(c);if(c=p(c),X.wk&&X.wk<312)return d;if(e){var f,g,h,i=r(X.ie?"div":F);typeof a.id==E&&(a.id=c);for(h in b)b.hasOwnProperty(h)&&"movie"!==h.toLowerCase()&&m(i,h,b[h]);X.ie&&(i=k(a.data,i.innerHTML));for(f in a)a.hasOwnProperty(f)&&(g=f.toLowerCase(),"styleclass"===g?i.setAttribute("class",a[f]):"classid"!==g&&"data"!==g&&i.setAttribute(f,a[f]));X.ie?R[R.length]=a.id:(i.setAttribute("type",I),i.setAttribute("data",a.data)),e.parentNode.replaceChild(i,e),d=i}return d}function m(a,b,c){var d=r("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=q(a);b&&"OBJECT"==b.nodeName.toUpperCase()&&(X.ie?(b.style.display="none",function a(){if(4==b.readyState){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}else setTimeout(a,10)}()):b.parentNode.removeChild(b))}function o(a){return a&&a.nodeType&&1===a.nodeType}function p(a){return o(a)?a.id:a}function q(a){if(o(a))return a;var b=null;try{b=M.getElementById(a)}catch(a){}return b}function r(a){return M.createElement(a)}function s(a){return parseInt(a,10)}function t(a,b,c){a.attachEvent(b,c),S[S.length]=[a,b,c]}function u(a){a+="";var b=X.pv,c=a.split(".");return c[0]=s(c[0]),c[1]=s(c[1])||0,c[2]=s(c[2])||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]}function v(a,b,c,d){var e=M.getElementsByTagName("head")[0];if(e){var f="string"==typeof c?c:"screen";if(d&&(C=null,D=null),!C||D!=f){var g=r("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),C=e.appendChild(g),X.ie&&typeof M.styleSheets!=E&&M.styleSheets.length>0&&(C=M.styleSheets[M.styleSheets.length-1]),D=f}C&&(typeof C.addRule!=E?C.addRule(a,b):typeof M.createTextNode!=E&&C.appendChild(M.createTextNode(a+" {"+b+"}")))}}function w(a,b){if(V){var c=b?"visible":"hidden",d=q(a);T&&d?d.style.visibility=c:"string"==typeof a&&v("#"+a,"visibility:"+c)}}function x(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=E?encodeURIComponent(a):a}var y,z,A,B,C,D,E="undefined",F="object",G="Shockwave Flash",H="ShockwaveFlash.ShockwaveFlash",I="application/x-shockwave-flash",J="SWFObjectExprInst",K="onreadystatechange",L=window,M=document,N=navigator,O=!1,P=[],Q=[],R=[],S=[],T=!1,U=!1,V=!0,W=!1,X=function(){var a=typeof M.getElementById!=E&&typeof M.getElementsByTagName!=E&&typeof M.createElement!=E,b=N.userAgent.toLowerCase(),c=N.platform.toLowerCase(),d=/win/.test(c?c:b),e=/mac/.test(c?c:b),f=!!/webkit/.test(b)&&parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),g="Microsoft Internet Explorer"===N.appName,h=[0,0,0],i=null;if(typeof N.plugins!=E&&typeof N.plugins[G]==F)(i=N.plugins[G].description)&&typeof N.mimeTypes!=E&&N.mimeTypes[I]&&N.mimeTypes[I].enabledPlugin&&(O=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=s(i.replace(/^(.*)\..*$/,"$1")),h[1]=s(i.replace(/^.*\.(.*)\s.*$/,"$1")),h[2]=/[a-zA-Z]/.test(i)?s(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1")):0);else if(typeof L.ActiveXObject!=E)try{var j=new ActiveXObject(H);j&&(i=j.GetVariable("$version"))&&(g=!0,i=i.split(" ")[1].split(","),h=[s(i[0]),s(i[1]),s(i[2])])}catch(a){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();!function(){X.w3&&((typeof M.readyState!=E&&("complete"===M.readyState||"interactive"===M.readyState)||typeof M.readyState==E&&(M.getElementsByTagName("body")[0]||M.body))&&a(),T||(typeof M.addEventListener!=E&&M.addEventListener("DOMContentLoaded",a,!1),X.ie&&(M.attachEvent(K,function b(){"complete"==M.readyState&&(M.detachEvent(K,b),a())}),L==top&&function b(){if(!T){try{M.documentElement.doScroll("left")}catch(a){return void setTimeout(b,0)}a()}}()),X.wk&&function b(){if(!T)return/loaded|complete/.test(M.readyState)?void a():void setTimeout(b,0)}()))}();P[0]=function(){O?d():e()};!function(){X.ie&&window.attachEvent("onunload",function(){for(var a=S.length,b=0;b<a;b++)S[b][0].detachEvent(S[b][1],S[b][2]);for(var c=R.length,d=0;d<c;d++)n(R[d]);for(var e in X)X[e]=null;X=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})}();return{registerObject:function(a,b,c,d){if(X.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,Q[Q.length]=e,w(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(X.w3)return f(a)},embedSWF:function(a,c,d,e,f,i,j,k,m,n){var o=p(c),q={success:!1,id:o};X.w3&&!(X.wk&&X.wk<312)&&a&&c&&d&&e&&f?(w(o,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===F)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var r={};if(k&&typeof k===F)for(var s in k)r[s]=k[s];if(j&&typeof j===F)for(var t in j)if(j.hasOwnProperty(t)){var v=W?encodeURIComponent(t):t,x=W?encodeURIComponent(j[t]):j[t];typeof r.flashvars!=E?r.flashvars+="&"+v+"="+x:r.flashvars=v+"="+x}if(u(f)){var y=l(b,r,c);b.id==o&&w(o,!0),q.success=!0,q.ref=y,q.id=y.id}else{if(i&&g())return b.data=i,void h(b,r,c,n);w(o,!0)}n&&n(q)})):n&&n(q)},switchOffAutoHideShow:function(){V=!1},enableUriEncoding:function(a){W=typeof a===E||a},ua:X,getFlashPlayerVersion:function(){return{major:X.pv[0],minor:X.pv[1],release:X.pv[2]}},hasFlashPlayerVersion:u,createSWF:function(a,b,c){return X.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){X.w3&&g()&&h(a,b,c,d)},removeSWF:function(a){X.w3&&n(a)},createCSS:function(a,b,c,d){X.w3&&v(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=M.location.search||M.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return x(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return x(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(U){var a=q(J);a&&y&&(a.parentNode.replaceChild(y,a),z&&(w(z,!0),X.ie&&(y.style.display="block")),A&&A(B)),U=!1}},version:"2.3"}}()}(uvpjs.register("uvpjs")),function(a){var b=a._;a.ResourceProvider=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this.vidContId="",this.containers=a.containers,this.internalNS="",this.rco={},this.contentDataProxy=null,this.cviMgr={},this.eventsMgr={},this.cviModel={},this.RPM={},this.metadata={},this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this.contentStartOpen=!1,this.uvpSwfService=null,this._previousLocalStorageTime=0,this._previousResumeBeaconTime=0,this._localStorageInterval=3e3,this.preloadContent=!1,this.bufferingDetected=null,this.bufferingCheckInterval=1e3,this.bufferingCheckOffset=1/this.bufferingCheckInterval,this.bufferingCheckLastTime=0,this.deferLoadingCaptions=a.deferLoadingCaptions,this.id3HandlingEnabled=!1,this.id3Parser=null,this.id3EventQueue=null,this.p2pClient=a.p2pClient,this.multiCdnClient=a.multiCdnClient,this.suppressFacadePlay=!1,this._overrideAssetUrlFailure=!1,this.mc=uvpjs.mediaCapabilities,this.providerType="",this._seekToTime=null,this._seekFromTime=null,this.initialize(a.rco,a.cviMgr,a.vidContId)},initialize:function(a,c,d){var e;this.debug&&uvpjs.log(this.DEBUG_ID,"initialize rcObj = ",a),this.rco=a,this.vidContId=d,this.cviMgr=c,this.eventsMgr=this.cviMgr.getEventsMgr(),this.cviModel=this.cviMgr.getModelRef(),this.RPM=this.cviMgr.RPM,this.internalNS="."+this.vidContId+".rp",e=this.cviModel.contentVideoState,e.sendResumeEvent=!1,e.startTime=0,e.elapsedTime=0,e.showPreroll=!0,e.playedChapterTime=0,e.previousSessionId="",this.contentDataProxy=new uvpjs.ContentDataProxy({cviModel:this.cviModel,eventsManager:this.eventsMgr}),b.isUndefined(this.cviModel.sessionOptions.resumeBeaconInterval)?this._resumeBeaconInterval=1e4:this._resumeBeaconInterval=1e3*this.cviModel.sessionOptions.resumeBeaconInterval,this.id3HandlingEnabled=this.cviModel.isId3HandlingRequired()},getProviderType:function(){return this.providerType},_addVideoProgressTimerCallback:function(){var a=this.eventsMgr;this._removeTimers(),a.addTimedEventCallback(a.TENTH_SECOND,this.internalNS,this.onUVPJSTimerTick.bind(this)),a.addTimedEventCallback(this.bufferingCheckInterval,this.internalNS,this.checkBuffering.bind(this))},setCaptionStyle:function(a){this._hasFacade()&&this.facade.setCaptionStyle&&this.facade.setCaptionStyle(a)},_removeTimers:function(){var a=this.eventsMgr;a.removeTimedEventCallback(a.TENTH_SECOND,this.internalNS),a.removeTimedEventCallback(this.bufferingCheckInterval,this.internalNS)},cleanUp:function(){var a=this.rco&&this.rco.rcoSeed;this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUp dispatches CONTENT_END",this.rco?this.rco.id:"No current RCO."),this.dispatchVideoDone(),this.id3Parser&&this.id3Parser.destroy(),this.id3Parser=null,this.contentStartOpen&&(this.contentStartOpen=!1,this.dispatchContentEnd()),this.p2pClient&&this.p2pClient.destroy(),this.multiCdnClient&&this.multiCdnClient.destroy(),this.p2pClient=null,this.multiCdnClient=null,this._removeTimers(),this._removeUVPEventListeners(),this.destroyFacade(),this.cleanUpObjects(),this.killDataProxy(),this.RPM.resourceEnd(a)},cleanUpObjects:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"cleanUpObjects"),this.removeCaptionEventListeners(),this.uvpSwfService&&(this.uvpSwfService&&this.uvpSwfService.destroy(),this.uvpSwfService=null),this.vidContId=null,this.internalNS=null,this.rco=null,this.cviMgr=null,this.eventsMgr=null,this.cviModel=null,this.metadata=null,this.facade={},this.dataLoadedCB=Function.prototype,this.dataLoadErrorCB=Function.prototype,this.errorInfo=null,this._overrideAssetUrlFailure=!1,this._seekToTime=null,this._seekFromTime=null},killDataProxy:function(){this.contentDataProxy&&this.contentDataProxy.destroy(),this.contentDataProxy=null},loadVideoAndBeginPlayback:function(a){var b=this.cviModel;this.debug&&uvpjs.log(this.DEBUG_ID,"loadVideoAndBeginPlayback vidContId, rco",this.vidContId,this.rco),b.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),b.setContentVideoStateItems(this.rco),this.setModelRcoOverrides(),b.mergeCDOData(),this.killDataProxy(),this.suppressFacadePlay=a,this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,null)):this.doFlashCheck(null)},doFlashCheck:function(a){this.shouldUseFlash()?(this.cviModel.contentVideoState.isFlash=!0,this.uvpSwfService=new uvpjs.UvpSwfService({capLevelToPlayerSize:!0===this.rco.capLevelToPlayerSize,debugId:this.DEBUG_ID,containerId:this.vidContId,id3OwnerIds:this.cviModel.getConfiguredId3OwnerIds(),contentVideoDom:this.containers.contentVideoDom,playerDom:this.containers.playerDom,readyCallback:this.handleUvpFlashPlayerLoaded.bind(this,a)})):this.finishLoadVideoAndBeginPlayback(a),this.prepForCaptionEvents()},handleContainerResize:function(){this.cviModel.contentVideoState.isFlash?this.uvpSwfService.resetSize():uvpjs.util.isFunction(this.facade.containerResize)&&this.facade.containerResize()},handleUvpFlashPlayerLoaded:function(a,b,c){var d,e=uvpjs.ErrorInfo;if(c)return d=new e({errorCode:e.errorCodes.FLASH_RELATED_ERROR,message:"Unable to use Flash: "+c,isFatal:!0}),void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYER_START_ERROR,{errorInfo:d},this.vidContId);setTimeout(this.finishLoadVideoAndBeginPlayback.bind(this,a),2)},handleCdnDecision:function(a,b){this.setNewAssetUrlAndCdn(b),this.doFlashCheck(a)},shouldUseFlash:function(){var a=this.mc.systemInfo,b=this.cviModel.getSessionOption("preventFlashPlayback"),c=a.supportsNativeHls||a.isHlsjsEligible,d=!b&&a.isDesktop&&uvpjs.UvpSwfService.hasFlash(),e=this.mc.isHlsUrl(this._getAssetUrl()),f=uvpjs.Configuration.env;return!("local"!==f&&"dev"!==f&&"stage"!==f||!window.forceFlash||!d)||e&&!c&&d},prepForCaptionEvents:function(){for(var a=this.eventsMgr.eventTypes,b=[a.CONTROL_HIDE_CAPTIONS,a.CONTROL_SHOW_CAPTIONS,a.CAPTIONS_READY,a.SET_CAPTIONS_LANG],c=b.length;c--;)this.eventsMgr.addEventListener(b[c]+this.internalNS,this.hCaptionEventForUvp.bind(this))},removeCaptionEventListeners:function(){for(var a=this.eventsMgr.eventTypes,b=[a.CONTROL_HIDE_CAPTIONS,a.CONTROL_SHOW_CAPTIONS,a.CAPTIONS_READY,a.SET_CAPTIONS_LANG],c=b.length;c--;)this.eventsMgr.removeEventListener(b[c]+this.internalNS)},hCaptionEventForUvp:function(a){var b=this.eventsMgr.eventTypes;if(this._hasFacade()&&a.target===this.vidContId)switch(a.type){case b.CAPTIONS_READY:uvpjs.util.isFunction(this.facade.loadCaptions)&&this.facade.loadCaptions(this.cviModel.contentVideoState.closedCaptionPath);break;case b.CONTROL_SHOW_CAPTIONS:uvpjs.util.isFunction(this.facade.showCaptions)&&this.facade.showCaptions(a.payload.language);break;case b.CONTROL_HIDE_CAPTIONS:uvpjs.util.isFunction(this.facade.hideCaptions)&&this.facade.hideCaptions();break;case b.SET_CAPTIONS_LANG:uvpjs.util.isFunction(this.facade.setCaptionLanguage)&&this.facade.setCaptionLanguage(a.payload.language)}},finishLoadVideoAndBeginPlayback:function(a){var b,c=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.cviMgr.setContextMetadata(this.rco.getContextMetadata()),this.dispatchContentDataLoaded(),this.RPM.resourceStart(this.rco.rcoSeed),this._addUVPEventListeners(),c.incrementMedNum(),this.createFacade(),b=this.facade.facadeType,this.id3HandlingEnabled&&this.createId3Parser(b),!0!==this.suppressFacadePlay&&(this.facade.showVideo(),this.facade.playVideo()),b===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},dispatchContentDataLoaded:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},setNewAssetUrlAndCdn:function(a){var b,c,d,e=a&&a.providers||null,f=e&&e[0]?e[0]:null,g=f&&f.host||null,h=f&&f.provider||null;g&&(b=this._getAssetUrl(),c=uvpjs.util.parseUrl(b),g!==c.host&&(d=c.protocol+"//"+g+c.pathname+c.search,this.cviModel.contentVideoState.assetURL=d)),h&&this.setContentVideoStateCdn(h)},setContentVideoStateCdn:function(a){this.cviModel.contentVideoState.cdn=a,this.debug&&uvpjs.log(this.DEBUG_ID,"CDN has been updated: ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CDN_UPDATED,{cdn:a},this.vidContId)},getContentVideoStateCdn:function(a){return this.cviModel.contentVideoState.cdn},setModelRcoOverrides:function(){var a=function(a){var b=c.getSessionOption(a);return"boolean"==typeof b?b:void 0!==c.getVideoPlaybackCDOProperty(a)&&c.getVideoPlaybackCDOProperty(a)},b=function(a){var b=c.getSessionOption(a);return"number"==typeof b&&b>=0?b:void 0!==c.getVideoPlaybackCDOProperty(a)?Number(c.getVideoPlaybackCDOProperty(a)):-1},c=this.cviModel,d=b(c.START_BITRATE),e=b(c.MIN_BITRATE),f=b(c.MAX_BITRATE),g=b(c.LIVE_SYNC_DURATION_COUNT),h=a(c.CAP_LEVEL_TO_PLAYER_SIZE),i=a(c.DASHJS_FAST_SWITCH_ABR),j=c.getSessionOption("useDynamicSwitching"),k=c.getSessionOption("errorRecovery"),l=Number(this.rco.startBitrate)||-1,m=Number(this.rco.minBitrate)||-1,n=Number(this.rco.maxBitrate)||-1,o=Number(this.rco.liveSyncDurationCount)||-1,p=this.rco.capLevelToPlayerSize,q=this.rco.enableDashJSFastSwitchABR,r=this.rco.useDynamicSwitching,r=this.rco.useDynamicSwitching,s=this.rco.errorRecovery;l>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Start Bitrate w RCO Value:",l),c.setStartBitrate(l)):c.setStartBitrate(d),m>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Min Bitrate w RCO Value:",m),c.setMinBitrate(m)):c.setMinBitrate(e),n>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Max Bitrate w RCO Value:",n),c.setMaxBitrate(n)):c.setMaxBitrate(f),o>-1?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Live Sync Duration Count w RCO Value:",o),c.setLiveSyncDurationCount(o)):c.setLiveSyncDurationCount(g),"boolean"==typeof p?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override Cap Level To Player Size w RCO Value:",p),c.setCapLevelToPlayerSize(p)):c.setCapLevelToPlayerSize(h),"boolean"==typeof q?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override FastSwitch ABR value w RCO Value:",q),c.setDashJSFastSwitchABR(q)):c.setDashJSFastSwitchABR(i),"boolean"==typeof r?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override useDynamicABR value w RCO Value:",r),c.setUseDynamicSwitching(r)):c.setUseDynamicSwitching(j),"object"==typeof s?(this.debug&&uvpjs.warn(this.DEBUG_ID,"Override session options errorRecovery value with RCO value:",s),c.setErrorRecovery(s)):c.setErrorRecovery(k)},createId3Parser:function(a){this.id3EventQueue=[];var b={ownerIdList:this.cviModel.getConfiguredId3OwnerIds(),findNielsen:this.cviModel.isNielsenTrackingEnabled(),dataCallback:this.handleId3Metadata.bind(this)};switch(a){case this.mc.HLSJS:this.id3Parser=new uvpjs.FrameId3Parser(b);break;case this.mc.HTML5:this.id3Parser=new uvpjs.TrackId3Parser(b);break;case this.mc.FLASH_HLS:b.dataCallback=this.dispatchCuepointEvent.bind(this),this.facade.setId3Options(b)}},handleId3Metadata:function(a){this.id3EventQueue&&this.id3EventQueue.push(a)},checkId3Events:function(a){for(var b,c=this.id3EventQueue,d=c&&c.length||0;d--;)b=c[d],a>=b.pts&&(this.dispatchCuepointEvent(b),this.id3EventQueue.splice(d,1))},dispatchCuepointEvent:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_CUEPOINT,a,this.vidContId)},createFacade:function(){var a=this.cviModel,b=a.getContentVideoState(),c=this._getAssetUrl(),d={enableId3Handling:this.id3HandlingEnabled,assetURL:c,isMuted:a.isMuted,resourceProvider:this,startTime:b.startTime,startBitrate:a.startBitrate,maxBitrate:a.maxBitrate,minBitrate:a.minBitrate,useDynamicSwitching:a.useDynamicSwitching,liveSyncDurationCount:a.liveSyncDurationCount,volume:a.volume,capLevelToPlayerSize:a.capLevelToPlayerSize,enableDashJSFastSwitchABR:a.enableDashJSFastSwitchABR,deferLoadingCaptions:this.deferLoadingCaptions,errorRecovery:a.errorRecovery,drm:b.drm};this.debug&&uvpjs.log(this.DEBUG_ID,"createFacade",d),this.facade=this.getFacade(c),this.facade.facadeType===this.mc.HLSJS&&this.p2pClient&&(d.hlsjsLoader=this.p2pClient.getHlsjsLoader()),this.facade.facadeType===this.mc.FLASH_HLS&&(d.swfService=this.uvpSwfService);var e=this.facade.initialize(d);!e||this.facade.facadeType!==this.mc.HLSJS&&this.facade.facadeType!==this.mc.DASHJS||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_LIBRARY_LOADED,{player:e,facadeType:this.facade.facadeType},this.vidContId),this.facade.manageNativeControls(a.nativeControls)},destroyFacade:function(){var a=this._hasFacade()&&"function"==typeof this.facade.destroy;if(this.debug&&uvpjs.log(this.DEBUG_ID,"destroyFacade"),!a)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Facade already cleaned up."));this.facade.destroy(),this.facade={}},muteContentForAdPlay:function(a){var b=this.cviModel,c=this.facade;this._hasFacade()&&(!1!==a?c.muteVideo():b.isMuted||c.unMuteVideo())},getModule:function(a){return this.cviModel.getModule(a)},getModuleParam:function(a,b){return this.cviModel.getModuleParam(a,b)},createWatermark:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"createWatermark"),this.cviModel.contentVideoState.useWatermark},is360:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"is360"),this.cviModel.contentVideoState.is360},startVideoProgressTimer:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"startVideoProgressTimer"),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()},dispatchContentStart:function(){var a=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_START; state = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_START,{contentData:a},this.vidContId)},dispatchContentEnd:function(){var a=this.cviModel.getContentVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"CONTENT_END; state = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTENT_END,{contentData:a},this.vidContId)},dispatchSeekDone:function(){var a=this.eventsMgr;a.dispatchEvent(a.eventTypes.SEEK_DONE,{seekFromTime:this._seekFromTime,seekToTime:this._seekToTime},this.vidContId),this._seekToTime=null,this._seekFromTime=null},dispatchVideoDone:function(){var a=this.cviModel&&this.cviModel.contentPlaybackState.fatalError,b=a?"Fatal ERROR encountered":"";this.eventsMgr&&(this.debug&&uvpjs.log(this.DEBUG_ID,"About to dispatch Video Done. "+b),!a&&this.clearLocalStorageItems(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_DONE,{},this.vidContId))},dispatchVideoStateChange:function(a){isNaN(a)||this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:a,isAd:!1},this.vidContId)},facadeBrowserPlayFailure:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_START_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.VIDEO_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.USER_GESTURE_REQUIRED,message:"Browser autoplay policy may be preventing video play: "+a,isFatal:!1})},this.vidContId)},facadeDisplayReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDisplayReady  this.rco.id = "+this.rco.id),this.startVideoProgressTimer(),this.contentStartOpen=!0,this.dispatchContentStart()},facadeMetadataParsed:function(a){a&&a.abrInfo&&this.cviModel.setAbrInfo(a.abrInfo)},facadeProgress:function(a){!uvpjs.util.isEmpty(a)&&"object"==typeof a&&a.currentTime&&a.duration&&(this.cviModel.setContentPlaybackStateItems({currentTime:a.currentTime}),this.setModelDuration(parseInt(a.duration)))},facadeDurationChanged:function(a){uvpjs.util.isEmpty(a)||"object"!=typeof a||a.duration},setModelDuration:function(a){a>0&&this.cviModel.contentVideoState.duration!==a&&(this.cviModel.setContentVideoStateItems({duration:a}),this.cviModel.setContentPlaybackStateItems({duration:a}))},facadeDone:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDone; this.rco.id = "+this.rco.id),this.cleanUp()},facadeSeeked:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeSeeked",a),!this._seekFromTime)return void(this.debug&&uvpjs.log(this.DEBUG_ID,"Facade seek doesn't appear to be user generated. Not dispatching SEEK_DONE."));this._seekToTime=a.seekToTime,this.dispatchSeekDone()},facadeError:function(a){var b,c,d,e,f=uvpjs.util,g=this.RPM&&this.RPM.currRP,h=this.eventsMgr,i=this.cviModel,j=!f.isEmpty(i),k=a.isFatal;if(this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; vc id= "+this.vidContId+";"+a.message),j&&k&&(b=this.cviModel.getContentVideoState(),c=b.playbackStarted,d=f.isDefinedString(b.overrideAssetURL),!c&&d&&!this._overrideAssetUrlFailure))return void this._handleOverrideAssetURLError(a);if(j||this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no cviModel **"),f.isEmpty(h)?this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP has no events mgr **"):(e=a.eventType||h.eventTypes.VIDEO_PLAYBACK_ERROR,a.eventType=e,h.dispatchEvent(e,{errorInfo:a},this.vidContId)),k){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"facadeError fatal error."),j&&(i.contentPlaybackState.fatalError=!0),g&&g.rco&&g.rco.type===uvpjs.mediaCapabilities.RP_IMA)return void g.imaContentComplete();this.debug&&uvpjs.log(this.DEBUG_ID,"facadeError; RP; RPM.currRP is null"),this.cleanUp()}},facadePlaybackStateChange:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"facadePlaybackStateChange id = "+this.rco.id+" newState = "+a),this.dispatchVideoStateChange(a)},facadeVideoLevelLoaded:function(a){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.LEVEL_LOADED,{details:a},this.vidContId)},facadeVideoTransitionStart:function(a,b){var c=b||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionStart id = "+this.rco.id+" bitrate = "+a+" mode = "+c),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_START,{bitrate:a,mode:c},this.vidContId)},facadeVideoTransitionComplete:function(a,b){var c=b||(this.cviModel.useDynamicSwitching?"auto":"manual");uvpjs.log(this.DEBUG_ID,"facadeVideoTransitionComplete id = "+this.rco.id+" bitrate = "+a+" mode = "+c),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_TRANSITION_COMPLETE,{bitrate:a,mode:c},this.vidContId)},facadeSetCaptionReady:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{},this.vidContId)},facadeSetAudioTrackInfo:function(a){this.cviModel.setAudioTrackInfo(a)},facadeId3Data:function(a){this.id3Parser&&this.id3Parser.parse(a)},facadeMinimumBitrateAllowedChanged:function(a){this.cviModel.setMinBitrate(a)},facadeMaximumBitrateAllowedChanged:function(a){this.cviModel.setMaxBitrate(a)},getFacade:function(a){var b,c=this.mc.STREAMING,a=a||this._getAssetUrl(),d=this.mc.isHlsUrl(a),e=this.mc.isDashUrl(a),f=this.cviModel.contentVideoState.isFlash;if(this.debug&&uvpjs.log(this.DEBUG_ID,"getFacade"),(f||d||e)&&this._setDeliveryType(c),!f&&d)this.mc.canPlayHLSJS()&&(b=new uvpjs.VPF_HLSJS);else if(!f&&e)if(uvpjs.VPF_DASHJS)b=new uvpjs.VPF_DASHJS;else{if(!uvpjs.VPF_SHAKA)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to create facade; DASHJS or Shaka Facade not available. - make sure you are using the correct .min file"));b=new uvpjs.VPF_SHAKA}else f&&(b=new uvpjs.VPF_Flash);return b||new uvpjs.VPF_HTML5},_addUVPEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS,d=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_addUVPEventListeners this.rco.id = ",d),this._uvpEventListenersAdded||(this._uvpEventListenersAdded=!0,a.addEventListener(b.CONTROL_SEEK+c,this.onVideoSeekTo.bind(this)),a.addEventListener(b.CONTROL_SEEK_TO_LIVE_POINT+c,this.onVideoSeekToLive.bind(this)),a.addEventListener(b.CONTROL_PAUSE+c,this.onPauseVideo.bind(this)),a.addEventListener(b.CONTROL_PLAY+c,this.onPlayVideo.bind(this)),a.addEventListener(b.CONTROL_MUTE+c,this.onMuteVideo.bind(this)),a.addEventListener(b.CONTROL_UNMUTE+c,this.onUnMuteVideo.bind(this)),a.addEventListener(b.CONTROL_VOLUME_SET+c,this.onChangeVideoVolume.bind(this)),a.addEventListener(b.CONTROL_FULLSCREEN+c,this.onFullscreen.bind(this)),a.addEventListener(b.SWITCH_REQUEST+c,this.onSwitchRequest.bind(this)),a.addEventListener(b.USE_DYNAMIC_SWITCHING+c,this.onUseDynamicSwitching.bind(this)),a.addEventListener(b.MAXIMUM_BITRATE_ALLOWED+c,this.onMaximumBitrateAllowed.bind(this)),a.addEventListener(b.MINIMUM_BITRATE_ALLOWED+c,this.onMinimumBitrateAllowed.bind(this)),a.addEventListener(b.CONTAINER_RESIZE+c,this.handleContainerResize.bind(this)),a.addEventListener(b.SWITCH_AUDIO_TRACK+c,this.onSwitchAudioTrack.bind(this)))},_removeUVPEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS,d=this.rco&&this.rco.id;this.debug&&uvpjs.log(this.DEBUG_ID,"_removeUVPEventListeners this.rco.id = ",d),a.removeEventListener(b.CONTROL_SEEK+c),a.removeEventListener(b.CONTROL_SEEK_TO_LIVE_POINT+c),a.removeEventListener(b.CONTROL_PAUSE+c),a.removeEventListener(b.CONTROL_PLAY+c),a.removeEventListener(b.CONTROL_MUTE+c),a.removeEventListener(b.CONTROL_UNMUTE+c),a.removeEventListener(b.CONTROL_VOLUME_SET+c),a.removeEventListener(b.SWITCH_REQUEST+c),a.removeEventListener(b.USE_DYNAMIC_SWITCHING+c),a.removeEventListener(b.MAXIMUM_BITRATE_ALLOWED+c),a.removeEventListener(b.MINIMUM_BITRATE_ALLOWED+c),a.removeEventListener(b.CONTROL_SHOW_CAPTIONS+c),a.removeEventListener(b.CONTROL_HIDE_CAPTIONS+c),a.removeEventListener(b.CAPTIONS_READY+c),a.removeEventListener(b.CONTAINER_RESIZE+c),a.removeEventListener(b.SWITCH_AUDIO_TRACK+c)},_getAssetUrl:function(a){var b=uvpjs.util,c=a||this.cviModel.getContentVideoState(),d=c.overrideAssetURL,e=b.isDefinedString(d)&&!this._overrideAssetUrlFailure,f=e?d:c.assetURL;return this.debug&&uvpjs.log(this.DEBUG_ID,"_getAssetUrl (using override: "+e+")",f),f},_setDeliveryType:function(a){this.cviModel.setContentVideoStateItems({deliveryType:a})},_handleOverrideAssetURLError:function(a){var b=uvpjs.ErrorInfo,c=this.eventsMgr,d=c.eventTypes.VIDEO_START_ERROR,e=b.messages.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR;this.debug&&uvpjs.warn(this.DEBUG_ID,e+" Error using overrideAssetURL; will use assetURL."),a.eventType=d,a.message=e,a.isFatal=!1,a.errorCode=b.errorCodes.DYNAMIC_VARIANT_MANIFEST_PARSE_ERROR,c.dispatchEvent(d,{errorInfo:a},this.vidContId),this._overrideAssetUrlFailure=!0,this.destroyFacade(),this.createFacade(),this.facade.showVideo(),this.facade.playVideo()},onSwitchRequest:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.bitrate,e=this.cviModel,f=this.facade;if(b===this.vidContId&&d&&this._hasFacade())switch(typeof d){case"string":if("up"===d)e.setUseDynamicSwitching(!1),f.switchUp();else if("down"===d)e.setUseDynamicSwitching(!1),f.switchDown();else{if(d=Number(d),isNaN(d))return;e.setUseDynamicSwitching(!1),f.switchToBitrate(d)}break;case"number":e.setUseDynamicSwitching(!1),f.switchToBitrate(d);break;default:this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to switch to a selected bitrate.",d)}},onSwitchAudioTrack:function(a){uvpjs.util.isFunction(this.facade.switchAudioTrack)&&this.facade.switchAudioTrack(a.payload.id)},onUseDynamicSwitching:function(a){if(a&&a.target===this.vidContId&&a.payload){var b=a.payload.data;this.cviModel.setUseDynamicSwitching(b),this._hasFacade()&&(this.facade.useDynamicSwitching(b),b&&(this.facade.setMinBitrateAllowed(this.cviModel.minBitrate),this.facade.setMaxBitrateAllowed(this.cviModel.maxBitrate))),this.debug&&uvpjs.log(this.DEBUG_ID,"facadeDynamicSwitchingChange  this.rco.id = "+this.rco.id+" useDynamic = ",b)}},onMinimumBitrateAllowed:function(a){var b=a.payload,c=b&&b.bitrate,d=this.facade;if(a.target===this.vidContId){if(!c||"number"!=typeof c)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+c,typeof c));this.cviModel.setMinBitrate(c),this._hasFacade()&&d.setMinBitrateAllowed(c)}},onMaximumBitrateAllowed:function(a){var b=a.payload,c=b&&b.bitrate,d=this.facade;if(a.target===this.vidContId){if(!c||"number"!=typeof c)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Unable to set minimum bitrate to "+c,typeof c));this.cviModel.setMaxBitrate(c),this._hasFacade()&&d.setMaxBitrateAllowed(c)}},onVideoSeekTo:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.seekTime,e=this.cviModel.contentVideoState.duration,f=this.cviModel.contentPlaybackState.currentTime,g=this.facade;if("number"==typeof d&&b===this.vidContId){if(d<0||d>e)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+d));this._seekFromTime=this._seekFromTime||f,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:d,seekFromTime:this._seekFromTime},null,2)),this._hasFacade()&&g.seekTo(d)}},onVideoSeekToLive:function(){var a=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekToLive"),this._hasFacade()&&a.seekToLive()},facadeVolumeChange:function(a){!b.isNaN(a)&&b.isNumber(a)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CONTROL_VOLUME_CHANGE,{vol:a},this.vidContId)},facadeLoading:function(a){var b={data:a};a&&(a.bufferLength||a.loaded)&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_LOADING,b,this.vidContId)},facadeTimeUpdate:function(a){this.cviModel.setContentPlaybackStateItems({currentTime:a})},onFullscreen:function(a){this.facade&&this.facade.facadeType===this.mc.FLASH_HLS&&this.facade.setFullscreenState(a.payload.isFs)},onPauseVideo:function(a){var b=a&&a.target,c=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",b),b===this.vidContId&&this._hasFacade()&&c.pauseVideo()},onPlayVideo:function(a){var b=a&&a.target,c=this.facade;this.debug&&uvpjs.log(this.DEBUG_ID,"onPauseVideo this.vidContId = ",this.vidContId," evtObj.target = ",b),b===this.vidContId&&this._hasFacade()&&c.playVideo()},onChangeVideoVolume:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.vol,e=uvpjs.util.inRange(d,0,1),f=this.cviModel.isMuted,g=this.facade;b===this.vidContId&&e&&!f&&this._hasFacade()&&g.setVolume(d)},onMuteVideo:function(a){var b=a&&a.target,c=this.facade;b===this.vidContId&&this._hasFacade()&&c.muteVideo()},onUnMuteVideo:function(a){var b=a&&a.target,c=this.facade;b===this.vidContId&&this._hasFacade()&&c.unMuteVideo()},onUVPJSTimerTick:function(){if(this._hasFacade()&&this.facade.getPlaybackState()===this.mc.PLAYING){var a={};this.cviModel.contentVideoState.episodeFlag&&(Date.now()-this._previousLocalStorageTime>this._localStorageInterval&&(this._previousLocalStorageTime=Date.now(),this.setLocalStorageItems()),a=this.cviModel.getContentVideoState(),!b.isEmpty(this.cviModel.sessionOptions.userId)&&Date.now()-this._previousResumeBeaconTime>this._resumeBeaconInterval&&(this._previousResumeBeaconTime=Date.now(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.PLAYBACK_DURATION_RESUME,{contentData:a},this.vidContId))),this.cviModel.contentVideoState.sendResumeEvent&&(this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_RESUME,{contentTime:this.cviModel.contentVideoState.startTime},this.vidContId),this.cviModel.contentVideoState.sendResumeEvent=!1);var c=this.getVideoProgressPayload();this.setModelDuration(c.duration),this.id3HandlingEnabled&&this.checkId3Events(c.currentTime),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,c,this.vidContId)}},checkBuffering:function(a){var b,c=this.cviModel?this.cviModel.contentPlaybackState:null;c&&c.playbackStarted&&c.playbackState!==this.mc.PAUSED&&this._hasFacade()&&this.facade.facadeType!==this.mc.FLASH_HLS&&(b=a||c.currentTime||0,!this.bufferingDetected&&b<this.bufferingCheckLastTime+this.bufferingCheckOffset?(this.bufferingDetected=!0,this.facade.playbackStateChange(this.mc.BUFFERING)):this.bufferingDetected&&b>=this.bufferingCheckLastTime+this.bufferingCheckOffset&&(this.bufferingDetected=!1,this.facade.playbackStateChange(this.mc.PLAYING)),this.bufferingCheckLastTime=b)},getVideoProgressPayload:function(){var a=(this.cviModel.getCurrentVideoState(),this.facade.getDuration()),b={averageDroppedFPS:0,bufferLength:0,currentBandwidth:0,currentContentSegment:1,currentMaxBandwidth:0,currentTime:0,droppedFrames:0,duration:a,errorInfo:"",facadeState:{},isAd:!1,isHDStreamLive:!1,isPlayingLive:!1,isSeeking:!1,lastPercentageCompleted:0,lastSecondCompleted:0,playbackState:this.mc.EMPTY,playbackBitrate:0,playbackComplete:!1,playbackFramerate:0,playbackStarted:!0,sourceBitrate:0,streamType:null,switchingMode:"auto",videoFramerate:0};return this.setFacadeStateOnProgressPayload(b),b},setFacadeStateOnProgressPayload:function(a){var b=this.facade,c=this._hasFacade()&&b.getFacadeState();if(!c)return a;a.facadeState=c,a.averageDroppedFPS=b.getAverageDroppedFPS(),a.bufferLength=b.getBuffered()||0,a.currentTime=b.getCurrentTime()||0,a.currentBandwidth=b.getCurrentBandwidth(),a.currentMaxBandwidth=b.getCurrentMaxBandwidth(),a.droppedFrames=b.getDroppedFramesCount(),a.playbackFramerate=b.getPlaybackFramerate(),a.playbackState=b.getPlaybackState(),a.streamType=b.getStreamType(),a.isHDStreamLive=b.isHDStreamLive(),a.isPlayingLive=b.isPlayingLive(),a.switchingMode=this.cviModel.useDynamicSwitching?"auto":"manual"},setLocalStorageItems:function(){uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",this.rco.pid),localStorage.setItem("UVPJS.resumeContentTime",this.cviModel.contentPlaybackState.currentTime),localStorage.setItem("UVPJS.resumeEpochTime",Date.now()),localStorage.setItem("UVPJS.resumeSessionId",this.cviModel.sessionId))},populateContentVideoStateFromLocalStorage:function(){var a=this.cviModel.contentVideoState,b=localStorage.getItem("UVPJS.resumePid")||null,c=localStorage.getItem("UVPJS.resumeContentTime")||null,d=localStorage.getItem("UVPJS.resumeEpochTime")||null,e=localStorage.getItem("UVPJS.resumeSessionId")||null;uvpjs.util.supportsLocalStorage()&&(b&&(a.resumePid=b),c&&(a.resumeContentTime=c),d&&(a.resumeEpochTime=d),e&&(a.resumeSessionId=e))},clearLocalStorageItems:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"clearLocalStorageItems"),uvpjs.util.supportsLocalStorage()&&(localStorage.setItem("UVPJS.resumePid",""),localStorage.setItem("UVPJS.resumeContentTime",0),localStorage.setItem("UVPJS.resumeEpochTime",0),localStorage.setItem("UVPJS.resumeSessionId",""))},resetModelState:function(){var a=this.cviModel;a&&(a.resetAdVideoState(),a.resetContentVideoState())},_hasFacade:function(){return!uvpjs.util.isEmpty(this.facade)}})}(uvpjs.register("uvpjs")),function(a){var b=a._,c={DOUBLECLICK_IMA:"pubads.g.doubleclick.net",DOUBLECLICK:"ad.doubleclick.net",PHP:"request.php",JSP:"Request.jsp"};a.ContentDataProxy=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CONTENT_DATA_PROXY,init:function(a){this.debug=uvpjs.debug,this.mdl={},this.retryLimit=3,this.callAttempts=0,this.selectorCall=null,this.callDelays=[0,20,1e3],this.opts=a||{},this.startErrorName=uvpjs.EventType.VIDEO_START_ERROR,this.cviModel=this.opts.cviModel,this.eventsMgr=this.opts.eventsManager,this.cviModel.contentVideoStateDefaults&&this.populateDefaults(this.cviModel.contentVideoStateDefaults),this.opts.url&&this.loadData(this.opts.url,this.opts.queryParams)},destroy:function(){this.mdl=null,this.opts&&delete this.opts.errorCallback,this.opts&&delete this.opts.successCallback,this.opts=null},setOptions:function(a){var b;for(b in a)this.opts[b]=a[b]},getModel:function(){return this.mdl},getProperty:function(a){return this.mdl[a]},setProperty:function(a,b){this.mdl[a]=b},loadData:function(a,b){var c,d="callback=uvpHandleJsonpResult",e=b||this.opts.queryParams,f=!1,g=!uvpjs.util.isEmpty(e);if(this.opts.url=a,this.opts.queryParams=b,g){a+=a.indexOf("?")<0?"?":"&";for(c in e)a+=(f?"&":"")+c+"="+e[c],f=!0}a.indexOf(d)<0&&(a+=(a.indexOf("?")<0?"?":"&")+d),this.selectorCall=a,this.tz=Date.now(),this.makeSelectorCall()},makeSelectorCall:function(){var a=new uvpjs.CodeLoader;this.callAttempts++,this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy making selector call: "+this.selectorCall),a.loadXHR(this.selectorCall,this.handleData.bind(this),this.handleError.bind(this))},signalError:function(a){"function"==typeof this.opts.errorCallback&&this.opts.errorCallback(a)},signalSuccess:function(){"function"==typeof this.opts.successCallback&&this.opts.successCallback()},parseSmilXML:function(a){var b,c,d,e,f,g,h,i,j,k=a.getElementsByTagName("ref"),l=null,m=k[0],n=!1,o=this.mdl,p=m&&this.checkForPlatformError(m);if(this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy.parseSmilXML; SMIL document:",a),p&&p.error)return p;if(b=a.getElementsByTagName("switch"),c=b[0]?b[0].getElementsByTagName("video"):a.getElementsByTagName("video"),null===c[0])return{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:uvpjs.ErrorInfo.messages.UNEXPECTED_ABSENCE_OF_VIDEO,isFatal:!0})};if(o.chapterTimesString="",m)for(d=0,e=k.length;d<e;d++)f=k[d],h=f.attributes.src.nodeValue,this.isAdCallURL(h)?(!n&&(o.imaAdCall=h),n=!0):l||(l=f,o.assetURL=l.getAttribute("src"),i=f.getElementsByTagName("param")),null!==f.getAttribute("clipEnd")&&(o.chapterTimesString+=f.getAttribute("clipEnd")+",");for(d=0,e=c.length;d<e&&(g=c[d],h=g.attributes.src.nodeValue,l||(l=g,o.assetURL=l.getAttribute("src"),i=g.getElementsByTagName("param"),null!==g.getAttribute("clipEnd")));d++)null!==g.getAttribute("clipEnd")&&(o.chapterTimesString+=g.getAttribute("clipEnd")+",");return j=i&&this.extractParams(i)||{},this.populateModelFromContentNodeAndParams(l,j),{error:!1}},populateModelFromContentNodeAndParams:function(a,b){var c,d,e=this.mdl,f=uvpjs.mediaCapabilities,g={episodeAbstract:"abstract",copyright:"copyright",sourceHeight:"height",keywords:"keywords",videoTitle:"title",sourceWidth:"width"},h={contentType:"contentType",excludeNielsenTracking:"excludeNielsenTracking",episodeNumber:"EpisodeNumber",cdn:"IsLiveCDN",category:"PrimaryCategoryName",seasonNumber:"SeasonNumber",VTAG:"VTAG",closedCaptionPath:"ClosedCaptionURL",seriesTitle:"SeriesTitle"},i="true";for(q in g)e[q]=a.getAttribute(g[q])||"";for(q in h)e[q]=b[h[q]]||"";e.mediaId=this.getMediaId(b),e.duration=this.getDuration(a),e.sourceOwner=this.getSourceOwner(b),e.cmsRefGuid=a.getAttribute("guid")||a.getAttribute("vid")||"",e.isEmbedable=b.Embeddable===i,e.isLive=b.IsLive===i,e.episodeFlag=b.EpisodeFlag===i,e.useWatermark=b.WatermarkPlayback===i,e.chapterTimesString.length>0?(c=e.chapterTimesString,d=c.length-1,c.lastIndexOf(",")===d&&(e.chapterTimesString=c.substring(0,d)),e.chapterStartTimes=this.convertChapterTimesToSeconds(e.chapterTimesString)):e.chapterStartTimes=[],e.assetURL.indexOf(f.M3U)>-1?(e.cdn="",e.fileType=f.M3U):e.assetURL.indexOf(f.MP3)>-1?e.fileType=f.MP3:e.fileType=f.MP4;var j=this.cviModel.getVideoPlaybackCDOProperty("matchPageUrlProtocol")||!1;j&&(e.assetURL=e.assetURL.replace(/^\w*:/,"")),this.debug&&uvpjs.log(this.DEBUG_ID,"ContentDataProxy mdl",e,j)},handleData:function(a){var b=a.responseText,c=uvpjs.util,d=b.substring(b.indexOf("{"),b.lastIndexOf("}")+1),e=this.isValidJsonStr(d)&&JSON.parse(d)||null,f=c.isEmpty(e)?null:e.metafile,g=f&&new DOMParser,h=g&&g.parseFromString(f,"application/xml"),i=h&&this.parseSmilXML(h);if(this.callAttempts=0,i){if(i.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: "+i.errorInfo.message),void this.signalError(i.errorInfo);this.defineProperties(),this.signalSuccess()}else this.debug&&uvpjs.error(this.DEBUG_ID,"ContentDataProxy Error: Invalid response"),this.signalError(this.createInvalidResourceFormatError())},isValidJsonStr:function(a){return"string"==typeof a&&("{"===a.charAt(0)&&"}"===a.charAt(a.length-1)||"["===a.charAt(0)&&"]"===a.charAt(a.length-1))},handleError:function(a){var b,c="ContentDataProxy Error: Unable to load url "+uvpjs.util.getErrorMessageForXHRStatus(a.status);this.debug&&uvpjs.error(this.DEBUG_ID,c,this.selectorCall),this.shouldRetryCall(a)?(b=this.callDelays[this.callAttempts],this.callAttempts>=1&&this.eventsMgr.dispatchEvent(this.startErrorName,{errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Selector call failed; now on retry "+this.callAttempts+"; dly = "+b,isFatal:!1})}),setTimeout(this.makeSelectorCall.bind(this),b)):(this.callAttempts=0,this.signalError(new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:c+" URL: "+this.selectorCall,isFatal:!0,serverCode:a.status})))},shouldRetryCall:function(a){var b=a.status;return this.selectorCall.indexOf("link.theplatform")>-1&&this.callAttempts<this.retryLimit&&500!==b&&404!==b&&403!==b&&0!==b},defineProperties:function(){},checkForPlatformError:function(a){var b=a&&this.parseSmilRefNodeForException(a);return b?{error:!0,errorInfo:new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.RESOURCE_UNAVAILABLE,message:this.composePlatformErrorMessage(b),serverCode:b.responseCode,isFatal:!0})}:{error:!1}},createInvalidResourceFormatError:function(){return new uvpjs.ErrorInfo({eventType:this.startErrorName,errorCode:uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,message:uvpjs.ErrorInfo.messages.INVALID_RESOURCE_FORMAT,isFatal:!0})},composePlatformErrorMessage:function(a){var b=a.responseCode||"n/a",c="; PID: "+(this.opts.pid||"n/a")+"; ",d=this.opts&&this.opts.cmsRefGuid+"; "||"",e=a.abstract?a.abstract+" ":"";return"Platform Error; code: "+b+c+d+(a.exception||"Resource Unavailable.")+" "+e},populateDefaults:function(a){!uvpjs.util.isEmpty(a)&&b.assign(this.mdl,a)},parseSmilRefNodeForException:function(a){var b,c=a.getElementsByTagName("param"),d={};if(c&&c.length){for(b=c.length;b--;)d[c[b].getAttribute("name")]=c[b].getAttribute("value");if("true"===d.isException)return d.abstract=a.getAttribute("abstract")||"",d}return null},extractParams:function(a){var b,c,d,e,f={};if(uvpjs.util.isEmpty(a))return f;for(e=a.length;e--;)b=a[e],c=b.getAttribute("name"),d=b.getAttribute("value"),c&&d&&(f[c]=d);return f},isAdCallURL:function(a){return a.indexOf(c.DOUBLECLICK)>-1||a.indexOf(c.DOUBLECLICK_IMA)>-1||a.indexOf(c.PHP)>-1||a.indexOf(c.JSP)>-1},getMediaId:function(a){var b,c,d,e="",f=a.trackingData;if(uvpjs.util.isEmpty(f))return"";for(b=f.split("|"),c=0,d=b.length;c<d;c++)b[c].indexOf("cid=")>-1&&(e=b[c].split("=")[1]);return e},getSourceOwner:function(a){var b=a.Source;return uvpjs.util.isEmpty(b)&&"true"===a.WatermarkPlayback?"Entertainment":b||""},getDuration:function(a){var b=parseInt(a.getAttribute("dur"))||0;return b>0?.001*b:b},convertChapterTimesToSeconds:function(a){for(var b=[],c=a.split(","),d=c.length,e=function(a){var b=parseInt;switch(a=c[d].split(":"),a.length){case 1:return b(a[0]);case 2:return 60*b(a[0])+b(a[1]);case 3:return 3600*b(a[0])+60*b(a[1])+b(a[2])}};d--;)b.unshift(e(c[d]));return b}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.RP_URL=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_URL},initialize:function(a,b,c){this._super(a,b,c)},loadData:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadData"),!b.isFunction(a)||!b.isFunction(c))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"RP_URL loadData Callbacks missing or invalid RETURN WITHOUT LOADING DATA"},this.internalNS);this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=a,this.dataLoadErrorCB=c,this.dataLoadedCB()},loadVideoAndBeginPlayback:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_URL loadVideoAndBeginPlayback this.rco = ",this.rco),this.resetModelState(),this.cviModel.isCurrVideoAd=!1,this._super(a)}})}(uvpjs.register("uvpjs")),function(a){a.RP_Platform=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,ONE_HOUR_MS:36e5,init:function(a){this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_PLATFORM},loadData:function(a,b){var c=this.getSelectorCall(),d=c.url||null,e=null;if(c.error)return this.debug&&uvpjs.error(this.DEBUG_ID,"RP_Platform ERROR: "+c.message),void("function"==typeof b&&b(new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.SELECTOR_CALL_ERROR,message:uvpjs.ErrorInfo.messages.SELECTOR_CALL_ERROR+" "+c.message,isFatal:!0})));this.dispatchVideoStateChange(this.mc.LOADING),this.dataLoadedCB=a,uvpjs.util.isDefinedString(this.rco.sig)&&(e={sig:this.rco.sig}),this.contentDataProxy.setOptions({pid:this.rco.pid||null,cmsRefGuid:this.rco.cmsRefGuid||null,successCallback:this.onDataProxyComplete.bind(this),errorCallback:b}),this.contentDataProxy.loadData(d,e)},loadVideoAndBeginPlayback:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform loadVideoAndBeginPlayback; roc = ",this.rco),this.resetModelState(),this._super(a)},getSelectorCall:function(){var a,b,c,d,e,f,g,h,i,j=this.rco,k=j.has("selectorCall")&&j.selectorCall||null;if(!k){if(k=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL"),d=k&&k.indexOf("$PID$")>-1,e=k&&k.indexOf("$GUID$")>-1,a=j.has("pid")&&j.pid||null,b=j.has("cmsRefGuid")&&j.cmsRefGuid||null,f=!d&&!e,c=!a&&!b,f||c)return h="Config error: "+(f?"Suitable selector call not found in config or RCO.":"Missing expected param: "+(d?"pid":"cmsRefGuid")),{error:!0,message:h};g=d?a:b,i=d?/\$PID\$/g:/\$GUID\$/g,k=k.replace(i,g),k=k.replace(/manifest=f4m/g,"manifest=m3u")}return{error:!1,url:k}},onDataProxyComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,'RP_Platform - ContentDataProxy "complete" callback invoked'),this.manageLocalAndGlobalResume(),this.setContinuationParams(),this.dataLoadedCB()},setContinuationParams:function(){var a=uvpjs.util;a.isEmpty(this.cviModel.sessionOptions.contsess)||this.contentDataProxy.setProperty("previousSessionId",this.cviModel.sessionOptions.contsess),a.isEmpty(this.rco.contPlayState)||this.contentDataProxy.setProperty("contPlayState",this.rco.contPlayState)},manageLocalAndGlobalResume:function(){var a,b,c,d,e,f,g,h,i=this.cviModel.contentVideoState,j=this.contentDataProxy,k=this.rco,l=function(){var a=j.getProperty("duration");return!uvpjs.util.isEmpty(k.globalResumeTime)&&k.globalResumeTime>0&&a>0&&a-k.globalResumeTime>20};this.populateContentVideoStateFromLocalStorage(),b=Date.now()-+i.resumeEpochTime,j.setProperty("resumePid",i.resumePid),j.setProperty("resumeEpochTime",+i.resumeEpochTime),j.setProperty("resumeSessionId",i.resumeSessionId),j.setProperty("resumeContentTime",+i.resumeContentTime),j.setProperty("playedChapterTime",+i.playedChapterTime),j.setProperty("showPreroll",i.showPreroll),j.setProperty("sendResumeEvent",!1),j.getProperty("episodeFlag")&&!0!==i.isLive&&(c=l(),e=!c&&k.pid===i.resumePid,c||e?(this.debug&&uvpjs.log(this.DEBUG_ID,"Local"),d=c?k.globalResumeTime:+i.resumeContentTime||0,a=c?0:b||0,h=!c&&b>this.ONE_HOUR_MS,g=c?this.cviModel.sessionId:"",f=this.getPlayedChapterTimeForContentResume(d),j.setProperty("sendResumeEvent",!0),j.setProperty("startTime",d),j.setProperty("elapsedTime",a),j.setProperty("showPreroll",h),j.setProperty("playedChapterTime",f),j.setProperty("previousSessionId",g),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.USER_GESTURE,{gestureInfo:[(e?"local":"global")+"Resume"],startTime:d},this.vidContId)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform; No global or local resume."),this.clearLocalStorageItems()))},getPlayedChapterTimeForContentResume:function(a){var b,c=0,d=this.contentDataProxy.getProperty("chapterStartTimes"),e=d.length||0;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform: chapterStartTimes = ",d),e)for(;e--;)if(b=d[e],a>=b){a-b>=4?c=b:(this.contentDataProxy.setProperty("startTime",a-4),e>0&&(c=d[e-1]));break}return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform resume using playedChapTime = ",c),c}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.RP_Mdialog=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_MDIALOG},initialize:function(a,b,c){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog initialize vidContId        = ",c),this._super(a,b,c)},loadData:function(a,c){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Mdialog loadData"),!b.isFunction(a))return void this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.UVPJS_WARNING,{msg:"ResourceProvider initialize init params missing or invalid RETURN WITHOUT CREATING A RESOURCE PROVIDER"},this.internalNS);this.dataLoadedCB=a,this.dataLoadErrorCB=c,this.dataLoadedCB()}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.RP_IMA=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,STUCK_AD_DEBUG_ID:uvpjs.DebugManager.configParams.STUCK_AD,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",AD_BITRATE_THRESHOLD:2500,AD_CALL_ONLY:"adCallOnly",PLATFORM:"platform",CONTENT_AND_AD_CALL:"contentAndAdCall",MDIALOG:"mdialog",AD_BLOCKER_POLLING_INTERVAL:120,IMA_TIMEOUT:"imaTimeout",STUCK_AD_NUM_INTERVALS:10,trueXInteractionIds:{CHOICE_CARD_LOADED:"TrueXChoiceCardLoaded",OPT_IN:"TrueXUserOptIn",OPT_OUT:"TrueXUserOptOut",TIME_OUT:"TrueXUserTimeOut",CREDIT:"TrueXCredit",CLOSED_AFTER_CREDIT:"TrueXClosedAfterCredit",CLOSED_BEFORE_CREDIT:"TrueXClosedBeforeCredit"},init:function(a){this.imaAdCall="",this.imaScenario="",this.APM={},this.currAdPod={},this.isRP_IMACleanedUp=!1,this.dynamicMidRollPodCount=0,this.lastAdBlockCheckTime=0,this.imaCuePoints=[],this.viewGuid="",this.renderSettings={},this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1},this.stuckAdCheckDisabled=!1,this.dynamicAdSessionInProgress=!1,this._uvpEventListenersAdded=!1,this.adTrackingHandle=null,this.contentPlayheadTracker={currentTime:0,pendingSeekTime:-1,seeking:!1,duration:0},this.adCallUrl="",this.ad=null,this.previousRemainingTime=null,this.stuckIntervals=0,this.seekPending=!1,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_IMA},initialize:function(a,b,c){var d,e;this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing; IMA version = ",google.ima.VERSION),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: rcObj = ",a),uvpjs.log(this.DEBUG_ID,"RP_IMA Initializing: vidContId = ",c)),this.playbackState=this.mc.EMPTY,this.vidContId=c,this.adsLoader=null,this.adsManager=null,this.remainingTimeInterval=0,this.refreshFrequency=300,this.duration=0,this.currImaAdTime=0,this.savedSeekToTime=-1,this.adPodInProgress=!1,this.adStartEventReceived=!1,this.uvpjsAdStartOpened=!1,this.uvpjsContentStartOpened=!1,this.contentVideoPresent=!1,this.contentNeedsToBeLoaded=!1,this.rco=a,this.isContentScenario=!1,this._super(a,b,c),this.cviModel.isCurrVideoAd=!1,this.imaScenario=this._determineIMAScenario(this.rco),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA initialize this.imaScenario = ",this.imaScenario),null===this.imaScenario?(d=this.getUnknownImaScenarioError(),this.eventsMgr.dispatchEvent(d.eventType,{errorInfo:d},c)):(e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+this.vidContId),this.videoPlayerDiv=document.getElementById(this.vidContId),this.contentVideoTag=e.getElementsByTagName("video")[0],this.cviModel.setAdVideoState())},loadData:function(a,b){switch(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadData"),this._updateIMAPlaybackState(this.mc.LOADING),!this.mc.isChromecast()&&this._updateAdSize(0,0),this.imaScenario){case this.AD_CALL_ONLY:a();break;case this.PLATFORM:this._super(a,b);break;case this.CONTENT_AND_AD_CALL:a()}},onDataProxyComplete:function(){this.setImaAdUrl(),this._super()},loadVideoAndBeginPlayback:function(a){var b=this.rco,c=this.cviModel,d=uvpjs.util.isDefinedString(b.adCall)?b.adCall:null,e=this.imaScenario===this.PLATFORM,f=d||(e?this.imaAdCall:null);this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA load/beginPlay, id= "+this.vidContId+"; RCO= ",this.rco),this.cviMgr.contentInitializedForIMA=!1,this.resetModelState(),this.setModelRcoOverrides(),this._addUVPEventListeners(),this.adsLoader=this.cviMgr.adsLoader,this.imaScenario===this.AD_CALL_ONLY?(c.mergeCDOData(),this.finishLoadVideoAndBeginPlayback(f)):(c.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),c.setContentVideoStateItems(b),c.mergeCDOData(),this.multiCdnClient?this.multiCdnClient.getDecision(this.handleCdnDecision.bind(this,f)):this.doFlashCheck(f))},finishLoadVideoAndBeginPlayback:function(a){var b="",c=uvpjs.adUtil,d=this.cviModel;this.cviMgr.setPlaybackInfoOnModel(),this.imaScenario!==this.AD_CALL_ONLY&&(this.dispatchContentDataLoaded(),this.contentNeedsToBeLoaded=!0,d.incrementMedNum(),this.isContentScenario=!0),a?(b=c.populateImaAdCallValues(a,d,this.isContentScenario),this.viewGuid=c.getDwViewGuid(d),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA assembled ad call...",b)):this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA finishLoadVideoAndBeginPlayback: No ad call."),this.killDataProxy(),this.RPM.resourceStart(this.rco.rcoSeed),this.requestAdsManagerOrResume(b)},dispatchContentStart:function(){this.resetTrueXStatus(),this.stuckAdCheckDisabled=!1,this._super()},requestAdsManagerOrResume:function(a){b.isString(a)&&!b.isEmpty(a)?this._requestAdsManager(a):this._onContentResumeRequested()},setImaAdUrl:function(){var a=this.checkForAdCallOverride();a?(this.contentDataProxy.setProperty("imaAdCall",a),this.imaAdCall=a):this.imaAdCall=this.contentDataProxy.getProperty("imaAdCall")},checkForAdCallOverride:function(){var a=this.cviModel.getModule(this.AD_SETTINGS),c=null!=a&&1==a.enabled,d=this.cviModel.getModuleParam(this.AD_SETTINGS,this.AD_CALL_OVERRIDE),e=null;return c&&!b.isUndefined(d)&&(e=d),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dCallOverride: "+(e||"null")),e},manageLocalAndGlobalResume:function(){this._super(),this.contentDataProxy.setProperty("podsToSkip",this.getPodsToSkip())},getPodsToSkip:function(){var a,b="",c=this.contentDataProxy,d=c.getProperty("chapterStartTimes");return c.getProperty("showPreroll")||(b="1"),d.length>0&&(a=d.indexOf(c.getProperty("playedChapterTime")))>=0&&(a+=2,b=b.length>0?b+","+String(a):String(a)),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_Platform getPodsToSkip returning: ",b),b},getUnknownImaScenarioError:function(){return new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.PLAYER_START_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_SCENARIO_UNKNOWN,message:uvpjs.ErrorInfo.messages.IMA_SCENARIO_UNKNOWN,isFatal:!0})},createContentFacade:function(){this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},facadeDisplayReady:function(){this.facade.facadeType===this.mc.FLASH_HLS&&this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.CAPTIONS_READY,{vidState:this.cviModel.getContentVideoState()},this.vidContId)},facadeDone:function(){this.imaContentComplete()},processInteractionEvent:function(a){var b=a&&a.id,c=this.trueXInteractionIds;switch(b){case c.CLOSED_BEFORE_CREDIT:case c.CHOICE_CARD_LOADED:this.resetTrueXStatus(),this.trueXStatus.choicePending=!0;break;case c.OPT_IN:this.trueXStatus.choicePending=!1,this.trueXStatus.inProgress=!0;break;case c.OPT_OUT:case c.TIME_OUT:this.resetTrueXStatus();break;case c.CREDIT:this.trueXStatus.discardBreakOnComplete=!0}this.stuckAdCheckDisabled=this.trueXStatus.choicePending||this.trueXStatus.inProgress},resetTrueXStatus:function(){this.trueXStatus={inProgress:!1,choicePending:!1,discardBreakOnComplete:!1}},assembleAdPodInfo:function(a){var b=this.getAdPodInfo(a),c=b.podIndex,d=0===c?"pre":-1===c?"post":"mid_"+c;if(this.currAdPod=this.APM.getAdPodById(d),void 0===this.currAdPod)return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA: currAdPod is undefined."),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_ADPOD_ERROR,isFatal:!1,adInfo:this.extractAdInfo(a)}),adCallUrl:this.adCallUrl},this.vidContId),!1;var e=this.currAdPod;return e.adCount=b.totalAds,e.podDuration=b.maxDuration,e.isBumper=b.isBumper,e.imaPodIndex=b.podIndex,e.timeOffset=b.timeOffset,e.totalAds=b.totalAds,e.imaAdPostion=b.adPosition,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Ad Pod encountered; podIdx = ",c,this.currAdPod),!0},getAdPodInfo:function(a,b){var c=a.getAdPodInfo(),d=b||{};return d.adPosition=c.getAdPosition(),d.isBumper=c.getIsBumper(),d.maxDuration=c.getMaxDuration(),d.podIndex=c.getPodIndex(),d.timeOffset=c.getTimeOffset(),d.totalAds=c.getTotalAds(),d},assembleAdInfo:function(a){return{adId:a.getAdId(),adPodInfo:this.getAdPodInfo(a),adSystem:a.getAdSystem(),advertiserName:a.getAdvertiserName(),apiFramework:a.getApiFramework(),contentType:a.getContentType(),creativeAdId:a.getCreativeAdId(),creativeId:a.getCreativeId(),dealId:a.getDealId(),description:a.getDescription(),duration:a.getDuration(),height:a.getHeight(),mediaUrl:a.getMediaUrl(),minSuggestedDuration:a.getMinSuggestedDuration(),skipTimeOffset:a.getSkipTimeOffset(),surveyUrl:a.getSurveyUrl(),title:a.getTitle(),traffickingParams:a.getTraffickingParameters(),traffickingParametersString:a.getTraffickingParametersString(),uiElements:a.getUiElements(),universalAdIdRegistry:a.getUniversalAdIdRegistry(),universalAdIdValue:a.getUniversalAdIdValue(),vastMediaHeight:a.getVastMediaHeight(),vastMediaWidth:a.getVastMediaWidth(),vastMediaBitrate:a.getVastMediaBitrate(),width:a.getWidth(),wrapperAdIds:a.getWrapperAdIds(),wrapperAdSystems:a.getWrapperAdSystems(),wrapperCreativeIds:a.getWrapperCreativeIds(),isLinear:a.isLinear()}},onAdEvent:function(a){var c,d=a.getAdData(),e=a.getAd(),f=google.ima.AdEvent.Type;if(a.type===f.INTERACTION)return void this.processInteractionEvent(d);if(!this.trueXStatus.choicePending)switch(!0===this.cviModel.isCurrVideoAd&&this.trackAdEvent(a.type),a.type){case f.LOADED:if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.LOADED ad = ",e),this.cviModel.setAdVideoStateItems({adAssetUrl:this._getAdAssetUrl(a)}),!this.adPodInProgress){if(!this.assembleAdPodInfo(e))return void this.adErrorCheckForContentVideoBeforeCallingCleanUp();this.adPodInProgress=!0,(this.APM.isMidRoll(this.currAdPod)||this.dynamicMidRollPodCount>0)&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd()),this.dispatchAdPodStart()}this._populateAdVideoState(e,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(a)}),this._dispatchAdLoaded(this.assembleAdInfo(e));break;case f.STARTED:var g,h,i=e.getContentType();this.ad=e,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.STARTED"),this.adStartEventReceived=!0,this.cviModel.isCurrVideoAd=!0,this.cviModel.incrementAdNum(),this.cviModel.resetAdPlaybackState(),this.duration=e.getDuration(),this._populateAdVideoState(e,{isCustomClickTrackingUsed:this.adsManager.isCustomClickTrackingUsed(),adAssetUrl:this._getAdAssetUrl(a)}),this.cviModel.mergeCDOData(),"application/javascript"!==i&&"application/x-shockwave-flash"!==i||this.cviModel.setAdVideoStateItems({isVPAID:!0}),"application/x-shockwave-flash"===i&&console.warn("IMA delivered FLash VPAID: application/x-shockwave-flash!"),this.trackAd(e),this.trackAdEvent(f.STARTED),g=e.getAdPodInfo(),g&&(h=g.getTotalAds()),this._dispatchAdStart(h),this._updateIMAPlaybackState(this.mc.PLAYING),this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback(),this._startRemainingTimeInterval();break;case f.AD_BUFFERING:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.AD_BUFFERING"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BUFFERING,{},this.vidContId);break;case f.FIRST_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.FIRST_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:25},this.vidContId);break;case f.MIDPOINT:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.MIDPOINT"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:50},this.vidContId);break;case f.THIRD_QUARTILE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.THIRD_QUARTILE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:75},this.vidContId),this._checkForContentPreload();break;case f.COMPLETE:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.COMPLETE"),this.ad=null,this._updateIMAPlaybackState(this.mc.STOPPED),this.untrackAd(),this._dispatchAdEnd(),this.trueXStatus.discardBreakOnComplete&&(this.resetTrueXStatus(),this.adsManager.discardAdBreak());break;case f.ALL_ADS_COMPLETED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.ALL_ADS_COMPLETED"),this.imaScenario===this.AD_CALL_ONLY||b.isEmpty(this.facade)?this.cleanUpRP_IMA():this._destroyAdsManagerAndRemoveAdsManagerListeners();break;case f.CLICK:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.CLICK this.adsManager.pause()"),this.adsManager.pause(),c=this.cviModel.getAdVideoState(),c.paused=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_CLICK,{adData:c},this.vidContId);break;case f.PAUSED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.PAUSED"),this._updateIMAPlaybackState(this.mc.PAUSED);break;case f.RESUMED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.RESUMED"),this._updateIMAPlaybackState(this.mc.PLAYING);break;case f.USER_CLOSE:this.stopVideo(),this.adErrorCheckForContentVideoBeforeCallingCleanUp();break;case f.SKIPPED:this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent google.ima.AdEvent.Type.SKIPPED"),this.ad=null,c=this.cviModel.getAdVideoState(),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_SKIPPED,{adData:c,adCallUrl:this.adCallUrl},this.vidContId),uvpjs.warn(this.DEBUG_ID,"DEPRECATION NOTICE: The AD_SKIPPED event will be removed in a future release. Please listen for AD_END and reference the `skipped` boolean in the event object payload (e.g. `adData: { skipped: true }`)."),this._dispatchAdEnd(!0);break;case f.LOG:var j,k=d&&d.adError,l=(uvpjs.ErrorInfo,null===e);this.eventsMgr.eventTypes.AD_ERROR;!k&&l?(j=this.cviModel.getSessionOption("adBlockerCallback"))&&"function"==typeof j&&j()&&this.dispatchAdBlockedEvent():this.dispatchAdErrorEvent(k,e,"Unknown error - IMA.AdEvent.Type.LOG "),this.checkForAdBlocker(),l&&!k&&this.savedSeekToTime>-1&&this.resumeContentPlay();break;case f.VOLUME_CHANGED:this._dispatchAdVolumeChange();break;default:return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdEvent UNKNOWN AD EVENT adEvent.type = ",f))}},_populateAdVideoState:function(a,c){var d,e;if(!b.isObject(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA _populateAdVideoState !_.isObject(ad) RETURN"));if(e=uvpjs.adUtil.extractAdStateData(a,uvpjs.adUtil.context.IMA),c)for(d in c)e[d]=c[d];this.cviModel.setAdVideoState(e),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _populateAdVideoState; mdl.adVideoState: ",this.cviModel.getAdVideoState())},_requestAdsManager:function(a){var b=this.cviModel;if(this.checkForAdBlocker(),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _requestAdsManager adCallUrl = ",a),this.adStartEventReceived=!1,this.adCallUrl=a,uvpjs.util.isEmpty(this.adsLoader))return this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,message:"Unexpected condtion: Encountered invalid ima.AdsLoader instance.",isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.resumeContentPlay();var c=new google.ima.AdsRequest;c.adTagUrl=a,this._updateAdSize(),c.linearAdSlotWidth=this.containerWidth,c.linearAdSlotHeight=this.containerHeight,c.nonLinearAdSlotWidth=this.containerWidth,c.nonLinearAdSlotHeight=this.containerHeight,"function"==typeof c.setAdWillAutoPlay&&(c.setAdWillAutoPlay(b.isAutoplay),c.setAdWillPlayMuted(b.isMuteAtPlayStart&&!b.userHasUnmuted)),this._dispatchAdRequest(),this.adsLoader.requestAds(c)},onAdsManagerLoaded:function(a){var c,d,e,f=this.imaScenario===this.AD_CALL_ONLY?this.contentVideoTag:this.contentPlayheadTracker,g=uvpjs.util;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA adsManagerLoadedEvent = ",a),this._dispatchAdResponse(),g.isEmpty(this.RPM)||g.isEmpty(this.RPM.currRP)||g.isEmpty(this.cviModel))return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded: resrc provider or cviModel is null"),void(null!==this.adsManager&&(this.adsManager.destroy(),this.adsManager=null));this.renderSettings=new google.ima.AdsRenderingSettings;var h=this.renderSettings;h.bitrate=this.getAdPlaybackBitrate(),h.restoreCustomPlaybackStateOnAdBreakComplete=!1,h.enablePreloading=!1,h.loadVideoTimeout=this._returnIMATimeout(),c=this.adsManager=a.getAdsManager(f,h),this.debug&&(uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomPlaybackUsed() = ",c.isCustomPlaybackUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.isCustomClickTrackingUsed() = ",c.isCustomClickTrackingUsed()),uvpjs.log(this.DEBUG_ID,"RP_IMA - adsMgr.getCuePoints() = ",c.getCuePoints())),this.imaScenario!==this.PLATFORM&&this.imaScenario!==this.CONTENT_AND_AD_CALL||(d=this.cviModel.contentVideoState.chapterStartTimes,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA - chapterStartTimes = ",d)),this.imaCuePoints=this.adsManager.getCuePoints(),b.isEmpty(this.imaCuePoints)&&(this.imaCuePoints=[0]),this.cviModel.APM=new uvpjs.AdPlaylistManager,this.APM=this.cviModel.APM,this.imaScenario===this.PLATFORM?this.APM.initialize(this.vidContId,d,this.imaCuePoints,this.imaAdCall):this.imaScenario===this.CONTENT_AND_AD_CALL?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA; CONTENT_AND_AD_CALL chapterStartTimes = ",d),this.APM.initialize(this.vidContId,d,this.imaCuePoints,this.rco.adCall)):this.APM.initialize(this.vidContId,[],this.imaCuePoints,this.rco.adCall),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded this.imaCuePoints = ",this.imaCuePoints),this._addAdsManagerEventListeners(),e=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.init(this.containerWidth,this.containerHeight,e),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onAdsManagerLoaded.. starting ads"),this.imaUsesContentVideoTag()&&(this._cleanUpContentVideoFacade(),this.contentNeedsToBeLoaded=!0),this.startAds()},getAdPlaybackBitrate:function(){var a=this.cviModel.contentPlaybackState.facadeState.currentBitrate,b=900;return!uvpjs.util.isEmpty(a)&&a>0&&(b=Math.min(a/1e3,this.AD_BITRATE_THRESHOLD)),b},startAds:function(){var a,b,c=null,d=null;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA startAds");try{this.adsManager.start()}catch(e){this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA ERROR startAds adError = ",e),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),b=uvpjs.ErrorInfo,a=b.messages.NO_AD_CONTENT,e&&"function"==typeof e.getMessage&&(a+=": "+e.getMessage(),c=e.getErrorCode(),d=e.getVastErrorCode()),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new b({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:b.errorCodes.IMA_AD_ERROR,message:a,imaErrorCode:c,imaVastErrorCode:d,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),this.adErrorCheckForContentVideoBeforeCallingCleanUp()}},imaUsesContentVideoTag:function(){return this.adsManager&&this.adsManager.isCustomPlaybackUsed()},_onContentPauseRequested:function(){var a,c=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _onContentPauseRequested by AdsManager"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_PAUSE_REQUEST,{},this.vidContId),b.isEmpty(this.facade)||(c=this.cviModel.contentVideoState.isLive,a=this.imaUsesContentVideoTag(),!a&&this.facade.hideVideo(),c&&!a?this.muteContentForAdPlay(!0):(this.facade.pauseVideo(),a&&(this.savedSeekToTime=c?-1:this.facade.getCurrentTime())),this.adsManager.setVolume(this.cviModel.isMuted?0:this.cviModel.volume))},_onContentResumeRequested:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_PLUGIN_CONTENT_RESUME_REQUEST,{},this.vidContId),this.resumeContentPlay()},imaContentComplete:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete"),!b.isEmpty(this.APM)&&this.APM.hasPostRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete this.APM.hasPostRoll() call this.adsLoader.contentComplete();"),this.adsLoader.contentComplete(),this._cleanUpContentVideoFacade()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA imaContentComplete !this.APM.hasPostRoll() NO POST ROLL wrap it up! call this.cleanUpRP_IMA();"),this.cleanUpRP_IMA())},stopVideo:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA stopVideo"),this.adsManager&&this.adsManager.stop(),this._updateIMAPlaybackState(this.mc.STOPPED)},resumeContentPlay:function(){if(this.contentPlayheadTracker.pendingSeekTime=-1,this.adPodInProgress&&(this.currAdPod.hasPlayed=!0,this.adPodInProgress=!1,this.handleAdPodEnd(),this.dynamicAdSessionInProgress&&(this.dynamicAdSessionInProgress=!1,this._destroyAdsManagerAndRemoveAdsManagerListeners())),!b.isEmpty(this.APM)&&this.APM.isPostRoll(this.currAdPod))return void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay by AdsManager post-roll case, content already done RETURN"));if(this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),!this.adStartEventReceived)return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === FALSE error case, ad load request made but ad start event never received"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.IMA_AD_ERROR,message:uvpjs.ErrorInfo.messages.IMA_AD_START_FAILED,isFatal:!1}),adCallUrl:this.adCallUrl},this.vidContId),void this.adErrorCheckForContentVideoBeforeCallingCleanUp();if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.adStartEventReceived === TRUE this._clearRemainingTimeInterval();"),this._clearRemainingTimeInterval(),b.isEmpty(this.facade))this.debug&&uvpjs.log(this.DEBUG_ID,"resumeContentPlay facade Empty, no video to play; CHECK FOR POST-ROLL and force cleanup"),this.imaScenario===this.AD_CALL_ONLY&&!b.isEmpty(this.APM)&&this.APM.hasPostRoll()&&(this.debug&&uvpjs.warn(this.DEBUG_ID,"resumeContentPlay; facade isEmpty, no video; HAS POST-ROLL FORCE CLEANUP"),this.cleanUpRP_IMA());else{if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA resumeContentPlay this.facade.playVideo() PLAY THE CONTENT VIDEO"),this.cviModel.isCurrVideoAd=!1,this.uvpjsContentStartOpened=!0,this.contentVideoPresent=!0,this.dispatchContentStart(),this.facade.setVolume(this.cviModel.volume),this.muteContentForAdPlay(!1),this.savedSeekToTime>-1){if(this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive)return this.seekPending=!0,void this.facade.playVideo();this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1}this.facade.showVideo(),this.facade.playVideo()}},facadePlaybackStateChange:function(a){this.seekPending&&a===this.mc.PLAYING&&(this.facade.seekTo(this.savedSeekToTime),this.savedSeekToTime=-1,this.seekPending=!1),this._super(a)},_updateIMAPlaybackState:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState this.playbackState = "+this.playbackState," newState = ",a),a!==this.playbackState&&(this.playbackState=a,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _updateIMAPlaybackState dispatch VIDEO_STATE_CHANGE newState = ",a),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{currentState:this.cviModel.getAdPlaybackState().playbackState,newState:this.playbackState,isAd:!0,adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl},this.vidContId))},_dispatchAdStart:function(a){var b=this.cviModel.getAdVideoState();this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdStart dispatch AD_START"),this.uvpjsAdStartOpened=!0,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_START,{podAdCount:a||1,adData:b,isDynamicAdCall:this.dynamicAdSessionInProgress,currAdPod:this.currAdPod,adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdEnd:function(a){var b;this.uvpjsAdStartOpened&&(b=this.cviModel.getAdVideoState(),b.skipped=!0===a,this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdEnd dispatch AD_END"),this.uvpjsAdStartOpened=!1,this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_END,{adData:b,adCallUrl:this.adCallUrl},this.vidContId))},_getAdAssetUrl:function(a){var b="function"==typeof a.getAdData?a.getAdData():{},c="function"==typeof a.getAd?a.getAd():{};return("function"==typeof c.getMediaUrl?c.getMediaUrl():b.mediaUrl)||null},_dispatchAdLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdLoaded dispatch AD_LOADED"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_LOADED,{adCallUrl:this.adCallUrl,adAssetUrl:this.cviModel.getAdVideoState().adAssetUrl,adData:this.cviModel.getAdVideoState(),imaAdData:a},this.vidContId)},_dispatchAdRequest:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdRequest dispatch AD_REQUEST"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_REQUEST,{adCallUrl:this.adCallUrl},this.vidContId)},_dispatchAdResponse:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdResponse dispatch AD_RESPONSE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_RESPONSE,{adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdPodStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA dispatchAdPodStart dispatch AD_POD_START this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod},this.vidContId)},_dispatchAdVolumeChange:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _dispatchAdVolumeChange dispatch AD_VOLUME_CHANGE"),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_VOLUME_CHANGE,{volume:this.adsManager.getVolume()},this.vidContId)},handleAdPodEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA handleAdPodEnd dispatch AD_POD_END this.currAdPod = ",this.currAdPod),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod},this.vidContId),this.cviModel.setAdVideoState(),this.currAdPod={}},getPlaybackState:function(){return this.playbackState},_updateAdSize:function(a,b){var c,d,e;a&&(this.containerWidth=a),b&&(this.containerHeight=b),this.mc.isChromecast()||(c=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("width")),d=parseInt(window.getComputedStyle(this.videoPlayerDiv,null).getPropertyValue("height")),c===this.containerWidth&&d===this.containerHeight||(this.containerWidth=c,this.containerHeight=d,this.adsManager&&(e=this.cviModel.isFullscreen?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL,this.adsManager.resize(this.containerWidth,this.containerHeight,e))))},_updateCurrentAdTime:function(){if(this._updateAdSize(),this.adsManager&&this.playbackState!==this.mc.PAUSED&&this.playbackState!==this.mc.EMPTY){var a=this.adsManager.getRemainingTime();this._checkForStuckAd(a)?this.adsManager.discardAdBreak():(this.currImaAdTime=Math.floor(this.duration-a),this.cviModel.setAdPlaybackStateItems({currentTime:this.currImaAdTime}))}},_checkForStuckAd:function(a){if(this.stuckAdCheckDisabled)return!1;if(null===this.previousRemainingTime)return this.previousRemainingTime=a,!1;var b=this.previousRemainingTime-a;if(this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, timeDelta: "+b),0===b?(this.stuckIntervals++,this.debug&&uvpjs.log(this.STUCK_AD_DEBUG_ID,"RP_IMA _checkForStuckAd, stuckIntervals: "+this.stuckIntervals)):this.stuckIntervals=0,this.stuckIntervals===this.STUCK_AD_NUM_INTERVALS){var c="Ad playback stuck for "+this.stuckIntervals+" intervals.",d=new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR,message:c,isFatal:!1,adInfo:this.extractAdInfo(this.ad)});return this.debug&&uvpjs.error(this.STUCK_AD_DEBUG_ID,c,d),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:d,adCallUrl:this.adCallUrl},this.vidContId),!0}return this.previousRemainingTime=a,!1},_startRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA this.startRemainingTimeInterval()"),0===this.remainingTimeInterval&&(this.previousRemainingTime=null,this.stuckIntervals=0,this.remainingTimeInterval=window.setInterval(this._updateCurrentAdTime.bind(this),this.refreshFrequency,this))},_clearRemainingTimeInterval:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _clearRemainingTimeInterval"),0!==this.remainingTimeInterval&&window.clearInterval(this.remainingTimeInterval),this.remainingTimeInterval=0,this.previousRemainingTime=null,this.stuckIntervals=0},_destroyAdsManagerAndRemoveAdsManagerListeners:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _destroyAdsManagerAndRemoveAdsManagerListeners"),null!==this.adsManager&&(this._removeAdsManagerEventListeners(),this.adsManager.destroy(),this.adsManager=null),this.dynamicAdSessionInProgress=!1},onAdError:function(a){var b=a&&a.getAd&&a.getAd()||null;this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.NO_AD_CONTENT,{},this.vidContId),this.dispatchAdErrorEvent(a.getError(),b),this.checkForAdBlocker(),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},handleAdsLoaderError:function(a){this.dispatchAdErrorEvent(a.getError()),this.adErrorCheckForContentVideoBeforeCallingCleanUp()},extractAdInfo:function(a){return uvpjs.adUtil.extractAdInfo(a,uvpjs.adUtil.context.IMA)},dispatchAdErrorEvent:function(a,b,c){var d,e,f,g=null,h=null,i=null,j="Unknown",k=uvpjs.ErrorInfo,l=uvpjs.util,m=l.isFunction,n="n/a",o=" Unspecified IMA ad error.";a&&m(a.getMessage)&&(g=a.getMessage(),h=a.getErrorCode()||"n/a",i=a.getVastErrorCode()||"n/a",j=" imaErrorCode: "+h+"; vastErrorCode: "+i,g+=j),a&&m(a.getInnerError)&&(d=a.getInnerError())&&(!g&&(g=""),e=m(d.getMessage)?d.getMessage():d.message||n,f=m(d.getErrorCode)?d.getErrorCode():n,g+=" Inner error: "+e+"; inner error code: "+f),this.debug&&uvpjs.warn(this.DEBUG_ID,"AD_ERROR: "+g),c&&(g=c+" "+g),this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_ERROR,{errorInfo:new k({eventType:this.eventsMgr.eventTypes.AD_ERROR,errorCode:k.errorCodes.IMA_AD_ERROR,message:k.messages.IMA_AD_ERROR_EVENT_RECEIVED+(g||o),isFatal:!1,imaErrorCode:h,imaVastErrorCode:i,adInfo:this.extractAdInfo(b)}),adCallUrl:this.adCallUrl},this.vidContId)},dispatchAdBlockedEvent:function(){this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})},this.vidContId)},adErrorCheckForContentVideoBeforeCallingCleanUp:function(){if(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.vidContId = ",this.vidContId),this.contentNeedsToBeLoaded&&(this.contentNeedsToBeLoaded=!1,this.createContentFacade()),b.isEmpty(this.facade))return this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA adErrorCheckForContentVideoBeforeCallingCleanUp this.facade is empty = ",this.facade),void this.cleanUpRP_IMA();this.cviModel.isCurrVideoAd=!1,this.contentVideoPresent||(this.contentVideoPresent=!0,this.onUVPJSTimerTick(),this._addVideoProgressTimerCallback()),this.uvpjsContentStartOpened||(this.uvpjsContentStartOpened=!0,this.dispatchContentStart()),this.facade.setVolume(this.cviModel.volume),this.cviModel.isMuted?this.facade.muteVideo():this.facade.unMuteVideo(),this.facade.showVideo(),this.facade.playVideo()},cleanUpRP_IMA:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA cleanUpRP_IMA RP_IMA this.isRP_IMACleanedUp = ",this.isRP_IMACleanedUp),!this.isRP_IMACleanedUp){var a=this.rco.rcoSeed;this.isRP_IMACleanedUp=!0,this._updateIMAPlaybackState(this.mc.STOPPED),this.adTrackingHandle=null,this._dispatchAdEnd(),this._clearRemainingTimeInterval(),this._removeTimers(),this._removeUVPEventListeners(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.adPodInProgress&&(this.adPodInProgress=!1,this.handleAdPodEnd()),this.killDataProxy(),this.platformContentVideoState={},this.APM={},this.cviModel.APM=null,this._cleanUpContentVideoFacade(),this.cleanUpObjects(),this.RPM.resourceEnd(a)}},_cleanUpContentVideoFacade:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _cleanUpContentVideoFacade"),this.contentVideoPresent&&(this.contentVideoPresent=!1,this.dispatchVideoDone(),this.uvpjsContentStartOpened&&(this.uvpjsContentStartOpened=!1,this.dispatchContentEnd())),this.destroyFacade()},loadDynamicAdCall:function(a){var b;if(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA loadDynamicAdCall adCall = ",a),null!==this.adsManager)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA loadDynamicAdCall WARNING this.adsManager != null; RETURN before making dynamic ad call"));this.dynamicMidRollPodCount++,b=uvpjs.adUtil.populateImaAdCallValues(a,this.cviModel,this.isContentScenario,this.rco.cpAB),this.mc.isIOS()&&!this.cviModel.contentVideoState.isLive&&(this.savedSeekToTime=this.facade&&this.facade.getCurrentTime()||-1),this.dynamicAdSessionInProgress=!0,this.rco.adCall=b,this._requestAdsManager(b)},forceDynamicMidrollPodEnd:function(){this.dynamicAdSessionInProgress&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA closing dynamic ad session"),this._updateIMAPlaybackState(this.mc.STOPPED),this._dispatchAdEnd(),this._destroyAdsManagerAndRemoveAdsManagerListeners(),this.resumeContentPlay())},onPauseVideo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo this.adsManager.pause(); this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress TRUE this.adsManager.pause(); this.vidContId = ",this.vidContId),this.adsManager.pause()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPauseVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent pause the CONTENT video"),this._super(a)))},onPlayVideo:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo aka resume ima this.vidContId = ",this.vidContId," this.adPodInProgress = ",this.adPodInProgress),b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?this.adsManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress TRUE this.adsManager.resume(); this.vidContId = ",this.vidContId),this.adsManager.resume()):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onPlayVideo adPodInProgress FALSE this._super(evtObj); have the Resource Provider parent play the CONTENT video"),this._super(a)))},onVideoSeekTo:function(a){var c,d,e,f=this.cviModel.contentPlaybackState.currentTime;return this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo evtObj = ",a),a.target!==this.vidContId||b.isEmpty(this.facade)||!this.canSeek(a&&a.payload)?void(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo BAD or out of range PARAMS, RETURN")):b.isEmpty(this.APM)||!this.APM.hasMidRoll()?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO MID-ROLLS CALL SUPER with evtObj argument and seek content"),void this._super(a)):(c=a.payload.seekTime,this._seekFromTime=f,d=this.imaScenario===this.MDIALOG?this.returnAbsSeekTime(c):c,e=this.APM.returnPrecedingUnplayedAdPod(d),void(b.isEmpty(e)||e.hasPlayed?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo NO UNPLAYED POD CALL SUPER with evtObj argument and seek content"),this._super(a)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA onVideoSeekTo UNPLAYED AD POD FOUND unplayedPod.startTime = ",e.startTime),this.savedSeekToTime=d,e.hasPlayed=!0,this.contentPlayheadTracker.pendingSeekTime=e.startTime)))},canSeek:function(a){return void 0!==a.seekTime&&null!==a.seekTime&&a.seekTime>=0&&a.seekTime<=this.cviModel.contentVideoState.duration},returnAbsSeekTime:function(a){return a},onChangeVideoVolume:function(a){b.has(a,"target")&&a.target===this.vidContId&&!this.cviModel.isMuted&&a.payload.vol>=0&&a.payload.vol<=1&&(this.adPodInProgress?this.adsManager.setVolume(a.payload.vol):this._super(a))},onMuteVideo:function(a){b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(0)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA muteVideo adPodInProgress FALSE; passing to super..."),this._super(a)))},onUnMuteVideo:function(a){b.has(a,"target")&&a.target===this.vidContId&&(this.adPodInProgress?(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress TRUE; set volume via adsManager for vidContId = ",this.vidContId),this.adsManager.setVolume(this.cviModel.volume)):(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA unmuteVideo adPodInProgress FALSE; passing to super..."),this._super(a)))},_createBoundAdEventHandlers:function(){this._onContentPauseRequested=this._onContentPauseRequested.bind(this),this._onContentResumeRequested=this._onContentResumeRequested.bind(this),this.onAdError=this.onAdError.bind(this),this.onAdEvent=this.onAdEvent.bind(this)},_addAdsManagerEventListeners:function(){var a,b=this.adsManager,c=google.ima.AdEvent.Type;this._createBoundAdEventHandlers(),a=this.onAdEvent,b.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),b.addEventListener(c.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),b.addEventListener(c.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),b.addEventListener(c.LOADED,a),b.addEventListener(c.STARTED,a),b.addEventListener(c.AD_BUFFERING,a),b.addEventListener(c.FIRST_QUARTILE,a),b.addEventListener(c.MIDPOINT,a),b.addEventListener(c.THIRD_QUARTILE,a),b.addEventListener(c.COMPLETE,a),b.addEventListener(c.ALL_ADS_COMPLETED,a),b.addEventListener(c.CLICK,a),b.addEventListener(c.PAUSED,a),b.addEventListener(c.RESUMED,a),b.addEventListener(c.USER_CLOSE,a),b.addEventListener(c.SKIPPED,a),b.addEventListener(c.LOG,a),b.addEventListener(c.VOLUME_CHANGED,a),b.addEventListener(c.VOLUME_MUTED,a),b.addEventListener(c.INTERACTION,a)},_removeAdsManagerEventListeners:function(){var a=this.onAdEvent,b=this.adsManager,c=google.ima.AdEvent.Type;b&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _removeAdsManagerEventListeners REMOVE listeners"),b.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),b.removeEventListener(c.CONTENT_PAUSE_REQUESTED,this._onContentPauseRequested),b.removeEventListener(c.CONTENT_RESUME_REQUESTED,this._onContentResumeRequested),b.removeEventListener(c.LOADED,a),b.removeEventListener(c.STARTED,a),b.removeEventListener(c.AD_BUFFERING,a),b.removeEventListener(c.FIRST_QUARTILE,a),b.removeEventListener(c.MIDPOINT,a),b.removeEventListener(c.THIRD_QUARTILE,a),b.removeEventListener(c.COMPLETE,a),b.removeEventListener(c.ALL_ADS_COMPLETED,a),b.removeEventListener(c.CLICK,a),b.removeEventListener(c.PAUSED,a),b.removeEventListener(c.RESUMED,a),b.removeEventListener(c.USER_CLOSE,a),b.removeEventListener(c.SKIPPED,a),b.removeEventListener(c.LOG,a),b.removeEventListener(c.VOLUME_CHANGED,a),b.removeEventListener(c.VOLUME_MUTED,a))},onUVPJSTimerTick:function(){var a,b,c,d,e,f=uvpjs.util,g=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,h=!f.isEmpty(this.adsManager),i=!f.isEmpty(this.facade);if(h){var j=this.getAdPlaybackBitrate();j!==this.renderSettings.bitrate&&(this.renderSettings.bitrate=j,this.adsManager.updateAdsRenderingSettings(this.renderSettings))}if(g&&(this.contentPlayheadTracker.duration=this.cviModel.contentPlaybackState.duration,this.contentPlayheadTracker.pendingSeekTime>-1?this.contentPlayheadTracker.currentTime=this.contentPlayheadTracker.pendingSeekTime:i?(a=this.facade.getCurrentTime(),this.contentPlayheadTracker.currentTime=a):this.contentPlayheadTracker.currentTime=0),!this.adPodInProgress)return d=h&&g&&(this.cviModel.sessionOptions.adBlockerCallback||null),b=d&&this._checkForCloseToMidrollPod(this.contentPlayheadTracker.currentTime),e=d&&(c=(new Date).getTime())&&(this.lastAdBlockCheckTime<c||b),e&&(this.lastAdBlockCheckTime=c+1e3*this.AD_BLOCKER_POLLING_INTERVAL,this.checkForAdBlocker()),void this._super();if(this.id3HandlingEnabled&&i&&this.checkId3Events(a),this.playbackState===this.mc.PLAYING){var k=this.createAdVideoProgressPayload();this.eventsMgr.dispatchEvent(this.eventsMgr.eventTypes.VIDEO_PROGRESS,k,this.vidContId)}},_checkForCloseToMidrollPod:function(a){var b,c,d,e=this.APM.getMidRollPods();if(a<=0)return!1;for(b=e.length;b--;)if(d=e[b],(c=d.startTime-a)>0&&c<1&&!d.hasPlayed&&!d.hasBeenChecked)return d.hasBeenChecked=!0,!0;return!1},createAdVideoProgressPayload:function(){return{isAd:!0,duration:this.duration,playbackStarted:!0,playbackComplete:!1,sourceBitrate:0,playbackBitrate:0,videoFramerate:0,isSeeking:!1,isHDStreamLive:!1,isPlayingLive:!1,currentContentSegment:1,currentMaxBandwidth:0,averageDroppedFPS:0,errorInfo:"",lastSecondCompleted:0,lastPercentageCompleted:0,currentTime:this.currImaAdTime,bufferLength:0,playbackState:this.playbackState,facadeState:{}}},_determineIMAScenario:function(a){var b=uvpjs.util,c=this._getAssetUrl(a),d=b.isDefinedString(a.pid),e=b.isDefinedString(a.cmsRefGuid),f=b.isDefinedString(a.selectorCall),g=b.isDefinedString(a.assetURL);return d||e&&!g||f?this.PLATFORM:b.isDefinedString(c)?this.CONTENT_AND_AD_CALL:b.isDefinedString(a.adCall)?this.AD_CALL_ONLY:(this.debug&&uvpjs.warn(this.DEBUG_ID,"RP_IMA Cannot determine IMA Scenario from RCO."),null)},checkForAdBlocker:function(){var a=uvpjs.adUtil.checkForAdBlocker(this.cviModel);return a&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA: ad blocking detected."),this.dispatchAdBlockedEvent()),a},_checkForContentPreload:function(){var a=this.imaScenario===this.PLATFORM||this.imaScenario===this.CONTENT_AND_AD_CALL,b=this.adsManager.isCustomPlaybackUsed(),c=this.currAdPod.adCount===this.cviModel.adVideoState.adPosition&&!b;this.cviModel.sessionOptions.preloadContent&&this.contentNeedsToBeLoaded&&a&&this.duration>5&&c&&(this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA Will start loading content video; creating facade."),this.contentNeedsToBeLoaded=!1,this.createContentFacade())},_returnIMATimeout:function(){var a=-1,b=this.cviModel.getModule(this.AD_SETTINGS),c=b&&b.enabled,d=c&&this.cviModel.getModuleParam(this.AD_SETTINGS,this.IMA_TIMEOUT);return d&&(a=parseInt(d),a=a>0?1e3*a:-1),this.debug&&uvpjs.log(this.DEBUG_ID,"RP_IMA _returnIMATimeout: "+a),a},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.cviMgr.adVideoDiv,context:uvpjs.adUtil.context.IMA,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(a){this.adTrackingHandle&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:a,context:uvpjs.adUtil.context.IMA,volume:this.adsManager.getVolume()})}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c=(a._,["LOADED","STREAM_INITIALIZED","STARTED","AD_BREAK_STARTED","AD_BREAK_ENDED","AD_PROGRESS","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","CLICK","COMPLETE","CUEPOINTS_CHANGED","ERROR"]),d=["hStreamLoaded","hStreamInitialized","hAdStarted","hAdBreakStart","hAdBreakEnd","hAdProgress","hAdProgress","hAdProgress","hAdProgress","hAdClick","hAdComplete","hCuePointsChanged","hStreamError"];a.DaiResourceProvider=uvpjs.RP_Platform.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,AD_SETTINGS:"AdSettings",AD_CALL_OVERRIDE:"adCallOverride",init:function(a){this.debug=uvpjs.debug,this.daiStreamId=null,this.streamManager=null,this.adClickElement=null,this.isLiveStream=!1,this.adBreakPending=!1,this.currAdPercentComplete=0,this.currAd=null,this.contentDuration=null,this.suppressFacadePlayOnLoad=!1,this.lastAdBlockCheckTime=0,this.adBlockCheckInterval=60,this.hMap={},this.adPods=null,this.currAdPod=null,this.adTrackingHandle=null,this.pendingSeekTime=null,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(a,c,d){var e=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+d),f=e.getElementsByTagName("video")[0];!b&&(b=google.ima.dai.api),this.debug&&this.log("DAI RP init'ing, IMA version = "+google.ima.VERSION),this.streamManager=new b.StreamManager(f),this.adClickElement=this.createAdClickElement(f),this.streamManager.setClickElement(this.adClickElement),this._super(a,c,d),this.resetAdStates(),this.contentVideoDiv=e,this.hStreamEvent=this.hStreamEvent.bind(this)},cleanUp:function(){this.removeStreamEventListeners(),this.streamManager=null,this.isAdPlaying()&&(this.currAd&&this.dispatchAdEnd(),this.currAdPod&&this.dispatchAdPodEnd(),this.resetAdStates()),this.adClickElement=null,this.adClickElement=null,this.adTrackingHandle=null,this.currAdPod=null,this.currAd=null,this.adPods=null,this.hMap=null,this.hStreamEvent=Function.prototype,this.resetModelState(),this._super()},loadData:function(a,b){var c=this.cviModel.getClassListItemProperty("VideoSourceManager","Platform_MPX","MultiBitrateURL");this.dispatchLoading(),this.rco.canMakePlatformCall(c)?this._super(a,b):(this.dataLoadedCB=a,this.onDataProxyComplete())},onDataProxyComplete:function(){var a=this.contentDataProxy.getProperty("cmsRefGuid");!uvpjs.util.isEmpty(a)&&!this.rco.getVideoId()&&this.rco.setCmsRefGuid(a),this._super()},loadVideoAndBeginPlayback:function(a){var b,c=this.rco,d=this.cviModel,e=this.contentDataProxy.getModel();if(this.suppressFacadePlayOnLoad=!0===a,this._addUVPEventListeners(),this.addStreamEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),d.setNonDefaultContentVideoStateItems(e),d.setContentVideoStateItems(c),d.mergeCDOData(),this.killDataProxy(),!(b=this.assembleResourceDefinition()))return this.debug&&this.log("DAI RP Fatal error: Invalid RCO",this.rco,"error"),void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"DAI RP: Invalid RCO",uvpjs.ErrorInfo.errorCodes.INVALID_RESOURCE_FORMAT,!0);this.cviMgr.setPlaybackInfoOnModel(),this.requestStream(b)},requestStream:function(a){var c=!uvpjs.util.isEmpty(a.assetKey),d=c?b.LiveStreamRequest:b.VODStreamRequest,e=new d;e.apiKey=a.apiKey||null,e.adTagParameters=a.adTagParameters,c?(e.assetKey=a.assetKey,e.attemptPreroll=!0,this.isLiveStream=!0,this.id3HandlingEnabled=!0):(e.contentSourceId=a.contentSourceId,e.videoId=a.videoId),this.streamManager.requestStream(e)},createContentFacade:function(){this.debug&&this.log("DAI RP creating facade; ID3 handling = "+this.id3HandlingEnabled),this.createFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType)},hStreamLoaded:function(a){var b=a.getStreamData().url;if(!uvpjs.util.isDefinedString(b))return this.debug&&this.log("DAI RP: No asset url in StreamLoaded event StreamData",null,"error"),void this.dispatchError(this.eventsMgr.eventType.VIDEO_START_ERROR,uvpjs.ErrorInfo.messages.DAI_ASSET_URL_ERROR,uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=b,this.cviModel.contentVideoState.isLive=this.isLiveStream,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(this.rco.rcoSeed),this.createContentFacade(),this.suppressFacadePlayOnLoad||(this.facade.showVideo(),this.facade.playVideo())},hStreamInitialized:function(a){this.daiStreamId=a.getStreamData().streamId,this.cviModel.daiStreamId=this.daiStreamId},hAdBreakStart:function(a){this.showAdClickEl(!0),this.resetAdStates(),this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.contentStartOpen&&(this.dispatchContentEnd(),this.contentStartOpen=!1),this.adBreakPending=!0},hAdBreakEnd:function(a){this.showAdClickEl(!1),this.dispatchAdPodEnd(this.currAdPod),this.resetAdStates(),this.currAdPod=null,this.pendingSeekTime&&(this._hasFacade()&&this.facade.seekTo(this.pendingSeekTime),this.pendingSeekTime=null)},hCuePointsChanged:function(a){this.currAdPod=this.getNewPod(a.getStreamData().cuepoints)},hAdStarted:function(a){var b=a.getAd();this.resetAdStates(),!this.currAdPod&&this.isLiveStream&&(this.currAdPod={played:!0}),this.updateAdModel(b),this.currAd=b,this.trackAd(),this.adBreakPending&&(this.adBreakPending=!1,this.trackAdEvent(a.type),this.dispatchAdPodStart()),this.cviModel.incrementAdNum(),this.dispatchAdStart()},hAdComplete:function(){this.dispatchAdEnd(),this.resetAdStates()},hAdProgress:function(a){var c,d,e,f=a.type,g=b.StreamEvent.Type,h=null;switch(f){case g.FIRST_QUARTILE:h=25;break;case g.MIDPOINT:h=50;break;case g.THIRD_QUARTILE:h=75;break;case g.AD_PROGRESS:c=a.getStreamData(),d=c&&c.adProgressData,e=d&&this.createAdProgressPayload(d),e&&this.dispatchVideoProgress(e)}h&&(this.checkForAdBlocker(this.facade.getCurrentTime(),!0),this.currAdPercentComplete=h,this.dispatchAdQuartile(h))},hStreamError:function(a){var b=a.getStreamData(),c=b&&b.errorMessage;this.debug&&this.log("DAI StreamManager Error: "+c,null,"error"),this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,c||"Unknown DAI stream error.",uvpjs.ErrorInfo.errorCodes.DAI_STREAM_ERROR,!0)},hAdClick:function(a){},hStreamEvent:function(a){this.isAdPlaying()&&this.trackAdEvent(a.type),this[this.hMap[a.type]](a)},onVideoSeekTo:function(a){var b,c=a&&a.target,d=a&&a.payload,e=d&&d.seekTime,f=this.facade,g=this._hasFacade(),h=f.getDuration(),i=this.facade.getCurrentTime();if("number"==typeof e&&c===this.vidContId){if((e=this.streamManager.streamTimeForContentTime(e))<0||e>h)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+e));b=this.getSkippedPod(e),b&&(this.pendingSeekTime=e,e=b.startTime-1),this._seekFromTime=this._seekFromTime||i,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:e,seekFromTime:this._seekFromTime},null,2)),g&&f.seekTo(e)}},getSkippedPod:function(a){var b,c,d,e,f=[];for(b in this.adPods)f.push(this.adPods[b].startTime);for(f.sort(function(a,b){return a-b}),c=f.length;c--;)if((d=f[c])<a)return e=this.adPods["t_"+d],e.hasPlayed?null:e;return null},dispatch:function(a,b){this.eventsMgr.dispatchEvent(a,b,this.vidContId)},dispatchLoading:function(){this.dispatch(this.eventsMgr.eventTypes.VIDEO_STATE_CHANGE,{newState:this.mc.LOADING})},dispatchContentDataLoaded:function(){var a=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:a})},dispatchAdPodStart:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:this.currAdPod})},dispatchAdPodEnd:function(){this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:this.currAdPod})},dispatchAdStart:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_LOADED,{adData:a}),this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:a})},dispatchAdEnd:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:a})},dispatchAdQuartile:function(a){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:a})},dispatchVideoProgress:function(a){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,a)},dispatchError:function(a,b,c,d){this.dispatch(a,{errorInfo:new uvpjs.ErrorInfo({eventType:a,errorCode:c,message:b+"; DAI stream id: "+(this.daiStreamId||"n/a"),isFatal:!0===d,adInfo:this.currAd?this.extractAdInfo(this.currAd):null})})},dispatchAdBlockedEvent:function(){this.dispatch(this.eventsMgr.eventTypes.AD_BLOCKED,{errorInfo:new uvpjs.ErrorInfo({eventType:this.eventsMgr.eventTypes.AD_BLOCKED,errorCode:uvpjs.ErrorInfo.errorCodes.AD_BLOCKING_DETECTED,message:uvpjs.ErrorInfo.messages.AD_BLOCKING_DETECTED,isFatal:!1})})},getNewPod:function(a){var b,c,d=null,e=a&&a.length;for(e&&!this.adPods&&this.createAdPods(a);e--;)b=a[e],c=this.adPods["t_"+b.start],d||c.hasPlayed===b.played||(d=c),c.hasPlayed=b.played;return d},createAdPods:function(a){var b,c,d,e,f=function(a){return i>1&&a===i-1?"post":0===a?"pre":"mid"},g=0,h=[],i=a.length;for(this.adPods={},c=0;c<i;c++)b=a[c],d=f(c),e=b.start,h.push(e),this.adPods["t_"+e]={startTime:e,hasPlayed:!1,adPodId:d+("mid"===d?"_"+g++:"_0"),adCount:0,podDuration:b.end-e};this.cviModel.contentVideoState.chapterStartTimes=h},resetAdStates:function(){var a=this.cviModel;a.resetAdPlaybackState(),a.resetAdVideoState(),a.isCurrVideoAd=!1,this.currAdPercentComplete=0,this.currAd=null,this.showAdClickEl(!1),this.untrackAd()},updateAdModel:function(a){var b=a.getAdPodInfo();this.populateAdVideoState(a),b&&this.currAdPod&&(this.currAdPod.adCount=b.getTotalAds(),this.currAdPod.podDuration=b.getMaxDuration()),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(a){var b=uvpjs.adUtil.extractAdStateData(a,uvpjs.adUtil.context.DAI,this.isLiveStream);b.adBitrate=this.cviModel.getContentPlaybackState().facadeState.currentBitrate,this.cviModel.setAdVideoState(b)},createAdProgressPayload:function(a){var b=this.getVideoProgressPayload(),c=a.currentTime;return b.isAd=!0,b.duration=a.duration,b.currentTime=c,b.absoluteStreamTime=this.facade.getCurrentTime(),b.lastSecondCompleted=Math.floor(c),b.lastPercentageCompleted=this.currAdPercentComplete,b},extractAdInfo:function(a){return uvpjs.adUtil.extractAdInfo(a,uvpjs.adUtil.context.DAI)},trackAd:function(){this.adTrackingHandle=uvpjs.adUtil.trackAd({adVideoContainer:this.contentVideoDiv,context:uvpjs.adUtil.context.DAI,model:this.cviModel})},untrackAd:function(){this.adTrackingHandle=null},trackAdEvent:function(a){this.adTrackingHandle&&a!=b.StreamEvent.Type.AD_PROGRESS&&this.facade&&uvpjs.adUtil.trackAdEvent({trackingHandle:this.adTrackingHandle,eventName:a,context:uvpjs.adUtil.context.DAI,volume:this.cviModel.isMuted?0:this.facade.getVolume()})},startOrResumeContent:function(){this.contentDuration||this.isLiveStream||(this.contentDuration=this.streamManager.contentTimeForStreamTime(this.facade.getDuration()),this.cviModel.contentVideoState.duration=this.contentDuration),this.contentStartOpen=!0,this.showAdClickEl(!1),this.dispatchContentStart()},onUVPJSTimerTick:function(){var a,b,c,d=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING&&!this.isAdPlaying();d&&(b=this.facade.getCurrentTime(),this.checkForAdBlocker(b,!1),a=this.streamManager.contentTimeForStreamTime(b),!this.contentStartOpen&&(a>0||this.isLiveStream)&&this.startOrResumeContent(),this.id3HandlingEnabled&&this.checkId3Events(a),c=this.createVideoProgressPayload(a,b),this.dispatchVideoProgress(c))},createVideoProgressPayload:function(a,b){var c=this.getVideoProgressPayload();return c.currentTime=a,c.absoluteStreamTime=b,c.duration=this.contentDuration||-1,c},checkBuffering:function(a){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},checkForAdBlocker:function(a,b){var c=a-this.lastAdBlockCheckTime>this.adBlockCheckInterval,d=b||c,e=d&&uvpjs.adUtil.checkForAdBlocker(this.cviModel);return d&&(this.lastAdBlockCheckTime=a),e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"DaiResourceProvider: ad blocking detected."),this.dispatchAdBlockedEvent()),!!e},assembleResourceDefinition:function(){var a=this.rco.getAdTagParameters(),b=this.rco.getVideoId(),c=this.rco.getContentSourceId(),d=this.rco.getAssetKey();return d&&a||a&&b&&c?{adTagParameters:a,videoId:b||null,contentSourceId:c||null,assetKey:d||null}:null},addStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("add")},removeStreamEventListeners:function(){this.streamManager&&this.addOrRemoveStreamListeners("remove")},addOrRemoveStreamListeners:function(a){for(var e,f="add"===a?"addEventListener":"removeEventListener",g="addEventListener"===f,h=b.StreamEvent.Type,i=c.length;i--;)e=h[c[i]],g&&(this.hMap[e]=d[i]),!g&&delete this.hMap[e],this.streamManager[f](e,this.hStreamEvent)},createAdClickElement:function(a){var b,c,d,e,f="uvpjsDaiContainer",g=a.nextSibling;if(g&&g.getAttribute("data-role")===f)return g;b=document.createElement("div"),b.setAttribute("data-role","uvpjsDaiContainer"),c={position:"absolute",width:"100%",height:"100%",left:0,top:0,zIndex:1},e=b.style;for(d in c)e[d]=c[d];return a.insertAdjacentElement("afterend",b),b},onPauseVideo:function(a){(a&&a.target)===this.vidContId&&this._hasFacade()&&(this.facade.pauseVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onPlayVideo:function(a){(a&&a.target)===this.vidContId&&this._hasFacade()&&(this.facade.showVideo(),this.facade.playVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onChangeVideoVolume:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.vol,e=uvpjs.util.inRange(d,0,1),f=this.cviModel.isMuted;b===this.vidContId&&e&&!f&&this._hasFacade()&&(this.facade.setVolume(d),this.isAdPlaying()&&this.trackAdEvent(a.type))},onMuteVideo:function(a){(a&&a.target)===this.vidContId&&this._hasFacade()&&(this.facade.muteVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},onUnMuteVideo:function(a){(a&&a.target)===this.vidContId&&this._hasFacade()&&(this.facade.unMuteVideo(),this.isAdPlaying()&&this.trackAdEvent(a.type))},facadeId3Data:function(a){if(this.streamManager){var b=function(a){this.streamManager.processMetadata("ID3",a.data,a.pts)}.bind(this);a&&a.forEach(b)}},facadeProgress:function(a){},facadeTimeUpdate:function(a){},facadeDurationChanged:function(a){this.contentDuration=this.streamManager.contentTimeForStreamTime(a.duration),this.cviModel.contentVideoState.duration=this.contentDuration},facadeDisplayReady:function(){this.startVideoProgressTimer()},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},showAdClickEl:function(a){this.adClickElement&&(this.adClickElement.style.display=!1!==a?"block":"none")},log:function(a,b,c){var d=c||"log";uvpjs[d](this.DEBUG_ID,a,b||"")}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b={google_ad_start:"handleAdStart",google_ad_end:"handleAdEnd"};a.DaiSsbResourceProvider=uvpjs.ResourceProvider.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,init:function(a){this.debug=uvpjs.debug,this.isLiveStream=!1,this.suppressFacadePlayOnLoad=!1,this.quartiles={25:0,50:0,75:0},this.contentStartOpen=!1,this.contentDuration=null,this.absoluteDuration=null,this.contentStartTime=null,this.contentVideoDiv=null,this.vidEl=null,this._super(a),this.providerType=uvpjs.mediaCapabilities.RP_DAI},initialize:function(a,b,c){this._super(a,b,c),this.contentVideoDiv=document.getElementById(uvpjs.domConstants.CONTENT_ID_PREFIX+c),this.vidEl=this.contentVideoDiv.getElementsByTagName("video")[0],this.resetAdStates()},cleanUp:function(){this.isAdPlaying()&&(this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates()),this.unlistenForTextTrackId3(),this.resetModelState(),this._super()},loadData:function(a){a()},loadVideoAndBeginPlayback:function(a){var b,c=this.rco,d=this.cviModel;if(this.suppressFacadePlayOnLoad=!0===a,this._addUVPEventListeners(),this.resetModelState(),this.setModelRcoOverrides(),d.setNonDefaultContentVideoStateItems(this.contentDataProxy.getModel()),d.setContentVideoStateItems(c),d.mergeCDOData(),this.killDataProxy(),this.contentDuration=d.contentVideoState.duration,this.debug&&this.log("DaiSsb: content duration (from rco) = "+this.contentDuration),!(b=this.assembleAssetUrl(c)))return void this.dispatchError(this.eventsMgr.eventTypes.VIDEO_START_ERROR,"Missing 'assetURL' in RCO",uvpjs.ErrorInfo.errorCodes.UNEXPECTED_CONDITION,!0);this.cviModel.contentVideoState.assetURL=b,this.dispatchContentDataLoaded(),this.cviModel.incrementMedNum(),this.RPM.resourceStart(c.rcoSeed),this.createContentFacade(),this.id3HandlingEnabled&&this.createId3Parser(this.facade.facadeType),!this.suppressFacadePlayOnLoad&&this.facade.playVideo()},assembleAssetUrl:function(a){var b,c,d=a.assetURL,e=uvpjs.util;return e.isEmpty(d)?null:d.indexOf("?")>-1?d:(c=a.getAdTagParameters(),b=c?e.queryStrFromObj(c):null,e.isEmpty(b)?d:d+"?"+b)},createContentFacade:function(){this.createFacade(),this.listenForTextTrackId3()},handleAdStart:function(a){this.resetAdStates(),this.cviModel.incrementAdNum(),this.updateAdModel(),this.dispatchAdPodStart(a),this.dispatchAdStart()},handleAdEnd:function(){this.dispatchAdEnd(),this.dispatchAdPodEnd(),this.resetAdStates(),this.contentStartTime=this.facade.getCurrentTime(),this.debug&&this.log("DaiSsb provider: contentStartTime = "+this.contentStartTime),this.startContent()},dispatch:function(a,b){this.eventsMgr.dispatchEvent(a,b,this.vidContId)},dispatchContentDataLoaded:function(){var a=this.cviModel.getContentVideoState();this.dispatch(this.eventsMgr.eventTypes.CONTENT_DATA_LOADED,{vidState:a})},dispatchAdPodStart:function(a){var b=this.getPrerollPod(a);this.dispatch(this.eventsMgr.eventTypes.AD_POD_START,{adPod:b})},dispatchAdPodEnd:function(){var a=this.getPrerollPod();a.hasPlayed=!0,this.dispatch(this.eventsMgr.eventTypes.AD_POD_END,{adPod:a})},dispatchAdStart:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_START,{adData:a})},dispatchAdEnd:function(){var a=this.cviModel.getAdVideoState();this.dispatch(this.eventsMgr.eventTypes.AD_END,{adData:a})},dispatchAdQuartile:function(a){this.dispatch(this.eventsMgr.eventTypes.AD_QUARTILE,{percent:a})},dispatchVideoProgress:function(a){this.dispatch(this.eventsMgr.eventTypes.VIDEO_PROGRESS,a)},dispatchError:function(a,b,c,d){this.dispatch(a,{errorInfo:new uvpjs.ErrorInfo({eventType:a,errorCode:c,message:b,isFatal:!0===d,adInfo:null})})},getPrerollPod:function(a){return this.adPod||(this.adPod={startTime:a,hasPlayed:!1,adPodId:"pre_0",adCount:1,podDuration:this.getPrerollAdDuration()}),this.adPod},resetAdStates:function(){var a=this.cviModel;a.resetAdPlaybackState(),a.resetAdVideoState(),a.isCurrVideoAd=!1},updateAdModel:function(){this.populateAdVideoState(),this.cviModel.isCurrVideoAd=!0,this.cviModel.mergeCDOData()},populateAdVideoState:function(){var a=uvpjs.adUtil.getAdStateBlank();a.adServerName="dai_ssb",a.duration=this.getPrerollAdDuration(),a.adClipID="pre_0",a.adPosition=1,a.adType="pre",this.cviModel.setAdVideoState(a)},getPrerollAdDuration:function(){var a=this.getAbsoluteDuration();return a>0&&this.contentDuration>0?a-this.contentDuration:-1},getAbsoluteDuration:function(){return this.absoluteDuration||(this.absoluteDuration=this.facade.getDuration()),this.absoluteDuration},createAdProgressPayload:function(){var a,b,c=this.getVideoProgressPayload(),d=this.facade.getCurrentTime(),e=this.getPrerollAdDuration(),f=Math.floor(d/e*100);switch(f){case 25:a=this.quartiles[25],b=25;break;case 50:a=this.quartiles[50],b=50;break;case 75:a=this.quartiles[75],b=75}return b&&!a&&this.dispatchAdQuartile(b),b&&(this.quartiles[String(b)]=1),c.isAd=!0,c.duration=e,c.currentTime=d,c.absoluteStreamTime=this.facade.getCurrentTime(),c.lastSecondCompleted=Math.floor(d),c.lastPercentageCompleted=f,c},startContent:function(){this.contentStartOpen||(this.contentStartOpen=!0,this.dispatchContentStart())},onUVPJSTimerTick:function(){var a,b=this.facade&&this.facade.getPlaybackState()===this.mc.PLAYING,c=this.isAdPlaying(),d=this.contentStartOpen,e=b&&this.facade.getCurrentTime();b&&(a=c?this.createAdProgressPayload():d?this.createVideoProgressPayload():null,e>1&&!d&&!c&&(this.debug&&this.log("DaiSsb provider: A 'no ad' start @ "+e),this.contentStartTime=e,this.startContent()),this.id3HandlingEnabled&&this.checkId3Events(e),a&&this.dispatchVideoProgress(a))},createVideoProgressPayload:function(){var a=this.getVideoProgressPayload(),b=this.facade.getCurrentTime(),c=b-this.contentStartTime;return a.currentTime=c,a.absoluteStreamTime=b,a.duration=this.contentDuration||-1,a},checkBuffering:function(a){this.cviModel.playbackState!==this.mc.PAUSED&&this._super(this.facade.getCurrentTime())},onVideoSeekTo:function(a){var b=a&&a.target,c=a&&a.payload,d=c&&c.seekTime,e=this.facade,f=this._hasFacade(),g=f&&(this.absoluteDuration||e.getDuration()),h=this.getPrerollAdDuration(),i=this.facade.getCurrentTime();if("number"==typeof d&&b===this.vidContId&&g){if((d+=h>0?h:0)<0||d>g)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"onVideoSeekTo out of range seekTime = "+d));this._seekFromTime=this._seekFromTime||i,this.debug&&uvpjs.log(this.DEBUG_ID,"onVideoSeekTo "+JSON.stringify({seekTime:d,seekFromTime:this._seekFromTime},null,2)),f&&e.seekTo(d)}},facadeProgress:function(a){},facadeTimeUpdate:function(a){},facadeDurationChanged:function(a){!this.absoluteDuration&&(this.absoluteDuration=a.duration)},facadeDisplayReady:function(){this.startVideoProgressTimer()},listenForTextTrackId3:function(){this.hAddTextTrack=this.hAddTextTrack.bind(this),this.hCueChange=this.hCueChange.bind(this),this.vidEl.textTracks.addEventListener("addtrack",this.hAddTextTrack,!1)},unlistenForTextTrackId3:function(){var a=this.vidEl.textTracks;a.removeEventListener("addtrack",this.hAddTextTrack,!1);for(var b=0,c=a.length;b<c;b++)a[b].removeEventListener("cuechange",this.hCueChange,!1)},hAddTextTrack:function(a){a.track&&"metadata"===a.track.kind&&(a.track.addEventListener("cuechange",this.hCueChange,!1),a.track.mode="hidden")},hCueChange:function(a){a.target&&a.target.activeCues&&1==a.target.activeCues.length&&this.handleId3Cue(a.target.activeCues[0])},handleId3Cue:function(a){var c,d,e=a.value,f=e.key;"TXXX"===f&&(c=""!==e.info?e.info:e.data,(d=b[c])&&this[d](a.startTime))},isAdPlaying:function(){return this.cviModel&&!0===this.cviModel.isCurrVideoAd},log:function(a,b,c){var d=c||"log";uvpjs[d](this.DEBUG_ID,a,b||"")}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b=2e3;a.P2pClient=uvpjs.Class.subClass({init:function(a){this.clientName=a.clientName||null,this.requiredParams=a.requiredParams||null},destroy:function(){this.requiredParams=null},getHlsjsLoader:function(){var a=uvpjs.P2pClient.clientMap[this.clientName];return a&&a.getHlsjsLoader&&(a.getHlsjsLoader()||null)}}),a.P2pClient.debugId=uvpjs.DebugManager.configParams.P2P_CLIENT,a.P2pClient.clientMap={peer5:{uvpcModuleName:"Peer5PluginJS",sdkPath:"//api.peer5.com/peer5.js?id=",hlsjsLoaderPath:"//api.peer5.com/peer5.hlsjs.loader.js",requires:["apiKey"],validateScriptLoad:function(){return null!==this.getHlsjsLoader()},getHlsjsLoader:function(){return window.peer5&&window.peer5.HlsJsLoader||null},getApi:function(){return window.peer5},loadScripts:function(a,c){var d;this.getHlsjsLoader()?a():c.apiKey?(d=this.loadHlsLoader.bind(this,a),uvpjs.VideoDeliveryPluginService.load(this.sdkPath+c.apiKey,d,b)):a(!0)},loadHlsLoader:function(a,c){if(c)return uvpjs.debug&&uvpjs.log(uvpjs.P2pClient.debugId,"P2pClient: Peer5 SDK load failed",c),void a(!0);uvpjs.VideoDeliveryPluginService.load(this.hlsjsLoaderPath,a,b)}}}}(uvpjs.register("uvpjs")),function(a){"use strict";a.MultiCdnClient=uvpjs.Class.subClass({init:function(a){this.clientName=a.clientName||null,this.requiredParams=a.requiredParams||null,this.url=uvpjs.MultiCdnClient.clientMap[this.clientName].getDecisionUrl(this.requiredParams),this.decisionCallback=null,this.timeoutHandle=null,this.aborted=!1,this.inFlight=!1},destroy:function(){this.decisionCallback=Function.prototype,this.requiredParams=null},getDecision:function(a){var b;this.inFlight||(this.inFlight=!0,this.decisionCallback=a,this.timeoutHandle=setTimeout(this.abortOnTimeout.bind(this),2e3),b=new uvpjs.CodeLoader,b.loadXHR(this.url,this.handleDecision.bind(this),this.handleError.bind(this),"json"))},abortOnTimeout:function(){this.aborted=!0,this.decisionCallback(null)},handleDecision:function(a){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(a.response),this.reset()},handleError:function(){clearTimeout(this.timeoutHandle),!this.aborted&&this.decisionCallback(null),this.reset()},reset:function(){this.inFlight=!1,this.aborted=!1}}),a.MultiCdnClient.clientMap={cedexis:{uvpcModuleName:"CedexisMultiCDNPlugin",decisionUrl:"//hopx.cedexis.com/zones/1/customers/{customerId}/apps/{appId}/decision",requires:["customerId","appId"],getDecisionUrl:function(a){return a&&a.customerId&&a.appId?this.decisionUrl.replace("{customerId}",a.customerId).replace("{appId}",a.appId):null},validateScriptLoad:function(){return!0},loadScripts:function(a){a()}}}}(uvpjs.register("uvpjs")),function(a){"use strict";a.VideoDeliveryPluginService=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.CORE_VIDEO_INSTANCE,init:function(a,b){var c=uvpjs.VideoDeliveryPluginService.clientType;this.model=b,this.callback=a,this.staticSvc=uvpjs.VideoDeliveryPluginService,this.p2pClientOptions=this.getClientOptions(c.P2P),this.multiCdnClientOptions=this.getClientOptions(c.MULTI_CDN)},destroy:function(){this.model=null,this.callback=Function.prototype,this.p2pClientOptions=null,this.multiCdnClientOptions=null},createPlugins:function(){this.p2pClientOptions.canUse||this.multiCdnClientOptions.canUse?this.loadDeliveryPluginScripts():this.callback(null,null)},handleAllScriptsLoaded:function(){var a=null,b=null;this.p2pClientOptions&&(this.p2pClientOptions.canUse&&(a=this.createClient(this.staticSvc.clientType.P2P,this.p2pClientOptions)),this.multiCdnClientOptions.canUse&&(b=this.createClient(this.staticSvc.clientType.MULTI_CDN,this.multiCdnClientOptions)),this.callback(a,b))},handleMcdnReady:function(a){var b=this.multiCdnClientOptions;!a&&this.validateScriptLoad(this.staticSvc.clientType.MULTI_CDN,b.clientName)||(b.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+b.clientName)),this.handleAllScriptsLoaded()},loadMultiCdn:function(){var a=this.multiCdnClientOptions;this.loadClientScripts(this.staticSvc.clientType.MULTI_CDN,a.clientName,this.handleMcdnReady.bind(this),a.requiredParams)},handleP2pReady:function(a,b){var c=this.p2pClientOptions;!b&&this.validateScriptLoad(this.staticSvc.clientType.P2P,c.clientName)||(c.canUse=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"Error loading SDK for "+c.clientName)),a?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadDeliveryPluginScripts:function(){var a=this.p2pClientOptions,b=this.multiCdnClientOptions,c=b.canUse;a.canUse?this.loadClientScripts(this.staticSvc.clientType.P2P,a.clientName,this.handleP2pReady.bind(this,c),a.requiredParams):c?this.loadMultiCdn():this.handleAllScriptsLoaded()},loadClientScripts:function(a,b,c,d){var e=this.getClientObject(a,b);e||c(!0),e.loadScripts(c,d)},validateScriptLoad:function(a,b){var c=this.getClientObject(a,b);return c&&c.validateScriptLoad()||!1},createClient:function(a,b){return new a(b)},getClientOptions:function(a){var b,c,d,e,f,g,h,i,j,k=this.model,l=this.getSupportedClients(a),m={canUse:!1,clientName:null};if(a===this.staticSvc.clientType.P2P&&!uvpjs.mediaCapabilities.canUseP2p())return m;for(b in l)if(c=b,d=l[c],(i=d&&d.uvpcModuleName)&&k.isModuleEnabled(i)){for(e=d.requiredParams,f=e&&e.length||0,h={},j=!0;f--;){if(g=k.getModuleParam(i,e[f]),uvpjs.util.isEmpty(g)){j=!1;break}h[e[f]]=g}return{canUse:j,clientName:c,requiredParams:h}}return m},getSupportedClients:function(a){var b,c,d={},e=a.clientMap;if(!e)return d;for(b in e)c=e[b],d[b]={uvpcModuleName:c.uvpcModuleName,requiredParams:c.requires};return d},getClientObject:function(a,b){return a.clientMap[b]||null}});var b=a.VideoDeliveryPluginService;b.clientType={P2P:uvpjs.P2pClient,MULTI_CDN:uvpjs.MultiCdnClient},b.load=function(a,b,c){(new uvpjs.CodeLoader).loadScript(a,b,c)}}(uvpjs.register("uvpjs")),function(a){var b="loadedmetadata";a.FullscreenManager=uvpjs.Class.subClass({init:function(a){var b=uvpjs.util,c=a||{},d=uvpjs.mediaCapabilities;if(this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,!c.videoElement||!c.container)return void uvpjs.error(this.DEBUG_ID,"FullscreenManager: constructor missing required options.");this.videoEl=c.videoElement,this.container=c.container,this.fullscreenChangeCallback=b.isFunction(c.fullscreenChangeCallback)&&c.fullscreenChangeCallback,this.readyCallback=b.isFunction(c.readyCallback)&&c.readyCallback,this.fsElement=null,this.hasFsApiSupport=!1,this.hasValidEntryMethod=!1,this.enterEvt=null,this.exitEvt=null,this.exitScope=null,this.canUseFullscreen=!1,this.enterMethod=d.getEnterFullscreenMethodName(),this.exitMethod=d.getExitFullscreenMethodName(),this.fsElementName=d.getFullScreenElementName(),this.isFullscreenProperty=d.getIsFullscreenPropertyName(),this.hMetadataLoaded=this.hMetadataLoaded.bind(this),this.hFullScreenEvent=this.hFullScreenEvent.bind(this),this.initialize()},destroy:function(){this.hasFsApiSupport?this.fsElement&&this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1):this.fsElement&&(this.fsElement.removeEventListener(this.enterEvt,this.hFullScreenEvent,!1),this.fsElement.removeEventListener(this.exitEvt,this.hFullScreenEvent,!1)),this.videoEl=null,this.fsElement=null,this.container=null,this.exitScope=null,this.fullscreenChangeCallback=null,this.hMetadataLoaded=this.hFullScreenEvent=this.readyCallback=Function.prototype},enterFullscreen:function(){!this.isFullscreen()&&this.hasValidEntryMethod&&this.fsElement[this.enterMethod]()},exitFullscreen:function(){this.isFullscreen()&&this.hasValidExitMethod&&this.exitScope[this.exitMethod]()},isFullscreenAvailable:function(){return uvpjs.mediaCapabilities.isFullscreenAvailable(this.videoEl)},isFullscreen:function(){return!!(this.hasFsApiSupport?document[this.fsElementName]:this.videoEl[this.isFullscreenProperty])},usesFullscreenApi:function(){return this.hasFsApiSupport},hFullScreenEvent:function(a){var b=this.isFullscreen();a.stopPropagation(),this.fullscreenChangeCallback&&this.fullscreenChangeCallback(b)},hMetadataLoaded:function(){this.canUseFullscreen=this.isFullscreenAvailable(),this.readyCallback&&this.readyCallback(this.canUseFullscreen),this.videoEl.removeEventListener(b,this.hMetadataLoaded,!1),this.hMetadataLoaded=Function.prototype},getInfo:function(){return{userAgent:navigator.userAgent,hasFullscreenApiSupport:this.hasFsApiSupport,canUseFullscreen:this.canUseFullscreen,enterEvent:this.enterEvt,enterMethod:this.enterMethod,exitEvent:this.exitEvt,exitMethod:this.exitMethod,fullScreenElementTag:this.fsElement.tagName,documentFullscreenElement:this.fsElementName}},getExitScope:function(){var a=document[this.exitMethod]?document:this.videoEl[this.exitMethod]?this.videoEl:null;return a&&uvpjs.util.isFunction(a[this.exitMethod])?a:null},validateEntryAndExitMethods:function(){var a=this.fsElement&&this.fsElement[this.enterMethod],b=this.exitScope&&this.exitScope[this.exitMethod],c=uvpjs.util;this.hasValidEntryMethod=c.isFunction(a),this.hasValidExitMethod=c.isFunction(b)},initialize:function(){var a,c,d,e,f=uvpjs.mediaCapabilities;if(this.hasFsApiSupport=f.supportsFullscreenApi(),this.hasFsApiSupport&&(this.canUseFullscreen=this.isFullscreenAvailable()),this.exitScope=this.getExitScope(),this.hasFsApiSupport?(e=f.getFullscreenEventName(),a=f.isFirefox()||f.isIE()?document:this.container,a.addEventListener(e,this.hFullScreenEvent,!1),this.fsElement=this.container):this.enterMethod&&(this.fsElement=this.videoEl,c=f.getFullscreenEnterEventName(),d=f.getFullscreenExitEventName(),this.fsElement.addEventListener(c,this.hFullScreenEvent,!1),this.fsElement.addEventListener(d,this.hFullScreenEvent,!1),this.enterEvt=c,this.exitEvt=d),this.validateEntryAndExitMethods(),!this.hasValidEntryMethod)return void(this.debug&&uvpjs.log("Fullscreen determined not available",this.getInfo()));this.canUseFullscreen&&this.readyCallback&&this.readyCallback(!0),this.hasFsApiSupport&&this.canUseFullscreen||this.videoEl.addEventListener(b,this.hMetadataLoaded,!1),this.debug&&uvpjs.log("Fullscreen management init'd; info: ",this.getInfo())}}),a.FullscreenManager.hasFullscreenSupport=function(){return!!uvpjs.mediaCapabilities.getEnterFullscreenMethodName()}}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c,d,e,f=a._;a.SkinManager=uvpjs.Class.subClass({DEFAULT_SKIN_PATH:"lib/css/default.css",NULL_TIME:"00:00",HIDE_DELAY:2e3,TAP_THRESHOLD:300,THROTTLE_WAIT:250,INITIAL_DOM_SETUP_WAIT:100,CAPTION_PADDING:10,SIZE_XS_BREAKPOINT:480,SIZE_SM_BREAKPOINT:550,SIZE_MD_BREAKPOINT:992,SIZE_LG_BREAKPOINT:1200,AD_CONTAINER_ID_PREFIX:"ad",CONTENT_CONTAINER_ID_PREFIX:"content",CONTROLS_CONTAINER_ID_PREFIX:"controls",VIDEO_CONTAINER_ID_PREFIX:"video",AD_LEARNMORE_ID_PREFIX:"learnMore",AD_COUNTDOWN_ID_PREFIX:"countDown",AD_LEARNMORE_TEXT:"Learn More",PRIMARY_BLOCK:"uvpjs",AD_MODIFIER:"ad",LIVE_MODIFIER:"live",PAUSED_MODIFIER:"paused",STREAMING_MODIFIER:"streaming",ACTIVE_MODIFIER:"active",DISABLED_MODIFIER:"disabled",FULLSCREEN_MODIFIER:"fullscreen",HIDDEN_MODIFIER:"hidden",MOBILE_MODIFIER:"mobile",TOUCH_MODIFIER:"touch",SIZE_XS_MODIFIER:"xs",SIZE_SM_MODIFIER:"sm",SIZE_MD_MODIFIER:"md",SIZE_LG_MODIFIER:"lg",BLOCK_DELIMITER:"_",BLOCK_ELEMENT_DELIMITER:"__",ELEMENT_DELIMITER:"-",ELEMENT_MODIFIER_DELIMITER:"--",MODIFIER_DELIMETER:"-",CLASS_SELECTOR_PREFIX:".",ID_SELECTOR_PREFIX:"#",css:{CONTENT:"content",VIDEO:"video",AD:"ad",AD_LEARNMORE:"ad-learnmore",CONTROLS:"controls",PREVIEW_BTN:"btn-preview",REPLAY_BTN:"btn-replay",LARGE_PLAY_BTN:"btn-large-play",BUFFERING_FRAME:"buffering-frame",SETTINGS_MENU:"settings-menu",SETTINGS_MENU_ITEM:"settings-menu-item",SETTINGS_MENU_INPUT:"settings-menu-input",CONTROL_BAR:"controlbar",PLAYSTATE_BTN:uvpjs.Type.Button.PLAYSTATE,TIME:"time",TIME_CURRENT:"time-current",TIME_DURATION:"time-duration",TIME_LIVE:"time-live",VOLUME_BTN:uvpjs.Type.Button.VOLUME,CLOSED_CAPTION_BTN:uvpjs.Type.Button.CLOSED_CAPTION,SETTINGS_BTN:uvpjs.Type.Button.SETTINGS,FULLSCREEN_BTN:uvpjs.Type.Button.FULLSCREEN,PROGRESS:"progress",PROGRESS_SLIDER:"progress-slider",PROGRESS_LOADED:"progress-loaded",VOLUME_SLIDER:"volume-slider"},settingsMenu:[{name:"controls",label:"Controls",enabled:!1,items:[{name:"background-opacity",label:"Background opacity",items:[{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]}]},{name:"cc",label:"Subtitles/CC",enabled:!1,items:[{name:"background-color",label:"Background color",items:[{value:"#ffffff",label:"White"},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black",default:!0}]},{name:"background-opacity",label:"Background opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-color",label:"Font color",items:[{value:"#ffffff",label:"White",default:!0},{value:"#ffff00",label:"Yellow"},{value:"#008000",label:"Green"},{value:"#00ffff",label:"Cyan"},{value:"#0000ff",label:"Blue"},{value:"#ff00ff",label:"Magenta"},{value:"#ff0000",label:"Red"},{value:"#000000",label:"Black"}]},{name:"font-opacity",label:"Font opacity",items:[{value:"0",label:"0%"},{value:".25",label:"25%"},{value:".50",label:"50%"},{value:".75",label:"75%"},{value:"1",label:"100%",default:!0}]},{name:"font-size",label:"Font size",items:[{value:"50%"},{value:"75%"},{value:"100%",default:!0},{value:"125%"},{value:"150%"},{value:"175%"},{value:"200%"}]},{name:"font-weight",label:"Font weight",items:[{value:"Normal",default:!0},{value:"Bold"}]},{name:"font-family",label:"Font family",items:[{value:"Arial",label:"Arial",default:!0},{value:"Avenir"},{value:"Copperplate"},{value:"Courier"},{value:"Helvetica"},{value:"Iowan"},{value:"Menlo"},{value:"sans-serif",label:"Sans Serif"},{value:"Trebuchet"}]},{name:"text-position",label:"Position",enabled:!0,items:[{value:"default",label:"Default"},{value:"top-left",label:"Top Left"},{value:"top-center",label:"Top Center"},{value:"top-right",label:"Top Right"},{value:"middle-left",label:"Middle Left"},{value:"middle-center",label:"Middle Center"},{value:"middle-right",label:"Middle Right"},{value:"bottom-left-floated",label:"Bottom Left"},{value:"bottom-center-floated",label:"Bottom Center",default:!0},{value:"bottom-right-floated",label:"Bottom Right"}]},{name:"text-edge-style",label:"Text edge style",items:[{value:"none",label:"None",default:!0},{value:"drop-shadow",label:"Drop Shadow"},{value:"raised",label:"Raised"},{value:"outline",label:"Outline"}]}]}],diagnosticMenuCfg:{name:"debug",label:"Debug",enabled:!0,items:[{value:"diagnostic-window",label:"Show diagnostics"}]},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.SKIN_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.vci=a.vci,this.dom=this.vci.dom,this._namespace=null,this._containerEl=this.dom.outer.el,this._contentEl=this.dom.content.el,this._videoEl=this.dom.video.el,this._adEl=this.dom.ad.el,this._controlsEl=this.dom.controls.el,this._containerId=this._containerEl.id,this._controlsId=this._controlsEl.id,this._skinReadyCB=a.skinReadyCallback,this.mc=uvpjs.mediaCapabilities,this.fullscreenMgr=null,this._autoPlay=!1,this._playbackState=this.mc.EMPTY,this._controlList={},this._controlCache={},this._intervals={},this._disabledButtons=[],this._downloaded=0,this._isMouseActive=!1,this._previewCallbackDone=!1,this._canFullscreen=!1,this._captionsLoaded=!1,this._ccEnabledByUser=!1,this._enableReplay=!1,this._isSliding=!1,this._isTouchActive=!1,this._cssPath="",this._cssRules={},this._styleEl=null,this._previewImage="",this._waitCount=0,this._vendorPrefix=this.mc.getBrowserVendorPrefix(),this._isMSEdge=this.mc.isEdge(),this._isTouch=this.mc.isMobile()&&this.mc.isTouch(),this._hasFirstTouch=!1,this._isIOS=this.mc.isIOS(),this.isAndroidOnHlsjs=this.mc.canPlayHlsjsAndriod(this.vci.CVI_Mgr.cviModel.getModuleParam("VideoPlaybackSettings","forceHlsjs")),this._isAndroid=this.mc.isAndroid(),this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._touchStartTime=null,this.isMonitoringMuting=!1,this.muteMonitorIntervalId=null,this.currVolumeInfo=null,this.durationChecked=!1,this.controlsVisible=!1,this.ignoreVideoStateChange=!1,this._menuSelections={},this._hPlay=null,this._onSettingsMenuBtnClick=this._onSettingsMenuBtnClick.bind(this),this._onSettingsMenuInputClick=this._onSettingsMenuInputClick.bind(this),this._intervals[this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER)]=-1,this.initialize(a.skinConfig)},destroy:function(){var a=function(){};this._clearIntervals(),this._removeUIEventListeners(),this._removeUVPJSEventListeners(),this._removeMenuEventListeners(),clearTimeout(this.muteMonitorIntervalId),this.vci=null,this.mc=null,this.dom=null,this._containerEl=null,this._contentEl=null,this._videoEl=null,this._adEl=null,this._controlsEl=null,this._containerId=null,this._controlsId=null,this._playstateBtn=null,this._playToggleFrame=null,this._progress=null,this._progressSlider=null,this._controlBar=null,this._previewBtn=null,this._replayBtn=null,this._volumeSlider=null,this._volumeBtn=null,this._ccBtn=null,this._settingsBtn=null,this._fullscreenBtn=null,this._updateProgressSlider=null,this._skinReadyCB=a,this._replayCB=a,this._controlList=null,this._controlCache=null,this._intervals=null,this._previewImage=null,this._disabledButtons=null,this._touchStartTime=null},initialize:function(a){var b=uvpjs.util,c=uvpjs.Configuration.hostname+uvpjs.Configuration.path,d=this._containerId,e=a.customCSS;this._namespace="."+d+".skin",this._autoPlay=a.isMutedAutoplay||a.isUnmutedAutoplay,this._isMutedAutoplay=a.isMutedAutoplay,this._previewImage=a.previewImage,this._enableReplay=a.enableReplay,this._themeName=a.themeName,this._controls=a.controls,this._template=a.template,this._canFullscreen=uvpjs.FullscreenManager.hasFullscreenSupport(),this._cssPath=b.isDefinedString(e)&&e||c+this.DEFAULT_SKIN_PATH,this.vci.usesDiagnosticWindow()&&this.settingsMenu.push(this.diagnosticMenuCfg),this.debug&&uvpjs.log(this.DEBUG_ID,"initialize cfg",JSON.stringify(a)),this._hideContainers(),this._setupDom(),this._addStylesheetToDom(),this._disableButton(this.css.FULLSCREEN_BTN),this._canFullscreen&&(this.fullscreenMgr=new uvpjs.FullscreenManager({videoElement:this._videoEl,container:this._containerEl,readyCallback:this._handleFullscreenMgrReady.bind(this),fullscreenChangeCallback:this._handleFullscreenChange.bind(this)}))},setPlaystate:function(a){this._playbackState=a,this._updatePlaybackStateUI(this._playbackState)},disableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"disableButton",a),f.includes(this._disabledButtons,a)||this._disabledButtons.push(a),this._disableButton(a)},enableButton:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"enableButton",a),f.pull(this._disabledButtons,a),this._enableButton(a)},_handleFullscreenMgrReady:function(a){a&&this._enableButton(this.css.FULLSCREEN_BTN)},_handleFullscreenChange:function(a){var b=this.fullscreenMgr.usesFullscreenApi();this._hide(this.css.VOLUME_SLIDER),a?(this.vci.fullscreen(!0),b&&this._addModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!0)):(this.vci.fullscreen(!1),b&&this._removeModifier(this.PRIMARY_BLOCK,this.FULLSCREEN_MODIFIER),this._isIOS&&this.monitorMuting(!1,!0))},_disableButton:function(a){var b=this._queryByElementName(a);this.debug&&uvpjs.log(this.DEBUG_ID,"_disableButton",a),this._disable(a),b&&b.setAttribute("disabled","disabled")},_enableButton:function(a){var b=this._queryByElementName(a);this.debug&&uvpjs.log(this.DEBUG_ID,"_enableButton",a),f.includes(this._disabledButtons,a)||(this._enable(a),b&&b.removeAttribute("disabled"))},_addUVPJSEventListeners:function(){var a=this.vci,b=this._namespace,c=uvpjs.EventType;a.addEventListener(c.AD_START+b,this._onAdStart.bind(this)),a.addEventListener(c.AD_END+b,this._onAdEnd.bind(this)),!this._isIOS&&a.addEventListener(c.CAPTIONS_READY+b,this._onCaptionsReady.bind(this)),a.addEventListener(c.CONTENT_START+b,this._onContentStart.bind(this)),a.addEventListener(c.CONTENT_END+b,this._onContentEnd.bind(this)),a.addEventListener(c.VIDEO_PROGRESS+b,this._onVideoProgress.bind(this)),a.addEventListener(c.VIDEO_STATE_CHANGE+b,this._onVideoStateChange.bind(this)),a.addEventListener(c.VIDEO_LOADING+b,this._onVideoLoading.bind(this)),a.addEventListener(c.CONTROL_MUTE+b,this._onControlMuteUnmute.bind(this)),a.addEventListener(c.CONTROL_UNMUTE+b,this._onControlMuteUnmute.bind(this)),a.addEventListener(c.RESOURCE_START+b,this._onResourceStart.bind(this)),a.addEventListener(c.RESOURCE_END+b,this._onResourceEnd.bind(this)),a.addEventListener(c.CONTAINER_RESIZE+b,this._onUVPJSResize.bind(this)),a.addEventListener(c.DIAGNOSTIC_WINDOW_CLOSE_BUTTON+b,this._onDiagCloseButton.bind(this))},_removeUVPJSEventListeners:function(){var a=this.vci,b=this._namespace,c=uvpjs.EventType;a&&a instanceof uvpjs.VideoControlInterface&&(a.removeEventListener(c.AD_START+b),a.removeEventListener(c.AD_END+b),!this._isIOS&&a.removeEventListener(c.CAPTIONS_READY+b),a.removeEventListener(c.CONTENT_START+b),a.removeEventListener(c.CONTENT_END+b),a.removeEventListener(c.VIDEO_PROGRESS+b),a.removeEventListener(c.VIDEO_STATE_CHANGE+b),a.removeEventListener(c.VIDEO_LOADING+b),a.removeEventListener(c.CONTROL_MUTE+b),a.removeEventListener(c.CONTROL_UNMUTE+b),a.removeEventListener(c.RESOURCE_END+b),a.removeEventListener(c.CONTAINER_RESIZE+b))},_addUIEventListeners:function(){for(var a=this.mc.isIE()?"change":"input",b=this._containerEl,c=this.css,d=this.shouldTrapTaps(),e=["_hideMenu","_onUVPJSGestureEvent","_onPreviewBtn","_onReplayBtn","_onControlBarMouseOver","_onControlBarMouseOut","_onProgressMouseOver","_onProgressMouseOut","_onProgressSliderEvent","_onVolumeSliderEvent","_onPlayToggle","_onVolumeBtnEvent","_onClosedCaptionBtnClick","_onSettingsBtnClick","_onFullscreenBtnClick","_hNonTap"],f=e.length;f--;)"_onClosedCaptionBtnClick"===e[f]&&this._isIOS||(this[e[f]]=this[e[f]].bind(this));var g=this._onUVPJSGestureEvent,h=this._hNonTap,i=this._onProgressSliderEvent,j=this._onVolumeSliderEvent,k=this._onVolumeBtnEvent;document.addEventListener("click",this._hideMenu,!1),window.addEventListener("scroll",h),b.addEventListener("mouseenter",g,!0),b.addEventListener("mouseleave",g,!0),b.addEventListener("mousemove",g,!0),b.addEventListener("mousedown",g,!1),b.addEventListener("mouseup",g,!1),b.addEventListener("click",g,!1),b.addEventListener("touchstart",g,!0),b.addEventListener("touchend",g,!0),this._previewBtn=this._queryByElementName(c.PREVIEW_BTN),this._previewBtn.addEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.addEventListener("touchmove",h),!this._isTouch&&this._previewBtn.addEventListener("click",this._onPreviewBtn,!0),this._replayBtn=this._queryByElementName(c.REPLAY_BTN),this._replayBtn.addEventListener("touchend",this._onReplayBtn,!0),!this._isTouch&&this._replayBtn.addEventListener("click",this._onReplayBtn,!0),this._controlBar=this._queryByElementName(c.CONTROL_BAR),this._controlBar.addEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.addEventListener("mouseout",this._onControlBarMouseOut,!1),this._progress=this._queryByElementName(c.PROGRESS),this._progress.addEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.addEventListener("mouseout",this._onProgressMouseOut,!1),this._progressSlider=this._queryByElementName(c.PROGRESS_SLIDER),this._progressSlider.addEventListener(a,i,!1),this._progressSlider.addEventListener("mousedown",i,!1),this._progressSlider.addEventListener("mouseup",i,!1),this._progressSlider.addEventListener("touchstart",i,!0),this._progressSlider.addEventListener("touchend",i,!0),this._volumeSlider=this._queryByElementName(c.VOLUME_SLIDER),this.mc.supportsVolume()?(this._volumeSlider.addEventListener(a,j,!1),this._volumeSlider.addEventListener("mouseover",j,!1),this._volumeSlider.addEventListener("mouseout",j,!1)):this._disable(this.css.VOLUME_SLIDER),this._playToggleFrame=this._queryByElementName(c.LARGE_PLAY_BTN),!d&&this._playToggleFrame.addEventListener("click",this._onPlayToggle,!1),this._playstateBtn=this._queryByElementName(c.PLAYSTATE_BTN),!d&&this._playstateBtn.addEventListener("click",this._onPlayToggle,!1),this._volumeBtn=this._queryByElementName(c.VOLUME_BTN),!d&&this._volumeBtn.addEventListener("click",k,!1),this._volumeBtn.addEventListener("mouseover",k,!1),this._volumeBtn.addEventListener("mouseout",k,!1),this._isIOS||(this._ccBtn=this._queryByElementName(c.CLOSED_CAPTION_BTN),!d&&this._ccBtn.addEventListener("click",this._onClosedCaptionBtnClick,!1)),this._settingsBtn=this._queryByElementName(c.SETTINGS_BTN),!d&&this._settingsBtn.addEventListener("click",this._onSettingsBtnClick,!1),this._updateProgressSlider=this._updateSliderUI.bind(this,this._progressSlider,c.PROGRESS_SLIDER),this._fullscreenBtn=this._queryByElementName(c.FULLSCREEN_BTN),this._canFullscreen&&this._listenToFullscreenBtn()},_removeUIEventListeners:function(){var a=this.mc.isIE()?"change":"input",b=this._containerEl,c=this._hNonTap,d=this._onUVPJSGestureEvent,e=this._onProgressSliderEvent,f=this._onVolumeSliderEvent,g=this._onVolumeBtnEvent;document.removeEventListener("click",this._hideMenu,!1),window.removeEventListener("scroll",c,!1),b.removeEventListener("mouseenter",d,!0),b.removeEventListener("mouseleave",d,!0),b.removeEventListener("mousemove",d,!0),b.removeEventListener("mousedown",d,!1),b.removeEventListener("mouseup",d,!1),b.removeEventListener("click",d,!1),b.removeEventListener("touchstart",d,!0),b.removeEventListener("touchend",d,!0),this._previewBtn&&(this._previewBtn.removeEventListener("touchend",this._onPreviewBtn,!0),this._previewBtn.removeEventListener("touchmove",c,!0),this._previewBtn.removeEventListener("click",this._onPreviewBtn,!0)),this._replayBtn&&(this._replayBtn.removeEventListener("touchend",this._replayBtn,!0),this._replayBtn.removeEventListener("click",this._replayBtn,!0)),this._controlBar&&(this._controlBar.removeEventListener("mouseover",this._onControlBarMouseOver,!1),this._controlBar.removeEventListener("mouseout",this._onControlBarMouseOut,!1)),this._progress&&(this._progress.removeEventListener("mouseover",this._onProgressMouseOver,!1),this._progress.removeEventListener("mouseout",this._onProgressMouseOut,!1)),this._progressSlider&&(this._progressSlider.removeEventListener(a,e,!1),this._progressSlider.removeEventListener("mousedown",e,!1),this._progressSlider.removeEventListener("mouseup",e,!1),this._progressSlider.removeEventListener("touchstart",e,!0),this._progressSlider.removeEventListener("touchend",e,!0)),this._volumeSlider&&(this._volumeSlider.removeEventListener(a,f,!1),this._volumeSlider.removeEventListener("mouseover",f,!1),this._volumeSlider.removeEventListener("mouseout",f,!1)),this._playstateBtn&&this._playstateBtn.removeEventListener("click",this._onPlayToggle,!1),this._playToggleFrame&&this._playToggleFrame.removeEventListener("click",this._onPlayToggle,!1),this._volumeBtn&&(this._volumeBtn.removeEventListener("click",g,!1),this._volumeBtn.removeEventListener("mouseover",g,!1),this._volumeBtn.removeEventListener("mouseout",g,!1)),this._isIOS||this._ccBtn&&this._ccBtn.removeEventListener("click",this._onClosedCaptionBtnClick,!1),this._settingsBtn&&this._settingsBtn.removeEventListener("click",this._onSettingsBtnClick,!1),this._canFullscreen&&this._fullscreenBtn&&(this._fullscreenBtn.removeEventListener("touchend",this._onFullscreenBtnClick,!0),this._fullscreenBtn.removeEventListener("click",this._onFullscreenBtnClick,!1))},_addStylesheetToDom:function(){var a=this._setStyleSheet.bind(this,this._waitForControls.bind(this,this._finalizeSkin));uvpjs.util.createStyleSheet(a,this._cssPath)},_haveControlsLoaded:function(){this.debug&&(uvpjs.log(this.DEBUG_ID,"_haveControlsLoaded."),uvpjs.log(this.DEBUG_ID,"controlsLoaded: control list: ",this._controlList));var a=!0;for(var b in this._controlList)this._checkControlOnDOM(this._controlList[b])||(a=!1);return a},_waitForControls:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_waitForControls.");setTimeout(function(){if(!(++this._waitCount>100))return this._haveControlsLoaded()?void a.call(this):void this._waitForControls(a)}.bind(this),50)},_clearMouseMoveInterval:function(a){var b=this._getClassName(a,this.ACTIVE_MODIFIER);this._intervals&&-1!==this._intervals[b]&&(clearInterval(this._intervals[b]),this._intervals[b]=-1)},_clearIntervals:function(){var a,b=this._intervals;for(a in b)-1!==b[a]&&(clearInterval(b[a]),b[a]=-1)},_setupDom:function(){var a=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"creating skin controls",this._containerId),b(this._containerEl,this.PRIMARY_BLOCK),b(this._contentEl,this._getClassName(a.CONTENT)),b(this._controlsEl,this._getClassName(a.CONTROLS)),this.debug&&uvpjs.log(this.DEBUG_ID,"_themeName",this._themeName),this._setDataAttribute(this._containerEl,"theme",this._themeName),this._adEl&&b(this._adEl,this._getClassName(a.AD)),this._hide(a.CONTROLS),this._setupControlsContainer(),this._createAdLearnMoreButton(),this._addBufferingIndicator(),this._hide(a.BUFFERING_FRAME),this._hide(a.LARGE_PLAY_BTN),this._hide(a.CONTROL_BAR),this._hide(a.PROGRESS),this._hide(a.VOLUME_SLIDER),this._show(a.CONTROLS),this._hide(a.BUFFERING_FRAME),this._hide(a.SETTINGS_MENU),this._hide(a.PREVIEW_BTN),this._hide(a.REPLAY_BTN),!0!==this._autoPlay&&this._setupPreview()},_finalizeSkin:function(){this._disableControls(),this._disableInactiveButtons(),this._addUVPJSEventListeners(),this._addUIEventListeners(),this._determineBreakpoint(),this.mc.isMobile()&&this._addModifier(this.PRIMARY_BLOCK,this.MOBILE_MODIFIER),this._skinReadyCB(),setTimeout(this._showContainers.bind(this),this.INITIAL_DOM_SETUP_WAIT)},_hideContainers:function(){this._containerEl.style.visibility="hidden",this._contentEl.style.visibility="hidden",this._videoEl.style.visibility="hidden",this._controlsEl.style.visibility="hidden"},_showContainers:function(){this._containerEl.style.visibility="visible",this._contentEl.style.visibility="visible",this._videoEl.style.visibility="visible",this._controlsEl.style.visibility="visible"},_appendControlList:function(a){this._controlList[this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+a]=a},_setupControlsContainer:function(){var a=JSON.parse(JSON.stringify(this._controls))||[{el:"PREVIEW_BTN",type:"button",label:"Start video"},{el:"REPLAY_BTN",type:"button",label:"Replay video"},{el:"LARGE_PLAY_BTN",type:"button",label:"Large play-pause toggle"},{el:"CONTROL_BAR",type:"div",children:[{el:"PLAYSTATE_BTN",type:"button",label:"Play pause"},{el:"TIME",type:"div",children:[{el:"TIME_CURRENT",type:"span",text:this.NULL_TIME},{el:"TIME_DURATION",type:"span",text:this.NULL_TIME},{el:"TIME_LIVE",type:"span",text:"Live"}]},{el:"CLOSED_CAPTION_BTN",type:"button",label:"Closed captions"},{el:"SETTINGS_BTN",type:"button",label:"Settings"},{el:"VOLUME_BTN",type:"button",label:"Volume"},{el:"FULLSCREEN_BTN",type:"button",label:"Fullscreen"}]},{el:"PROGRESS",type:"div",children:[{el:"PROGRESS_SLIDER",type:"range",value:0,step:1e-4},{el:"PROGRESS_LOADED",type:"progress",value:0,step:1e-4}]},{el:"VOLUME_SLIDER",type:"range",value:1,step:.05},{el:"SETTINGS_MENU",type:"div",children:[]}];this._controlsEl.innerHTML=this._templateToHTML(a),this._isIOS&&(this._controlsEl.querySelector(".uvpjs__btn-volume").style.right="45px",this._controlsEl.querySelector(".uvpjs__time").style.right="83px")},_generateSettingsMenu:function(a,b){function c(a){var b=a.value,c=a.property,d=c&&q[c];return!((d&&d.toLowerCase())!==(b&&b.toLowerCase()))}function d(a,b){var d={};if(!1!==a.enabled)return void 0===a.value?(d.el="SETTINGS_MENU_ITEM",d.type="button",d.label=a.label,d.target=b):(d.el="SETTINGS_MENU_INPUT",d.type="menu",d.label=a.label||a.value,d.value=a.value,d.property=b&&f.last(b.split(":")),d.selected=c(d)),d}var e,g,h,i,j,k,l,m,n,o=this._queryByElementName(this.css.SETTINGS_MENU),p=this._getClassName(this.css.SETTINGS_MENU_ITEM),q=f.assign({},this._menuSelections,this._getCaptionsStyle()),r=document.createRange(),s=uvpjs.util,t=[],u=this.shouldTrapTaps();for(n=a&&a.length,m=0;m<n;m++)k=a[m],j=k.name,i=b,j&&(i=s.isDefinedString(b)&&[b,j].join(":")||j),t.push(d(k,i));for(b&&(h=this._findMenuItem(b),i=b.split(":").slice(0,-1).join(":"),l=d(h,i),l.cls=p+"--back",t.unshift(l)),r.selectNodeContents(o),r.deleteContents(),o.insertAdjacentHTML("beforeend",this._templateToHTML(t)),e=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),g=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT),m=e&&e.length;m--;)!u&&e[m].addEventListener("click",this._onSettingsMenuBtnClick);for(m=g&&g.length;m--;)!u&&g[m].addEventListener("click",this._onSettingsMenuInputClick)},_removeMenuEventListeners:function(){var a,b=this._queryAllByElementName(this.css.SETTINGS_MENU_ITEM),c=this._queryAllByElementName(this.css.SETTINGS_MENU_INPUT);for(a=b&&b.length;a--;)b[a].removeEventListener("click",this._onSettingsMenuBtnClick);for(a=c&&c.length;a--;)c[a].removeEventListener("click",this._onSettingsMenuInputClick)},_findMenuItem:function(a){var b={items:this.settingsMenu};if(f.isEmpty(a))return b;var c=this,d=a.split(":");return f(d).each(function(a){c.debug&&uvpjs.log(c.DEBUG_ID,"_findMenuItem key",a),b=f.find(b.items,function(b){return b.name===a})}),b},_createAdLearnMoreButton:function(){},_setupPreview:function(){var a=uvpjs.util,b=this.css.PREVIEW_BTN,c=this._previewImage,d=this._queryByElementName(b);uvpjs.log(this.DEBUG_ID,"_setupPreview",c),a.isDefinedString(c)&&(d.style.backgroundImage="url('"+c+"')"),this._show(b)},_setupReplay:function(){var a=uvpjs.util,b=this.css,c=b.REPLAY_BTN,d=this._previewImage,e=this._queryByElementName(c);this.debug&&uvpjs.log(this.DEBUG_ID,"_setupReplay"),a.isDefinedString(d)&&(e.style.backgroundImage="url('"+d+"')"),this._hide(b.LARGE_PLAY_BTN),this._hide(b.PREVIEW_BTN),this._hide(b.BUFFERING_FRAME),this._show(b.CONTROLS),this._hide(b.CONTROL_BAR),this._hide(b.PROGRESS),this._show(c),this._disableControls(),this._replayCB=this.vci.replayVideo.bind(this.vci)},_addBufferingIndicator:function(){var a=this._getClassName(this.css.BUFFERING_FRAME),b={lines:7,length:0,width:12,radius:9,scale:1,corners:1,color:"#ecf0f1",opacity:0,rotate:0,direction:1,speed:1.2,trail:95,fps:30,zIndex:2e9,className:a,top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};new Spinner(b).spin(this._controlsEl)},_disableInactiveButtons:function(){!this._isIOS&&this._disableCaptions(),this.mc.supportsMute()||this._disableButton(this.css.VOLUME_BTN)},_onAdStart:function(a){var b=this.css;this._containerId===a.target&&(this.ignoreVideoStateChange=this.shouldIgnoreStateChange(a.payload.isDynamicAdCall),this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdStart"),this.mc.supportsMute()&&this._enableButton(b.VOLUME_BTN),this._disableButton(b.SETTINGS_BTN),this._disableButton(b.CLOSED_CAPTION_BTN),this._disableProgress(),this._addModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(b.PROGRESS),this._hasActive(b.CLOSED_CAPTION_BTN)&&!this._isIOS&&this.vci.hideCaptions(),a.payload.adData.isCustomClickTrackingUsed||this._disable(b.LARGE_PLAY_BTN))},shouldIgnoreStateChange:function(a){return this.vci.getContentVideoData().isLive&&!!a},_onAdEnd:function(a){this._containerId===a.target&&(this.ignoreVideoStateChange=!1,this.debug&&uvpjs.log(this.DEBUG_ID,"_onAdEnd",this._containerId,a.target),this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(this.css.LARGE_PLAY_BTN),this._isWaitingForFirstTouch=!1,this._resetProgressSlider())},_onCaptionsReady:function(a){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsReady",a),this._captionsLoaded=!0,this._enableCaptions(),this.isAndroidOnHlsjs||this._enableButton(this.css.SETTINGS_BTN))},_onCaptionsUnavailable:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onCaptionsUnavailable",a),this._isIOS||this._disableCaptions()},_onContentStart:function(a){var b=this.css;this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart",a),this._containerId===a.target&&(this._isWaitingForFirstTouch=!1,this.ignoreVideoStateChange=!1,this.currVolumeInfo={muted:this.vci.getPlayerMuted(),volume:this._videoEl.volume},this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentStart this._captionsLoaded",this._captionsLoaded),!this._isLive()&&this._enableProgress(),this._enableSettingsBtn(),this.mc.supportsMute()&&this._enableButton(b.VOLUME_BTN),this._captionsLoaded&&this._enableButton(b.CLOSED_CAPTION_BTN),this._hasAd()&&(this._removeModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER),this._enable(b.LARGE_PLAY_BTN)),this._isLive()?(this._setDataAttribute(this._containerEl,"stream",this.LIVE_MODIFIER),this._hide(b.PROGRESS)):this._isStreaming()&&(this._addModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),!this._hasHidden(this.css.CONTROL_BAR)&&this._show(b.PROGRESS)),!this._isIOS&&this._hasActive(b.CLOSED_CAPTION_BTN)&&this.vci.showCaptions())},_onContentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onContentEnd"),this._containerId===a.target&&(this._removeDataAttribute(this._containerEl,"stream"),this._removeModifier(this.PRIMARY_BLOCK,this.STREAMING_MODIFIER),this._resetProgressSlider(),this._disableProgress(),this._hide(this.css.PROGRESS))},_onControlMuteUnmute:function(a){var b="controlMute"===a.type;this._containerId===a.target&&this._updateVolumeUI(this._volumeSlider.value,b)},_onDiagCloseButton:function(a){this._containerId===a.target&&(uvpjs.log(this.DEBUG_ID,"_onDiagCloseButton",a),this._menuSelections.debug=null)},_onResourceStart:function(a){(a&&a.target)===this._containerId&&(uvpjs.log(this.DEBUG_ID,"_onResourceStart",a),this.durationChecked=!1,this._previewCallbackDone=!0,this._show(this.css.CONTROLS))},_onResourceEnd:function(a){var b=a.target,c=a.payload,d=0===c.playlistLength;this._containerId===b&&(uvpjs.log(this.DEBUG_ID,"_onResourceEnd",a),this._hide(this.css.CONTROLS),this._enableReplay&&d&&this._setupReplay(),this._captionsLoaded&&(this._captionsLoaded=!1,this._disableCaptions()),this._resetProgressSlider())},_onVideoProgress:function(a){var b,c,d=a.payload,e=d.playbackState,f=this.vci.getVolume(),g=this.css.TIME_DURATION,h=this.css.TIME_CURRENT,i=!1;this._containerId===a.target&&(f!==Number(this._volumeSlider.value)&&this._updateVolumeUI(f),e!==this._playbackState&&(this._playbackState=e,this._updatePlaybackStateUI(this._playbackState)),this._updateProgressLoad(d),e!==this.mc.PLAYING||this._isSliding||d.duration!==1/0&&(b=this._queryByElementName(g),c=this._queryByElementName(h),this._isLive()||this.durationChecked?this._isLive()&&!this.durationChecked&&d.duration>=3600&&(this.durationChecked=i=!0):(this.durationChecked=!0,d.duration>=3600&&(i=!0)),i&&(c.parentNode.style.width="100px"),b.innerHTML=this._formatTimestampByType(g,d.duration),c.innerHTML=this._formatTimestampByType(h,d.currentTime),this._updateProgressUI(d)),this.isMonitoringMuting&&this.checkMute())},_onVideoLoading:function(a){f.has(a,"target")&&this._containerId===a.target&&f.isObject(a)&&f.has(a,"payload.data")&&this._updateProgressLoad(a.payload.data)},_onVideoStateChange:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoStateChange",a),f.isObject(a)&&this._containerId===a.target&&f.isObject(a.payload)&&f.isNumber(parseInt(a.payload.newState))&&(!this.ignoreVideoStateChange||b===this.mc.PAUSED||b===this.mc.PLAYING)){var b=a.payload.newState;b!==this._playbackState&&(this._playbackState=b,this._updatePlaybackStateUI(this._playbackState)),b===this.mc.PAUSED&&this.isMonitoringMuting?this.monitorMuting(null,!0,!0):this.isMonitoringMuting&&this.monitorMuting(null,!0,!1)}},monitorMuting:function(a,b,c){null!==a&&(this.isMonitoringMuting=a),b&&clearInterval(this.muteMonitorIntervalId),c&&(this.muteMonitorIntervalId=setInterval(this.checkMute.bind(this),300))},checkMute:function(){var a=this._videoEl&&this._videoEl.muted;this.currVolumeInfo&&a!==this.currVolumeInfo.muted&&(this.currVolumeInfo.muted=a,a?this.vci.mute():this.vci.unMute())},_onUVPJSGestureEvent:function(a){var b=!1;switch(a.type){case"mouseenter":this._onUVPJSMouseEnter(a);break;case"mouseleave":this._onUVPJSMouseLeave(a);break;case"mousemove":this._onUVPJSMouseMove(a);break;case"mousedown":this._onUVPJSMouseDown(a);break;case"mouseup":this._onUVPJSMouseUp(a);break;case"click":this._showControlBar(a),b=!0;break;case"touchstart":this._onUVPJSTouchStart(a);break;case"touchend":this._onUVPJSTouchEnd(a),b=!0}!this._hasFirstTouch&&b&&(this._hasFirstTouch=!0,this.vci.handleFirstGesture(this._getTargetInfo(a)))},_getTargetInfo:function(a){var b=a.target;return{isVolumeButton:-1!==b.className.indexOf(this.css.VOLUME_BTN),isPlayPauseToggle:-1!==b.className.indexOf(this.css.PLAYSTATE_BTN)}},_onProgressSliderEvent:function(a){switch(a.type){case"input":case"change":this._onProgressSliderChange(a);break;case"touchstart":case"mousedown":this._onProgressSliderStart(a);break;case"touchend":case"mouseup":this._onProgressSliderEnd(a)}},_onVolumeSliderEvent:function(a){switch(a.type){case"input":case"change":this._onVolumeSliderChange(a);break;case"mouseover":this._showVolumeSlider(a);break;case"mouseout":this._hideVolumeSlider(a)}},_onVolumeBtnEvent:function(a){switch(a.type){case"click":case"touchend":this._onVolumeBtnClick(a);break;case"mouseover":this._showVolumeSlider(a);break;case"mouseout":this._hideVolumeSlider(a)}},_onUVPJSMouseEnter:function(a){a.stopPropagation(),this._containerEl===a.target&&(this._hasPaused()||this._showControlBar(a))},_onUVPJSMouseDown:function(a){a.stopPropagation(),this._hasAd()||(this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!0)},_onUVPJSTouchStart:function(a){var b,c=this.vci.getCurrentPlaybackState().playbackState;return this.debug&&uvpjs.log(this.DEBUG_ID,"_onUVPJSTouchStart"),a.target.getAttribute("disabled")?(a.stopPropagation(),void a.preventDefault()):(this._touchStartTime=a.timeStamp,this._previewCallbackDone?void(this._hasDisabled(this.css.CONTROLS)||c!==this.mc.EMPTY&&(this._isTouchActive=this._hasModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),a.target===this._progressSlider&&(b=1-(a.target.clientWidth-a.layerX)/a.target.clientWidth,this._onProgressSliderChange(a,b)))):void(this.debug&&uvpjs.log(this.DEBUG_ID,"Ignoring touchstart; preview callback not executed yet.")))},_onUVPJSTouchEnd:function(a){function b(){this._hasPaused()||(c=null,this._removeModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER))}var c,d,e,f,g=this.css,h=this._isTap(a.timeStamp),i=[g.CLOSED_CAPTION_BTN,g.VOLUME_BTN,g.PLAYSTATE_BTN,g.SETTINGS_BTN,g.SETTINGS_MENU,g.SETTINGS_MENU_ITEM,g.SETTINGS_MENU_INPUT,g.LARGE_PLAY_BTN,g.FULLSCREEN_BTN],j=i.length,k=a.target.className;if(a.target.getAttribute("disabled"))return a.stopPropagation(),void a.preventDefault();if(!this._hasDisabled(g.CONTROLS)){for(;j--&&!(d=d||k.indexOf(i[j])>-1););if(this.shouldTrapTaps()&&d&&j<i.length-1)return a.stopPropagation(),a.preventDefault(),void this.handleTap(i[j],a);e=!(d||this._isTouchActive&&h),e&&a.preventDefault(),e&&this._addModifier(this.PRIMARY_BLOCK,this.TOUCH_MODIFIER),f=c||e?this.HIDE_DELAY:0,c&&clearTimeout(c),c=setTimeout(b.bind(this),f)}},handleTap:function(a,b){var c=this.css;if(!this._queryByElementName(a).hasAttribute("disabled"))switch(a){case c.CLOSED_CAPTION_BTN:this._onClosedCaptionBtnClick(b);break;case c.VOLUME_BTN:this._onVolumeBtnEvent(b);break;case c.PLAYSTATE_BTN:case c.LARGE_PLAY_BTN:this._onPlayToggle(b);break;case c.SETTINGS_BTN:this._onSettingsBtnClick(b);break;case c.SETTINGS_MENU_ITEM:this._onSettingsMenuBtnClick(b);break;case c.SETTINGS_MENU_INPUT:this._onSettingsMenuInputClick(b)}},shouldTrapTaps:function(){return this._isIOS},_onUVPJSMouseUp:function(a){a.stopPropagation(),this._removeModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._isMouseActive=!1},_onUVPJSMouseMove:function(a){var b=this._getClassName(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER);-1===this._intervals[b]&&(this._hasHidden(this.css.CONTROL_BAR)&&this._showControlBar(),this._addModifier(this.PRIMARY_BLOCK,this.ACTIVE_MODIFIER),this._intervals[b]=setInterval(this._onUVPJSMouseMoveStop.bind(this,this.PRIMARY_BLOCK),this.HIDE_DELAY))},_onUVPJSMouseMoveStop:function(a){this._isMouseActive||(this._clearMouseMoveInterval(a),this._removeModifier(a,this.ACTIVE_MODIFIER),this._hideControlBar())},_onUVPJSMouseLeave:function(a){a.stopPropagation(),this._containerEl===a.target&&(this._hasPaused()||this._hasHidden(this.css.CONTROL_BAR)||this._hideControlBar())},_onControlBarMouseOver:function(a){a.stopPropagation(),this._addModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onControlBarMouseOut:function(a){a.stopPropagation(),this._removeModifier(this.css.CONTROL_BAR,this.ACTIVE_MODIFIER)},_onUVPJSResize:function(a){a.target===this._containerId&&this._determineBreakpoint()},_determineBreakpoint:function(){var a=this._containerEl.offsetWidth;a>=this.SIZE_XS_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),a>=this.SIZE_SM_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),a>=this.SIZE_MD_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),a>=this.SIZE_LG_BREAKPOINT&&this._addModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER),a<this.SIZE_XS_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_XS_MODIFIER),a<this.SIZE_SM_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_SM_MODIFIER),a<this.SIZE_MD_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_MD_MODIFIER),a<this.SIZE_LG_BREAKPOINT&&this._removeModifier(this.PRIMARY_BLOCK,this.SIZE_LG_MODIFIER)},_onVolumeBtnClick:function(a){var b=this.vci,c=b.getPlayerMuted();this._hasDisabled(this.css.VOLUME_BTN)||(c?this.vci.unMute():this.vci.mute())},_onVolumeSliderChange:function(a){var b=parseFloat(a.target.value),c=this.vci.getPlayerMuted();c&&b>0&&this.vci.unMute(),this.vci.setVolume(b),this._updateVolumeUI(b,c)},_onFullscreenBtnClick:function(a){a.stopPropagation(),this._hideVolumeSlider(),this.fullscreenMgr.isFullscreen()?this.fullscreenMgr.exitFullscreen():this.fullscreenMgr.enterFullscreen()},_onPlayToggle:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle this.vci.vidContId = ",this.vci.vidContId),a.stopPropagation(),a.preventDefault(),this.ignoreVideoStateChange&&this._isLive())return void(this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)?(this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.playVideo()):(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo()));var b=this.vci.getCurrentPlaybackState().playbackState;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPlayToggle playbackState = ",b),b===this.mc.PAUSED||b===this.mc.EMPTY||b===this.mc.LOADING)return this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),void this.vci.playVideo();b!==this.mc.BUFFERING&&(this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.vci.pauseVideo())},_onPreviewBtn:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onPreviewBtn"),this._isTouch&&!this._isTap(a.timeStamp))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Long touch detected; not executing preview-button callback."));a.stopPropagation(),this.vci.onPreviewButton(this._skinReadyCB.bind(this))},_hNonTap:function(){this._touchStartTime=null},_onReplayBtn:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onReplayBtn"),a.stopPropagation(),this._hide(this.css.REPLAY_BTN),this._show(this.css.BUFFERING_FRAME),this._replayCB&&this._replayCB()},_listenToFullscreenBtn:function(){this._canFullscreen&&(this._fullscreenBtn.addEventListener("touchend",this._onFullscreenBtnClick.bind(this),!0),!this._isTouch&&this._fullscreenBtn.addEventListener("click",this._onFullscreenBtnClick.bind(this),!1))},_onClosedCaptionBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onClosedCaptionBtnClick"),a.stopPropagation();var b=this.css.CLOSED_CAPTION_BTN,c=this._hasActive(b);if(this._ccEnabledByUser=!c,c)return this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),void this.vci.hideCaptions();this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions(),this._setCCPosition()},_onSettingsBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick"),a.stopPropagation();var b=this.css.SETTINGS_MENU,c=this._hasHidden(b);if(uvpjs.log(this.DEBUG_ID,"_onSettingsBtnClick isHidden",c),c)return this._addModifier(b,this.ACTIVE_MODIFIER),this._generateSettingsMenu(this.settingsMenu),void this._show(b);this._removeModifier(b,this.ACTIVE_MODIFIER),this._hide(b)},_onSettingsMenuBtnClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick",a);var b=a.target.getAttribute("data-target");this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuBtnClick target",b),a.target.parentNode.setAttribute("data-target",b);var c=this._findMenuItem(b);this._generateSettingsMenu(c.items,b)},_onSettingsMenuInputClick:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsMenuInputClick",a);var b=a.target,c=b.parentNode,d=c.getAttribute("data-target");switch(d&&d.split(":")[0]){case"cc":this._onSettingsCaptionsChange(a);break;case"controls":this._onSettingsControlsChange(a);break;case"debug":this._onSettingsDiagWindowChange(a)}},_onSettingsCaptionsChange:function(a){var b=a.target,c=b.parentNode,d=b.getAttribute("data-property"),e=b.getAttribute("data-value").toLowerCase();if(this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsCaptionsChange property, value",d,e),f(c.children).each(function(a){a.setAttribute("data-selected","false")}.bind(this)),b.setAttribute("data-selected","true"),"text-position"===d)return void this._setCCPosition(e);this.vci.setCaptionsStyleProperty(d,e)},_onSettingsControlsChange:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange",a);var b=a.target,c=b.getAttribute("data-property"),d=b.getAttribute("data-value").toLowerCase(),e="#"+this._containerId+" ";if("background-opacity"===c){c="background-color";var f=this._queryByElementName(this.css.CONTROL_BAR),g=getComputedStyle(f).getPropertyValue(c);if(-1===g.indexOf("rgba"))return;d=g.split(",").slice(0,-1).join(",")+", "+d+")",this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsControlsChange value",d),e+=this._getClassName(this.css.CONTROL_BAR)}this._addCSSRule(e,c,d)},_onSettingsDiagWindowChange:function(a){var b=a.target,c=b.getAttribute("data-property"),d=b.getAttribute("data-value"),e="true"===b.getAttribute("data-selected"),f=!e;this.debug&&uvpjs.log(this.DEBUG_ID,"_onSettingsDiagWindowChange",a),this._menuSelections[c]=d,b.setAttribute("data-selected",f),f?this.vci.showDiagnosticWindow():this.vci.hideDiagnosticWindow()},_setCaptionsStyle:function(a){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyle",a),this.vci.setCaptionsStyle(a))},_setCaptionsStyleProperty:function(a,b){!this._isIOS&&this._captionsLoaded&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCaptionsStyleProperty",a,b),this.vci.setCaptionsStyleProperty(a,b))},_setCueProperty:function(a,b){if(!this._isIOS&&this._captionsLoaded){this._videoEl.textTracks&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_setCueProperty",a,b),this.vci.setCaptionsCueProperty(a,b))}},_setCCPosition:function(a){var b="text-position";!this._isIOS&&this._captionsLoaded&&(a=a||this._getCaptionsStyle()[b],this.debug&&uvpjs.log(this.DEBUG_ID,"_setCCPosition prop, value",b,a),this.vci.setCaptionsStyleProperty(b,a))},_showControlBar:function(a){var b=this.vci.getCurrentPlaybackState().playbackState,c=this.css;this._hasHidden(this.css.CONTROL_BAR)&&!this._hasDisabled(this.css.CONTROLS)&&b!==this.mc.EMPTY&&(f.isUndefined(this._hideControlBar.hide)||this._hideControlBar.hide.cancel(),this._removeModifier(this.PRIMARY_BLOCK,[c.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._show(c.CONTROL_BAR),this.controlsVisible=!0,this._show(c.PROGRESS))},_hideMenu:function(a){this._hasHidden(this.css.SETTINGS_MENU)||a.target.className.indexOf(this._getClassName(this.css.SETTINGS_MENU))>-1||this._hide(this.css.SETTINGS_MENU)},_hideControlBar:function(a){this._hasHidden(this.css.CONTROL_BAR)||this._hasDisabled(this.css.CONTROLS)||(this._hideControlBar.hide=f.debounce(function(){if(this._hasActive(this.PRIMARY_BLOCK)||this._hasActive(this.css.PROGRESS)||this._hasActive(this.css.PROGRESS_SLIDER)||this._hasActive(this.css.VOLUME_SLIDER)||this._hasActive(this.css.CONTROL_BAR)||!this._hasHidden(this.css.SETTINGS_MENU)||this._hasPaused()||this._isTouch)return void this._hideControlBar.hide.cancel();this.controlsVisible=!1,this._addModifier(this.PRIMARY_BLOCK,[this.css.CONTROL_BAR,this.HIDDEN_MODIFIER]),this._hideVolumeSlider(),this._hide(this.css.CONTROL_BAR),this._hide(this.css.PROGRESS)},a||this.HIDE_DELAY),this._hideControlBar.hide.cancel(),this._hideControlBar.hide.call(this))},_showVolumeSlider:function(a){var b,c=this.css;this._hasDisabled(c.VOLUME_BTN)||this._hasDisabled(c.CONTROLS)||(this._hasActive(c.SETTINGS_MENU)&&this._hide(c.SETTINGS_MENU),this._setDataAttribute(this._containerEl,c.VOLUME_SLIDER,!0),this._addModifier(c.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._show(c.VOLUME_SLIDER),(this.mc.isFirefox()||this.mc.isEdge())&&(b=this._controlsEl.querySelector(".uvpjs__volume-slider"))&&b.setAttribute("style","bottom: 62px"))},_hideVolumeSlider:function(a){this._isMouseActive||(this._removeDataAttribute(this._containerEl,this.css.VOLUME_SLIDER),this._removeModifier(this.css.VOLUME_SLIDER,this.ACTIVE_MODIFIER),this._hide(this.css.VOLUME_SLIDER))},_disableControls:function(){this._disable(this.css.CONTROLS)},_enableControls:function(){this._enable(this.css.CONTROLS)},_disableProgress:function(){this._disable(this.css.PROGRESS)},_enableProgress:function(){this._enable(this.css.PROGRESS)},_enableCaptions:function(){this._isIOS||(this.debug&&uvpjs.log(this.DEBUG_ID,"_enableCaptions"),this._enableMenuItem("cc"),this.enableButton(this.css.CLOSED_CAPTION_BTN),this._ccEnabledByUser&&(this._addModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this.vci.showCaptions()))},_disableCaptions:function(){this._isIOS||(this._removeModifier(this.css.CLOSED_CAPTION_BTN,this.ACTIVE_MODIFIER),this._disableButton(this.css.CLOSED_CAPTION_BTN),this._disableButton(this.css.SETTINGS_BTN))},_enableSettingsBtn:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_enableSettingsBtn"),f.some(this.settingsMenu,"enabled")&&this._enableButton(this.css.SETTINGS_BTN)},_updateVolumeUI:function(a,b){var c,d=uvpjs.util,e=this._containerEl,f=this.vci.getPlayerMuted();!0===f?c="mute":a>.85?c="full":d.inRange(a,.5,.85)?c="high":d.inRange(a,.15,.5)?c="medium":d.inRange(a,0,.15)&&(c="low"),this._volumeSlider.value=a||this._videoEl.volume,this._setDataAttribute(e,"volume-level",c),this._updateSliderUI(this._volumeSlider,this.css.VOLUME_SLIDER,a)},_onProgressSliderChange:function(a,b){var c,d,e=this.vci.getContentVideoData(),f=this.vci.getCurrentPlaybackState(),g=this.css.TIME_CURRENT,h=this._queryByElementName(g),i=b||this._progressSlider.value;i=i>1?1:i<0?0:i,c=Math.ceil(i*e.duration*1e4)/1e4,d=Math.abs((f.currentTime-c)/c),this._updateProgressSlider(i),h.innerHTML=this._formatTimestampByType(g,c),this._hasActive(this.css.PROGRESS_SLIDER)||d<=.02||this.vci.seekTo(c)},_onProgressMouseOver:function(a){a.stopPropagation(),this._addModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressMouseOut:function(a){a.stopPropagation(),this._removeModifier(this.css.PROGRESS,this.ACTIVE_MODIFIER)},_onProgressSliderStart:function(a){var b=this.css;if(this._hasAd()||this._hasDisabled(b.PROGRESS))return a.stopPropagation(),void a.preventDefault();this._addModifier(b.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!0},_onProgressSliderEnd:function(a){if(this._hasAd()||this._hasDisabled(this.css.PROGRESS))return a.stopPropagation(),void a.preventDefault();this._removeModifier(this.css.PROGRESS_SLIDER,this.ACTIVE_MODIFIER),this._isSliding=!1,this._onProgressSliderChange(a)},_resetProgressSlider:function(){this._updateProgressSlider&&this._updateProgressSlider(0)},_updateProgressLoad:function(a){var b,c;this._isLive()||(b=Math.ceil(a.bufferLength/a.duration*1e4)/1e4,f.isNaN(b)||b===1/0||b<=0||(this._downloaded=b,this._hasAd()||(c=this._queryByElementName(this.css.PROGRESS_LOADED),c.value=this._downloaded)))},_updatePlaybackStateUI:function(a){var b=this.css;switch(this.debug&&uvpjs.log(this.DEBUG_ID,"_updatePlaybackStateUI newState = ",a),a){case this.mc.PLAYING:this._show(b.CONTROLS),this._enableControls(),this._isTouch&&this._showControlBar(),this._hide(b.LARGE_PLAY_BTN),this._hide(b.PREVIEW_BTN),this._hide(b.REPLAY_BTN),this._hide(b.BUFFERING_FRAME),this._removeModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this.controlsVisible&&!this._isLive()&&this._show(b.PROGRESS);break;case this.mc.PAUSED:this._show(b.CONTROLS),this.controlsVisible&&this._showControlBar(),this._hide(b.BUFFERING_FRAME),this._addModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER),this._show(b.LARGE_PLAY_BTN);break;case this.mc.STOPPED:this._hide(b.CONTROLS);break;case this.mc.BUFFERING:case this.mc.LOADING:this._show(b.CONTROLS),this._hide(b.PREVIEW_BTN),this._hide(b.REPLAY_BTN),this._hide(b.LARGE_PLAY_BTN),this._show(b.BUFFERING_FRAME)}},_updateProgressUI:function(a){var b=Math.ceil(a.currentTime/a.duration*1e4)/1e4;this._updateProgressSlider(b)},_updateSliderUI:function(a,b,c){var d=this,e={};if(!f.isUndefined(this._vendorPrefix)&&!f.isUndefined(a)){if(e.id="#"+this._containerId,e.cls=d._getClass(b),e.pseudo={moz:"::-moz-range-track",webkit:"::-webkit-slider-runnable-track"}[d._vendorPrefix],this._isMSEdge&&(e.pseudo=""),e.add=function(a,b,c){if(!f.isUndefined(this.pseudo)){var e=this.id+(b||"")+" "+this.cls+(c||"")+this.pseudo;d._addCSSRule(e,"background-size",100*a+"% 100%")}},e.before=function(a,b){var c=d._getClass(d.PRIMARY_BLOCK);b&&(c+=d._getClass(d.PRIMARY_BLOCK,b)),this.add(a,c,null)},e.after=function(a,b){this.add(a,null,b)},b===d.css.VOLUME_SLIDER)return void e.add(c);var g=c*a.offsetWidth,h=(.5-c)*a.offsetHeight,i=g/a.offsetWidth,j=(g+h)/a.offsetWidth;a.value=c;var k=d._hasAd();e.before(i,k?d.AD_MODIFIER:null),this._isTouch&&e.before(j,d.TOUCH_MODIFIER)}},_checkControlOnDOM:function(a){var b=this.ID_SELECTOR_PREFIX+this._controlsId+" "+this.CLASS_SELECTOR_PREFIX+a;return!!this._controlCache[b]},_getClassName:function(a,b){var c=this.PRIMARY_BLOCK;return a!==this.PRIMARY_BLOCK&&(c+=this.BLOCK_ELEMENT_DELIMITER+a),b&&(c+=this.ELEMENT_MODIFIER_DELIMITER+b),c},_getClass:function(a,b){return this.CLASS_SELECTOR_PREFIX+this._getClassName(a,b)},_queryByClassName:function(a){var b,c;if(this._containerId)return b=this.ID_SELECTOR_PREFIX+this._containerId,a!==this.PRIMARY_BLOCK&&(b+=" "+this.CLASS_SELECTOR_PREFIX+a),c=this._controlCache[b]||document.querySelector(b),c&&(this._controlCache[b]=c),c},_queryAllByClassName:function(a){var b=this.ID_SELECTOR_PREFIX+this._containerId;return a!==this.PRIMARY_BLOCK&&(b+=" "+this.CLASS_SELECTOR_PREFIX+a),document.querySelectorAll(b)},_queryByElementName:function(a){return this._queryByClassName(this._getClassName(a))},_queryAllByElementName:function(a){return this._queryAllByClassName(this._getClassName(a))},_show:function(a){if(a===this.css.PROGRESS&&!this._isLive()){var b=this._queryByElementName(a),c=b.querySelector("input"),d=b.querySelector("progress");b&&(b.style.display="block"),c&&(c.style.display="block"),d&&(d.style.display="block")}this._removeModifier(a,this.HIDDEN_MODIFIER)},_hide:function(a){if(a===this.css.PROGRESS){var b=this._queryByElementName(a),c=b.querySelector("input"),d=b.querySelector("progress");b&&(b.style.display="none"),c&&(c.style.display="none"),d&&(d.style.display="none")}this._addModifier(a,this.HIDDEN_MODIFIER)},_enable:function(a){this._removeModifier(a,this.DISABLED_MODIFIER)},_disable:function(a){this._addModifier(a,this.DISABLED_MODIFIER)},_enableMenuItem:function(a){var b;a&&(b=this._findMenuItem(a))&&(b.enabled=!0)},_hasHidden:function(a){return this._hasModifier(a,this.HIDDEN_MODIFIER)},_hasActive:function(a){return this._hasModifier(a,this.ACTIVE_MODIFIER)},_hasAd:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.AD_MODIFIER)},_hasDisabled:function(a){return this._hasModifier(a,this.DISABLED_MODIFIER)},_hasPaused:function(){return this._hasModifier(this.PRIMARY_BLOCK,this.PAUSED_MODIFIER)},_isLive:function(){return this.vci.getContentVideoData().isLive&&this._isStreaming()},_isPlaying:function(){var a=this.vci.getContentVideoData();return a.deliveryType&&a.deliveryType===this.mc.PLAYING},_isStreaming:function(){var a=this.vci.getContentVideoData();return a.deliveryType&&a.deliveryType===this.mc.STREAMING},_hasModifier:function(a,b){f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER));var d=this._getClassName(a,b),e=this._queryByElementName(a);return!!e&&c(e,d)},_addModifier:function(a,c){f.isArray(c)&&(c=c.join(this.MODIFIER_DELIMETER));var d=this._getClassName(a,c),e=this._queryByElementName(a);e&&b(e,d)},_removeModifier:function(a,b){var c,e=this._queryByElementName(a);f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER)),c=this._getClassName(a,b),e&&d(e,c)},_toggleModifier:function(a,b){f.isArray(b)&&(b=b.join(this.MODIFIER_DELIMETER));var c=this._getClassName(a,b),d=this._queryByElementName(a);d&&e(d,c)},_setDataAttribute:function(a,b,c){a.setAttribute("data-"+b,c)},_removeDataAttribute:function(a,b){a.removeAttribute("data-"+b)},_formatTimestamp:function(a){var b,c;return uvpjs.util.isEmpty(a)||a===1/0?this.NULL_TIME:(isNaN(a)&&(a=0),b=new Date(null),b.setSeconds(Math.round(a)),c=b.toISOString(),a>=3600?c.substr(11,8):c.substr(14,5))},_formatTimestampByType:function(a,b){if(void 0===b||b<0){if(a===this.css.TIME_DURATION)return this.NULL_TIME;if(a===this.css.TIME_CURRENT)return this.NULL_TIME}return this._formatTimestamp(b)},_addCSSRule:function(a,b,c){var d=this._styleEl.sheet,e=d.cssRules.length,g=this._cssRules[a];if(!f.isUndefined(g)){var h=d.rules||d.cssRules;if(h.length>0&&h[g])return void(h[g].style[b]=c)}this._cssRules[a]=e,uvpjs.util.addCSSRule(this._styleEl,a,b,c)},_setStyleSheet:function(a){var b=!1;this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet",this.styleSheet),this._styleEl||uvpjs.util.createStyleSheet(function(c){this._styleEl=c,b||"function"!=typeof a||(this.debug&&uvpjs.log(this.DEBUG_ID,"_setStyleSheet executing callback."),b=!0,a())}.bind(this))},_templateToHTML:function(a){function b(a){var g="";return f(a).each(function(a){a&&("CLOSED_CAPTION_BTN"!==a.el&&"SETTINGS_BTN"!==a.el||!e)&&(a.cls=f.isUndefined(a.cls)?c(a.el):[a.cls,c(a.el)].join(" "),a.children&&(a.children=b(a.children)),g+=f.template(d[a.type],{variable:"o"})(a))}),g}if(f.isArray(a)&&!f.isEmpty(a)){var c=function(a){return this._getClassName(this.css[a]||a)}.bind(this),d=JSON.parse(JSON.stringify(this._template))||{button:'<button class="${ o.cls }" data-target="${ o.target }" aria-label="${ o.label }">${ o.label }</button>\n',div:'<div class="${ o.cls }">${ o.children }</div>\n',span:'<span class="${ o.cls }">${ o.text }</span>\n',menu:'<button class="${ o.cls }" data-property="${ o.property }" data-value="${ o.value }" data-selected="${ o.selected }">${ o.label }</button>\n',range:'<input type="range" value="${ o.value }" min="0" max="1" step="${ o.step }" class="${ o.cls }" />\n',progress:'<progress class="${ o.cls }" value="${ o.value }" max="1" step="${ o.step }"></progress>\n'},e=this._isIOS;return b(a)}},_getCaptionsStyle:function(){return this.vci.getCaptionsStyle()},_isTap:function(a){return!!this._touchStartTime&&a-this._touchStartTime<this.TAP_THRESHOLD}}),c=function(a,b){return!f.isNull(a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)")))},b=function(a,b){c(a,b)||(a.className=(a.className+=" "+b).trim())},d=function(a,b){a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," ").trim()},e=function(a,e){if(c(a,e))return void d(a,e);b(a,e)}}(uvpjs.register("uvpjs")),function(a){var b=a._;a.AdPlaylistManager=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.RESOURCE_PROVIDER,PRE:"pre",MID:"mid",MID_:"mid_",POST:"post",init:function(){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager init"),this.vidContId="",this.midRollPods=null,this.adPods={}},initialize:function(a,c,d,e){if(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize vidContId    = ",a),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize adStartTimes = ",c),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager initialize imaCuePoints = ",d)),!b.isArray(c))return void(this.debug&&uvpjs.warn("AdPlaylistManager initialize  !_.isArray(adStartTimes) RETURN"));this.vidContId=a,this._generateAdPods(c,d,e)},_generateAdPods:function(a,b,c){var d,e,f,g=b.length,h=function(a,b,c){return{hasBeenChecked:!1,startTime:c||0,hasPlayed:!1,adPodId:a,adCount:0,podDuration:0,adCallURL:b}};for(this.debug&&(uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods adStartTimes = ",a),uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods imaCuePoints = ",b)),this.adPods={},g>0&&(b.indexOf(0)>-1&&(this.adPods[this.PRE]=h(this.PRE+"_0",c)),b.indexOf(-1)>-1&&(this.adPods[this.POST]=h(this.POST+"_0",c))),d=0;d<g;d++)e=0===b[0]?d:d+1,f=b[d],isNaN(f)||0===f||-1===f||(this.adPods[this.MID_+e]=h(this.MID_+e,c,f));this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager _generateAdPods this.adPods = ",this.adPods)},getAdPodById:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById      adPodId = ",a),b.isString(a)){var c=this.adPods[a];return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPodById RETURN adPod = ",c),c}},getAdPods:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getAdPods",this.adPods),this.adPods},getNumberOfPods:function(){var a=Object.keys(this.adPods).length;return this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager getNumberOfPods",a),a},getMidRollPods:function(){var a,b=[];if(!this.midRollPods){b=[];for(a in this.adPods)a.indexOf(this.MID)>=0&&b.push(this.adPods[a]);this.midRollPods=b}return this.midRollPods},isPreRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.PRE)>-1},isMidRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.MID)>-1},isPostRoll:function(a){return!b.isUndefined(a.adPodId)&&a.adPodId.indexOf(this.POST)>-1},hasMidRoll:function(){for(var a in this.adPods)if(a.indexOf(this.MID)>-1)return!0;return!1},hasPostRoll:function(){return this.adPods.hasOwnProperty(this.POST)},returnPrecedingUnplayedAdPod:function(a){var b,c,d,e=null,f="No eligible ad pod found.";for(d in this.adPods)this.adPods.hasOwnProperty(d)&&(b=this.adPods[d],this.isPreRoll(b)||this.isPostRoll(b)||b.startTime<=a&&(e?a-b.startTime<a-e.startTime&&(e=b):e=b));return e&&(c=e.hasPlayed?"has played, returning null.":"not yet played - returning found pod.",f="Found Ad pod; adPodId = "+e.adPodId+"; "+c),this.debug&&uvpjs.log(this.DEBUG_ID,"AdPlaylistManager returnPreceedingUnplayedAdPod() for absSeekTime: "+a+";  "+f),e}})}(uvpjs.register("uvpjs")),function(a){var b,c=a._;a.TrackingManager=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,PLAYER_NAME:uvpjs.Configuration.name+"_"+uvpjs.Configuration.version,PLAYER_NAME_ONLY:uvpjs.Configuration.name,PLAYER_VERSION_ONLY:uvpjs.Configuration.version,ADOBE_HEARTBEAT_MODULE_NAME:"SiteCatalyst",COMSCORE_SS_MODULE_NAME:"ComScore_ss",CONVIVA_MODULE_NAME:"ConvivaQOSPluginJS",DW_MODULE_NAME:"DWTracking",LEGACY_DW_MODULE_NAME:"CNetTracking",NIELSEN_MODULE_NAME:"NielsenTracking_SDK",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",MUX_MODULE_NAME:"MuxQOSPluginJS",CONCURRENCY_BEACON_MODULE_NAME:"Beacon",OZTAM_MODULE_NAME:"OzTam",DATAZOOM_MODULE_NAME:"Datazoom",DEFAULT_SITEID:"17",PLATFORM_CMS:"platform",LUMIERE_CMS:"lumiere",PI_CMS:"pi",ZDNET_CMS:"zdnet",CONCURRENCY_BEACON_SITE_ID:164,CONCURRENCY_BEACON_USER_ID:-1,progressEvents:{FIRST_QUARTILE:"firstQuartile",MID_QUARTILE:"midQuartile",THIRD_QUARTILE:"thirdQuartile",TIMED:"timed"},agentConfigs:[],beaconEndPoint:{},_hasAgentInit:!1,init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"init"),this.eventCBs={},this.vidContId=null,this.eventsMgr=null,this.cviModel=null,this.internalNS=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this.componentid="",this._lastContentSecondCompleted=0,this.resourceStartTime=0,this.contextMetadata={},this._contentLength=0,this._adLength=0,this._beaconElement=!1,this.agents=[],this.mc=uvpjs.mediaCapabilities,a&&this.initialize(a.vidContId,a.cviMgr)},destroy:function(){for(var a,b=this.agents.length;b--;)this.agents[b]&&"function"==typeof this.agents[b].destroy&&this.agents[b].destroy(),this.agents.splice(b,1);for(a in this.eventCBs)this.eventsMgr.removeEventListener(a+this.internalNS+".agent"),delete this.eventsMgr[a];for(a in this.progressEvents)delete this.progressEvents[a];this._removeTrackingEventListeners(),this.eventsMgr=null,this.cviModel=null,this.mc=null,this.agents=null,this.eventCBs=null,this.progressEvents=null,this.contextMetadata=null,this._beaconElement=null,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0,this._contentLength=0,this._adLength=0},initialize:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"initialize"),c.isString(a)&&c.isObject(b)&&(this.vidContId=a,this.eventsMgr=b.getEventsMgr(),this.cviModel=b.getModelRef(),this.internalNS="."+this.vidContId+".trackingMgr",this.componentid=this.cviModel.sessionId,this._beaconElement=document.createElement("div"),this._beaconElement.id="uvpjs-tracking-"+(new Date).getTime(),document.getElementsByTagName("body")[0].appendChild(this._beaconElement),this._addTrackingEventListeners())},hasTrackingConfigOverrides:function(a){return null!==a&&a.hasOwnProperty("trackingConfigOverrides")&&null!==a.trackingConfigOverrides},getAgentConfig:function(a,b){for(var c=null,d=a.length;d-- >0;){var e=a[d];if(e.name===b){c=e;break}}return c},_overrideUvpc:function(){var a=this.cviModel;if(!this.hasTrackingConfigOverrides(a))return void(this.agentConfigs=a.getModules().slice(0));for(var b=a.getModules().slice(0),c=b.length;c-- >0;){var d=b[c],e=this.getAgentConfig(a.trackingConfigOverrides,d.name);null!==e&&(b[c]=e)}this.agentConfigs=b},isTrackingAgentEnabled:function(a){var b,c=this.getAgentConfig(this.agentConfigs,a),d=this.mc.systemInfo.trackingAvailability,e=!1;for(b in uvpjs.tracking)if(uvpjs.tracking[b]===a&&d[b]){e=!0;break}return this.debug&&c&&c.enabled&&!e&&uvpjs.warn(this.DEBUG_ID,"Agent enabled in the config but sdk did not load",c,d),null!==c&&c.enabled&&e},_createAgentsArray:function(a){var b,c,d,e,f,g,h;if(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray"),c=a||this.cviModel,this.debug&&uvpjs.log(this.DEBUG_ID,"agentConfigs",this.agentConfigs),e=c.isModuleEnabled.bind(c),f=c.isModuleSet.bind(c),h=this.getPlayerName(),d={trackingMgr:this,cviModel:this.cviModel,eventsMgr:this.eventsMgr,playerName:h,playerVersion:this.PLAYER_VERSION_ONLY},this.isTrackingAgentEnabled(this.ADOBE_HEARTBEAT_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AdobeHeartbeatAgent"),d.moduleName=this.ADOBE_HEARTBEAT_MODULE_NAME,b=new uvpjs.AdobeHeartbeatAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.AKAMAI_ANALYTICS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray AkamaiAnalyticsAgent"),d.moduleName=this.AKAMAI_ANALYTICS_MODULE_NAME,b=new uvpjs.AkamaiAnalyticsAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.COMSCORE_SS_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ComScoreAgent"),d.moduleName=this.COMSCORE_SS_MODULE_NAME,d.playerName=this.getPlayerName("|","_"),b=new uvpjs.ComScoreAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.CONVIVA_MODULE_NAME)&&(null!=this.cviModel&&this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray ConvivaAgent"),d.moduleName=this.CONVIVA_MODULE_NAME,b=new uvpjs.ConvivaAgent(d),this.agents.push(b)),g=e(this.DW_MODULE_NAME),(g||e(this.LEGACY_DW_MODULE_NAME))&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray DWAgent"),d.moduleName=g?this.DW_MODULE_NAME:this.LEGACY_DW_MODULE_NAME,d.playerName=this.getPlayerName(";"),b=new uvpjs.DWAgent(d),this.agents.push(b)),this.isTrackingAgentEnabled(this.NIELSEN_MODULE_NAME)&&(this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray NielsenAgent"),d.moduleName=this.NIELSEN_MODULE_NAME,b=new uvpjs.NielsenAgent(d),this.agents.push(b)),f(this.MUX_MODULE_NAME)&&!this.isTrackingAgentEnabled(this.MUX_MODULE_NAME))this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent. Mux Disabled in UVPC");else{this.debug&&uvpjs.log(this.DEBUG_ID,"_createAgentsArray MuxAgent");var i=this.cviModel.getModuleParam.bind(this.cviModel,this.MUX_MODULE_NAME);d.moduleName=this.MUX_MODULE_NAME,d.playerName=this.PLAYER_NAME_ONLY,d.playerVersion=this.PLAYER_VERSION_ONLY,d.useDefaultProperty=!i("propertyKey"),b=new uvpjs.MuxAgent(d),this.agents.push(b)}var j=this.getAgentConfig(this.agentConfigs,this.CONCURRENCY_BEACON_MODULE_NAME);if(j&&j.params&&j.params.length>0)for(var k=j.params.length;k-- >0;)this.beaconEndPoint[j.params[k].name]=j.params[k].value;this.isTrackingAgentEnabled(this.OZTAM_MODULE_NAME)&&(d.moduleName=this.OZTAM_MODULE_NAME,b=new uvpjs.OzTamAgent(d),this.agents.push(b));var l=this.getAgentConfig(this.agentConfigs,this.DATAZOOM_MODULE_NAME);l&&l.enabled&&(d.moduleName=this.DATAZOOM_MODULE_NAME,b=new uvpjs.DatazoomAgent(d),this.agents.push(b))},_addTrackingEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS;a.addEventListener(b.CONTEXT_METADATA+c,this._onContextMetadata.bind(this)),a.addEventListener(b.VIDEO_STATE_CHANGE+c,this._onVideoStateChange.bind(this)),a.addEventListener(b.VIDEO_PROGRESS+c,this._onVideoProgress.bind(this)),a.addEventListener(b.RESOURCE_START+c,this._onResourceStart.bind(this)),a.addEventListener(b.PLAYBACK_DURATION_RESUME+c,this._onPlaybackDurationResume.bind(this))},_removeTrackingEventListeners:function(){var a=this.eventsMgr,b=a.eventTypes,c=this.internalNS;a.removeEventListener(b.VIDEO_PROGRESS+c),a.removeEventListener(b.AD_QUARTILE+c),a.removeEventListener(b.RESOURCE_START+c)},_initializeAgents:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"_initializeAgents",this.agents),c.isEmpty(this.agents))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"loadAgentPlugins no tracking agents enabled."));for(var a=this.agents.length;a--;)this.agents[a].initialize();this._addAgentEventListeners()},fireTrackingPixel:function(a){var b=document.createElement("img");b.setAttribute("src",a),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("border","0"),b.style.position="absolute",b.style.bottom="0",b.style.right="0",this._beaconElement.appendChild(b)},registerEventCallbacks:function(a){if(c.isPlainObject(a)&&!c.isEmpty(a))for(var b in a)this.eventCBs[b]=this.eventCBs[b]||[],this.eventCBs[b].push(a[b])},registerProgressEvents:function(a){if(c.isPlainObject(a)&&!c.isEmpty(a))for(var b in a)this.debug&&uvpjs.log(this.DEBUG_ID,"registerEventCallbacks progressEvent",b),this.progressEvents[b]=this.progressEvents[b]||[],this.progressEvents[b].push(a[b])},getContentPlayhead:function(){var a=this.cviModel.contentPlaybackState.currentTime;return parseInt(a)},getPlayerName:function(a,b){var d=this.PLAYER_NAME;return c.isEmpty(d)?"UVPJS":(a&&(d=d.replace("_",a)),b&&(d=d.replace(/\./g,b)),d)},getAdLength:function(){return this._adLength=b(this._adLength,this.cviModel.adVideoState.duration),this._adLength},getContentLength:function(){return this._contentLength=b(this._contentLength,this.cviModel.contentVideoState.duration),this._contentLength},_addAgentEventListeners:function(){for(var a in this.eventCBs)this.eventsMgr.addEventListener(a+this.internalNS+".agent",this._onTrackingEvent.bind(this))},_onTrackingEvent:function(a){if(a.target===this.vidContId){var b,d=this.eventCBs[a.type];if(!c.isEmpty(d)){b=d.length;for(var e=0;e<b;e++)d[e](a)}}},_onContextMetadata:function(a){this.contextMetadata=a.payload.contextMetadata},_onVideoStateChange:function(a){if(a.payload.newState===this.mc.LOADING&&!this._hasAgentInit){var b,c=this.cviModel.cviMgr.RPM.currRP,d=this.cviModel.cviMgr.RPM.rscProviders;c&&c.rco&&c.rco.uvpc?b=c.rco.uvpc:d&&d.length>0&&(b=d[0].rco.uvpc),b&&b.modules&&this.cviModel.copyModules(b.modules),this._overrideUvpc(),this._createAgentsArray(),this._initializeAgents(),this._hasAgentInit=!0}},_onResourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"_onResourceStart",a),this.resourceStartTime=new Date,this._contentFirstQFired=!1,this._contentMidFired=!1,this._contentThirdQFired=!1,this._contentTimeFired={},this._lastContentSecondCompleted=0},_onProgressEvent:function(a){var b,d=this.progressEvents[a];if(!c.isEmpty(d))for(b=d.length,i=0;i<b;i++)d[i]()},_onPlaybackDurationResume:function(b){var c=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),d=this.cviModel.getContentVideoState(),e={ts:Math.floor(Date.now()/1e3),contentid:d.cmsRefGuid,userid:this.cviModel.getSessionOption("userId")||this.CONCURRENCY_BEACON_USER_ID,siteid:c("siteid")||this.CONCURRENCY_BEACON_SITE_ID,sessionid:this.cviModel.sessionId,platform:this.mc.isDesktop()?"desktop":"mobile_web",premium:d.isPaidContent,affiliate:d.isAffiliateFeed,medtime:Math.round(this.cviModel.contentPlaybackState.currentTime)},f=(new a.BeaconBuilder).concurrencyBeacon(this.beaconEndPoint).queryParams(e).devMode(this.debug).buildUrl();this.fireTrackingPixel(f)},_onVideoProgress:function(a){var b,d=a.payload,e=Math.floor(d.currentTime),f=d.duration;if(e&&f&&!d.isAd&&!(this._lastContentSecondCompleted>=e)){if(this._lastContentSecondCompleted=e,e%15==0&&e<=60||e%60==0){if(this._contentTimeFired[e])return;this._contentTimeFired[e]=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress flooredTime",e),this._onProgressEvent(this.progressEvents.TIMED)}d.isPlayingLive||f<=10||(b=Math.floor(e/f*100),b!==this.percentDone&&(this.percentDone=b),c.inRange(b,25,50)&&!this._contentFirstQFired&&(this._contentFirstQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress FIRST_QUARTILE"),this._onProgressEvent(this.progressEvents.FIRST_QUARTILE)),c.inRange(b,50,75)&&!this._contentMidFired&&(this._contentMidFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress MID_QUARTILE"),this._onProgressEvent(this.progressEvents.MID_QUARTILE)),b>=75&&!this._contentThirdQFired&&(this._contentThirdQFired=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"_onVideoProgress THIRD_QUARTILE"),this._onProgressEvent(this.progressEvents.THIRD_QUARTILE)))}}}),b=function(a,b){var c=1e3,d=b>0?Math.floor(b*c):0;return uvpjs.util.inRange(a,d-c,d+c)?a:d}}(uvpjs.register("uvpjs")),function(a){a.TrackingAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,vo:null,sdkEvent:null,hasSdk:!1,hasResourceStart:!1,hasContentStart:!1,isPaused:!1,isBuffering:!1,isSeekDone:!1,trackQosEvent:!1,trackContentStartEvent:!1,contextMetadata:{},initTime:null,init:function(a){this.options=a,this.initTime=new Date,this.contextMetadata=a.trackingMgr.contextMetadata||{}},initialize:function(){var a=this.options.eventsMgr.eventTypes,b={};b[a.RESOURCE_START]=this.onResourceStart.bind(this),b[a.CONTENT_START]=this.onContentStart.bind(this),b[a.VIDEO_STATE_CHANGE]=this.onVideoStateChange.bind(this),b[a.CONTROL_SEEK]=this.onSeekStart.bind(this),b[a.SEEK_DONE]=this.onSeekDone.bind(this),b[a.RESOURCE_END]=this.onResourceEnd.bind(this),b[a.CONTEXT_METADATA]=this.onContextMetadata.bind(this),b[a.CDN_UPDATED]=this.onCdnUpdated.bind(this),b[a.AD_POD_START]=this.onAdPodStart.bind(this),b[a.AD_POD_END]=this.onAdPodEnd.bind(this),b[a.AD_START]=this.onAdStart.bind(this),b[a.AD_CLICK]=this.onAdClick.bind(this),b[a.AD_END]=this.onAdEnd.bind(this),b[a.VIDEO_TRANSITION_START]=this.onVideoTransition.bind(this),b[a.VIDEO_PROGRESS]=this.onVideoProgress.bind(this),b[a.USER_GESTURE]=this.onUserGesture.bind(this),b[a.FORCE_TRACK_SESSION_END]=this.onForceTrackSessionEnd.bind(this),this.options.trackingMgr.registerEventCallbacks(b),a=this.options.trackingMgr.progressEvents,b={},b[a.FIRST_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.FIRST_QUARTILE),b[a.MID_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.MID_QUARTILE),b[a.THIRD_QUARTILE]=this.onQuartileProgress.bind(this,this.sdkEvent.THIRD_QUARTILE),this.options.trackingMgr.registerProgressEvents(b)},onResourceStart:function(a){this.hasResourceStart||(this.sendTrackEvent(this.sdkEvent.SESSION_START,this.vo.getSessionStartInfo()),this.hasResourceStart=!0)},onContentStart:function(a){this.trackContentStartEvent=!0,this.hasContentStart&&this.isPaused&&(this.sendTrackEvent(this.sdkEvent.PLAY_RESUME),this.isPaused=!1)},onQuartileProgress:function(a){this.sendTrackEvent(a,this.vo.getQuartileInfo())},onVideoStateChange:function(a){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(a.payload.newState){case uvpjs.mediaCapabilities.PAUSED:this.isPaused||(this.isPaused=!0,this.sendTrackEvent(this.sdkEvent.PAUSE));break;case uvpjs.mediaCapabilities.BUFFERING:this.isBuffering||(this.isBuffering=!0,this.sendTrackEvent(this.sdkEvent.BUFFER_START));break;case uvpjs.mediaCapabilities.PLAYING:this.isPaused&&(this.isPaused=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME)),this.isBuffering&&(this.isBuffering=!1,this.sendTrackEvent(this.sdkEvent.BUFFER_COMPLETE),this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))}},onSeekStart:function(a){this.sendTrackEvent(this.sdkEvent.SEEK_START,this.vo.getSeekInfo())},onSeekDone:function(a){this.sendTrackEvent(this.sdkEvent.SEEK_COMPLETE,this.vo.getSeekInfo()),this.isSeekDone=!0},onResourceEnd:function(a){this.hasContentStart&&this.vo.isCompletedMarker()&&(this.sendTrackEvent(this.sdkEvent.CONTENT_COMPLETE,this.vo.getContentCompleteInfo()),this.sendTrackEvent(this.sdkEvent.SESSION_END),this.hasResourceStart=!1,this.hasContentStart=!1)},onContextMetadata:function(a){this.contextMetadata=a.payload.contextMetadata},onCdnUpdated:function(a){this.sendTrackEvent(this.sdkEvent.CDN_UPDATED,{cdn:a.payload.cdn})},onAdPodStart:function(a){this.sendTrackEvent(this.sdkEvent.AD_BREAK_START,this.vo.getAdBreakInfo())},onAdPodEnd:function(a){this.sendTrackEvent(this.sdkEvent.AD_BREAK_COMPLETE)},onAdStart:function(a){this.sendTrackEvent(this.sdkEvent.AD_START,this.vo.getAdItemInfo())},onAdClick:function(a){this.sendTrackEvent(this.sdkEvent.AD_CLICK)},onAdEnd:function(a){this.sendTrackEvent(this.sdkEvent.AD_COMPLETE)},onVideoTransition:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"bitrate",a.payload.bitrate),this.trackQosEvent=!0},onVideoProgress:function(a){this.trackQosEvent&&(this.trackQosEvent=!1,this.sendTrackEvent(this.sdkEvent.QOS,this.vo.getQosInfo())),this.trackContentStartEvent&&(this.trackContentStartEvent=!1,this.hasContentStart||(this.sendTrackEvent(this.sdkEvent.CONTENT_START,this.vo.getContentStartInfo()),this.hasContentStart=!0)),this.isSeekDone&&(this.isSeekDone=!1,this.sendTrackEvent(this.sdkEvent.PLAY_RESUME))},onUserGesture:function(a){a.payload.startTime>0&&(this.options.resumeTime=a.payload.startTime)},onForceTrackSessionEnd:function(a){this.onResourceEnd(a)},destroy:function(){this.vo.destroy(),this.DEBUG_ID=null,this.options=null,this.initTime=null,this.vo=null,this.contextMetadata=null}})}(uvpjs.register("uvpjs")),function(a){"use strict";var b,c,d,e,f,g;g=a._,a.AdobeHeartbeatAgent=uvpjs.Class.subClass({SDK_VERSION:"2.0.1",TEALIUM_SETUP_TIMEOUT:1e4,TEALIUM_RETRY_INTERVAL:100,scriptPaths:{APP_MEASUREMENT:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/AppMeasurement-2.3.0.min.js",HEARTBEAT:uvpjs.Configuration.hostname+uvpjs.Configuration.path+"lib/tracking/adobe/VideoHeartbeat-2.0.2.min.js"},ACCOUNT_PARAM_NAME:"account",BRAND_PARAM_NAME:"brand",CHAR_SET_PARAM_NAME:"charSet",CURRENCY_CODE_PARAM_NAME:"currencyCode",EDITION_PARAM_NAME:"edition",HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME:"heartbeatAdobePublisherId",HEARTBEAT_TRACKING_SERVER_PARAM_NAME:"heartbeatTrackingServer",HEARTBEAT_MKTNG_CLOUD_ORG_ID:"heartbeatVisitorMarketingCloudOrgId",PARTNER_ID_PARAM_NAME:"partnerID",SITE_CODE_PARAM_NAME:"siteCode",SITE_TYPE_PARAM_NAME:"siteType",TRACKING_SERVER_PARAM_NAME:"trackingServer",VISITOR_NAMESPACE_PARAM_NAME:"visitorNamespace",SEGMENT_OWNER_PARAM_NAME:"id3SegmentOwner",PAGE_REPORT_SUITE_ID_KEY:"sitePrimaryRsid",PAGE_SITE_ACCOUNT_KEY:"siteRsids",HEARTBEAT_AD_START:"AdStart",HEARTBEAT_AD_COMPLETE:"AdComplete",HEARTBEAT_AD_SKIP:"AdSkip",HEARTBEAT_AD_BREAK_START:"AdBreakStart",HEARTBEAT_AD_BREAK_COMPLETE:"AdBreakComplete",HEARTBEAT_BUFFER_START:"BufferStart",HEARTBEAT_BUFFER_COMPLETE:"BufferComplete",HEARTBEAT_CHAPTER_START:"ChapterStart",HEARTBEAT_CHAPTER_COMPLETE:"ChapterComplete",HEARTBEAT_PLAY:"Play",HEARTBEAT_PAUSE:"Pause",HEARTBEAT_COMPLETE:"Complete",HEARTBEAT_SEEK_START:"SeekStart",HEARTBEAT_SEEK_COMPLETE:"SeekComplete",HEARTBEAT_SESSION_START:"SessionStart",HEARTBEAT_SESSION_END:"SessionEnd",CLIPS:"clips",FULL_EPISODES:"fullepisodes",MOVIES:"movies",TRACKING_SERVER_SSL_PREFIX:"s",LIVE_CONTENT_LENGTH:86400,init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.LIB_DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_LIB,this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this._mediaHeartbeat=null,this._videoInfo=null,this._qosObject=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._mediaObject=null,this._adContextData=null,this._chapterCustomMetadata=null,this._getTealiumTimer=null,this._segmentOwner=null,this.mc=null,this._videoLoaded=!1,this._isBuffering=!1,this._adBreakStartSent=!1,this._initialPlaySent=!1,this._heartbeatDebug=!1,this._contextMetadataCBSetup=!1,this._seekPending=!1,this._contentStarted=!1,this._appMeasurementData={},this._heartbeatData={},this._visitorData={},this._contextMetadata=this.trackingMgr.contextMetadata||{},this._sessionMetadata={},this._s=null,this._usesTealium=!1,this._waitForTealium=!1,this.isPluginLoaded=!1,this.pluginLoadedCB=Function.prototype,this._startUpTime=0,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent init")},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this._playerName=null,this.mc=null,this._mediaHeartbeat=null,this._appMeasurementData=null,this._heartbeatData=null,this._visitorData=null,this._contextMetadata=null,this._sessionMetadata=null,this._adContextData=null,this._chapterCustomMetadata=null,this._mediaObject=null,this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._adObject=null,this._adBreakObject=null,this._chapterObject=null,this._segmentOwner=null,this._s=null,this._getTealiumTimer=null,this.pluginLoadedCB=Function.prototype},initialize:function(){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent initialize"),this.mc=uvpjs.mediaCapabilities,this._loadSessionOptions(),this._loadConfigData(),g.isUndefined(this._visitorData.marketingCloudOrgId))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent initialize no Adobe Marketing Cloud Org ID."));this.loadPlugin(this._initializePlugin.bind(this))},loadPlugin:function(a,b){var c;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin"),!g.isFunction(a))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin no callback supplied!"));c=b?b.sessionOptions:this.cviModel.sessionOptions,this.pluginLoadedCB=function(){this.isPluginLoaded=!0,a()}.bind(this),this._usesTealium=c.usesTealium;var d=[this.scriptPaths.APP_MEASUREMENT,this.scriptPaths.HEARTBEAT];if(this._usesTealium&&(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin not loading AppMeasurement script."),d=g.without(d,this.scriptPaths.APP_MEASUREMENT)),e()&&!this.isPluginLoaded)return this.codeLoader=new uvpjs.CodeLoader,void this.codeLoader.loadScript(d,this.pluginLoadedCB);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin plugin already loaded into the page"),this.pluginLoadedCB()},getVideoInfo:function(){return this._videoInfo},getAdBreakInfo:function(){return this._adBreakInfo},getAdInfo:function(){return this._adInfo},getChapterInfo:function(){return this._chapterInfo},getQoSInfo:function(){var a=this._qosObject;return b.createQoSObject(a.bitrate,a.startupTime,a.fps,a.droppedFrames)},getCurrentPlaybackTime:function(){return this._videoInfo?this._videoInfo.playhead:0},_loadConfigData:function(){var a=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),b=a(this.HEARTBEAT_TRACKING_SERVER_PARAM_NAME),c=a(this.TRACKING_SERVER_PARAM_NAME);this._segmentOwner=a(this.SEGMENT_OWNER_PARAM_NAME),this.mc.isSecure()&&(g.isString(c)&&0!==c.indexOf(this.TRACKING_SERVER_SSL_PREFIX)&&(c=this.TRACKING_SERVER_SSL_PREFIX+c),g.isString(b)&&(b=b.replace("heartbeats.omtrdc.net","newimagitasinc.hb.omtrdc.net"))),this._appMeasurementData={account:a(this.ACCOUNT_PARAM_NAME),charSet:a(this.CHAR_SET_PARAM_NAME),trackingServer:c},this._heartbeatData={publisher:a(this.HEARTBEAT_ADOBE_PUBLISHER_ID_PARAM_NAME),trackingServer:b},this._visitorData={marketingCloudOrgId:a(this.HEARTBEAT_MKTNG_CLOUD_ORG_ID),trackingServer:c},this._heartbeatDebug=uvpjs.DebugManager.isParamEnabled(this.LIB_DEBUG_ID),this.debug&&(uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._heartbeatData =",this._heartbeatData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._visitorData =",this._visitorData),uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadConfigData this._appMeasurementData =",this._appMeasurementData))},_loadSessionOptions:function(){var a=this.cviModel.sessionOptions;this._usesTealium=a.usesTealium;var b={ftag:"ftag",netwk:"Network"};g.each(b,function(b,c){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions",b,c);var d=a[c];g.isNull(d)||g.isUndefined(d)||g.isEmpty(d)||(this._sessionMetadata[b]=d)}.bind(this)),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _loadSessionOptions this._sessionMetadata",this._sessionMetadata)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setupEventCallbacks"),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.AD_POD_START]=this._onAdPodStart.bind(this),b[a.AD_POD_END]=this._onAdPodEnd.bind(this),b[a.AD_CLICK]=this._onAdClick.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.CONTROL_SEEK]=this._onControlSeek.bind(this),b[a.SEEK_DONE]=this._onSeekDone.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),b[a.VIDEO_PROGRESS]=this._updatePlayhead.bind(this),b[a.PLAYER_DATA_LOADED]=this._updateVideoInfo.bind(this),b[a.PLAYER_LOADED]=this._updateVideoInfo.bind(this),b[a.RESOURCE_START]=this._updateVideoInfo.bind(this),b[a.VIDEO_RESUME]=this._updateVideoInfo.bind(this),b[a.VIDEO_DONE]=this._updateVideoInfo.bind(this),b[a.VIDEO_CUEPOINT]=this._onVideoCuePoint.bind(this),this._contextMetadataCBSetup||(b[a.CONTEXT_METADATA]=this._onContextMetadata.bind(this)),this.trackingMgr.registerEventCallbacks(b)},_setupContextMetadataEventCallback:function(){var a={};a[this.eventsMgr.eventTypes.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(a),this._contextMetadataCBSetup=!0},_initializePlugin:function(){function a(a){this._agent=a}var h,i,j,k;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin"),e())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin AdobeHeartbeat SDK not properly loaded."));if(this._mediaHeartbeat)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent: plugin already initialized. No further page context metadata updates used."));if(b=ADB.va.MediaHeartbeat,c=ADB.va.MediaHeartbeatConfig,d=ADB.va.MediaHeartbeatDelegate,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent loadPlugin this._s, this._usesTealium, this._waitForTealium",this._s,this._usesTealium,this._waitForTealium),this._usesTealium&&!f(this._s)&&!this._waitForTealium)return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent: Tealium detected on the page."),void this._getTealium();if(this._usesTealium)i=this._s,this.debug&&uvpjs.log(this.DEBUG_ID,'AdobeHeartbeatAgent setting appMeasurement to Tealium "s" object.');else{if("undefined"==typeof Visitor)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed."));if("undefined"==typeof AppMeasurement)return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create AppMeasurement object. Adobe Heartbeat tracking setup failed."));if(h=this._appMeasurementData.account,g.isString(h)&&g.isEmpty(h))return this._setupContextMetadataEventCallback(),void(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: "account" param is an empty string. Waiting for API call to define "account" param and continue initiaization.'));try{try{this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent new Visitor"),k=new Visitor(this._visitorData.marketingCloudOrgId)}catch(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Visitor.getInstance",k),k=Visitor.getInstance(this._visitorData.marketingCloudOrgId)}}catch(a){this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Unable to create Visitor object. Adobe Heartbeat tracking setup failed.")}k.trackingServer=this._visitorData.trackingServer,k.setCustomerIDs({userId:{id:this._visitorData.dpid},puuid:{id:this._visitorData.dpuuid}}),i=new AppMeasurement(h),i.visitor=k,i.account=h,i.trackingServer=this._appMeasurementData.trackingServer,i.pageName=this._appMeasurementData.pageName,i.charSet=this._appMeasurementData.charSet,i.visitorID=this._appMeasurementData.visitorID}if(g.isNull(i))return void(this.debug&&uvpjs.error(this.DEBUG_ID,"AdobeHeartbeatAgent: Error while setting up AppMeasurement object. Adobe Heartbeat tracking setup failed."));j=new c,j.trackingServer=this._heartbeatData.trackingServer,j.playerName=this._playerName,j.channel=this._heartbeatData.channel,j.debugLogging=this._heartbeatDebug,j.appVersion=this.SDK_VERSION,j.ssl=this.mc.isSecure(),j.ovp="",this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _initializePlugin mediaConfig",j),g.extend(a.prototype,d.prototype),a.prototype.getCurrentPlaybackTime=function(){return this._agent.getCurrentPlaybackTime()},a.prototype.getQoSObject=function(){return this._agent.getQoSInfo()},this._mediaHeartbeat=new b(new a(this),j,i),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent this._mediaHeartbeat object created."),this._setupEventCallbacks(),this.cviModel.getCurrentPlaybackState().playbackStarted&&this._setVideoLoad()},_getTealium:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium."),f(this._s)||this._waitForTealium?void(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent Tealium already loaded.")):(this._getTealiumTimer||(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getTealium setting timeout."),this._getTealiumTimer=setTimeout(this._onTealiumTimeout.bind(this),this.TEALIUM_SETUP_TIMEOUT)),g.has(window,"s")&&f(window.s)?(this._s=window.s,this._waitForTealium=!0,void this._initializePlugin()):(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent "usesTealium" is "true", but no Tealium "s" object detected.',window.s),void setTimeout(this.loadPlugin.bind(this,this.pluginLoadedCB.bind(this)),this.TEALIUM_RETRY_INTERVAL)))},_onTealiumTimeout:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"_onTealiumTimeout."),this._waitForTealium||(this.debug&&uvpjs.error(this.DEBUG_ID,"Tealium wait-time expired. Failed to load Tealium from the page."),this._getTealiumTimer=null,this._waitForTealium=!0,this._initializePlugin())},_trackHeartbeatInfo:function(a,c){if(g.isNull(this._mediaHeartbeat))return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo no player plugin defined"));switch(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _trackHeartbeatInfo action =",a),a){case this.HEARTBEAT_SESSION_START:this._mediaHeartbeat.trackSessionStart(this._mediaObject,this._getContentVideoMetadata());break;case this.HEARTBEAT_SESSION_END:this._mediaHeartbeat.trackSessionEnd();break;case this.HEARTBEAT_PLAY:this._mediaHeartbeat.trackPlay();break;case this.HEARTBEAT_PAUSE:this._mediaHeartbeat.trackPause();break;case this.HEARTBEAT_COMPLETE:this._mediaHeartbeat.trackComplete();break;case this.HEARTBEAT_SEEK_START:this._mediaHeartbeat.trackEvent(b.Event.SeekStart);break;case this.HEARTBEAT_SEEK_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.SeekComplete);break;case this.HEARTBEAT_BUFFER_START:this._mediaHeartbeat.trackEvent(b.Event.BufferStart);break;case this.HEARTBEAT_BUFFER_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.BufferComplete);break;case this.HEARTBEAT_AD_BREAK_START:this._mediaHeartbeat.trackEvent(b.Event.AdBreakStart,this._adBreakObject);break;case this.HEARTBEAT_AD_BREAK_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.AdBreakComplete);break;case this.HEARTBEAT_AD_START:this._mediaHeartbeat.trackEvent(b.Event.AdStart,this._adObject,this._adContextData);break;case this.HEARTBEAT_AD_SKIP:this._mediaHeartbeat.trackEvent(b.Event.AdSkip);break;case this.HEARTBEAT_AD_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.AdComplete);break;case this.HEARTBEAT_CHAPTER_START:this._mediaHeartbeat.trackEvent(b.Event.ChapterStart,this._chapterObject,this._chapterCustomMetadata);break;case this.HEARTBEAT_CHAPTER_COMPLETE:this._mediaHeartbeat.trackEvent(b.Event.ChapterComplete);break;case this.HEARTBEAT_BITRATE_CHANGE:this._mediaHeartbeat.trackBitrateChange();break;case this.HEARTBEAT_VIDEO_PLAYER_ERROR:this._mediaHeartbeat.trackError(c)}},_getContentVideoMetadata:function(){var a,b,c=this.cviModel.getContentVideoState(),d=this._contextMetadata,e=this._sessionMetadata,f={};for(a in d)d.hasOwnProperty(a)&&(f[a]=d[a]);for(a in e)e.hasOwnProperty(a)&&(f[a]=e[a]);if(c.contextMetadata){b=c.contextMetadata;for(a in b)b.hasOwnProperty(a)&&(f[a]=b[a])}return f.tl=c.videoTitle,f.mediaAutoPlay=this.cviModel.isAutoplay.toString(),f.mediaMuted=this.cviModel.isMuteAtPlayStart.toString(),f.mediaIsPaidContent=c.isPaidContent.toString(),this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getContentVideoMetadata metadata",f),f},_onContextMetadata:function(a){var b,c=a.payload.contextMetadata;if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata",a),!g.isEmpty(c)&&(this._contextMetadata=c,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContextMetadata this._contextMetadata",this._contextMetadata),g.isEmpty(c[this.PAGE_REPORT_SUITE_ID_KEY]),b=c[this.PAGE_SITE_ACCOUNT_KEY],!g.isEmpty(b))){var d=g.isEmpty(this._appMeasurementData.account);this._appMeasurementData.account=b,d&&(this.debug&&uvpjs.warn(this.DEBUG_ID,'AdobeHeartbeatAgent: No "account" specified in config. Attempting to reinitialize plugin with "account" = '+b),this._initializePlugin())}},_setVideoLoad:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _setVideoLoad",this._mediaHeartbeat,this._startUpTime),this._updateVideoInfo(),this._videoLoaded=!0,this._qosObject={droppedFrames:0,startupTime:this._startUpTime,fps:0,bitrate:0},this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_START)},_setChapterInfo:function(a){var c,d,e,f,g,h=a.chapterStartTimes,i=h&&h.length||0,j=parseInt(a.currentContentSegment);this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",a),isNaN(j)&&(j=1),c=j<0?0:j-1,d=c<=0?0:h[c],e=c+1>i?a.duration:h[c+1],g=e-d,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter",e,d),f={},f.name="",f.length=isNaN(g)?0:g,f.position=j,f.startTime=h[c],this._chapterObject=b.createChapterObject(f.name,f.position,f.length,f.startTime),this._chapterInfo=f,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _getChapter this._chapterInfo",this._chapterInfo)},_onAdStart:function(a){var c,d,e,f,h,i;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdStart",a),i=a.payload.adData,h=i.adClipID.split("_"),f=h[0],"pre"===f?e=1:"mid"===f?e=parseInt(h[1])+1:"post"===f&&(e=this.cviModel.getNumberOfAdPods()),d={},d.name=g.isEmpty(i.adVideoTitle)?"na":i.adVideoTitle,d.position=e,d.playerName=this._playerName,d.startTime=this.getCurrentPlaybackTime(),c={},c.id=g.isEmpty(i.adVideoId)?g.isEmpty(i.adVatId)?"na":i.adVatId:i.adVideoId,c.name=d.name,c.length=i.duration,c.position=i.adPosition,this._adObject=b.createAdObject(c.name,c.id,c.position,c.length),this._adBreakObject=b.createAdBreakObject(d.name,d.position,d.startTime),this._adInfo=c,this._adBreakInfo=d,this._adContextData={},this._sendInitialPlay(),this._adBreakStartSent||(this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_START),this._adBreakStartSent=!0),this._trackHeartbeatInfo(this.HEARTBEAT_AD_START)},_onAdEnd:function(a){var b=this.HEARTBEAT_AD_COMPLETE;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdEnd"),this._trackHeartbeatInfo(b)},_onAdClick:function(a){var b=!0===a.payload.adData.paused;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPaused"),b&&this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onAdPodStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodStart"),this._adBreakStartSent=!1},_onAdPodEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onAdPodEnd"),this._adBreakStartSent&&this._trackHeartbeatInfo(this.HEARTBEAT_AD_BREAK_COMPLETE)},_onContentStart:function(a){var b=a.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onContentStart",b),this._contentStarted=!0,this._startUpTime=Math.abs(new Date-this.trackingMgr.resourceStartTime)/1e3,this._sendInitialPlay(),b.chapterStartTimes.length>0&&(this._setChapterInfo(b),this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_START))},_onContentEnd:function(a){var b=a.payload.contentData;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ContentEnd",b),this._seekPending=!1,this._videoLoaded&&this._chapterInfo&&b.chapterStartTimes.length>0&&(this._chapterInfo=null,this._trackHeartbeatInfo(this.HEARTBEAT_CHAPTER_COMPLETE))},_onResourceEnd:function(a){var b=this._videoInfo,c=this._contentStarted&&b&&Math.ceil(b.playhead)>=.95*b.length,d=this.cviModel.getContentVideoState().isLive;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent; ResourceEnd; completed ? ",c),this._videoInfo=null,this._adBreakInfo=null,this._adInfo=null,this._chapterInfo=null,this._initialPlaySent=!1,this._qosObject={droppedFrames:0,startupTime:0,fps:0,bitrate:0},this._videoLoaded&&(this._videoLoaded=!1,this._seekPending=!1,!d&&c&&this._trackHeartbeatInfo(this.HEARTBEAT_COMPLETE),this._contentStarted=!1,this._trackHeartbeatInfo(this.HEARTBEAT_SESSION_END))},_onControlPlay:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPlay"),this._seekPending||this._trackHeartbeatInfo(this.HEARTBEAT_PLAY)},_onControlPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlPause"),this._trackHeartbeatInfo(this.HEARTBEAT_PAUSE)},_onControlSeek:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onControlSeek"),this._seekPending||(this._seekPending=!0,this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_START))},_onSeekDone:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onSeekDone"),this._seekPending&&this._trackHeartbeatInfo(this.HEARTBEAT_SEEK_COMPLETE),this._seekPending=!1},_onVideoStateChange:function(a){var b=a.payload.newState,c=this.mc.isMobile()&&this.mc.isIOS()&&this.cviModel.isFullscreen;this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoStateChange",b),this._videoLoaded&&(this._isBuffering||b!==this.mc.BUFFERING?this._isBuffering&&b!==this.mc.BUFFERING&&(this._isBuffering=!1,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_COMPLETE)):(this._isBuffering=!0,this._trackHeartbeatInfo(this.HEARTBEAT_BUFFER_START)),b===this.mc.PLAYING&&this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),c&&b===this.mc.PAUSED&&this._onControlPause(a))},_updateVideoInfo:function(){var a,c=this.cviModel.getCurrentPlaybackState(),d=this.cviModel.getContentVideoState(),e=b.StreamType,f=d.duration,h=d.isLive,i=d.episodeFlag,j={};g.isEmpty(d.cmsRefGuid)?g.isEmpty(d.mediaId)?g.isEmpty(d.pid)?g.isEmpty(d.assetURL)?j.id="na":j.id=d.assetURL:j.id=d.pid:j.id=d.mediaId:j.id=d.cmsRefGuid,j.name=d.videoTitle,j.playerName=this._playerName,j.length=h?this.LIVE_CONTENT_LENGTH:isNaN(f)?0:f,j.playhead=c.currentTime,h?a=e.LIVE:(a=e.VOD,a+=":"+(i?this.FULL_EPISODES:this.CLIPS)),j.streamType=a,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo MediaHeartbeat",b),this._mediaObject=b.createMediaObject(j.name,j.id,j.length,j.streamType),this._videoInfo=j,this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _updateVideoInfo this._videoInfo",this._videoInfo)},_updateQosObj:function(a){var b=a&&a.facadeState,c=this._qosObject;b&&c&&(c.bitrate=b.currentBitrate||0,c.droppedFrames=b.droppedFrames||0,c.fps=b.playbackFramerate||0)},_updatePlayhead:function(a){var b=a.payload;this._videoInfo&&b&&(b.isAd||(this._updateQosObj(b),this._videoInfo.playhead=b.currentTime))},_sendInitialPlay:function(){!this._videoLoaded&&this._setVideoLoad(),this._initialPlaySent||(this._trackHeartbeatInfo(this.HEARTBEAT_PLAY),this._initialPlaySent=!0)},_onVideoCuePoint:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _onVideoCuePoint",a),this._isSegmentOwner(a.payload)){var b=a.payload.data;b=b.split("|"),b.length>0&&this._segmentStart({segmentId:b[0],segmentTitle:b[1]})}},_segmentStart:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _segmentStart",a),a.segmentId){this._mediaHeartbeat.trackComplete(),this._mediaHeartbeat.trackSessionEnd(),this._mediaObject.data["a.videoId"]=a.segmentId,this._mediaObject.data["a.name"]=a.segmentTitle;var b=this._getContentVideoMetadata();b.tl=a.segmentTitle,this._mediaHeartbeat.trackSessionStart(this._mediaObject,b),this._mediaHeartbeat.trackPlay()}},_isSegmentOwner:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"AdobeHeartbeatAgent _isOwner",this._segmentOwner),a.data&&a.data.indexOf("|")>-1&&a.name===this._segmentOwner}}),e=function(){return"undefined"==typeof ADB||"undefined"===g.get(ADB,"va.Heartbeat")},f=function(a){return g.isObject(a)&&!g.isEmpty(a)&&g.isFunction(a.isReadyToTrack)}}(uvpjs.register("uvpjs")),function(a){var b,c=a._,d=function(a){return(a>0&&a<10?"0":"")+a.toString()},e="*null",f={publisherBrand:"ns_st_pu",programTitle:"ns_st_pr",episodeTitle:"ns_st_ep",seasonNumber:"ns_st_sn",episodeNumber:"ns_st_en",stationTitle:"ns_st_st",clipLength:"ns_st_cl",contentGenre:"ns_st_ge",tmsGracenoteId:"ns_st_ti",episodeId:"ns_st_tep",adLoadFlag:"ns_st_ia",fullEpisodeFlag:"ns_st_ce",digitalAirDate:"ns_st_ddt",tvAirDate:"ns_st_tdt"};a.ComScoreAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,_shouldTrackPlayStart:!1,_comScoreConfig:null,_contentMetadata:null,_adMetadata:null,_adType:null,_contentType:null,_liveSegmentData:null,init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent init"),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this.streamingTag=null,this._isAd=!1,this._mc=null},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._isAd=!1,this._comScoreConfig=null,this._contentMetadata=null,this._adMetadata=null,this._adType=null,this._contentType=null,this._mc=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent initialize"),this._mc=uvpjs.mediaCapabilities,this._loadConfigData(),this._initializePlugin()},_loadConfigData:function(){var a=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME);this._comScoreConfig={publisherId:a("c2")||"3005086",ns_st_pu:a("partnerID")||this.cviModel.sessionOptions.partner},this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _loadConfigData this",this)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.RESOURCE_START]=this._onResourceStart.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.LIVE_SEGMENT_START]=this._onLiveSegmentStart.bind(this),b[a.LIVE_SEGMENT_END]=this._onLiveSegmentEnd.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),b[a.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){if(b())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ComScoreAgent _initializePlugin comScore SDK not properly loaded."));this._setupEventCallbacks()},_createStreamingTag:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _createStreamingTag",a),this.streamingTag=new ns_.ReducedRequirementsStreamingAnalytics(a)},_getContentMetadata:function(){var a,b,c=this.cviModel.getContentVideoState(),g=(this.cviModel.getContentPlaybackState(),uvpjs.util),h=this.cviModel.getModuleParam.bind(this.cviModel,this.trackingMgr.COMSCORE_SS_MODULE_NAME),i=this.cviModel.getContentVideoState().isLive,j=parseInt(c.episodeNumber),k=parseInt(c.seasonNumber),l=(c.seriesTitle,c.videoTitle),m=l&&l.split("-")[1],n=!isNaN(j),o=!isNaN(k),p=null!==c.contextMetadata&&c.contextMetadata.comscore_c4,q=l;n&&o&&(a=d(j),b=d(k),q+="--"+b+a);var r={ns_st_ci:g.getDefinedString(c.cmsRefGuid,c.mediaId,"0"),ns_st_cl:i?0:this.trackingMgr.getContentLength(),ns_st_pu:this._comScoreConfig[f.publisherBrand],ns_st_pr:g.getDefinedString(c.seriesTitle,c.videoTitle),ns_st_ep:m,ns_st_sn:o&&b||e,ns_st_en:n&&a||e,ns_st_ge:c.category||e,ns_st_ia:i?1:0,ns_st_ddt:e,ns_st_tdt:e,ns_st_st:h("c4")||e,ns_st_ce:c.episodeFlag?1:0,c3:h("c3")||this._playerName,c4:p||h("c4")||e,c6:h("c6")||q};return["ns_st_ge","ns_st_st","ns_st_pu","ns_ap_an","ns_st_ddt","ns_st_tdt"].forEach(function(a){var b=h(a);b&&(r[a]=b)}),r},_onAdStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdStart",a),this._isAd=!0,this._adMetadata={ns_st_cl:this.trackingMgr.getAdLength()},this._adType=this._getAdType(),this._trackAdPlay()},_onAdEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onAdEnd",a),this._isAd=!1,this._trackStop()},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentStart",a);var b=ns_.ReducedRequirementsStreamingAnalytics.ContentType;this._contentType=this.cviModel.getContentVideoState().isLive?b.Live:b.LongFormOnDemand,this._contentMetadata=this._getContentMetadata(),this._isAd=!1,this._shouldTrackPlayStart=!0},_onContentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onContentEnd",a),this._trackStop()},_onControlPlay:function(a){return this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPlay",a),this.streamingTag?this._isAd?void this._trackAdPlay():void this._trackContentPlay():void(this.debug&&uvpjs.warn(this.DEBUG_ID,"Streaming tag not initialized"))},_onControlPause:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onControlPause"),this._trackStop()},_onResourceStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceStart",a),this._createStreamingTag(this._comScoreConfig)},_onResourceEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onResourceEnd",a),this.streamingTag=null},_onLiveSegmentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentStart",a),this._isLiveEvent(a)&&(this._shouldTrackPlayStart=!0,this._liveSegmentData=a.payload.liveSegmentData,this._trackStop(),null==this._contentMetadata||this._isSameLiveStation(this._liveSegmentData)||this._createStreamingTag(this._comScoreConfig))},_onLiveSegmentEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onLiveSegmentEnd",a),this._trackStop()},_onVideoProgress:function(a){this._shouldTrackPlayStart&&(this._trackContentPlay(),this._shouldTrackPlayStart=!1)},_onVideoStateChange:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _onVideoStateChange",a);var b=a.payload.newState;this._mc.isMobile()&&this._mc.isIOS()&&this.cviModel.isFullscreen&&(b===this._mc.PAUSED?this._onControlPause(a):b===this._mc.PLAYING&&this._onControlPlay(a))},_trackAdPlay:function(){this.streamingTag&&this.streamingTag.playVideoAdvertisement(this._adMetadata,this._adType)},_trackContentPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ComScoreAgent _trackContentPlay"),this._contentMetadata=a.util.copyObjectWithKeyMap(f).from(this._liveSegmentData).to(this._contentMetadata),this.streamingTag&&this.streamingTag.playVideoContentPart(this._contentMetadata,this._contentType)},_trackStop:function(){this.streamingTag&&this.streamingTag.stop()},_isLiveEvent:function(a){return this.cviModel.getContentVideoState().isLive&&a.payload&&a.payload.hasOwnProperty("liveSegmentData")&&"object"==typeof a.payload.liveSegmentData},_isSameLiveStation:function(a){return a.stationTitle===this._contentMetadata[f.stationTitle]},_getAdType:function(){var a,b=ns_.ReducedRequirementsStreamingAnalytics.AdType,c=this.cviModel.getAdVideoState().adClipID.split("_")[0];return a="pre"===c?b.LinearOnDemandPreRoll:"mid"===c?b.LinearOnDemandMidRoll:b.LinearOnDemandPostRoll,this.cviModel.getContentVideoState().isLive&&(a=b.LinearLive),a}}),b=function(){return"undefined"==typeof ns_||c.isUndefined(ns_.ReducedRequirementsStreamingAnalytics)}}(uvpjs.register("uvpjs")),function(a){"use strict";a.ConvivaAgent=uvpjs.Class.subClass({init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: construct",a),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.hasConvivaAdSession=!1,this.hasConvivaAdPaused=!1,this.convivaPlayerStateManager=null,this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.isSeekPending=!1,this.isSeekDone=!1,this.currAdPodInfo=null,this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventTypes=a.eventsMgr&&a.eventsMgr.eventTypes||null,this.moduleName=a.moduleName,this.playerName=a.playerName,this.moduleParams=null,this.defaultHeartbeatInterval=20,this.adPodInProgress=!1,this.startEvents={ad:0,content:0},this.podCount=0,this.adEventHandlerMap=null,this.contextMetadata=this.trackingMgr.contextMetadata||{}},destroy:function(){this.hasConvivaSession&&this._killConvivaSession(),this.convivaClient&&this.convivaClient.release(),this.convivaSystemFactory&&this.convivaSystemFactory.release(),this.convivaClient=null,this.convivaSystemFactory=null,this.convivaAdPlayerStateManager=null,this.convivaAdSessionKey=null,this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null,this.contextMetadata=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent initialize()"),this._gatherModuleParams(),this._initializePlugin()},_initializePlugin:function(){if(void 0===window.Conviva)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: Conviva SDK not properly loaded."));var a=this.eventTypes,b=this.adEventHandlerMap={};b[a.AD_POD_START]=this.hPodStart.bind(this),b[a.AD_POD_END]=this.hPodEnd.bind(this),b[a.AD_LOADED]=this.hAdLoaded.bind(this),b[a.AD_START]=this.hAdStart.bind(this),b[a.AD_END]=this.hAdEnd.bind(this),b[a.AD_ERROR]=this.hAdError.bind(this),b[a.AD_BUFFERING]=this.hAdBuffering.bind(this),this.cviModel&&(this.convivaClient=this._createConvivaClient(),null!==this.convivaClient&&(this._setupEventCallbacks(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: created Conviva client.")))},_getAdType:function(a){var b="string"==typeof a?a.toLowerCase():null,c=Conviva.Client.AdPosition,d=uvpjs.ConvivaAgent.adPositions;return b?b.indexOf(d.PRE)>=0?c.PREROLL:b.indexOf(d.MID)>=0?c.MIDROLL:b.indexOf(d.POST)>=0?c.POSTROLL:void 0:c.PREROLL},_getArgsForStartAd:function(a){var b=Conviva.Client.AdStream,c=Conviva.Client.AdPlayer,d="ima"==a.adServerName;return{key:this.convivaSessionKey,pos:this._getAdType(a.adType),stream:d?b.SEPARATE:b.CONTENT,player:d?c.SEPARATE:c.CONTENT}},_onAdEvent:function(a){var b=a.type;this.startEvents.content=0,this.hasConvivaSession||b===this.eventTypes.AD_ERROR||this._createConvivaSession(),this.adEventHandlerMap[b](a.payload,a)},hPodStart:function(a,b){this.podCount++,this._onContentPaused(b),this.currAdPodInfo=this._buildAdPodInfo(a.adPod),this.adPodInProgress=!0,this._sendCustomEvent("Conviva.PodStart",this.currAdPodInfo);var c=this._getArgsForStartAd(a);this.convivaClient.detachPlayer(this.convivaSessionKey),this.convivaClient.adStart(c.key,c.stream,c.player,c.pos),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad Start",c),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_START",this.currAdPodInfo)},hAdLoaded:function(a,b){var c=this._buildAdInfo(a);this.hasConvivaAdSession&&this._killConvivaAdSession(),this.convivaAdSessionKey=this.convivaClient.createAdSession(this.convivaSessionKey,c),this.convivaAdPlayerStateManager=this.convivaClient.getPlayerStateManager(),this._attachPlayerToAdSession(),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_LOADED, created Ad Session with key:",this.convivaAdSessionKey)},hAdStart:function(a,b){this.adPodInProgress&&this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.startEvents.ad=1,this.convivaAdPlayerStateManager.setBitrateKbps(this.cviModel.getAdVideoState().adBitrate),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING))},hAdEnd:function(a,b){this.startEvents.ad=0,this._killConvivaAdSession()},hPodEnd:function(a,b){var c=this.currAdPodInfo||{},d=this.convivaSessionKey;this.adPodInProgress=!1,uvpjs.util.isEmpty(d)||d===Conviva.Client.NO_SESSION_KEY?this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad end - no session key"):(this.convivaClient.adEnd(this.convivaSessionKey),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_END")),this._sendCustomEvent("Conviva.PodEnd",c),this.currAdPodInfo=null,this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_POD_END")},hAdError:function(a,b){var c=a.errorInfo;this.hasConvivaAdSession?(this._sendError(c.errorCode,Conviva.Client.ErrorSeverity.FATAL,!0),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: actionable ad error",c)):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: non-actionable ad error",c)},hAdBuffering:function(a,b){this.hasConvivaAdSession?(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent AD_BUFFERING")):this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Unable to call ad buffering - no session key")},_onContentEvent:function(a){var b=!1;this.startEvents.ad=0,a.type===this.eventTypes.CONTENT_DATA_LOADED?(this.startEvents.content&&this.hasConvivaSession&&this._killConvivaSession(),!this.hasConvivaSession&&this._createConvivaSession(),b=!0):a.type==this.eventTypes.CONTENT_START&&(this.startEvents.content=1,b=!0,this.hasContentStarted=!0,this._killConvivaAdSession()),b&&(this.adPodInProgress=!1,this.currAdPodInfo=null)},_onContentPaused:function(a){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED)},_onContentPlaying:function(a){this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING)},_onContentBuffering:function(a){!this.isSeekPending&&this._setConvivaPlayerState(Conviva.PlayerStateManager.PlayerState.BUFFERING)},_onControlSeek:function(a){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onControlSeek",a),this.convivaPlayerStateManager.setPlayerSeekStart(Math.floor(1e3*a.payload.seekTime))),this.isSeekPending=!0},_onSeekDone:function(a){this.isSeekPending&&this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onSeekDone",a),this.convivaPlayerStateManager.setPlayerSeekEnd()),this.isSeekPending=!1,this.isSeekDone=!0},_onVideoProgress:function(a){this.isSeekDone&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent play after seek",a),this._onContentPlaying(a),this.isSeekDone=!1)},_onVideoEvent:function(a){var b=this.eventTypes;switch(a.type){case b.VIDEO_STATE_CHANGE:var c=a.payload.newState,d=this._getMediaCapabilities();this.hasConvivaAdSession?c===d.PLAYING&&this.hasConvivaAdPaused?this._onAdResume(a):c===d.PAUSED&&this._onAdPaused(a):this.hasConvivaSession&&(c===d.PLAYING?this._onContentPlaying(a):c===d.PAUSED?this._onContentPaused(a):c===d.BUFFERING&&this.hasContentStarted&&this._onContentBuffering(a));break;case b.VIDEO_TRANSITION_COMPLETE:case b.VIDEO_DONE:this._onVideoTransition(a);break;case b.RESOURCE_END:this._killConvivaSession()}},_onCdnUpdated:function(a){var b=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY,c=new Conviva.ContentMetadata;c.defaultResource=this._validateStr(a.payload.cdn,""),this.convivaClient.updateContentMetadata(b,c)},_onError:function(a){var b=a.payload.errorInfo;b.isFatal?(!this.hasConvivaSession&&this._createConvivaSession(),this._sendError(b.errorCode,Conviva.Client.ErrorSeverity.FATAL,!1),this._killConvivaAdSession(),this._killConvivaSession()):this._sendError(b.errorCode,Conviva.Client.ErrorSeverity.WARNING,!1)},_attachPlayerToAdSession:function(){this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY?(this.convivaClient.attachPlayer(this.convivaAdSessionKey,this.convivaAdPlayerStateManager),this.hasConvivaAdSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent Ad session created; attaching player",this.convivaAdSessionKey)):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent AdSession creation failed"),this.hasConvivaAdSession=!1)},_onAdPaused:function(a){this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdPaused PAUSED"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PAUSED),this.hasConvivaAdPaused=!0)},_onAdResume:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onAdResume",a),this.hasConvivaAdSession&&this.convivaAdPlayerStateManager&&(this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.PLAYING),this.hasConvivaAdPaused=!1)},_onVideoTransition:function(a){var b=a.payload.bitrate;this.hasConvivaSession&&this.convivaPlayerStateManager&&(b>0&&(b*=.001),this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _onVideoTransition",b),this.convivaPlayerStateManager.setBitrateKbps(b))},_onContextMetadata:function(a){this.contextMetadata=a.payload.contextMetadata||{}},_createConvivaSession:function(){if(this.convivaClient){var a=this.cviModel,b=(this._getMediaCapabilities(),Conviva.PlayerStateManager.PlayerState,{userId:a.getSessionOption("userId"),userPPID:a.getSessionOption("userPPID"),userStatus:a.getSessionOption("userStatus")}),c=new Conviva.ContentMetadata;this._setContentMetadata(c,b),this.convivaSessionKey=this.convivaClient.createSession(c),this.convivaPlayerStateManager=this.convivaClient.getPlayerStateManager(),this.convivaClient.attachPlayer(this.convivaSessionKey,this.convivaPlayerStateManager),this.hasConvivaSession=!0,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session created")}},_killConvivaSession:function(){this.convivaClient&&this.hasConvivaSession&&(this.convivaPlayerStateManager&&(this.convivaPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaPlayerStateManager)),this.convivaPlayerStateManager=null,this.convivaClient.cleanupSession(this.convivaSessionKey),this.convivaSessionKey=null,this.hasConvivaSession=!1,this.hasContentStarted=!1,this.adPodInProgress=!1,this.currAdPodInfo=null,this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: Conviva session killed"))},_killConvivaAdSession:function(){this.hasConvivaAdSession&&this.convivaClient&&this.convivaAdSessionKey&&this.convivaAdSessionKey!==Conviva.Client.NO_SESSION_KEY&&this.convivaAdPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _killConvivaAdSession"),this.convivaAdPlayerStateManager.setPlayerState(Conviva.PlayerStateManager.PlayerState.STOPPED),this.convivaClient.releasePlayerStateManager(this.convivaAdPlayerStateManager),this.convivaClient.cleanupSession(this.convivaAdSessionKey),this.convivaAdPlayerStateManager=null,this.hasConvivaAdSession=!1)},_sendCustomEvent:function(a,b){var c=this.hasConvivaSession?this.convivaSessionKey:Conviva.Client.NO_SESSION_KEY;this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent: _sendCustomEvent",a,b),this.convivaClient&&this.convivaClient.sendCustomEvent(c,a,b)},_sendError:function(a,b,c){if(this.hasConvivaSession){var d="";a=uvpjs.mapErrorCode(a).toString(),!0===c?(d=" AD",this.convivaClient.reportError(this.convivaAdSessionKey,a,b)):this.convivaPlayerStateManager.sendError(a,b),this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent: sent"+d+" ERROR: "+a)}},_setConvivaPlayerState:function(a){this.hasConvivaSession&&this.convivaPlayerStateManager&&(this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _setConvivaPlayerState",a),this.convivaPlayerStateManager.setPlayerState(a))},_setContentMetadata:function(a,b){var c=this.cviModel,d=Conviva.ContentMetadata.StreamType,e=c.contentVideoState,f=e.defaultBitrate;a.applicationName=this.playerName,a.assetName=this._validateStr(e.videoTitle,"N/A"),a.defaultBitrateKbps=f&&f>0?f:700,a.defaultResource=this._validateStr(e.cdn,""),a.duration=e.duration,a.streamType=e.isLive?d.LIVE:d.VOD,a.streamUrl=this._validateStr(e.assetURL,"N/A"),a.viewerId=this._validateStr(b.userId,"N/A"),a.custom={accessType:this._validateStr(b.userStatus,"anon"),contentId:this._validateStr(e.cmsRefGuid,"N/A"),contentType:e.isLive?"Live":"VOD",isEpisode:e.episodeFlag?"true":"false",Partner_ID:this._validateStr(c.getSessionOption("partner"),"N/A"),Player_Version:uvpjs.Configuration.version,seriesTitle:this._validateStr(e.seriesTitle,"N/A"),winDimension:this._getWinDimension(),episodeTitle:this._getEpisodeTitle(e),appRegion:this._validateStr(c.sessionOptions.userCountry,"us"),app:uvpjs.Configuration.name,appVersion:uvpjs.Configuration.name+" "+uvpjs.Configuration.version,drm:e.drm.enabled.toString(),drmType:this.trackingMgr.mc.getDrmType(e.drm),showId:this.contextMetadata.showId&&this._validateStr(this.contextMetadata.showId.toString(),""),connectionType:this._validateStr(c.sessionOptions.userConnectionType,"unknown")}},_getEpisodeTitle:function(a){if(a.isLive)return a.videoTitle||a.episodeTitle;var b=this._validateStr(a.episodeTitle,a.videoTitle);return b.search(/\w+.*-.*\w+/)>-1&&(b=b.split("-")[1]),b.replace(/^\s+|\s+$/g,"")},_getWinDimension:function(){var a=this.cviModel.contentVideoState.sourceWidth,b=this.cviModel.contentVideoState.sourceHeight;return window&&window.screen&&(window.screen.width&&(a=window.screen.width),window.screen.height&&(b=window.screen.height)),a+"x"+b},_createConvivaClient:function(){var a=this._getConvivaClientSettings();return a?(this.convivaSystemFactory=this._createConvivaSystemFactory(),new Conviva.Client(a,this.convivaSystemFactory)):null},_getConvivaClientSettings:function(){var a,b=this.moduleParams;return this._isValidStr(b.customerKey)&&this._isValidStr(b.serviceUrl)?(a=new Conviva.ClientSettings(b.customerKey),a.heartbeatInterval=b.heartbeatInterval||this.defaultHeartbeatInterval,a.gatewayUrl=b.serviceUrl,a):(this.debug&&uvpjs.warn(this.DEBUG_ID,"ConvivaAgent could not create client: key and/or service url invalid."),null)},_setConvivaSystemProps:function(a){var b="development"===uvpjs.Configuration.env,c=Conviva.SystemSettings.LogLevel;a.allowUncaughtExceptions=b,a.logLevel=b?c.WARNING:c.NONE},_createConvivaSystemFactory:function(){var a=new Conviva.SystemInterface(new uvpjs.ConvivaHtml5Time,new uvpjs.ConvivaHtml5Timer,new uvpjs.ConvivaHtml5Http,new uvpjs.ConvivaHtml5Storage,new uvpjs.ConvivaHtml5Metadata,new uvpjs.ConvivaHtml5Logging),b=new Conviva.SystemSettings;return this._setConvivaSystemProps(b),new Conviva.SystemFactory(a,b)},_buildAdPodInfo:function(a){var b,c,d,e,f={};uvpjs.ConvivaAgent.adPositions;return a?(void 0!==a.podDuration&&(f.podDuration=String(a.podDuration)),a.adPodId?(b=a.adPodId.split("_"),c=b[0].toLowerCase(),d=c.charAt(0).toUpperCase()+c.slice(1),e=String(a.imaPodIndex+1),f.podPosition=d+"-roll",f.podIndex=this.podCount,f.absoluteIndex=e,f):f):null},_buildAdInfo:function(a){var b=new Conviva.ContentMetadata,c=a.adData,d=a.imaAdData||{},e=this.cviModel.getSessionOption("partner");if(!a)return null;b.adTitle="("+c.adVideoId+")"+c.adVideoTitle,b.assetName=b.adTitle,b.adClipId=this._validateStr(c.adClipID,"N/A"),b.Partner_ID=this._validateStr(e,"N/A"),b.adServerName=this._validateStr(c.adServerName,"N/A"),b.streamUrl=this._validateStr(c.adAssetUrl,"N/A"),b.duration=c.duration,b.streamType=Conviva.ContentMetadata.StreamType.VOD;var f=c.adType;return b.custom={"c3.ad.technology":"Client Side","c3.ad.id":d.adId||c.adVideoId,"c3.ad.system":d.adSystem||c.adServerName,"c3.ad.position":f.charAt(0).toUpperCase()+f.substr(1)+"roll","c3.ad.mediaFileApiFramework":d.apiFramework,"c3.ad.sequence":d.adPodInfo?d.adPodInfo.adPosition:c.adPosition,"c3.ad.creativeId":d.creativeId||c.creativeId,"c3.ad.advertiser":d.advertiserName},this.debug&&uvpjs.log(this.DEBUG_ID,"ConvivaAgent _buildAdInfo",b),b},_isValidStr:function(a){return uvpjs.util.isDefinedString(a)},_validateStr:function(a,b){return this._isValidStr(a)?a:b},_isDynamicStreaming:function(a){var b=a.split("?");return"mp4"===b[0].substr(b[0].lastIndexOf(".")+1)?"false":"true"},_getMediaCapabilities:function(){return uvpjs.mediaCapabilities},_gatherModuleParams:function(){for(var a,b=this.cviModel,c=b.getModule(this.moduleName),d=c.params,e=d.length,f={};e--;)a=d[e],f[a.name]=a.value;this.moduleParams=f},_setupEventCallbacks:function(){var a=this.eventTypes,b={},c=this._onAdEvent.bind(this),d=this._onContentEvent.bind(this),e=this._onVideoEvent.bind(this),f=this._onError.bind(this);b[a.AD_POD_START]=c,b[a.AD_LOADED]=c,b[a.AD_START]=c,b[a.AD_END]=c,b[a.AD_POD_END]=c,b[a.AD_ERROR]=c,b[a.AD_BUFFERING]=c,b[a.CONTENT_DATA_LOADED]=d,b[a.CONTENT_START]=d,b[a.CONTENT_END]=d,b[a.VIDEO_STATE_CHANGE]=e,b[a.VIDEO_TRANSITION_COMPLETE]=e,b[a.VIDEO_DONE]=e,b[a.RESOURCE_END]=e,b[a.PLAYER_START_ERROR]=f,b[a.VIDEO_START_ERROR]=f,b[a.VIDEO_PLAYBACK_ERROR]=f,b[a.CDN_UPDATED]=this._onCdnUpdated.bind(this),b[a.VIDEO_TRANSITION_START]=this._onVideoTransition.bind(this),b[a.CONTROL_SEEK]=this._onControlSeek.bind(this),b[a.SEEK_DONE]=this._onSeekDone.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),b[a.CONTEXT_METADATA]=this._onContextMetadata.bind(this),this.trackingMgr.registerEventCallbacks(b),window.addEventListener("beforeunload",function(){this.hasConvivaAdSession&&this._killConvivaAdSession(),this._killConvivaSession()}.bind(this),!1)}}),a.ConvivaAgent.adPositions={PRE:"pre",MID:"mid",POST:"post"}}(uvpjs.register("uvpjs")),function(a){"use strict";a.NielsenAgent=uvpjs.Class.subClass({debug:uvpjs.DebugManager.isEnabled,NIELSEN_APID_PARAM_NAME:"apid",NIELSEN_CLIENTID_PARAM_NAME:"clientid",NIELSEN_SFCODE_PARAM_NAME:"sfcode",NIELSEN_VCID_PARAM_NAME:"vcid",NIELSEN_CHANNEL_INFO_PARAM_NAME:"channelInfo",NIELSEN_CHANNEL_NAME_PARAM_NAME:"channelName",NIELSEN_IAG_SID_PARAM_NAME:"iag_sid",NIELSEN_IAG_TFID_PARAM_NAME:"iag_tfid",NIELSEN_NOL_DEV_DEBUG_PARAM_NAME:"nol_devDebug",NIELSEN_APN:"cbsdesktop",NIELSEN_DEFAULT_APID:"PF7B87067-BF4D-F80F-E040-070AAD316CE6",NIELSEN_LIVE_VIDEO_DURATION:86400,NIELSEN_VIDEO_CUEPOINT_NAME:"www.nielsen.com",events:{PLAY:5,STOP:7,END:57,LOAD_METADATA:15,SET_PLAYHEAD_POSITION:49,SEND_ID3:55},adType:{LINEAR:"1",DYNAMIC:"2"},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,"development"===uvpjs.Configuration.env&&this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent init",a),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this.pluginLoadedCB=Function.prototype,this._gg=null,this._nolggGlobalParams=null,this._metadata=null,this._lastAdSecond=null,this._lastContentSecond=null,this._numAdsInPod=null,this._adDisplayed=!1},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent initialize"),this._metadata={},this._initializeParams(),this._initializePlugin()},_initializeParams:function(){var a,b,c,d=this.cviModel,e=this._metadata,f=d.sessionOptions.partner,g=d.getModule(this._moduleName),h=g.params,i=h.length,j={};for(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams");i--;)a=h[i],""!==a.value&&(j[a.name]=a.value);switch(this._nolggGlobalParams={nsdkv:"511",apn:this._playerName,sfcode:j[this.NIELSEN_SFCODE_PARAM_NAME],apid:j[this.NIELSEN_APID_PARAM_NAME]||this.NIELSEN_DEFAULT_APID,nol_sdkDebug:j[this.NIELSEN_NOL_DEV_DEBUG_PARAM_NAME]},f){case"chow":b="us-700144",c="c06";break;case"tvcom":b="us-200330",c="c03";break;case"cbs":case"can":b="us-700144",c="c01";break;case"cbssports":case"cbssports_test":b="us-201669",c="c02";break;case"news":b="us-700144",c="c03";break;case"gamespot":b="us-200330",c="c13";break;case"cnettv":b="us-200330",c="c05";break;default:b="us-700144",c="c01"}e.ci=j.clientid||b,e.c6=j.vcid||c,e.iag_sid=j.iag_sid,e.iag_tfid=j.iag_tfid,e.channelName=j.channelName,e.segB=j.segB||"",this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _initializeParams params, metadata",j,e)},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_POD_START]=this._onAdPodStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),b[a.VIDEO_CUEPOINT]=this._onVideoCuepoint.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){if(b())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"NielsenAgent _initializePlugin Nielsen SDK not properly loaded."));window.NOLBUNDLE&&"function"==typeof window.NOLBUNDLE.nlsQ?this._gg=window.NOLBUNDLE.nlsQ(this._nolggGlobalParams.apid,"_gg"+(new Date).getTime()):(this._gg=window.NOLCMB.getInstance(),this._gg.ggInitialize(this._nolggGlobalParams)),this._setupEventCallbacks()},_notifySDK:function(a,b){this._isDisabled()||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent ggPM",a,b),this._gg.ggPM(a,b))},_onContentDataLoaded:function(a){var b,c,d,e,f,g,h,i,j=uvpjs.mediaCapabilities.isMobile(),k=this._metadata,l=a.payload;l&&(b=a.payload.vidState,d=b.chapterStartTimes.length>0?"lf":"sf",f=b.episodeNumber,g=b.seasonNumber,h=b.seriesTitle,i=b.videoTitle,c=b.duration,e=[i,g,f,d].join("|"),""===g&&(g="0"),""===f&&(f="0"),b.isAffiliateFeed&&(k.tv="true"),(b.isLive||-1===c)&&(c=this.NIELSEN_LIVE_VIDEO_DURATION),k.pc=k.ci+k.c6+k.cmsRefGuid,k.c10="plt,"+(j?"MBL":"DSK"),k.sd=c,k.dur=c,k.cg=h,k.tl=e,k.videotype="content",k.guid=b.cmsRefGuid,k.seriestitle=h,k.episodetitle=i,k.isfullepisode=b.episodeFlag?"y":"n",k.crossId1=b.mediaId,k.iag_pgm=i,k.iag_epi=e,k.iag_pd=location.hostname,k.iag_fp=d,k.iag_cte="na",k.iag_oad="na",k.iag_seg=1,this._metadata.adloadtype=b.isLive?this.adType.LINEAR:this.adType.DYNAMIC,this._isRcoTypeDai()&&(this._metadata.adloadtype=this.adType.DYNAMIC),this._metadata.adModel=this._metadata.adloadtype,this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentDataLoaded metadata",k))},_onAdStart:function(a){var b,c,d,e,f,g,h,i,j,k,l=this.cviModel.getContentVideoState(),m=a.payload;m&&(this._metadata.hasAds=1,this._adDisplayed=!0,k=uvpjs._.clone(this._metadata),b=m.adData,c=b.adClipID.split("_"),e=c[0],i=this.cviModel.getNumberOfAdPods(),j="post"===e?i:++c[1],d=["dav0",l.videoTitle,l.seasonNumber,l.episodeNumber].join("-"),h=[i,j,this._numAdsInPod,c[2]].join("_"),f=b.adVatId,g=b.adVideoUrl,""!==f&&(g+="|"+f),k.videotype=e+"roll",k.iag_cte=g,k.iag_pod=h,k.iag_apt="na",k.tl=d,k.c3="st,a","pre"===e&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart sending content metadata."),this._notifySDK(this.events.LOAD_METADATA,this._metadata)),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdStart adMetadata",k),this._lastAdSecond=0,this._notifySDK(this.events.SET_PLAYHEAD_POSITION,this._lastAdSecond),this._notifySDK(this.events.LOAD_METADATA,k))},_onAdPodStart:function(a){var b=a.payload;b&&(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdPodStart adCount",b.adPod.adCount),this._numAdsInPod=b.adPod.adCount)},_onAdEnd:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onAdEnd"),this._adDisplayed=!1,this._notifySDK(this.events.STOP,this._lastAdSecond)},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart"),this._adDisplayed=!1,this._metadata.hasAds=this._hasAds(),this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentStart this._metadata",this._metadata),this._notifySDK(this.events.LOAD_METADATA,this._metadata)},_onContentEnd:function(a){var b,c=a.payload;if(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onContentEnd"),c){if(this._metadata.iag_seg&&this._metadata.iag_seg++,b=a.payload.contentData,b.duration>0&&Math.abs(b.duration-this._lastContentSecond)<=5)return void this._notifySDK(this.events.END,this._lastContentSecond);this._notifySDK(this.events.STOP,this._lastContentSecond)}},_onControlPlay:function(a){this._adDisplayed||(this.debug&&uvpjs.log(this.DEBUG_ID,"NielsenAgent _onControlPlay"),this._notifySDK(this.events.PLAY,this._lastContentSecond))},_onVideoProgress:function(a){var b,c=a.payload;if(c&&!((b=Math.floor(c.currentTime))<0)){if(c.isAd){if(this._lastAdSecond===b)return;this._lastAdSecond=b}else{if(this._lastContentSecond===b)return;this._lastContentSecond=b}this._notifySDK(this.events.SET_PLAYHEAD_POSITION,b)}},_onVideoCuepoint:function(a){var b=a.payload,c=b.data;b.name===this.NIELSEN_VIDEO_CUEPOINT_NAME&&c&&"string"==typeof c&&this._notifySDK(this.events.SEND_ID3,c)},_hasAds:function(){var a=this.cviModel.getNumberOfAdPods();return-1===a?2:0===a?0:1},_isDisabled:function(){var a=this.cviModel.contentVideoState.excludeNielsenTracking;return"true"===a||!0===a},_isRcoTypeDai:function(){var b=this.cviModel.cviMgr.RPM.currRP;return!(void 0===b||null===b)&&b.rco.type===a.mediaCapabilities.RP_DAI}});var b=function(){return void 0===window.NOLCMB}}(uvpjs.register("uvpjs")),function(a){var b,c,d,e=a._;a.DWAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,LEGACY_DW_MODULE_NAME:"CNetTracking",DW_MODULE_NAME:"DWTracking",BASE_URL:"",RESUME_BEACON_URL:"",events:{INIT:"init",START:"start",END:"end",PLAY:"play",STOP:"stop",FORWARD:"forward",REWIND:"rewind",PAUSE:"pause",UNPAUSE:"unpause",FORCED_END:"forced_end",RESUME:"resume",BEACON:"beacon",PROMPT:"prompt",AD_BLOCK:"beam",AD_STUCK:"adstuck"},init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent init"),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this._playerName=a.playerName,this._gestval={},this._pauseStart=0,this._agentStartTime=0,this._onInitDone=!1,this._setStartTagsDone=!1,this._tags=this._getDefaultTagsObj(),this._pageParams=this._getDefaultPageParamsObj(),this.gestureInfoStr="",this.isPluginLoaded=!0},destroy:function(){this.trackingMgr=null,this.cviModel=null,this.eventsMgr=null,this._moduleName=null,this._playerName=null,this._tags=null,this._pageParams=null,this._onInitDone=!1,this._setStartTagsDone=!1,this.isPluginLoaded=!0,this.gestureInfoStr=null},initialize:function(){var a=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent initialize"),a.componentid=this.trackingMgr.componentid,a.device=this._getDevice(),a.mapp=this._playerName,a.part=this.cviModel.getSessionOption("partner"),a.playertime=0,a.siteid=this.trackingMgr.DEFAULT_SITEID,a.ts=this.eventsMgr.sessionStartTime,this._loadConfigParams(),this._loadDWPageParams(),this._setupEventCallbacks(),this._registerProgressEvents(),this._onInit()},_setCMSDependentValues:function(){var a=this.cviModel,b=a.getSessionOption("cms"),c=a.getContentVideoState(),d=a.getCurrentPlaybackState(),e=uvpjs.mediaCapabilities,f=this._tags.content,g=this._tags.ad,h=this.trackingMgr;g.adastid=b===h.PLATFORM_CMS?"43":"0",(uvpjs.util.isEmpty(f.medastid)||0===f.medastid||"0"===f.medastid)&&(c.isLive?c.isAffiliateFeed?f.medastid="cbsnews"===a.getSessionOption("playerId")?"601":"600":d.isHDStreamLive||e.isChromecast()?f.medastid="601":f.medastid="0":f.medastid=b===h.PLATFORM_CMS?"595":"0",this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setCMSDependentValues medastid, adastid",f.medastid,g.adastid))},_loadConfigParams:function(){for(var a,b,c,d=this.cviModel.getModuleParam.bind(this.cviModel,this._moduleName),f=["adastid","assetguid","edid","host","medastid","omnicookie","onid","pagetype","ptid","siteid","topic","topicbrcrm","viewguid"],g=f.length;g--;)b=f[g],a=this._getTagType(b),c=d(b),e.isUndefined(a)||e.isEmpty(c)||(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams key",b,c),this._tags[a][b]=c);this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadConfigParams this._tags updated",this._tags)},_loadDWPageParams:function(){var a,b,c,d=window.DW&&window.DW.pageParams||{};this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams");for(a in d)d.hasOwnProperty(a)&&(c=d[a],e.isEmpty(c)||(this._pageParams[a]=c,b=this._getTagType(a),e.isUndefined(b)||(this._tags[b][a]=c)));this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._tags updated",this._tags),uvpjs.log(this.DEBUG_ID,"DWAgent _loadDWPageParams this._pageParams updated",this._pageParams))},_setupEventCallbacks:function(){var a=this.eventsMgr.eventTypes,b={};b[a.AD_BLOCKED]=this._onAdBlocked.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.AD_QUARTILE]=this._onAdQuartile.bind(this),b[a.AD_ERROR]=this._onAdError.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.SEEK_DONE]=this._onSeekDone.bind(this),b[a.USER_GESTURE]=this._onUserGesture.bind(this),b[a.VIDEO_PROGRESS]=this._onVideoProgress.bind(this),this.trackingMgr.registerEventCallbacks(b),window&&(window.onbeforeunload=this._onContentStop.bind(this))},_registerProgressEvents:function(){var a=this.trackingMgr.progressEvents,b={};b[a.FIRST_QUARTILE]=this._onProgressEvent.bind(this,a.FIRST_QUARTILE),b[a.MID_QUARTILE]=this._onProgressEvent.bind(this,a.MID_QUARTILE),b[a.THIRD_QUARTILE]=this._onProgressEvent.bind(this,a.THIRD_QUARTILE),b[a.TIMED]=this._onProgressEvent.bind(this,a.TIMED),this.trackingMgr.registerProgressEvents(b)},_sendDWEvent:function(a){var b=this._tags.content,e=b.event,f=e===this.events.BEACON?this.RESUME_BEACON_URL:this.BASE_URL;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent"),b.gestval=uvpjs.util.isDefinedString(this.gestureInfoStr)?this.gestureInfoStr:d(this._gestval),e!==this.events.INIT&&(b.playertime=this._getPlayerTime()),b.ts=+new Date,f+=c(b),a&&(f+="&"+c(this._tags.ad)),this.trackingMgr.fireTrackingPixel(f),this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _sendDWEvent url = ",f),this._gestval={},b.gestval="",b.eventdur=0,this.gestureInfoStr=""},_onInit:function(){var a=window.location,b=uvpjs.mediaCapabilities,c=b.isMobile()?"mobile%20web":"desktop%20web",d=this.cviModel.getSessionOption("userStatus"),f=this.cviModel.getSessionOption("userId"),g=this._tags.content,h=this._pageParams;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onInit"),this._agentStartTime=new Date,g.event=this.events.INIT,g.mso=this.trackingMgr.mso,g.pageurl=a.href,g.srchost=a.host,g.ursuid=f,g.v16=h.viewguid,g.v17=h.topic,g.v18=h.topicbrcrm,g.v19=h.pagetype,g.v20=h.assetguid,g.v21=b.isChromecast()?"chromecast":c,g.v23=h.rsid,g.v25=e.isEmpty(d)?"anon":d,this._onInitDone=!0,this._sendDWEvent()},_onProgressEvent:function(a){var b=this.trackingMgr.progressEvents,c=this._tags.content,d=this._gestval;if(this._onInitDone&&this._setStartTagsDone){if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onProgressEvent progressEvt",a),a)switch(a){case b.FIRST_QUARTILE:d.pct=25;break;case b.MID_QUARTILE:d.pct=50;break;case b.THIRD_QUARTILE:d.pct=75}c.event=this.events.PLAY,this._sendDWEvent(),delete d.pct}},_onAdBlocked:function(a){this._tags.ad;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdBlocked",a),this._setCMSDependentValues(),this._setStartTags(a),this._updateTimeTags(),this._tags.content.event=this.events.AD_BLOCK,this._sendDWEvent(!0)},_onAdStart:function(a){var b=this._tags.ad,c=a.payload.adData,d=c.adClipID.split("_");this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdStart",a),this._setCMSDependentValues(),this._setStartTags(a),this._updateTimeTags(),b.adid=e.isEmpty(c.adVideoId)?"999":c.adVideoId,b.adnum=this.cviModel.adNum,b.adtime=0,b.adtitle=c.adVideoTitle,b.adtype=c.isLinear?1:2,b.adlength=Math.floor(this.trackingMgr.getAdLength()/1e3),b.adbreak="",b.adpos=d[0],b.adpod=d[1],b.adpodpos=d[2],this._sendDWEvent(!0)},_onAdQuartile:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdQuartile",a),this._tags.content.event=this.events.PLAY,this._tags.ad.adtime=this.cviModel.adPlaybackState.currentTime,this._sendDWEvent(!0)},_onAdEnd:function(a){var b=a.payload.adData;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdEnd",a),this._tags.content.event=this.events.END,this._tags.ad.adtime=b.duration,this._sendDWEvent(!0)},_onAdError:function(a){var b=a.payload.errorInfo.errorCode;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onAdError",a),b===uvpjs.ErrorInfo.errorCodes.STUCK_AD_ERROR&&(this._tags.content.event=this.events.AD_STUCK,this._sendDWEvent(!0))},_setStartTags:function(a){var b=this.cviModel,c=b.getContentVideoState(),d=this._tags.content,f=this._gestval;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _setStartTags",a),d.event=this.events.START,d.codec=c.fileType,d.distntwrk=b.getSessionOption("netwk"),d.playersz=this._getPlayerSize(),d.sdlvrytype=this._getStreamType(),d.v22=c.cmsRefGuid,d.medid=c.mediaId,d.medlength=this.trackingMgr.getContentLength()/1e3,d.mednum=b.medNum,d.medrls=c.pid,d.medtitle=c.videoTitle,d.contsessid=c.previousSessionId,e.isEmpty(c.contPlayState)||(f.autoplay=c.contPlayState),f.paywall=c.isPaidContent?"1":"0",f.caption_available=c.closedCaptionPath?"1":"0",this._setStartTagsDone=!0},_onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStart",a),this._setCMSDependentValues(),this._updateTimeTags(),this._setStartTags(a),this._sendDWEvent()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentEnd"),this._tags.content.event=this.events.END,this._sendDWEvent()},_onContentStop:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onContentStop"),this._tags.content.event=this.events.STOP,this._sendDWEvent()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPause"),this._tags.content.event=this.events.PAUSE,this._gestval.action="pause",this._pauseStart=(new Date).getTime(),this._sendDWEvent()},_onControlPlay:function(){var a=this._tags.content;this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onControlPlay"),!this._onInitDone||!this._setStartTagsDone||this._pauseStart<=0||(a.eventdur=Math.floor(((new Date).getTime()-this._pauseStart)/1e3),a.event=this.events.UNPAUSE,this._gestval.action="resume",this._pauseStart=0,this._sendDWEvent())},_onSeekDone:function(a){var b=a&&a.payload,c=b&&b.seekFromTime,d=b&&b.seekToTime,e=d-c,f=this._tags.content;f.eventdur=Math.floor(Math.abs(e)),f.event=e>0?this.events.FORWARD:this.events.REWIND,this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onSeekDone "+JSON.stringify({seekFromTime:c,seekToTime:d,seekDuration:e,event:f.event,eventdur:f.eventdur},null,2)),this._updateTimeTags(),this._sendDWEvent()},_onVideoProgress:function(){this._updateTimeTags()},_onUserGesture:function(a){var b,c,d,f,g,h,i,j=this._tags.content,k=this._gestval,l=a.payload.gestureInfo,m=this.cviModel.contentVideoState,n=m.elapsedTime,o="",p=uvpjs.Type.Gesture;if(this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture evtObj = ",a),"string"==typeof l&&-1===l.indexOf("event="))return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is a String and missing event=, RETURN.");if(e.isArray(l)){if(l.length<1)return void uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gestureInfo is an empty Array, RETURN.");o=l[0]}if(m=this.cviModel.contentVideoState,"string"==typeof l)f=/event=([^&]*)(?:&gestval=(.*))?/,g=f.exec(l),h=g[1],i=g[2],j.event=h,j.medtime=this.cviModel.contentPlaybackState.currentTime,this.gestureInfoStr=void 0===i?"":i;else if(o===p.GLOBAL_RESUME||o===p.LOCAL_RESUME)k.prevcomponentid=m.previousSessionId,k.eventdur=n>0?Math.round(n/1e3):0,k.paywall=m.isPaidContent?"1":"0",j.event=this.events.RESUME,j.medtime=m.resumeContentTime;else if(o===p.CONT_CANCEL)k.action=this.events.PROMPT;else switch(j.medtime=this.cviModel.contentPlaybackState.currentTime,o){case p.RELATED_OVERLAY:j.event=p.RELATED_OVERLAY;break;case p.RELATED_CLICK_GESTURE:l.length>=2&&(k.related_pid=l[1]),j.event=p.RELATED_CLICK_GESTURE;break;case p.SHARE_OVERLAY:j.event=p.SHARE_OVERLAY;break;case p.SHARE_NETWORK_GESTURE:l.length>=2&&(k.network=l[1]),j.event=p.SHARE_NETWORK_GESTURE;break;case p.SEND_GESTURE:l.length>=2&&(b=l[1].split(","),c=b.shift(),d=b.join(","),k.sender=c,k.recipient=d),j.event=p.SEND_GESTURE;break;case p.EMBED_GESTURE:j.event=p.EMBED_GESTURE;break;case p.LINK_GESTURE:j.event=p.LINK_GESTURE;break;case p.REPLAY_GESTURE:j.event=p.REPLAY_GESTURE;break;case p.END_CARD_OVERLAY:j.event=p.END_CARD_OVERLAY;break;case p.ERROR_OVERLAY:j.event=p.ERROR_OVERLAY;break;case p.RECOMMEND_NOW:l.length>=3?(k.mediaid=l[1],k.pid=l[2]):(k.mediaid="",k.pid=""),j.event=p.RECOMMEND_NOW;break;case p.RECOMMEND_NEXT:l.length>=3?(k.mediaid=l[1],k.pid=l[2]):(k.mediaid="",k.pid=""),j.event=p.RECOMMEND_NEXT;break;case p.RECOMMEND_CLOSE:j.event=p.RECOMMEND_CLOSE;break;default:return void uvpjs.warn(this.DEBUG_ID,"DWAgent _onUserGesture untrapped GESTURE Type = ",o)}this.debug&&(uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture ctag = ",j),uvpjs.log(this.DEBUG_ID,"DWAgent _onUserGesture gval = ",k)),this._sendDWEvent()},_updateTimeTags:function(){this._tags.content.medtime=this.trackingMgr.getContentPlayhead()},_getTagType:function(a){return e.has(this._tags.ad,a)?"ad":e.has(this._tags.content,a)?"content":void 0},_getStreamType:function(){var a=this.cviModel.getContentVideoState(),b=uvpjs.mediaCapabilities,c=a.deliveryType,d=a.isLive;return c===b.STREAMING?d?5:4:c===b.PROGRESSIVE?3:void 0},_getPlayerTime:function(){var a=this._agentStartTime,b=e.isDate(a)&&parseInt((new Date-a)/1e3)||0;return this.debug&&uvpjs.log(this.DEBUG_ID,"DWAgent _getPlayerTime nt",b),b},_getDefaultTagsObj:function(){return{ad:{adastid:0,adbreak:"",adid:0,adlength:0,adnum:0,adpod:0,adpodpos:0,adpos:"",adtime:0,adtitle:"",adtype:0},content:{bitrate:0,blockcntry:"",codec:"",componentid:"",contsessid:"",device:"",distntwrk:"",encodeprfl:"",event:"",eventdur:0,gestval:"",ip:"",mapp:"",medastid:0,medid:0,medlength:0,mednum:0,medrls:"",medtime:0,medtitle:"",medtype:0,mso:"",pageurl:"",part:"",playerembed:0,playersz:"",playertime:0,qosnum:0,recommend:"",relsessid:"",sdlvrytype:"",siteid:0,sponsored:"",srchost:"",subj:"",ts:"",ua:"",ursuid:0,usrbndwdth:0,v16:"",v17:"",v18:"",v19:"",v20:"",v21:"",v22:"",v23:"",v25:"",v26:"",videosz:"",volume:0}}},_getDefaultPageParamsObj:function(){return{asid:0,astid:0,cid:0,edid:0,onid:0,pguid:"",pid:0,ptid:0,siteid:0,testgroup:"",testname:"",testversion:"",ursuid:0,assetguid:0,omnicookie:"",pagetype:"",rsid:0,topicbrcrm:"",topicguid:"",viewguid:0}},_getDevice:function(){var a=uvpjs.mediaCapabilities,b=window.screen,c={type:(a.getDevice()||"").toLowerCase(),os:(a.getOS()||"").toLowerCase(),ver:a.getOSVersion(),screensz:[b.width,b.height].join("x")};return d(c)},_getPlayerSize:function(){var a=this.cviModel.getContentVideoState();return[a.sourceWidth,a.sourceHeight].join("x")}}),b=function(a,b,c){var d,f,g=[];for(d in a)a.hasOwnProperty(d)&&(f=e.isUndefined(a[d])?"":encodeURIComponent(a[d]),g.push([d,f].join(b)));return g.join(c)},c=function(a){return b(a,"=","&")},d=function(a){return b(a,":",";")}}(uvpjs.register("uvpjs")),function(a){var b;a._,a.AkamaiAnalyticsAgent=uvpjs.Class.subClass({debug:"prod"!==uvpjs.Configuration.env,CONFIG_FILE_PATH:"//ma61-r.analytics.edgekey.net/config/beacon-16339.xml?enableGenericAPI=1",AKAMAI_ANALYTICS_MODULE_NAME:"AkamaiQOSPluginJS",init:function(a){this.debug=uvpjs.debug,this.DEBUG_ID=uvpjs.DebugManager.configParams.TRACKING_MANAGER,this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent init"),this.trackingMgr=a.trackingMgr,this.cviModel=a.cviModel,this.eventsMgr=a.eventsMgr,this._moduleName=a.moduleName,this.buffering=!1,this.akamaiPlugin=null},destroy:function(){this.trackingMgr=null,this.eventsMgr=null,this.cviModel=null,this._moduleName=null,this.buffering=!1,this.akamaiPlugin=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent initialize"),this.buffering=!1,this._initializePlugin()},_setupEventCallbacks:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _setupEventCallbacks");var a=this.eventsMgr.eventTypes,b={};b[a.CONTENT_DATA_LOADED]=this._onContentDataLoaded.bind(this),b[a.AD_START]=this._onAdStart.bind(this),b[a.AD_END]=this._onAdEnd.bind(this),b[a.CONTENT_START]=this._onContentStart.bind(this),b[a.AD_QUARTILE]=this._onAdQuartile.bind(this),b[a.CONTENT_END]=this._onContentEnd.bind(this),b[a.CONTROL_PLAY]=this._onControlPlay.bind(this),b[a.CONTROL_PAUSE]=this._onControlPause.bind(this),b[a.VIDEO_STATE_CHANGE]=this._onVideoStateChange.bind(this),b[a.RESOURCE_END]=this._onResourceEnd.bind(this),b[a.QOS_METADATA]=this._onQosMetadata.bind(this),this.trackingMgr.registerEventCallbacks(b)},_initializePlugin:function(){var a={};if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _initializePlugin loadPlugin callback"),b())return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"AkamaiAnalyticsAgent SDK not properly loaded."));a.configPath=this.cviModel.getModuleParam(this._moduleName,"configpath")||this.CONFIG_FILE_PATH,a.streamHeadPosition=this.getStreamHeadPosition.bind(this),a.streamLength=this.getStreamLength.bind(this),a.streamURL=this.getStreamURL.bind(this),this.akamaiPlugin=new AkaHTML5MediaAnalytics(a),this._setupEventCallbacks()},setAdMetaData:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setAdMetaData");var a=this.cviModel.adVideoState,b={};b.adTitle=a.adVideoTitle,b.adDuration=a.duration,b.id=a.adVideoId,b.adPartnerId=this.cviModel.sessionOptions.partner,b.adServer=a.adServerName,this.akamaiPlugin.handleAdLoaded(b)},setContentMetaData:function(){var a=this.cviModel,b=a.sessionOptions,c=this.akamaiPlugin,d=a.getContentVideoState(),e=a.getContentPlaybackState();this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent setContentMetaData"),c.setData("viewerId",a.getModuleParam(this._moduleName,"viewerID")),c.setData("partnerId",b.partner),c.setData("playerId",this.trackingMgr.getPlayerName("|")),c.setData("Host",b.host),c.setData("Referrer",b.referrer),c.setData("title",d.title),c.setData("category",d.category),c.setData("subCategory",d.sourceOwner),c.setData("show",d.title),c.setData("contentLength",1e3*e.duration)},getStreamHeadPosition:function(){return this.cviModel.contentPlaybackState.currentTime},getStreamLength:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamLength this.cviModel.contentPlaybackState.duration ",this.cviModel.contentPlaybackState.duration),this.cviModel.contentPlaybackState.duration},getStreamURL:function(){return this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent getStreamURL this.cviModel.contentVideoState.assetURL ",this.cviModel.contentVideoState.assetURL),this.cviModel.contentVideoState.assetURL},_onContentDataLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentDataLoaded evtObj = ",a),this.akamaiPlugin&&(this.akamaiPlugin.handleSessionInit(),this.setContentMetaData())},_onAdStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdStart"),this.akamaiPlugin&&(this.setAdMetaData(),this.akamaiPlugin.handlePlaying(),this.akamaiPlugin.handleAdStarted())},_onAdQuartile:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdQuartile this.akamaiPlugin.handleAdFirstQuartile() evtObj.payload ",a.payload),this.akamaiPlugin&&a.payload)switch(a.payload.percent){case 25:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdFirstQuartile()"),this.akamaiPlugin.handleAdFirstQuartile();break;case 50:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdMidPoint()"),this.akamaiPlugin.handleAdMidPoint();break;case 75:this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent this.akamaiPlugin.handleAdThirdQuartile()"),this.akamaiPlugin.handleAdThirdQuartile()}},_onAdEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdEnd this.akamaiPlugin.handleAdCompleted()  this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdCompleted(),this.akamaiPlugin.handleAdStopped())},_onAdError:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onAdError this.akamaiPlugin.handleAdError() this.akamaiPlugin.handleAdStopped();"),this.akamaiPlugin&&(this.akamaiPlugin.handleAdError(),this.akamaiPlugin.handleAdStopped())},_onContentStart:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentStart"),this.akamaiPlugin&&this.akamaiPlugin.handlePlaying()},_onContentEnd:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onContentEnd")},_onControlPlay:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPlay this.akamaiPlugin.handleResume()"),this.akamaiPlugin&&this.akamaiPlugin.handleResume()},_onControlPause:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onControlPause  this.akamaiPlugin.handlePause()"),this.akamaiPlugin&&this.akamaiPlugin.handlePause()},_onVideoStateChange:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onVideoStateChange evtObj = ",a),this.akamaiPlugin){var b=a.payload.newState;b!==uvpjs.mediaCapabilities.BUFFERING||this.buffering||(this.buffering=!0,this.akamaiPlugin.handleBufferStart()),b===uvpjs.mediaCapabilities.PLAYING&&this.buffering&&(this.buffering=!1,this.akamaiPlugin.handleBufferEnd())}},_onResourceEnd:function(a){if(this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onResourceEnd evtObj = ",a),this.akamaiPlugin){this.akamaiPlugin.handlePlayEnd("Play.End.Detected")}},_onQosMetadata:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"AkamaiAnalyticsAgent _onQosMetadata evtObj = ",a);var b,c;if(this.akamaiPlugin&&-1!==a.payload.vendorArray.indexOf(uvpjs.Type.QOSVendor.AKAMAI)){c=a.payload.paramsObj;for(b in c)this.akamaiPlugin.setData(b,c[b])}}}),b=function(){return"undefined"==typeof AkaHTML5MediaAnalytics}}(uvpjs.register("uvpjs")),function(a){"use strict";var b=a._;a.MuxAgent=uvpjs.Class.subClass({MUX_AD_EVENTS:{AD_BREAK_START:"adbreakstart",AD_BREAK_END:"adbreakend",AD_PLAY:"adplay",AD_PLAYING:"adplaying",AD_PAUSE:"adpause",AD_ENDED:"adended",AD_ERROR:"aderror",AD_REQUEST:"adrequest",AD_RESPONSE:"adresponse",AD_FIRST_QUARTILE:"adfirstquartile",AD_MIDPOINT:"admidpoint",AD_THIRD_QUARTILE:"adthirdquartile"},MUX_EVENTS:{PAUSE:"pause",PLAY:"play",PLAYING:"playing"},MUX_DEFAULT_PROPERTY_KEY:"ec83cce4c209447a2af3d62f2",init:function(a){this.cviModel=a.cviModel,this.debug=this._isDebugEnabled(),this.DEBUG_ID=uvpjs.DebugManager.configParams.MUX_DEBUG,this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: construct",a),this.trackingMgr=a.trackingMgr,this.eventTypes=a.eventsMgr&&a.eventsMgr.eventTypes||null,this.moduleName=a.moduleName,this.playerName=a.playerName,this.playerVersion=a.playerVersion,this.useDefaultProperty=a.useDefaultProperty,this.moduleParams=null,this.vidContId=this.trackingMgr.vidContId,this.videoElement=null,this.muxMonitor=null,this.muxHLSJSMonitoring=!1,this.muxDashJSMonitoring=!1,this.muxShakaMonitoring=!1,this.mc=uvpjs.mediaCapabilities},destroy:function(){this.muxMonitor&&(this.muxHLSJSMonitoring?(this.muxHLSJSMonitoring=!1,this.muxMonitor.removeHLSJS()):this.muxDashJSMonitoring?(this.muxDashJSMonitoring=!1,this.muxMonitor.removeDashJS()):this.muxShakaMonitoring,this.muxMonitor.destroy()),this.trackingMgr=null,this.cviModel=null,this.eventTypes=null,this.moduleParams=null},initialize:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent initialize()"),this.moduleParams=this._gatherModuleParams(this.moduleName),this._initializePlugin()},_isDebugEnabled:function(){if(!this.cviModel)return uvpjs.debug;var a=this._gatherModuleParams(uvpjs.DebugManager.CONFIG_MODULE_NAME);return!!a&&!0===a[uvpjs.DebugManager.configParams.MUX_DEBUG]},_initializePlugin:function(){if(console.log("[MUX] _initializePlugin"),void 0===window.mux)return void(this.debug&&uvpjs.warn(this.DEBUG_ID,"MuxAgent _initializePlugin Mux SDK not properly loaded."));this.cviModel&&this._setupEventCallbacks()},_createMuxMonitor:function(){this.videoElement=document.getElementById("video_"+this.vidContId);var a=this.cviModel,c=this.moduleParams,d=b.assign({page_type:"",viewer_user_id:a.getSessionOption("userId"),experiment_name:c&&!uvpjs.util.isEmpty(c.experimentName)?c.experimentName:"",sub_property_id:!1!==this.useDefaultProperty||uvpjs.util.isEmpty(c.subPropertyId)?a.getSessionOption("partner"):c.subPropertyId,player_name:this.playerName,player_version:this.playerVersion,player_init_time:a.initTime},this._getMuxVideoData());return this.useDefaultProperty?d.property_key=this.MUX_DEFAULT_PROPERTY_KEY:d.property_key=c.propertyKey,window.mux.monitor(this.videoElement,{debug:this.debug,data:d}),this.videoElement.mux},_getMuxVideoData:function(){var a=this.cviModel.contentVideoState;return{video_id:this._validateStr(a.cmsRefGuid,""),video_title:this._validateStr(a.videoTitle,""),video_series:this._validateStr(a.seriesTitle,""),video_producer:"",video_content_type:a.episodeFlag?"episode":"clip",video_language_code:"",video_variant_name:"",video_variant_id:"",video_duration:a.duration,video_stream_type:a.isLive?"live":"on-demand",video_encoding_variant:"",video_cdn:this._validateStr(a.cdn,""),video_source_url:this._validateStr(a.assetURL,"")}},_emitMuxVideoChange:function(){window.mux.emit(this.videoElement,"videochange",this._getMuxVideoData())},_isValidStr:function(a){return uvpjs.util.isDefinedString(a)},_validateStr:function(a,b){return this._isValidStr(a)?a:b},_onContentEvent:function(a){a.type===this.eventTypes.CONTENT_DATA_LOADED&&(null===this.muxMonitor?(this.muxMonitor=this._createMuxMonitor(),null!==this.muxMonitor&&this.debug&&uvpjs.log(this.DEBUG_ID,"MuxAgent: created Mux monitor.")):this._emitMuxVideoChange())},_onPlaybackLibraryLoaded:function(a){if(this.muxMonitor)switch(a.payload.facadeType){case this.mc.HLSJS:this.muxHLSJSMonitoring||(this.muxHLSJSMonitoring=!0,this.muxMonitor.addHLSJS({hlsjs:a.payload.player,Hls:window.Hls}));break;case this.mc.DASHJS:this.muxDashJSMonitoring||(this.muxDashJSMonitoring=!0,this.muxMonitor.addDashJS({dashjs:a.payload.player}));break;case this.mc.SHAKA:this.muxShakaMonitoring}},_onError:function(a){var b=a.payload.errorInfo;b&&b.isFatal&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),window.mux.emit(this.videoElement,"error",{player_error_code:b.errorCode,player_error_message:b.message}))},_gatherModuleParams:function(a){var b,c=this.cviModel,d=c.getModule(a),e=d.params,f={};if(!e)return null;for(var g=e.length;g--;)b=e[g],f[b.name]=b.value;return f},_setupEventCallbacks:function(){var a=this.eventTypes,b={},c=this._onContentEvent.bind(this),d=this._onPlaybackLibraryLoaded.bind(this),e=this._onError.bind(this),f=this._onAdEvent.bind(this);b[a.CONTENT_DATA_LOADED]=c,b[a.PLAYBACK_LIBRARY_LOADED]=d,b[a.PLAYER_START_ERROR]=e,b[a.VIDEO_START_ERROR]=e,b[a.VIDEO_PLAYBACK_ERROR]=e,b[a.AD_ERROR]=e,b[a.AD_PLUGIN_CONTENT_PAUSE_REQUEST]=f,b[a.AD_PLUGIN_CONTENT_RESUME_REQUEST]=f,b[a.AD_LOADED]=f,b[a.AD_START]=f,b[a.VIDEO_STATE_CHANGE]=f,b[a.AD_SKIPPED]=f,b[a.AD_END]=f,b[a.AD_ERROR]=f,b[a.AD_REQUEST]=f,b[a.AD_RESPONSE]=f,b[a.AD_QUARTILE]=f,this.trackingMgr.registerEventCallbacks(b)},_getMuxAdData:function(a){var b=a.payload.adData?a.payload.adData.adAssetUrl:a.payload.adAssetUrl;return{ad_tag_url:a.payload.adCallUrl,ad_asset_url:b}},_dispatchMuxAdEvent:function(a,b){a&&(null===this.muxMonitor&&(this.muxMonitor=this._createMuxMonitor()),b||(b={ad_tag_url:"",ad_asset_url:""}),b.ad_tag_url||(b.ad_tag_url=""),b.ad_asset_url||(b.ad_asset_url=""),window.mux.emit(this.videoElement,a,b))},_dispatchMuxEvent:function(a){window.mux.emit(this.videoElement,a)},_onAdEvent:function(a){var b=this.eventTypes,c=this.MUX_AD_EVENTS,d=this.MUX_EVENTS;switch(a.type){case b.AD_PLUGIN_CONTENT_PAUSE_REQUEST:this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&this._dispatchMuxEvent(d.PAUSE),this._dispatchMuxAdEvent(c.AD_BREAK_START);break;case b.AD_PLUGIN_CONTENT_RESUME_REQUEST:this._dispatchMuxAdEvent(c.AD_BREAK_END),this.cviModel.contentPlaybackState.playbackState===uvpjs.mediaCapabilities.PLAYING&&(this._dispatchMuxEvent(d.PLAY),this._dispatchMuxEvent(d.PLAYING));break;case b.AD_LOADED:this._dispatchMuxAdEvent(c.AD_PLAY,this._getMuxAdData(a));break;case b.AD_START:this._dispatchMuxAdEvent(c.AD_PLAYING,this._getMuxAdData(a));break;case b.VIDEO_STATE_CHANGE:if(!a.payload.isAd)return;var e=a.payload.newState,f=a.payload.currentState;e===this.mc.PAUSED?this._dispatchMuxAdEvent(c.AD_PAUSE,this._getMuxAdData(a)):f==this.mc.PAUSED&&e===this.mc.PLAYING&&(this._dispatchMuxAdEvent(c.AD_PLAY,this._getMuxAdData(a)),this._dispatchMuxAdEvent(c.AD_PLAYING,this._getMuxAdData(a)));break;case b.AD_SKIPPED:case b.AD_END:this._dispatchMuxAdEvent(c.AD_ENDED,this._getMuxAdData(a));break;case b.AD_ERROR:this._dispatchMuxAdEvent(c.AD_ERROR,this._getMuxAdData(a));break;case b.AD_REQUEST:this._dispatchMuxAdEvent(c.AD_REQUEST,this._getMuxAdData(a));break;case b.AD_RESPONSE:this._dispatchMuxAdEvent(c.AD_RESPONSE,this._getMuxAdData(a));break;case b.AD_QUARTILE:switch(a.payload.percent){case 25:this._dispatchMuxAdEvent(c.AD_FIRST_QUARTILE,this._getMuxAdData(a));break;case 50:this._dispatchMuxAdEvent(c.AD_MIDPOINT,this._getMuxAdData(a));break;case 75:this._dispatchMuxAdEvent(c.AD_THIRD_QUARTILE,this._getMuxAdData(a))}}}})}(uvpjs.register("uvpjs")),function(a){a.OzTamAgent=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.TRACKING_MANAGER,debug:"prod"!==uvpjs.Configuration.env,options:null,ozTamService:null,ozTamVo:null,mediaInfo:null,isStopped:!1,resumeTime:-1,init:function(a){this.options=a,this.ozTamVo=new uvpjs.OzTamVo(this);var b=this.ozTamVo.getConfig();this.ozTamService=new OzTAMService(b.publisherId,b.vendorVersion,b.productionMode,b.verboseLogging,b.useHTTPS),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService",b,this.ozTamService)},initialize:function(){var a=this.options.eventsMgr.eventTypes,b=this.onVideoEvent.bind(this),c={};c[a.RESOURCE_START]=b,c[a.CONTENT_START]=b,c[a.CONTROL_SEEK]=b,c[a.SEEK_DONE]=b,c[a.CONTENT_END]=b,c[a.VIDEO_STATE_CHANGE]=b,c[a.VIDEO_PROGRESS]=b,c[a.USER_GESTURE]=b,this.options.trackingMgr.registerEventCallbacks(c)},onVideoEvent:function(a){var b=this.options.eventsMgr.eventTypes;if(this.ozTamVo.isOzTamOptOut())return void(this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService Opt-out"));switch(a.type){case b.RESOURCE_START:this.onResourceStart(a);break;case b.CONTENT_START:this.onContentStart(a);break;case b.CONTROL_SEEK:this.onSeekStart(a);break;case b.SEEK_DONE:this.onSeekDone(a);break;case b.CONTENT_END:this.onContentEnd(a);break;case b.VIDEO_STATE_CHANGE:this.onVideoStateChange(a);break;case b.VIDEO_PROGRESS:this.onVideoProgress(a);break;case b.USER_GESTURE:this.onUserGesture(a)}},onResourceStart:function(a){this.mediaInfo=this.ozTamVo.getMediaInfo(),this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.startSession",this.mediaInfo),this.ozTamService.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},onContentStart:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"ozTamService.beginPlayback"),this.mediaInfo.properties=this.ozTamVo.getPropertyDictionary(),this.ozTamService.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.mediaInfo.properties,this.mediaInfo.mediaType)},onSeekStart:function(a){this.ozTamService.seekBegin()},onSeekDone:function(a){this.ozTamService.seekComplete(),this.isStopped=!0},onContentEnd:function(a){this.ozTamService.complete()},onVideoStateChange:function(a){if(this.options.cviModel.getCurrentPlaybackState().playbackStarted)switch(a.payload.newState){case uvpjs.mediaCapabilities.PAUSED:case uvpjs.mediaCapabilities.BUFFERING:this.isStopped||(this.isStopped=!0,this.ozTamService.haltProgress())}},onVideoProgress:function(a){this.isStopped&&(this.isStopped=!1,this.ozTamService.resumeProgress())},onUserGesture:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"startTime",a.payload.startTime),a.payload.startTime>0&&(this.resumeTime=a.payload.startTime)},destroy:function(){this.ozTamVo.destroy(),this.DEBUG_ID=null,this.options=null,this.ozTamService=null,this.ozTamVo=null,this.mediaInfo=null}})}(uvpjs.register("uvpjs")),function(a){a.DatazoomAgent=uvpjs.TrackingAgent.subClass({metadata:{},init:function(a){this._super(a),this.vo=new uvpjs.DatazoomVo(this),this.sdkEvent=this.vo.Event,this.metadata={},(new uvpjs.CodeLoader).loadScript(this.vo.sdkUrl,this.onSdkReady.bind(this))},onSdkReady:function(){this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent SDK Ready"),this.hasSdk="function"==typeof window.setDatazoomMetadata},sendTrackEvent:function(a,b){if(this.hasSdk){this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent "+a),b=b||{};for(var c in b)this.metadata[c]=b[c];switch(a){case"content_start":window.setDatazoomMetadata(this.format(this.metadata));break;case"cdn_updated":window.generateDatazoomEvent("CDNChange",this.format(b));break;case"content_complete":this.metadata={}}}},format:function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c)&&a[c]&&"object"!=typeof a[c]){var d={};d[c]=a[c],b.push(d)}return this.debug&&uvpjs.log(this.DEBUG_ID,"DatazoomAgent",b),b}})}(uvpjs.register("uvpjs")),function(a){a.DataModelVo=uvpjs.Class.subClass({agent:null,channelName:null,apiKey:null,contentInfo:{},getApiKey:function(){return this.apiKey},getPersistentData:function(a){var b=this.agent.options.cviModel,c=b&&b.getContentVideoState(),d=this.agent.contextMetadata,a=a||{};a.sessionId=b&&b.sessionId,a.contentAssetId=c&&(c.cmsRefGuid||c.mediaId)||"",a.playheadTime=a.playheadTime||this.getPlayhead(),a.playerTime=this.getPlayerElapsedTime();for(var e in d)d.hasOwnProperty(e)&&(a[e]=d[e]);return a},getSessionStartInfo:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState(),c=b.duration,d=a.contentPlaybackState.facadeState,e=b.isLive?-1:isNaN(c)?0:c,f=this.getDrmInfo(b.drm);return this.getPersistentData({adAssetId:a.adVideoState.adClipID,adPodId:a.adVideoState.adVideoId||a.adVideoState.adVatId,adType:a.adVideoState.adType,allowConcurrentPlayback:a.sessionOptions.allowConcurrentPlayback,bitrate:d.currentBitrate,channel:this.channelName,cdn:b.cdn,cms:a.sessionOptions.cms,currentIndex:1,"drm.dash.playreadyURL":f.playreadyURL,"drm.dash.widevineURL":f.widevineURL,"drm.enabled":f.enabled,"drm.fairplay.appCertURL":f.appCertURL,"drm.ticket":f.ticket,drmType:this.agent.options.trackingMgr.mc.getDrmType(b.drm),enableMutedAutoplay:a.sessionOptions.enableMutedAutoplay,enableNativeMobileAutoplay:a.sessionOptions.enableNativeMobileAutoplay,enableReplay:a.sessionOptions.enableReplay,enableUnmutedAutoplay:a.sessionOptions.enableUnmutedAutoplay,framerate:d.playbackFramerate,fullScreen:a.isFullscreen,isAutoplay:a.isAutoplay,isMultiCDN:a.cviMgr.RPM.currRP.facade.multiCDNEnabled,isMuteAtPlayStart:a.isMuteAtPlayStart,isMuted:b.isMuted,isSslRequired:window.location.href.search(/^https/)>-1,length:e,livestream:b.isLive,liveSyncDurationCount:a.sessionOptions.liveSyncDurationCount,maxBitrate:a.maxBitrate,method:"",minBitrate:a.minBitrate,pageProvidesTealium:a.sessionOptions.usesTealium,pagetype:a.dwPageParams.pagetype,partner:a.sessionOptions.partner,pguid:a.dwPageParams.pguid,playerName:this.agent.options.playerName,quality:"",sound:a.volume,startTime:b.startTime,streamType:b.isLive?"Live":"VOD",title:b.videoTitle,totalLength:e,usesIMA:a.sessionOptions.usesIMA,userConnectionType:a.sessionOptions.userConnectionType,userCountry:a.sessionOptions.userCountry,userIsp:a.sessionOptions.userISP,userPpid:a.sessionOptions.userPPID,userStatus:a.sessionOptions.userStatus,videoPlayer:this.agent.options.playerName})},getContentStartInfo:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState(),c=b.duration,d=a.contentPlaybackState.facadeState,e=b.isLive?-1:isNaN(c)?0:c;return this.contentInfo={assetUrl:b.assetURL,assetId:b.cmsRefGuid||b.mediaId,category:b.category,channel:this.channelName,chapterStartTimes:b.chapterStartTimes.join(","),closedCaptionPath:b.closedCaptionPath,cms:a.sessionOptions.cms,cmsRefGuid:b.cmsRefGuid,dfpMediaId:b.dfpMediaId,duration:e,episodeAbstract:b.episodeAbstract,episodeFlag:b.episodeFlag,episode:b.episodeNumber,excludeNielsenTracking:b.excludeNielsenTracking,fileType:b.fileType,genre:b.category,indexPosition:a.contentPlaybackState.currentContentSegment,is360:b.is360,isAffiliateFeed:b.isAffiliateFeed,isEmbedable:b.isEmbedable,isPaidContent:b.isPaidContent,mediaId:b.mediaId,overrideAssetURL:b.overrideAssetURL,program:b.videoTitle.split("-")[0],pguid:a.dwPageParams.pguid,playbackBitrate:d.currentBitrate,playheadTime:this.getContentStartPlayhead(),season:b.seasonNumber,seriesTitle:b.seriesTitle,showPreroll:b.showPreroll,startTime:b.startTime,useWatermark:b.useWatermark,title:b.videoTitle,totalLength:e},this.getPersistentData(this.contentInfo)},getContentCompleteInfo:function(){var a=this.agent.options.cviModel;return this.contentInfo.playbackBitrate=a.contentPlaybackState.facadeState.currentBitrate,this.getPersistentData(this.contentInfo)},getQuartileInfo:function(){var a=this.agent.options.cviModel;a.getContentVideoState();return this.getPersistentData()},getQosInfo:function(){var a=this.agent.options.cviModel,b=a.contentPlaybackState,c=a.contentPlaybackState.facadeState;return this.getPersistentData({averageDroppedFPS:b.averageDroppedFPS,bufferLength:b.bufferLength,currentContentSegment:b.currentContentSegment,currentMaxBandwidth:b.currentMaxBandwidth,currentTime:this.getPlayhead(),currentBitrate:c.currentBitrate,droppedFPS:c.droppedFPS,droppedFrames:c.droppedFrames,playbackFramerate:c.playbackFramerate})},getAdBreakInfo:function(){var a=this.agent.options.cviModel,b=a.adVideoState,c=b.adClipID.split("_"),d=1;return"post"===b.adType?d=a.getNumberOfAdPods():"mid"===b.adType&&(d=parseInt(c[1])+1),this.getPersistentData({indexPosition:d,startTime:this.getPlayhead(),title:b.adVideoTitle})},getAdItemInfo:function(){var a=this.agent.options.cviModel.adVideoState;return this.getPersistentData({adCallUrl:a.assetURL||a.adAssetUrl||a.adVideoUrl,adParams:a.adParameters,assetId:a.adVideoId||a.adVatId,indexPosition:a.adPosition,isCustomClickTrackingUsed:a.isCustomClickTrackingUsed,title:a.adVideoTitle,totalLength:a.duration})},getSeekInfo:function(){return this.getPersistentData({seekPosition:this.getPlayhead()})},getPlayhead:function(){return Math.floor(this.agent.options.cviModel.getCurrentPlaybackState().currentTime)},getContentStartPlayhead:function(){var a=this.getPlayhead();return this.agent.options.resumeTime&&this.agent.options.resumeTime>0&&(a=this.agent.options.resumeTime,this.agent.options.resumeTime=-1),a},getPlayerElapsedTime:function(){return parseInt((new Date-this.agent.initTime)/1e3)},getDrmInfo:function(a){return{playreadyURL:a.dash&&a.dash.playreadyURL?a.dash.playreadyURL:"",widevineURL:a.dash&&a.dash.widevineURL?a.dash.widevineURL:"",appCertURL:a.fairplay&&a.fairplay.appCertURL?a.fairplay.appCertURL:"",enabled:a.enabled||!1,ticket:a.ticket||""}},isCompletedMarker:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState();return!b.isLive&&this.getPlayhead()>=.95*b.duration},destroy:function(){this.Event=null,this.agent=null,this.channelName=null,this.apiKey=null}})}(uvpjs.register("uvpjs")),function(a){a.DatazoomVo=uvpjs.DataModelVo.subClass({Event:{SESSION_START:"session_start",CONTENT_START:"content_start",CONTENT_COMPLETE:"content_complete",CDN_UPDATED:"cdn_updated",PAUSE:"pause",STOP:"stop",BUFFER_START:"buffer_start",BUFFER_COMPLETE:"buffer_complete",SEEK_START:"seek_start",SEEK_COMPLETE:"seek_complete",PLAY_RESUME:"resume",SESSION_END:"session_end",AD_BREAK_START:"ad_break_start",AD_BREAK_COMPLETE:"ad_break_end",AD_START:"ad_start",AD_COMPLETE:"ad_end",AD_CLICK:"ad_click",QOS:"qos",FIRST_QUARTILE:"first_quartile",MID_QUARTILE:"mid_quartile",THIRD_QUARTILE:"third_quartile"},sdkUrl:"//platform.datazoom.io/beacon/v1/config?configuration_id=",init:function(a){this.agent=a;var b=this.agent.options;this.getModuleParam=b.cviModel.getModuleParam.bind(b.cviModel,b.trackingMgr.DATAZOOM_MODULE_NAME),this.sdkUrl+=this.getModuleParam("configId")}})}(uvpjs.register("uvpjs")),function(a){a.OzTamVo=uvpjs.Class.subClass({agent:null,init:function(a){this.agent=a;var b=this.agent.options;this.getModuleParam=b.cviModel.getModuleParam.bind(b.cviModel,b.trackingMgr.OZTAM_MODULE_NAME)},getConfig:function(){return{publisherId:this.getModuleParam("publisherId"),vendorVersion:this.getVendorVersion(),productionMode:!this.agent.debug,verboseLogging:this.agent.debug,useHTTPS:top.location.href.search(/^https/)>-1}},getVendorVersion:function(){return[this.getModuleParam("platform"),uvpjs.mediaCapabilities.isMobile()?"Mobile-Web":"Desktop-Web",this.agent.options.playerVersion].join("_")},getMediaInfo:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState(),c=b.duration,d=function(){var b=a.getCurrentPlaybackState().currentTime;return this.agent.resumeTime>0&&(b=this.agent.resumeTime,this.agent.resumeTime=-1),b}.bind(this);return{mediaId:b.ozTamMediaId||b.cmsRefGuid||b.mediaId,url:b.assetURL,mediaDuration:b.isLive?-1:isNaN(c)?0:c,mediaType:b.isLive?"live":"vod",mediaPositionFunction:function(){return d()}}},getPropertyDictionary:function(){var a=this.agent.options.cviModel,b=a.getContentVideoState(),c=a.getSessionOption("userId"),d=this.agent.ozTamService,e={};return b.ozTamMediaId&&(e[d.PROP_ALT_MEDIA_ID]=b.cmsRefGuid||b.mediaId),c&&(e[d.PROP_DEMO1]=c),e},isOzTamOptOut:function(){var a=this.agent.options.cviModel.getContentVideoState();return a.hasOwnProperty("ozTamOptOut")&&a.ozTamOptOut},getValue:function(a){return a.toString().replace(/^\s|\s$/gm,"")||""},destroy:function(){this.agent=null}})}(uvpjs.register("uvpjs")),function(a){var b={concurrencyBeacon:{prodUrl:"",stageUrl:"",path:""}},c=!1,d=null,e=null,f=function(a){return a=a.replace(/\s/g,""),a.search(/^\/\//)>-1?a:"//"+a};a.BeaconBuilder=uvpjs.Class.subClass({concurrencyBeacon:function(a){return e=b.concurrencyBeacon,a&&a.prodUrl&&a.stageUrl&&(e.prodUrl=f(a.prodUrl),e.stageUrl=f(a.stageUrl)),this},queryParams:function(b){return d=a.util.queryStrFromObj(b,!1),this},devMode:function(a){return c=a,this},buildUrl:function(){return null===e?"Unable to build url.":(c?e.stageUrl:e.prodUrl)+e.path+(null===d?"":"?"+d)}})}(uvpjs.register("uvpjs")),function(a){var b=a._;a.FairPlayDRM=uvpjs.Class.subClass({DEBUG_ID:uvpjs.DebugManager.configParams.FAIRPLAY_DRM,DRM_VENDORS:{IRDETO:"irdeto",DRMTODAY:"drmtoday"},KEY_SYSTEMS:{FPS_1_0:"com.apple.fps.1_0"},init:function(a){this.debug=uvpjs.debug,this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Init"),this.drm=a.drm,this.videoTagRef=a.videoTagRef,this.eventTypes=a.eventTypes,this.errorCallback=a.errorCallback,this.drmVendor=null,this.appCertData=null,this.appCertLoaded=!1,this.webKitNeedKeyCalled=!1,this.initData=null,this.loadAppCert(),this.addEvents()},destroy:function(){this.removeEvents(),this.drm=null,this.videoTagRef=null,this.eventTypes=null,this.errorCallback=null,this.appCertData=null,this.initData=null},addEvents:function(){this.onWebKitNeedKeyBound=this.onWebKitNeedKey.bind(this),this.videoTagRef.addEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1)},removeEvents:function(){this.videoTagRef.removeEventListener(this.eventTypes.HTML5.WEBKIT_NEED_KEY,this.onWebKitNeedKeyBound,!1),this.onWebKitNeedKeyBound=null},initializeFairPlayCDM:function(){var a=this.getLicenseServerUrl(this.initData),b=this.getId(a);if(this.drmVendor=this.getDRMVendor(a),!b)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_NO_CONTENTID,null);if(!this.videoTagRef.webkitKeys){var c=this.KEY_SYSTEMS.FPS_1_0;if(!WebKitMediaKeys.isTypeSupported(c,"video/mp4"))return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_KEYSYSTEM_NOT_SUPPORTED,null);this.videoTagRef.webkitSetMediaKeys(new WebKitMediaKeys(c))}if(!this.videoTagRef.webkitKeys)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_MEDIAKEYS,null);var d=this.concatInitDataIdAndCertificate(this.initData,b,this.appCertData),e=this.videoTagRef.webkitKeys.createSession("video/mp4",d);if(!e)return void this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_CREATE_SESSION,null);e.contentId=b,e.addEventListener("webkitkeymessage",this.onLicenseRequestReady.bind(this,a),!1),e.addEventListener("webkitkeyadded",this.onKeyAdded.bind(this),!1),e.addEventListener("webkitkeyerror",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_KEY_ERROR),!1)},loadAppCert:function(){b.isEmpty(this.drm.fairplay.appCertURL)||(new uvpjs.CodeLoader).loadArrayBuffer(this.drm.fairplay.appCertURL,this.onAppCertLoaded.bind(this),this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_APP_CERT_LOAD))},onAppCertLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM Application certificate has loaded successfully!",a),this.appCertData=new Uint8Array(a.response),this.appCertLoaded=!0,this.webKitNeedKeyCalled&&this.initializeFairPlayCDM()},onWebKitNeedKey:function(a){this.webKitNeedKeyCalled=!0,this.initData=a.initData,this.appCertLoaded&&this.initializeFairPlayCDM()},concatInitDataIdAndCertificate:function(a,b,c){"string"==typeof b&&(b=this.stringToArray(b));var d=0,e=new ArrayBuffer(a.byteLength+4+b.byteLength+4+c.byteLength),f=new DataView(e);new Uint8Array(e,d,a.byteLength).set(a),d+=a.byteLength,f.setUint32(d,b.byteLength,!0),d+=4;var g=new Uint8Array(e,d,b.byteLength);return g.set(b),d+=g.byteLength,f.setUint32(d,c.byteLength,!0),d+=4,new Uint8Array(e,d,c.byteLength).set(c),new Uint8Array(e,0,e.byteLength)},onLicenseRequestReady:function(a,b){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM ready to load license request - url: "+a,b);var c=new XMLHttpRequest;c.session=b.target,c.addEventListener("load",this.onLicenseRequestLoaded.bind(this),!1),c.addEventListener("error",this.onError.bind(this,uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_REQUEST),!1),c.open("POST",a,!0),this.drmVendor===this.DRM_VENDORS.IRDETO?c.responseType="arraybuffer":this.drmVendor===this.DRM_VENDORS.DRMTODAY&&(c.responseType="text");var d=encodeURIComponent(this.base64EncodeUint8Array(b.message)),e="spc="+d+"&"+c.session.contentId;c=this.setRequestHeaders(c),c.send(e)},onLicenseRequestLoaded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM license request has loaded!",a);var c=a.target,d=c.session,e=null;b.inRange(c.status,200,400)||this.onError(uvpjs.ErrorInfo.messages.FAIRPLAY_LIC_RESPONSE_CODE,a),this.drmVendor===this.DRM_VENDORS.DRMTODAY?e=this.base64DecodeUint8Array(c.responseText):this.drmVendor===this.DRM_VENDORS.IRDETO&&(e=new Uint8Array(c.response)),d.update(e)},onError:function(a,b){this.debug&&uvpjs.error(this.DEBUG_ID,a,b),this.errorCallback&&this.errorCallback(uvpjs.ErrorInfo.errorCodes.FAIRPLAY_LIC_ERROR,a)},onKeyAdded:function(a){this.debug&&uvpjs.log(this.DEBUG_ID,"FairPlayDRM key was added successfully!",a)},getLicenseServerUrl:function(a){var c=null;if(b.isEmpty(this.drm.fairplay.licenseURL)){c="https://"+String.fromCharCode.apply(null,new Uint16Array(a.buffer)).split("://")[1]}else c=this.drm.fairplay.licenseURL;return this.appendDRMQueryParams(c)},appendDRMQueryParams:function(a){var b=-1===a.indexOf("?")?"?":"&";return this.drm.sessionId&&(a+=b+"SessionId="+this.drm.sessionId),this.drm.ticket&&(a+="&Ticket="+this.drm.ticket),a},getDRMVendor:function(a){var b=null;return-1!==a.indexOf(this.DRM_VENDORS.DRMTODAY)?b=this.DRM_VENDORS.DRMTODAY:-1!==a.indexOf(this.DRM_VENDORS.IRDETO)&&(b=this.DRM_VENDORS.IRDETO),b},setRequestHeaders:function(a){if(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),!b.isEmpty(this.drm.fairplay.header)){var c=this.drm.fairplay.header;for(var d in c)a.setRequestHeader(d,c[d])}return a},getId:function(a){var b=uvpjs.util.objFromQueryStr(a);return b.ContentId||b.contentId||b.assetId||null},base64EncodeUint8Array:function(a){var b=String.fromCharCode.apply(null,a);return btoa(b)},base64DecodeUint8Array:function(a){var b=window.atob(a),c=b.length,d=new Uint8Array(new ArrayBuffer(c));for(i=0;i<c;i++)d[i]=b.charCodeAt(i);return d},stringToArray:function(a){for(var b=new ArrayBuffer(2*a.length),c=new Uint16Array(b),d=0,e=a.length;d<e;d++)c[d]=a.charCodeAt(d);return c}})}(uvpjs.register("uvpjs"))}();
})();